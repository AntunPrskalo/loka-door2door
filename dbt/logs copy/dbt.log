

============================== 2023-02-03 16:39:55.546728 | 7c1f47ea-7d5a-47d6-8a04-a9a3a058db85 ==============================
[0m16:39:55.546728 [info ] [MainThread]: Running with dbt=1.3.1
[0m16:39:55.547773 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'config_dir': False, 'which': 'debug', 'indirect_selection': 'eager'}
[0m16:39:55.547773 [debug] [MainThread]: Tracking: tracking
[0m16:39:55.579732 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000242FEDA1910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000242FEDB5D60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000242FEDB5700>]}
[0m16:39:56.561875 [debug] [MainThread]: Executing "git --help"
[0m16:39:56.605880 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m16:39:56.605880 [debug] [MainThread]: STDERR: "b''"
[0m16:39:56.611122 [debug] [MainThread]: Acquiring new snowflake connection "debug"
[0m16:39:56.612136 [debug] [MainThread]: Using snowflake connection "debug"
[0m16:39:56.612136 [debug] [MainThread]: On debug: select 1 as id
[0m16:39:56.612136 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:41:16.695995 [debug] [MainThread]: Flushing usage events
[0m16:41:17.063057 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m16:41:17.064056 [info ] [MainThread]: ctrl-c


============================== 2023-02-03 16:42:26.727221 | 56728027-12e5-4824-a539-69a0d93f75b8 ==============================
[0m16:42:26.727221 [info ] [MainThread]: Running with dbt=1.3.1
[0m16:42:26.728223 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'config_dir': False, 'which': 'debug', 'indirect_selection': 'eager'}
[0m16:42:26.728223 [debug] [MainThread]: Tracking: tracking
[0m16:42:26.760223 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001759C001D00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001759C001F70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001759C001AF0>]}
[0m16:42:27.718228 [debug] [MainThread]: Executing "git --help"
[0m16:42:27.764986 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m16:42:27.764986 [debug] [MainThread]: STDERR: "b''"
[0m16:42:27.769000 [debug] [MainThread]: Acquiring new snowflake connection "debug"
[0m16:42:27.769000 [debug] [MainThread]: Using snowflake connection "debug"
[0m16:42:27.769999 [debug] [MainThread]: On debug: select 1 as id
[0m16:42:27.769999 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:42:49.222607 [debug] [MainThread]: Flushing usage events
[0m16:42:49.561700 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m16:42:49.561700 [info ] [MainThread]: ctrl-c


============================== 2023-02-03 16:43:07.369688 | 5349fc98-30ce-4c40-b9a5-86da3aab6102 ==============================
[0m16:43:07.369688 [info ] [MainThread]: Running with dbt=1.3.1
[0m16:43:07.370650 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'config_dir': False, 'which': 'debug', 'indirect_selection': 'eager'}
[0m16:43:07.370650 [debug] [MainThread]: Tracking: tracking
[0m16:43:07.402663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CEB7CD1430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CEB7CD1B20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CEB7CD1D90>]}
[0m16:43:08.351093 [debug] [MainThread]: Executing "git --help"
[0m16:43:08.398119 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m16:43:08.399094 [debug] [MainThread]: STDERR: "b''"
[0m16:43:08.403828 [debug] [MainThread]: Acquiring new snowflake connection "debug"
[0m16:43:08.404839 [debug] [MainThread]: Using snowflake connection "debug"
[0m16:43:08.404839 [debug] [MainThread]: On debug: select 1 as id
[0m16:43:08.405838 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:43:15.591187 [debug] [MainThread]: Flushing usage events
[0m16:43:15.885194 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m16:43:15.885194 [info ] [MainThread]: ctrl-c


============================== 2023-02-03 16:43:29.205193 | 4c1fe092-29ad-4479-8212-45b440ad92ae ==============================
[0m16:43:29.205193 [info ] [MainThread]: Running with dbt=1.3.1
[0m16:43:29.206371 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'config_dir': False, 'which': 'debug', 'indirect_selection': 'eager'}
[0m16:43:29.206371 [debug] [MainThread]: Tracking: tracking
[0m16:43:29.237620 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024AB5111D00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024AB5111F70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024AB5111AF0>]}
[0m16:43:30.334582 [debug] [MainThread]: Executing "git --help"
[0m16:43:30.394584 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m16:43:30.395585 [debug] [MainThread]: STDERR: "b''"
[0m16:43:30.398600 [debug] [MainThread]: Acquiring new snowflake connection "debug"
[0m16:43:30.399590 [debug] [MainThread]: Using snowflake connection "debug"
[0m16:43:30.400619 [debug] [MainThread]: On debug: select 1 as id
[0m16:43:30.400619 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:45:46.876784 [debug] [MainThread]: Snowflake adapter: Error running SQL: select 1 as id
[0m16:45:46.876784 [debug] [MainThread]: Snowflake adapter: Rolling back transaction.
[0m16:45:46.877786 [debug] [MainThread]: On debug: No close available on handle
[0m16:45:46.879798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024AC61F24F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024AC6222B80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024AC6222EE0>]}
[0m16:45:46.880786 [debug] [MainThread]: Flushing usage events
[0m16:45:47.525786 [debug] [MainThread]: Connection 'debug' was properly closed.


============================== 2023-02-03 16:47:23.870931 | cc75a40e-e303-4020-b5ee-b0fb255fd6c7 ==============================
[0m16:47:23.870931 [info ] [MainThread]: Running with dbt=1.3.1
[0m16:47:23.871933 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'config_dir': False, 'which': 'debug', 'indirect_selection': 'eager'}
[0m16:47:23.871933 [debug] [MainThread]: Tracking: tracking
[0m16:47:23.904966 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC6C1B1CD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC6C1C5BB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC6C1C5AF0>]}
[0m16:47:24.879595 [debug] [MainThread]: Executing "git --help"
[0m16:47:24.926583 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m16:47:24.927587 [debug] [MainThread]: STDERR: "b''"
[0m16:47:24.930581 [debug] [MainThread]: Acquiring new snowflake connection "debug"
[0m16:47:24.931582 [debug] [MainThread]: Using snowflake connection "debug"
[0m16:47:24.931582 [debug] [MainThread]: On debug: select 1 as id
[0m16:47:24.932584 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:47:25.833872 [debug] [MainThread]: SQL status: SUCCESS 1 in 0.9 seconds
[0m16:47:25.834869 [debug] [MainThread]: On debug: Close
[0m16:47:25.968754 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC7D2C3C10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC7D2773D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC7D277310>]}
[0m16:47:25.968754 [debug] [MainThread]: Flushing usage events
[0m16:47:26.601641 [debug] [MainThread]: Connection 'debug' was properly closed.


============================== 2023-02-03 17:05:37.330270 | 5d135baf-977f-45d2-99e7-3ca543d62bb4 ==============================
[0m17:05:37.330270 [info ] [MainThread]: Running with dbt=1.3.1
[0m17:05:37.331291 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m17:05:37.331291 [debug] [MainThread]: Tracking: tracking
[0m17:05:37.332270 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022148B43AF0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022148B43B50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022148B43BB0>]}
[0m17:05:37.343270 [info ] [MainThread]: Partial parse save file not found. Starting full parse.
[0m17:05:37.344270 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '5d135baf-977f-45d2-99e7-3ca543d62bb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022148B658B0>]}
[0m17:05:37.432504 [debug] [MainThread]: Parsing macros\adapters.sql
[0m17:05:37.475506 [debug] [MainThread]: Parsing macros\apply_grants.sql
[0m17:05:37.477507 [debug] [MainThread]: Parsing macros\catalog.sql
[0m17:05:37.479506 [debug] [MainThread]: Parsing macros\materializations\incremental.sql
[0m17:05:37.492506 [debug] [MainThread]: Parsing macros\materializations\merge.sql
[0m17:05:37.497506 [debug] [MainThread]: Parsing macros\materializations\seed.sql
[0m17:05:37.502505 [debug] [MainThread]: Parsing macros\materializations\snapshot.sql
[0m17:05:37.503506 [debug] [MainThread]: Parsing macros\materializations\table.sql
[0m17:05:37.508505 [debug] [MainThread]: Parsing macros\materializations\test.sql
[0m17:05:37.509506 [debug] [MainThread]: Parsing macros\materializations\view.sql
[0m17:05:37.511505 [debug] [MainThread]: Parsing macros\utils\array_construct.sql
[0m17:05:37.511505 [debug] [MainThread]: Parsing macros\utils\bool_or.sql
[0m17:05:37.512505 [debug] [MainThread]: Parsing macros\utils\escape_single_quotes.sql
[0m17:05:37.513506 [debug] [MainThread]: Parsing macros\utils\right.sql
[0m17:05:37.513506 [debug] [MainThread]: Parsing macros\utils\safe_cast.sql
[0m17:05:37.514505 [debug] [MainThread]: Parsing macros\utils\timestamps.sql
[0m17:05:37.516506 [debug] [MainThread]: Parsing macros\adapters\apply_grants.sql
[0m17:05:37.530507 [debug] [MainThread]: Parsing macros\adapters\columns.sql
[0m17:05:37.539505 [debug] [MainThread]: Parsing macros\adapters\freshness.sql
[0m17:05:37.541507 [debug] [MainThread]: Parsing macros\adapters\indexes.sql
[0m17:05:37.544505 [debug] [MainThread]: Parsing macros\adapters\metadata.sql
[0m17:05:37.551505 [debug] [MainThread]: Parsing macros\adapters\persist_docs.sql
[0m17:05:37.556505 [debug] [MainThread]: Parsing macros\adapters\relation.sql
[0m17:05:37.570537 [debug] [MainThread]: Parsing macros\adapters\schema.sql
[0m17:05:37.572536 [debug] [MainThread]: Parsing macros\adapters\timestamps.sql
[0m17:05:37.576536 [debug] [MainThread]: Parsing macros\etc\datetime.sql
[0m17:05:37.585509 [debug] [MainThread]: Parsing macros\etc\statement.sql
[0m17:05:37.594536 [debug] [MainThread]: Parsing macros\generic_test_sql\accepted_values.sql
[0m17:05:37.595536 [debug] [MainThread]: Parsing macros\generic_test_sql\not_null.sql
[0m17:05:37.596536 [debug] [MainThread]: Parsing macros\generic_test_sql\relationships.sql
[0m17:05:37.597554 [debug] [MainThread]: Parsing macros\generic_test_sql\unique.sql
[0m17:05:37.598506 [debug] [MainThread]: Parsing macros\get_custom_name\get_custom_alias.sql
[0m17:05:37.600540 [debug] [MainThread]: Parsing macros\get_custom_name\get_custom_database.sql
[0m17:05:37.602546 [debug] [MainThread]: Parsing macros\get_custom_name\get_custom_schema.sql
[0m17:05:37.604549 [debug] [MainThread]: Parsing macros\materializations\configs.sql
[0m17:05:37.607547 [debug] [MainThread]: Parsing macros\materializations\hooks.sql
[0m17:05:37.610536 [debug] [MainThread]: Parsing macros\materializations\models\incremental\column_helpers.sql
[0m17:05:37.619509 [debug] [MainThread]: Parsing macros\materializations\models\incremental\incremental.sql
[0m17:05:37.629509 [debug] [MainThread]: Parsing macros\materializations\models\incremental\is_incremental.sql
[0m17:05:37.632511 [debug] [MainThread]: Parsing macros\materializations\models\incremental\merge.sql
[0m17:05:37.645509 [debug] [MainThread]: Parsing macros\materializations\models\incremental\on_schema_change.sql
[0m17:05:37.660509 [debug] [MainThread]: Parsing macros\materializations\models\incremental\strategies.sql
[0m17:05:37.668510 [debug] [MainThread]: Parsing macros\materializations\models\table\create_table_as.sql
[0m17:05:37.671510 [debug] [MainThread]: Parsing macros\materializations\models\table\table.sql
[0m17:05:37.677510 [debug] [MainThread]: Parsing macros\materializations\models\view\create_or_replace_view.sql
[0m17:05:37.680509 [debug] [MainThread]: Parsing macros\materializations\models\view\create_view_as.sql
[0m17:05:37.683510 [debug] [MainThread]: Parsing macros\materializations\models\view\helpers.sql
[0m17:05:37.684511 [debug] [MainThread]: Parsing macros\materializations\models\view\view.sql
[0m17:05:37.689509 [debug] [MainThread]: Parsing macros\materializations\seeds\helpers.sql
[0m17:05:37.706509 [debug] [MainThread]: Parsing macros\materializations\seeds\seed.sql
[0m17:05:37.713509 [debug] [MainThread]: Parsing macros\materializations\snapshots\helpers.sql
[0m17:05:37.725510 [debug] [MainThread]: Parsing macros\materializations\snapshots\snapshot.sql
[0m17:05:37.736537 [debug] [MainThread]: Parsing macros\materializations\snapshots\snapshot_merge.sql
[0m17:05:37.738541 [debug] [MainThread]: Parsing macros\materializations\snapshots\strategies.sql
[0m17:05:37.753536 [debug] [MainThread]: Parsing macros\materializations\tests\helpers.sql
[0m17:05:37.755536 [debug] [MainThread]: Parsing macros\materializations\tests\test.sql
[0m17:05:37.759509 [debug] [MainThread]: Parsing macros\materializations\tests\where_subquery.sql
[0m17:05:37.762506 [debug] [MainThread]: Parsing macros\python_model\python.sql
[0m17:05:37.768541 [debug] [MainThread]: Parsing macros\utils\any_value.sql
[0m17:05:37.769539 [debug] [MainThread]: Parsing macros\utils\array_append.sql
[0m17:05:37.770536 [debug] [MainThread]: Parsing macros\utils\array_concat.sql
[0m17:05:37.771537 [debug] [MainThread]: Parsing macros\utils\array_construct.sql
[0m17:05:37.773538 [debug] [MainThread]: Parsing macros\utils\bool_or.sql
[0m17:05:37.774537 [debug] [MainThread]: Parsing macros\utils\cast_bool_to_text.sql
[0m17:05:37.776511 [debug] [MainThread]: Parsing macros\utils\concat.sql
[0m17:05:37.777511 [debug] [MainThread]: Parsing macros\utils\data_types.sql
[0m17:05:37.785507 [debug] [MainThread]: Parsing macros\utils\dateadd.sql
[0m17:05:37.787507 [debug] [MainThread]: Parsing macros\utils\datediff.sql
[0m17:05:37.788508 [debug] [MainThread]: Parsing macros\utils\date_trunc.sql
[0m17:05:37.789507 [debug] [MainThread]: Parsing macros\utils\escape_single_quotes.sql
[0m17:05:37.791509 [debug] [MainThread]: Parsing macros\utils\except.sql
[0m17:05:37.792555 [debug] [MainThread]: Parsing macros\utils\hash.sql
[0m17:05:37.794537 [debug] [MainThread]: Parsing macros\utils\intersect.sql
[0m17:05:37.795538 [debug] [MainThread]: Parsing macros\utils\last_day.sql
[0m17:05:37.797537 [debug] [MainThread]: Parsing macros\utils\length.sql
[0m17:05:37.798537 [debug] [MainThread]: Parsing macros\utils\listagg.sql
[0m17:05:37.800539 [debug] [MainThread]: Parsing macros\utils\literal.sql
[0m17:05:37.801538 [debug] [MainThread]: Parsing macros\utils\position.sql
[0m17:05:37.803537 [debug] [MainThread]: Parsing macros\utils\replace.sql
[0m17:05:37.804537 [debug] [MainThread]: Parsing macros\utils\right.sql
[0m17:05:37.806538 [debug] [MainThread]: Parsing macros\utils\safe_cast.sql
[0m17:05:37.807537 [debug] [MainThread]: Parsing macros\utils\split_part.sql
[0m17:05:37.809537 [debug] [MainThread]: Parsing tests\generic\builtin.sql
[0m17:05:38.122855 [debug] [MainThread]: 1603: static parser failed on stg\vehicle_event_log.sql
[0m17:05:38.142513 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\vehicle_event_log.sql
[0m17:05:38.173550 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'my_first_dbt_model' in the 'models' section of file 'models\dwh\schema.yml'
[0m17:05:38.176645 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'my_second_dbt_model' in the 'models' section of file 'models\dwh\schema.yml'
[0m17:05:38.197645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022148CB8AC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022148D082E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022148D08100>]}
[0m17:05:38.198605 [debug] [MainThread]: Flushing usage events
[0m17:05:38.830960 [error] [MainThread]: Encountered an error:
Compilation Error in model vehicle_event_log (models\stg\vehicle_event_log.sql)
  Model 'model.door2door_dwh.vehicle_event_log' (models\stg\vehicle_event_log.sql) depends on a source named 'RAW.vehicle_iot_data' which was not found


============================== 2023-02-03 17:06:44.219119 | bae76f43-5212-44d8-933b-34941dc7e60e ==============================
[0m17:06:44.219119 [info ] [MainThread]: Running with dbt=1.3.1
[0m17:06:44.219119 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m17:06:44.220077 [debug] [MainThread]: Tracking: tracking
[0m17:06:44.220077 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C2D634DB50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C2D634DBB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C2D634DC10>]}
[0m17:06:44.230104 [info ] [MainThread]: Partial parse save file not found. Starting full parse.
[0m17:06:44.231106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'bae76f43-5212-44d8-933b-34941dc7e60e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C2D6373880>]}
[0m17:06:44.293104 [debug] [MainThread]: Parsing macros\adapters.sql
[0m17:06:44.335105 [debug] [MainThread]: Parsing macros\apply_grants.sql
[0m17:06:44.336106 [debug] [MainThread]: Parsing macros\catalog.sql
[0m17:06:44.338110 [debug] [MainThread]: Parsing macros\materializations\incremental.sql
[0m17:06:44.348074 [debug] [MainThread]: Parsing macros\materializations\merge.sql
[0m17:06:44.352075 [debug] [MainThread]: Parsing macros\materializations\seed.sql
[0m17:06:44.357074 [debug] [MainThread]: Parsing macros\materializations\snapshot.sql
[0m17:06:44.358075 [debug] [MainThread]: Parsing macros\materializations\table.sql
[0m17:06:44.364075 [debug] [MainThread]: Parsing macros\materializations\test.sql
[0m17:06:44.365075 [debug] [MainThread]: Parsing macros\materializations\view.sql
[0m17:06:44.366075 [debug] [MainThread]: Parsing macros\utils\array_construct.sql
[0m17:06:44.367075 [debug] [MainThread]: Parsing macros\utils\bool_or.sql
[0m17:06:44.368075 [debug] [MainThread]: Parsing macros\utils\escape_single_quotes.sql
[0m17:06:44.368075 [debug] [MainThread]: Parsing macros\utils\right.sql
[0m17:06:44.369075 [debug] [MainThread]: Parsing macros\utils\safe_cast.sql
[0m17:06:44.370075 [debug] [MainThread]: Parsing macros\utils\timestamps.sql
[0m17:06:44.372075 [debug] [MainThread]: Parsing macros\adapters\apply_grants.sql
[0m17:06:44.391125 [debug] [MainThread]: Parsing macros\adapters\columns.sql
[0m17:06:44.400116 [debug] [MainThread]: Parsing macros\adapters\freshness.sql
[0m17:06:44.402116 [debug] [MainThread]: Parsing macros\adapters\indexes.sql
[0m17:06:44.405119 [debug] [MainThread]: Parsing macros\adapters\metadata.sql
[0m17:06:44.412105 [debug] [MainThread]: Parsing macros\adapters\persist_docs.sql
[0m17:06:44.416106 [debug] [MainThread]: Parsing macros\adapters\relation.sql
[0m17:06:44.430107 [debug] [MainThread]: Parsing macros\adapters\schema.sql
[0m17:06:44.433107 [debug] [MainThread]: Parsing macros\adapters\timestamps.sql
[0m17:06:44.436105 [debug] [MainThread]: Parsing macros\etc\datetime.sql
[0m17:06:44.444105 [debug] [MainThread]: Parsing macros\etc\statement.sql
[0m17:06:44.449106 [debug] [MainThread]: Parsing macros\generic_test_sql\accepted_values.sql
[0m17:06:44.450106 [debug] [MainThread]: Parsing macros\generic_test_sql\not_null.sql
[0m17:06:44.451106 [debug] [MainThread]: Parsing macros\generic_test_sql\relationships.sql
[0m17:06:44.452106 [debug] [MainThread]: Parsing macros\generic_test_sql\unique.sql
[0m17:06:44.453125 [debug] [MainThread]: Parsing macros\get_custom_name\get_custom_alias.sql
[0m17:06:44.455106 [debug] [MainThread]: Parsing macros\get_custom_name\get_custom_database.sql
[0m17:06:44.457106 [debug] [MainThread]: Parsing macros\get_custom_name\get_custom_schema.sql
[0m17:06:44.459106 [debug] [MainThread]: Parsing macros\materializations\configs.sql
[0m17:06:44.462107 [debug] [MainThread]: Parsing macros\materializations\hooks.sql
[0m17:06:44.465106 [debug] [MainThread]: Parsing macros\materializations\models\incremental\column_helpers.sql
[0m17:06:44.474078 [debug] [MainThread]: Parsing macros\materializations\models\incremental\incremental.sql
[0m17:06:44.484121 [debug] [MainThread]: Parsing macros\materializations\models\incremental\is_incremental.sql
[0m17:06:44.486118 [debug] [MainThread]: Parsing macros\materializations\models\incremental\merge.sql
[0m17:06:44.500107 [debug] [MainThread]: Parsing macros\materializations\models\incremental\on_schema_change.sql
[0m17:06:44.516119 [debug] [MainThread]: Parsing macros\materializations\models\incremental\strategies.sql
[0m17:06:44.523106 [debug] [MainThread]: Parsing macros\materializations\models\table\create_table_as.sql
[0m17:06:44.527107 [debug] [MainThread]: Parsing macros\materializations\models\table\table.sql
[0m17:06:44.532107 [debug] [MainThread]: Parsing macros\materializations\models\view\create_or_replace_view.sql
[0m17:06:44.536106 [debug] [MainThread]: Parsing macros\materializations\models\view\create_view_as.sql
[0m17:06:44.538107 [debug] [MainThread]: Parsing macros\materializations\models\view\helpers.sql
[0m17:06:44.540108 [debug] [MainThread]: Parsing macros\materializations\models\view\view.sql
[0m17:06:44.545122 [debug] [MainThread]: Parsing macros\materializations\seeds\helpers.sql
[0m17:06:44.561075 [debug] [MainThread]: Parsing macros\materializations\seeds\seed.sql
[0m17:06:44.569108 [debug] [MainThread]: Parsing macros\materializations\snapshots\helpers.sql
[0m17:06:44.580107 [debug] [MainThread]: Parsing macros\materializations\snapshots\snapshot.sql
[0m17:06:44.592106 [debug] [MainThread]: Parsing macros\materializations\snapshots\snapshot_merge.sql
[0m17:06:44.594108 [debug] [MainThread]: Parsing macros\materializations\snapshots\strategies.sql
[0m17:06:44.610079 [debug] [MainThread]: Parsing macros\materializations\tests\helpers.sql
[0m17:06:44.612080 [debug] [MainThread]: Parsing macros\materializations\tests\test.sql
[0m17:06:44.616079 [debug] [MainThread]: Parsing macros\materializations\tests\where_subquery.sql
[0m17:06:44.618080 [debug] [MainThread]: Parsing macros\python_model\python.sql
[0m17:06:44.624079 [debug] [MainThread]: Parsing macros\utils\any_value.sql
[0m17:06:44.625081 [debug] [MainThread]: Parsing macros\utils\array_append.sql
[0m17:06:44.626080 [debug] [MainThread]: Parsing macros\utils\array_concat.sql
[0m17:06:44.628080 [debug] [MainThread]: Parsing macros\utils\array_construct.sql
[0m17:06:44.629080 [debug] [MainThread]: Parsing macros\utils\bool_or.sql
[0m17:06:44.631081 [debug] [MainThread]: Parsing macros\utils\cast_bool_to_text.sql
[0m17:06:44.632081 [debug] [MainThread]: Parsing macros\utils\concat.sql
[0m17:06:44.633081 [debug] [MainThread]: Parsing macros\utils\data_types.sql
[0m17:06:44.640080 [debug] [MainThread]: Parsing macros\utils\dateadd.sql
[0m17:06:44.641081 [debug] [MainThread]: Parsing macros\utils\datediff.sql
[0m17:06:44.642080 [debug] [MainThread]: Parsing macros\utils\date_trunc.sql
[0m17:06:44.644081 [debug] [MainThread]: Parsing macros\utils\escape_single_quotes.sql
[0m17:06:44.645080 [debug] [MainThread]: Parsing macros\utils\except.sql
[0m17:06:44.646082 [debug] [MainThread]: Parsing macros\utils\hash.sql
[0m17:06:44.647081 [debug] [MainThread]: Parsing macros\utils\intersect.sql
[0m17:06:44.648099 [debug] [MainThread]: Parsing macros\utils\last_day.sql
[0m17:06:44.650080 [debug] [MainThread]: Parsing macros\utils\length.sql
[0m17:06:44.651081 [debug] [MainThread]: Parsing macros\utils\listagg.sql
[0m17:06:44.654080 [debug] [MainThread]: Parsing macros\utils\literal.sql
[0m17:06:44.655081 [debug] [MainThread]: Parsing macros\utils\position.sql
[0m17:06:44.656080 [debug] [MainThread]: Parsing macros\utils\replace.sql
[0m17:06:44.657081 [debug] [MainThread]: Parsing macros\utils\right.sql
[0m17:06:44.658081 [debug] [MainThread]: Parsing macros\utils\safe_cast.sql
[0m17:06:44.660080 [debug] [MainThread]: Parsing macros\utils\split_part.sql
[0m17:06:44.662081 [debug] [MainThread]: Parsing tests\generic\builtin.sql
[0m17:06:44.935080 [debug] [MainThread]: 1603: static parser failed on stg\vehicle_event_log.sql
[0m17:06:44.953082 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\vehicle_event_log.sql
[0m17:06:44.981081 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'my_first_dbt_model' in the 'models' section of file 'models\dwh\schema.yml'
[0m17:06:44.984109 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'my_second_dbt_model' in the 'models' section of file 'models\dwh\schema.yml'
[0m17:06:45.004100 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C2D65182B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C2D65182E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C2D6518220>]}
[0m17:06:45.004100 [debug] [MainThread]: Flushing usage events
[0m17:06:45.651813 [error] [MainThread]: Encountered an error:
Compilation Error in model vehicle_event_log (models\stg\vehicle_event_log.sql)
  Model 'model.door2door_dwh.vehicle_event_log' (models\stg\vehicle_event_log.sql) depends on a source named 'RAW.vehicle_iot_data' which was not found


============================== 2023-02-03 17:07:02.643328 | 27768096-c2a7-4cd3-9e29-e7b06d828f34 ==============================
[0m17:07:02.643328 [info ] [MainThread]: Running with dbt=1.3.1
[0m17:07:02.644337 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m17:07:02.645332 [debug] [MainThread]: Tracking: tracking
[0m17:07:02.645332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B788E6EAC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B788E6EB20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B788E6EB80>]}
[0m17:07:02.657371 [info ] [MainThread]: Partial parse save file not found. Starting full parse.
[0m17:07:02.657371 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '27768096-c2a7-4cd3-9e29-e7b06d828f34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B788E94A90>]}
[0m17:07:02.721329 [debug] [MainThread]: Parsing macros\adapters.sql
[0m17:07:02.765348 [debug] [MainThread]: Parsing macros\apply_grants.sql
[0m17:07:02.766330 [debug] [MainThread]: Parsing macros\catalog.sql
[0m17:07:02.768372 [debug] [MainThread]: Parsing macros\materializations\incremental.sql
[0m17:07:02.780331 [debug] [MainThread]: Parsing macros\materializations\merge.sql
[0m17:07:02.784373 [debug] [MainThread]: Parsing macros\materializations\seed.sql
[0m17:07:02.790372 [debug] [MainThread]: Parsing macros\materializations\snapshot.sql
[0m17:07:02.791379 [debug] [MainThread]: Parsing macros\materializations\table.sql
[0m17:07:02.797375 [debug] [MainThread]: Parsing macros\materializations\test.sql
[0m17:07:02.798376 [debug] [MainThread]: Parsing macros\materializations\view.sql
[0m17:07:02.799332 [debug] [MainThread]: Parsing macros\utils\array_construct.sql
[0m17:07:02.800376 [debug] [MainThread]: Parsing macros\utils\bool_or.sql
[0m17:07:02.801348 [debug] [MainThread]: Parsing macros\utils\escape_single_quotes.sql
[0m17:07:02.801348 [debug] [MainThread]: Parsing macros\utils\right.sql
[0m17:07:02.803336 [debug] [MainThread]: Parsing macros\utils\safe_cast.sql
[0m17:07:02.804333 [debug] [MainThread]: Parsing macros\utils\timestamps.sql
[0m17:07:02.807334 [debug] [MainThread]: Parsing macros\adapters\apply_grants.sql
[0m17:07:02.822333 [debug] [MainThread]: Parsing macros\adapters\columns.sql
[0m17:07:02.832333 [debug] [MainThread]: Parsing macros\adapters\freshness.sql
[0m17:07:02.835335 [debug] [MainThread]: Parsing macros\adapters\indexes.sql
[0m17:07:02.838334 [debug] [MainThread]: Parsing macros\adapters\metadata.sql
[0m17:07:02.846334 [debug] [MainThread]: Parsing macros\adapters\persist_docs.sql
[0m17:07:02.851334 [debug] [MainThread]: Parsing macros\adapters\relation.sql
[0m17:07:02.868352 [debug] [MainThread]: Parsing macros\adapters\schema.sql
[0m17:07:02.870335 [debug] [MainThread]: Parsing macros\adapters\timestamps.sql
[0m17:07:02.874334 [debug] [MainThread]: Parsing macros\etc\datetime.sql
[0m17:07:02.884341 [debug] [MainThread]: Parsing macros\etc\statement.sql
[0m17:07:02.889333 [debug] [MainThread]: Parsing macros\generic_test_sql\accepted_values.sql
[0m17:07:02.891335 [debug] [MainThread]: Parsing macros\generic_test_sql\not_null.sql
[0m17:07:02.892336 [debug] [MainThread]: Parsing macros\generic_test_sql\relationships.sql
[0m17:07:02.894335 [debug] [MainThread]: Parsing macros\generic_test_sql\unique.sql
[0m17:07:02.895336 [debug] [MainThread]: Parsing macros\get_custom_name\get_custom_alias.sql
[0m17:07:02.898337 [debug] [MainThread]: Parsing macros\get_custom_name\get_custom_database.sql
[0m17:07:02.901338 [debug] [MainThread]: Parsing macros\get_custom_name\get_custom_schema.sql
[0m17:07:02.906331 [debug] [MainThread]: Parsing macros\materializations\configs.sql
[0m17:07:02.909331 [debug] [MainThread]: Parsing macros\materializations\hooks.sql
[0m17:07:02.915336 [debug] [MainThread]: Parsing macros\materializations\models\incremental\column_helpers.sql
[0m17:07:02.924340 [debug] [MainThread]: Parsing macros\materializations\models\incremental\incremental.sql
[0m17:07:02.946335 [debug] [MainThread]: Parsing macros\materializations\models\incremental\is_incremental.sql
[0m17:07:02.954335 [debug] [MainThread]: Parsing macros\materializations\models\incremental\merge.sql
[0m17:07:02.988333 [debug] [MainThread]: Parsing macros\materializations\models\incremental\on_schema_change.sql
[0m17:07:03.013334 [debug] [MainThread]: Parsing macros\materializations\models\incremental\strategies.sql
[0m17:07:03.026334 [debug] [MainThread]: Parsing macros\materializations\models\table\create_table_as.sql
[0m17:07:03.032333 [debug] [MainThread]: Parsing macros\materializations\models\table\table.sql
[0m17:07:03.040331 [debug] [MainThread]: Parsing macros\materializations\models\view\create_or_replace_view.sql
[0m17:07:03.044335 [debug] [MainThread]: Parsing macros\materializations\models\view\create_view_as.sql
[0m17:07:03.047331 [debug] [MainThread]: Parsing macros\materializations\models\view\helpers.sql
[0m17:07:03.048332 [debug] [MainThread]: Parsing macros\materializations\models\view\view.sql
[0m17:07:03.059330 [debug] [MainThread]: Parsing macros\materializations\seeds\helpers.sql
[0m17:07:03.080330 [debug] [MainThread]: Parsing macros\materializations\seeds\seed.sql
[0m17:07:03.088330 [debug] [MainThread]: Parsing macros\materializations\snapshots\helpers.sql
[0m17:07:03.103330 [debug] [MainThread]: Parsing macros\materializations\snapshots\snapshot.sql
[0m17:07:03.115330 [debug] [MainThread]: Parsing macros\materializations\snapshots\snapshot_merge.sql
[0m17:07:03.117334 [debug] [MainThread]: Parsing macros\materializations\snapshots\strategies.sql
[0m17:07:03.133333 [debug] [MainThread]: Parsing macros\materializations\tests\helpers.sql
[0m17:07:03.135374 [debug] [MainThread]: Parsing macros\materializations\tests\test.sql
[0m17:07:03.139374 [debug] [MainThread]: Parsing macros\materializations\tests\where_subquery.sql
[0m17:07:03.141375 [debug] [MainThread]: Parsing macros\python_model\python.sql
[0m17:07:03.147334 [debug] [MainThread]: Parsing macros\utils\any_value.sql
[0m17:07:03.148374 [debug] [MainThread]: Parsing macros\utils\array_append.sql
[0m17:07:03.150362 [debug] [MainThread]: Parsing macros\utils\array_concat.sql
[0m17:07:03.151361 [debug] [MainThread]: Parsing macros\utils\array_construct.sql
[0m17:07:03.152334 [debug] [MainThread]: Parsing macros\utils\bool_or.sql
[0m17:07:03.154334 [debug] [MainThread]: Parsing macros\utils\cast_bool_to_text.sql
[0m17:07:03.156343 [debug] [MainThread]: Parsing macros\utils\concat.sql
[0m17:07:03.158337 [debug] [MainThread]: Parsing macros\utils\data_types.sql
[0m17:07:03.166341 [debug] [MainThread]: Parsing macros\utils\dateadd.sql
[0m17:07:03.168338 [debug] [MainThread]: Parsing macros\utils\datediff.sql
[0m17:07:03.169332 [debug] [MainThread]: Parsing macros\utils\date_trunc.sql
[0m17:07:03.171374 [debug] [MainThread]: Parsing macros\utils\escape_single_quotes.sql
[0m17:07:03.172334 [debug] [MainThread]: Parsing macros\utils\except.sql
[0m17:07:03.173374 [debug] [MainThread]: Parsing macros\utils\hash.sql
[0m17:07:03.174334 [debug] [MainThread]: Parsing macros\utils\intersect.sql
[0m17:07:03.175335 [debug] [MainThread]: Parsing macros\utils\last_day.sql
[0m17:07:03.177376 [debug] [MainThread]: Parsing macros\utils\length.sql
[0m17:07:03.178376 [debug] [MainThread]: Parsing macros\utils\listagg.sql
[0m17:07:03.181374 [debug] [MainThread]: Parsing macros\utils\literal.sql
[0m17:07:03.182378 [debug] [MainThread]: Parsing macros\utils\position.sql
[0m17:07:03.183332 [debug] [MainThread]: Parsing macros\utils\replace.sql
[0m17:07:03.185374 [debug] [MainThread]: Parsing macros\utils\right.sql
[0m17:07:03.186375 [debug] [MainThread]: Parsing macros\utils\safe_cast.sql
[0m17:07:03.187375 [debug] [MainThread]: Parsing macros\utils\split_part.sql
[0m17:07:03.189376 [debug] [MainThread]: Parsing tests\generic\builtin.sql
[0m17:07:03.506368 [debug] [MainThread]: 1603: static parser failed on stg\vehicle_event_log.sql
[0m17:07:03.527334 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\vehicle_event_log.sql
[0m17:07:03.559335 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'my_first_dbt_model' in the 'models' section of file 'models\dwh\schema.yml'
[0m17:07:03.561335 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'my_second_dbt_model' in the 'models' section of file 'models\dwh\schema.yml'
[0m17:07:03.583403 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.door2door_dwh.unique_my_first_dbt_model_id.16e066b321' (models\dwh\schema.yml) depends on a node named 'my_first_dbt_model' which was not found
[0m17:07:03.585335 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.door2door_dwh.not_null_my_first_dbt_model_id.5fb22c2710' (models\dwh\schema.yml) depends on a node named 'my_first_dbt_model' which was not found
[0m17:07:03.586715 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.door2door_dwh.unique_my_second_dbt_model_id.57a0f8c493' (models\dwh\schema.yml) depends on a node named 'my_second_dbt_model' which was not found
[0m17:07:03.587725 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.door2door_dwh.not_null_my_second_dbt_model_id.151b76d778' (models\dwh\schema.yml) depends on a node named 'my_second_dbt_model' which was not found
[0m17:07:03.618725 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.door2door_dwh.dwh

[0m17:07:03.625725 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '27768096-c2a7-4cd3-9e29-e7b06d828f34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B788FEBBE0>]}
[0m17:07:03.636727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '27768096-c2a7-4cd3-9e29-e7b06d828f34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B788F4ADF0>]}
[0m17:07:03.636727 [info ] [MainThread]: Found 1 model, 0 tests, 0 snapshots, 0 analyses, 303 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m17:07:03.637725 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '27768096-c2a7-4cd3-9e29-e7b06d828f34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B788E91610>]}
[0m17:07:03.638772 [info ] [MainThread]: 
[0m17:07:03.639724 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m17:07:03.641728 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m17:07:03.661770 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m17:07:03.661770 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m17:07:03.661770 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:07:04.839626 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.18 seconds
[0m17:07:04.841639 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m17:07:04.993213 [debug] [ThreadPool]: Acquiring new snowflake connection "create_DOOR2DOOR_DWH_DBT"
[0m17:07:04.994210 [debug] [ThreadPool]: Acquiring new snowflake connection "create_DOOR2DOOR_DWH_DBT"
[0m17:07:04.995216 [debug] [ThreadPool]: Creating schema "_ReferenceKey(database='door2door_dwh', schema='dbt', identifier=None)"
[0m17:07:05.001210 [debug] [ThreadPool]: Using snowflake connection "create_DOOR2DOOR_DWH_DBT"
[0m17:07:05.002213 [debug] [ThreadPool]: On create_DOOR2DOOR_DWH_DBT: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "create_DOOR2DOOR_DWH_DBT"} */
create schema if not exists DOOR2DOOR_DWH.DBT
[0m17:07:05.003213 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:07:05.635308 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.63 seconds
[0m17:07:05.637352 [debug] [ThreadPool]: On create_DOOR2DOOR_DWH_DBT: Close
[0m17:07:05.773206 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m17:07:05.779226 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m17:07:05.780226 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT"} */
show terse objects in DOOR2DOOR_DWH.DBT
[0m17:07:05.780226 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:07:06.455468 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.68 seconds
[0m17:07:06.457467 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: Close
[0m17:07:06.584132 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '27768096-c2a7-4cd3-9e29-e7b06d828f34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B788EDEA00>]}
[0m17:07:06.585142 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:07:06.585142 [info ] [MainThread]: 
[0m17:07:06.593142 [debug] [Thread-1  ]: Began running node model.door2door_dwh.vehicle_event_log
[0m17:07:06.594141 [info ] [Thread-1  ]: 1 of 1 START sql incremental model DBT.vehicle_event_log ....................... [RUN]
[0m17:07:06.595141 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:07:06.595141 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.vehicle_event_log
[0m17:07:06.596142 [debug] [Thread-1  ]: Compiling model.door2door_dwh.vehicle_event_log
[0m17:07:06.600181 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.vehicle_event_log"
[0m17:07:06.602141 [debug] [Thread-1  ]: finished collecting timing info
[0m17:07:06.603163 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.vehicle_event_log
[0m17:07:06.662188 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.vehicle_event_log"
[0m17:07:06.665143 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:07:06.666141 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_event_log"} */
create or replace transient table DOOR2DOOR_DWH.DBT.vehicle_event_log  as
        (

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TIMESTAMP as on,
        VALUE:"at"::TIMESTAMP as at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM  DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
)
SELECT
    event,
    on,
    at,
    data:"id"::TEXT as data_id,
    data:"location"::"lat"::FLOAT as data_location_lat,
    data:"location"::"lng"::FLOAT as data_location_lng,
    data:"location"::"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
        );
[0m17:07:06.666141 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:07:07.224099 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa1663-3201-995c-0000-0001c1464185
[0m17:07:07.224099 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 7 at position 33 unexpected 'on'.
syntax error line 8 at position 13 unexpected ':'.
syntax error line 9 at position 24 unexpected ':'.
syntax error line 10 at position 13 unexpected ':'.
syntax error line 15 at position 0 unexpected 'SELECT'.
[0m17:07:07.224099 [debug] [Thread-1  ]: finished collecting timing info
[0m17:07:07.225098 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: Close
[0m17:07:07.359916 [debug] [Thread-1  ]: Database Error in model vehicle_event_log (models\stg\vehicle_event_log.sql)
  001003 (42000): SQL compilation error:
  syntax error line 7 at position 33 unexpected 'on'.
  syntax error line 8 at position 13 unexpected ':'.
  syntax error line 9 at position 24 unexpected ':'.
  syntax error line 10 at position 13 unexpected ':'.
  syntax error line 15 at position 0 unexpected 'SELECT'.
  compiled Code at target\run\door2door_dwh\models\stg\vehicle_event_log.sql
[0m17:07:07.360916 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27768096-c2a7-4cd3-9e29-e7b06d828f34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B7893B2F70>]}
[0m17:07:07.360916 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model DBT.vehicle_event_log .............. [[31mERROR[0m in 0.77s]
[0m17:07:07.362389 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.vehicle_event_log
[0m17:07:07.364425 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m17:07:07.365448 [info ] [MainThread]: 
[0m17:07:07.365448 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 3.73 seconds (3.73s).
[0m17:07:07.366412 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:07:07.366412 [debug] [MainThread]: Connection 'create_DOOR2DOOR_DWH_DBT' was properly closed.
[0m17:07:07.367415 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT' was properly closed.
[0m17:07:07.367415 [debug] [MainThread]: Connection 'model.door2door_dwh.vehicle_event_log' was properly closed.
[0m17:07:07.421415 [info ] [MainThread]: 
[0m17:07:07.423029 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m17:07:07.424084 [info ] [MainThread]: 
[0m17:07:07.425094 [error] [MainThread]: [33mDatabase Error in model vehicle_event_log (models\stg\vehicle_event_log.sql)[0m
[0m17:07:07.426094 [error] [MainThread]:   001003 (42000): SQL compilation error:
[0m17:07:07.427095 [error] [MainThread]:   syntax error line 7 at position 33 unexpected 'on'.
[0m17:07:07.427095 [error] [MainThread]:   syntax error line 8 at position 13 unexpected ':'.
[0m17:07:07.428093 [error] [MainThread]:   syntax error line 9 at position 24 unexpected ':'.
[0m17:07:07.429095 [error] [MainThread]:   syntax error line 10 at position 13 unexpected ':'.
[0m17:07:07.429095 [error] [MainThread]:   syntax error line 15 at position 0 unexpected 'SELECT'.
[0m17:07:07.430095 [error] [MainThread]:   compiled Code at target\run\door2door_dwh\models\stg\vehicle_event_log.sql
[0m17:07:07.431137 [info ] [MainThread]: 
[0m17:07:07.432093 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m17:07:07.433095 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B788E062B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B788E06250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B788E13580>]}
[0m17:07:07.433095 [debug] [MainThread]: Flushing usage events


============================== 2023-02-03 17:07:37.407424 | 2a4927cf-916e-4fb3-8a6f-54067ffec2f1 ==============================
[0m17:07:37.407424 [info ] [MainThread]: Running with dbt=1.3.1
[0m17:07:37.408441 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m17:07:37.408441 [debug] [MainThread]: Tracking: tracking
[0m17:07:37.408441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A59FC53B50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A59FC53BB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A59FC53C10>]}
[0m17:07:37.501643 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:07:37.502648 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\stg\vehicle_event_log.sql
[0m17:07:37.516642 [debug] [MainThread]: 1603: static parser failed on stg\vehicle_event_log.sql
[0m17:07:37.539642 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\vehicle_event_log.sql
[0m17:07:37.559690 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2a4927cf-916e-4fb3-8a6f-54067ffec2f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A59FE320D0>]}
[0m17:07:37.567646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2a4927cf-916e-4fb3-8a6f-54067ffec2f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A59FE0B160>]}
[0m17:07:37.567646 [info ] [MainThread]: Found 1 model, 0 tests, 0 snapshots, 0 analyses, 303 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m17:07:37.568646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2a4927cf-916e-4fb3-8a6f-54067ffec2f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A59FC6ED60>]}
[0m17:07:37.569642 [info ] [MainThread]: 
[0m17:07:37.570642 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m17:07:37.572687 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m17:07:37.587688 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m17:07:37.587688 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m17:07:37.588643 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:07:38.564258 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.98 seconds
[0m17:07:38.566257 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m17:07:38.704713 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m17:07:38.710717 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m17:07:38.711743 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT"} */
show terse objects in DOOR2DOOR_DWH.DBT
[0m17:07:38.711743 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:07:39.315672 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.6 seconds
[0m17:07:39.317674 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: Close
[0m17:07:39.451143 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2a4927cf-916e-4fb3-8a6f-54067ffec2f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A59FDD9070>]}
[0m17:07:39.452115 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:07:39.453145 [info ] [MainThread]: 
[0m17:07:39.458400 [debug] [Thread-1  ]: Began running node model.door2door_dwh.vehicle_event_log
[0m17:07:39.459435 [info ] [Thread-1  ]: 1 of 1 START sql incremental model DBT.vehicle_event_log ....................... [RUN]
[0m17:07:39.460407 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:07:39.460407 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.vehicle_event_log
[0m17:07:39.461415 [debug] [Thread-1  ]: Compiling model.door2door_dwh.vehicle_event_log
[0m17:07:39.465427 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.vehicle_event_log"
[0m17:07:39.466402 [debug] [Thread-1  ]: finished collecting timing info
[0m17:07:39.466402 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.vehicle_event_log
[0m17:07:39.525438 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.vehicle_event_log"
[0m17:07:39.527442 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:07:39.527442 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_event_log"} */
create or replace transient table DOOR2DOOR_DWH.DBT.vehicle_event_log  as
        (

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TIMESTAMP as on,
        VALUE:"at"::TIMESTAMP as at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM  DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
)
SELECT
    event,
    on,
    at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
        );
[0m17:07:39.527442 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:07:39.947739 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa1663-3201-9838-0000-0001c1463191
[0m17:07:39.948740 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 7 at position 33 unexpected 'on'.
syntax error line 8 at position 13 unexpected ':'.
syntax error line 9 at position 24 unexpected ':'.
syntax error line 10 at position 13 unexpected ':'.
syntax error line 15 at position 0 unexpected 'SELECT'.
[0m17:07:39.948740 [debug] [Thread-1  ]: finished collecting timing info
[0m17:07:39.949815 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: Close
[0m17:07:40.093822 [debug] [Thread-1  ]: Database Error in model vehicle_event_log (models\stg\vehicle_event_log.sql)
  001003 (42000): SQL compilation error:
  syntax error line 7 at position 33 unexpected 'on'.
  syntax error line 8 at position 13 unexpected ':'.
  syntax error line 9 at position 24 unexpected ':'.
  syntax error line 10 at position 13 unexpected ':'.
  syntax error line 15 at position 0 unexpected 'SELECT'.
  compiled Code at target\run\door2door_dwh\models\stg\vehicle_event_log.sql
[0m17:07:40.093822 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a4927cf-916e-4fb3-8a6f-54067ffec2f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A5A0140E20>]}
[0m17:07:40.094823 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model DBT.vehicle_event_log .............. [[31mERROR[0m in 0.63s]
[0m17:07:40.096248 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.vehicle_event_log
[0m17:07:40.098273 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m17:07:40.098273 [info ] [MainThread]: 
[0m17:07:40.100272 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 2.53 seconds (2.53s).
[0m17:07:40.100272 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:07:40.101272 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m17:07:40.101272 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT' was properly closed.
[0m17:07:40.101272 [debug] [MainThread]: Connection 'model.door2door_dwh.vehicle_event_log' was properly closed.
[0m17:07:40.108272 [info ] [MainThread]: 
[0m17:07:40.109287 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m17:07:40.111280 [info ] [MainThread]: 
[0m17:07:40.111280 [error] [MainThread]: [33mDatabase Error in model vehicle_event_log (models\stg\vehicle_event_log.sql)[0m
[0m17:07:40.113123 [error] [MainThread]:   001003 (42000): SQL compilation error:
[0m17:07:40.113123 [error] [MainThread]:   syntax error line 7 at position 33 unexpected 'on'.
[0m17:07:40.114132 [error] [MainThread]:   syntax error line 8 at position 13 unexpected ':'.
[0m17:07:40.115132 [error] [MainThread]:   syntax error line 9 at position 24 unexpected ':'.
[0m17:07:40.116144 [error] [MainThread]:   syntax error line 10 at position 13 unexpected ':'.
[0m17:07:40.117133 [error] [MainThread]:   syntax error line 15 at position 0 unexpected 'SELECT'.
[0m17:07:40.118133 [error] [MainThread]:   compiled Code at target\run\door2door_dwh\models\stg\vehicle_event_log.sql
[0m17:07:40.119138 [info ] [MainThread]: 
[0m17:07:40.119138 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m17:07:40.120132 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A59FE62F70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A59FDDF1F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A5A0140280>]}
[0m17:07:40.121132 [debug] [MainThread]: Flushing usage events


============================== 2023-02-03 17:08:15.892612 | 9babf0ba-4cf7-423a-8f42-a22145bba889 ==============================
[0m17:08:15.892612 [info ] [MainThread]: Running with dbt=1.3.1
[0m17:08:15.892612 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m17:08:15.893614 [debug] [MainThread]: Tracking: tracking
[0m17:08:15.893614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001ECB7A94B50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001ECB7A94BB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001ECB7A94C10>]}
[0m17:08:15.985637 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:08:15.985637 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\stg\vehicle_event_log.sql
[0m17:08:15.998636 [debug] [MainThread]: 1603: static parser failed on stg\vehicle_event_log.sql
[0m17:08:16.015637 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\vehicle_event_log.sql
[0m17:08:16.034637 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9babf0ba-4cf7-423a-8f42-a22145bba889', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001ECB7C710D0>]}
[0m17:08:16.041611 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9babf0ba-4cf7-423a-8f42-a22145bba889', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001ECB7C4B160>]}
[0m17:08:16.041611 [info ] [MainThread]: Found 1 model, 0 tests, 0 snapshots, 0 analyses, 303 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m17:08:16.042612 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9babf0ba-4cf7-423a-8f42-a22145bba889', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001ECB7AADD60>]}
[0m17:08:16.043607 [info ] [MainThread]: 
[0m17:08:16.044609 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m17:08:16.046662 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m17:08:16.060647 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m17:08:16.061637 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m17:08:16.061637 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:08:17.049097 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.99 seconds
[0m17:08:17.052062 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m17:08:17.199310 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m17:08:17.205319 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m17:08:17.206319 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT"} */
show terse objects in DOOR2DOOR_DWH.DBT
[0m17:08:17.206319 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:08:17.808186 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.6 seconds
[0m17:08:17.809182 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: Close
[0m17:08:17.937224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9babf0ba-4cf7-423a-8f42-a22145bba889', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001ECB7C18070>]}
[0m17:08:17.938197 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:08:17.939225 [info ] [MainThread]: 
[0m17:08:17.944563 [debug] [Thread-1  ]: Began running node model.door2door_dwh.vehicle_event_log
[0m17:08:17.945603 [info ] [Thread-1  ]: 1 of 1 START sql incremental model DBT.vehicle_event_log ....................... [RUN]
[0m17:08:17.946574 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:08:17.946574 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.vehicle_event_log
[0m17:08:17.947576 [debug] [Thread-1  ]: Compiling model.door2door_dwh.vehicle_event_log
[0m17:08:17.951612 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.vehicle_event_log"
[0m17:08:17.952576 [debug] [Thread-1  ]: finished collecting timing info
[0m17:08:17.952576 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.vehicle_event_log
[0m17:08:18.012602 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.vehicle_event_log"
[0m17:08:18.014578 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:08:18.014578 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_event_log"} */
create or replace transient table DOOR2DOOR_DWH.DBT.vehicle_event_log  as
        (

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TIMESTAMP as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM  DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
        );
[0m17:08:18.014578 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:08:20.633656 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 2.62 seconds
[0m17:08:20.640652 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:08:20.640652 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_event_log"} */
drop view if exists DOOR2DOOR_DWH.DBT.vehicle_event_log__dbt_tmp cascade
[0m17:08:20.717657 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m17:08:20.738654 [debug] [Thread-1  ]: finished collecting timing info
[0m17:08:20.738654 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: Close
[0m17:08:20.875672 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9babf0ba-4cf7-423a-8f42-a22145bba889', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001ECB7F96A00>]}
[0m17:08:20.876674 [info ] [Thread-1  ]: 1 of 1 OK created sql incremental model DBT.vehicle_event_log .................. [[32mSUCCESS 1[0m in 2.93s]
[0m17:08:20.879670 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.vehicle_event_log
[0m17:08:20.881668 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m17:08:20.882696 [info ] [MainThread]: 
[0m17:08:20.883668 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 4.84 seconds (4.84s).
[0m17:08:20.883668 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:08:20.884670 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m17:08:20.884670 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT' was properly closed.
[0m17:08:20.884670 [debug] [MainThread]: Connection 'model.door2door_dwh.vehicle_event_log' was properly closed.
[0m17:08:20.891668 [info ] [MainThread]: 
[0m17:08:20.892712 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:08:20.894676 [info ] [MainThread]: 
[0m17:08:20.895668 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m17:08:20.896666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001ECB7FBC820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001ECB7FBC400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001ECB7FBCFA0>]}
[0m17:08:20.896666 [debug] [MainThread]: Flushing usage events


============================== 2023-02-03 17:09:53.857750 | e25e8a46-b9c3-4850-88f6-f7dee1a5bf73 ==============================
[0m17:09:53.857750 [info ] [MainThread]: Running with dbt=1.3.1
[0m17:09:53.858755 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m17:09:53.858755 [debug] [MainThread]: Tracking: tracking
[0m17:09:53.858755 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002351DB43BB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002351DB43C10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002351DB43C70>]}
[0m17:09:53.952751 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m17:09:53.953833 [debug] [MainThread]: Partial parsing: deleted source source.door2door_dwh.RAW.VEHICLE_IOT_DATA
[0m17:09:53.953833 [debug] [MainThread]: Partial parsing: update schema file: door2door_dwh://models\sources.yml
[0m17:09:53.954751 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\stg\vehicle_event_log.sql
[0m17:09:53.966792 [debug] [MainThread]: 1603: static parser failed on stg\vehicle_event_log.sql
[0m17:09:53.985783 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\vehicle_event_log.sql
[0m17:09:54.016783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e25e8a46-b9c3-4850-88f6-f7dee1a5bf73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002351DCC9220>]}
[0m17:09:54.024751 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e25e8a46-b9c3-4850-88f6-f7dee1a5bf73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002351DC302E0>]}
[0m17:09:54.024751 [info ] [MainThread]: Found 1 model, 0 tests, 0 snapshots, 0 analyses, 303 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m17:09:54.025761 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e25e8a46-b9c3-4850-88f6-f7dee1a5bf73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002351DC762E0>]}
[0m17:09:54.026751 [info ] [MainThread]: 
[0m17:09:54.027757 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m17:09:54.029782 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m17:09:54.044784 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m17:09:54.044784 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m17:09:54.045754 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:09:54.995583 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.95 seconds
[0m17:09:54.997553 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m17:09:55.141242 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m17:09:55.148273 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m17:09:55.148273 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT"} */
show terse objects in DOOR2DOOR_DWH.DBT
[0m17:09:55.149241 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:09:55.821491 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.67 seconds
[0m17:09:55.822488 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: Close
[0m17:09:55.951862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e25e8a46-b9c3-4850-88f6-f7dee1a5bf73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002351DC939D0>]}
[0m17:09:55.952880 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:09:55.953861 [info ] [MainThread]: 
[0m17:09:55.959192 [debug] [Thread-1  ]: Began running node model.door2door_dwh.vehicle_event_log
[0m17:09:55.960202 [info ] [Thread-1  ]: 1 of 1 START sql incremental model DBT.vehicle_event_log ....................... [RUN]
[0m17:09:55.961204 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:09:55.961204 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.vehicle_event_log
[0m17:09:55.962205 [debug] [Thread-1  ]: Compiling model.door2door_dwh.vehicle_event_log
[0m17:09:55.968230 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.vehicle_event_log"
[0m17:09:55.969205 [debug] [Thread-1  ]: finished collecting timing info
[0m17:09:55.969205 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.vehicle_event_log
[0m17:09:56.020231 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:09:56.021231 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_event_log"} */
create or replace  view DOOR2DOOR_DWH.DBT.vehicle_event_log__dbt_tmp
  
   as (
    

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TIMESTAMP as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
        where at > (select max(at) from DOOR2DOOR_DWH.DBT.vehicle_event_log)
    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
  );
[0m17:09:56.021231 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:09:56.669270 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa1665-3201-995c-0000-0001c146418d
[0m17:09:56.670271 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 16 at position 14
invalid identifier 'AT'
[0m17:09:56.670271 [debug] [Thread-1  ]: finished collecting timing info
[0m17:09:56.670271 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: Close
[0m17:09:56.799733 [debug] [Thread-1  ]: Database Error in model vehicle_event_log (models\stg\vehicle_event_log.sql)
  000904 (42000): SQL compilation error: error line 16 at position 14
  invalid identifier 'AT'
[0m17:09:56.799733 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e25e8a46-b9c3-4850-88f6-f7dee1a5bf73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002351DF12850>]}
[0m17:09:56.800760 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model DBT.vehicle_event_log .............. [[31mERROR[0m in 0.84s]
[0m17:09:56.802836 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.vehicle_event_log
[0m17:09:56.804866 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m17:09:56.805888 [info ] [MainThread]: 
[0m17:09:56.805888 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 2.78 seconds (2.78s).
[0m17:09:56.806888 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:09:56.806888 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m17:09:56.807890 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT' was properly closed.
[0m17:09:56.807890 [debug] [MainThread]: Connection 'model.door2door_dwh.vehicle_event_log' was properly closed.
[0m17:09:56.814888 [info ] [MainThread]: 
[0m17:09:56.815922 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m17:09:56.817876 [info ] [MainThread]: 
[0m17:09:56.818862 [error] [MainThread]: [33mDatabase Error in model vehicle_event_log (models\stg\vehicle_event_log.sql)[0m
[0m17:09:56.820560 [error] [MainThread]:   000904 (42000): SQL compilation error: error line 16 at position 14
[0m17:09:56.821598 [error] [MainThread]:   invalid identifier 'AT'
[0m17:09:56.821598 [info ] [MainThread]: 
[0m17:09:56.822592 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m17:09:56.823590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002351E06DB80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002351DC93A30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002351DF12550>]}
[0m17:09:56.824593 [debug] [MainThread]: Flushing usage events


============================== 2023-02-03 17:10:12.982128 | f6543b62-377a-44c4-917d-054df5b42cae ==============================
[0m17:10:12.982128 [info ] [MainThread]: Running with dbt=1.3.1
[0m17:10:12.983110 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m17:10:12.983110 [debug] [MainThread]: Tracking: tracking
[0m17:10:12.983110 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000183F5A2DAC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000183F5A2DB20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000183F5A2DB80>]}
[0m17:10:13.076098 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:10:13.077098 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\stg\vehicle_event_log.sql
[0m17:10:13.089098 [debug] [MainThread]: 1603: static parser failed on stg\vehicle_event_log.sql
[0m17:10:13.107100 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\vehicle_event_log.sql
[0m17:10:13.126126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f6543b62-377a-44c4-917d-054df5b42cae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000183F5C140D0>]}
[0m17:10:13.133100 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f6543b62-377a-44c4-917d-054df5b42cae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000183F5BB96A0>]}
[0m17:10:13.134100 [info ] [MainThread]: Found 1 model, 0 tests, 0 snapshots, 0 analyses, 303 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m17:10:13.135098 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f6543b62-377a-44c4-917d-054df5b42cae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000183F5BD0D90>]}
[0m17:10:13.136127 [info ] [MainThread]: 
[0m17:10:13.137127 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m17:10:13.138100 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m17:10:13.155104 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m17:10:13.155104 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m17:10:13.156103 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:10:14.043604 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.89 seconds
[0m17:10:14.044597 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m17:10:14.192191 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m17:10:14.199186 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m17:10:14.199186 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT"} */
show terse objects in DOOR2DOOR_DWH.DBT
[0m17:10:14.200190 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:10:14.836928 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.64 seconds
[0m17:10:14.838953 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: Close
[0m17:10:14.966098 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f6543b62-377a-44c4-917d-054df5b42cae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000183F5C47310>]}
[0m17:10:14.967134 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:10:14.968099 [info ] [MainThread]: 
[0m17:10:14.972830 [debug] [Thread-1  ]: Began running node model.door2door_dwh.vehicle_event_log
[0m17:10:14.973830 [info ] [Thread-1  ]: 1 of 1 START sql incremental model DBT.vehicle_event_log ....................... [RUN]
[0m17:10:14.975829 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:10:14.975829 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.vehicle_event_log
[0m17:10:14.975829 [debug] [Thread-1  ]: Compiling model.door2door_dwh.vehicle_event_log
[0m17:10:14.982868 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.vehicle_event_log"
[0m17:10:14.983841 [debug] [Thread-1  ]: finished collecting timing info
[0m17:10:14.983841 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.vehicle_event_log
[0m17:10:15.033856 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:10:15.033856 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_event_log"} */
create or replace  view DOOR2DOOR_DWH.DBT.vehicle_event_log__dbt_tmp
  
   as (
    

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TIMESTAMP as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
        where at > (select max(event_at) from DOOR2DOOR_DWH.DBT.vehicle_event_log)
    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
  );
[0m17:10:15.033856 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:10:15.503634 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa1666-3201-995c-0000-0001c1464195
[0m17:10:15.503634 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 16 at position 14
invalid identifier 'AT'
[0m17:10:15.503634 [debug] [Thread-1  ]: finished collecting timing info
[0m17:10:15.504635 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: Close
[0m17:10:15.638698 [debug] [Thread-1  ]: Database Error in model vehicle_event_log (models\stg\vehicle_event_log.sql)
  000904 (42000): SQL compilation error: error line 16 at position 14
  invalid identifier 'AT'
[0m17:10:15.638698 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f6543b62-377a-44c4-917d-054df5b42cae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000183F5F3EDC0>]}
[0m17:10:15.639674 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model DBT.vehicle_event_log .............. [[31mERROR[0m in 0.66s]
[0m17:10:15.640672 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.vehicle_event_log
[0m17:10:15.643711 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m17:10:15.644712 [info ] [MainThread]: 
[0m17:10:15.645674 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 2.51 seconds (2.51s).
[0m17:10:15.646674 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:10:15.647674 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m17:10:15.647674 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT' was properly closed.
[0m17:10:15.648680 [debug] [MainThread]: Connection 'model.door2door_dwh.vehicle_event_log' was properly closed.
[0m17:10:15.656700 [info ] [MainThread]: 
[0m17:10:15.657673 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m17:10:15.658677 [info ] [MainThread]: 
[0m17:10:15.659694 [error] [MainThread]: [33mDatabase Error in model vehicle_event_log (models\stg\vehicle_event_log.sql)[0m
[0m17:10:15.660673 [error] [MainThread]:   000904 (42000): SQL compilation error: error line 16 at position 14
[0m17:10:15.661685 [error] [MainThread]:   invalid identifier 'AT'
[0m17:10:15.663671 [info ] [MainThread]: 
[0m17:10:15.664673 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m17:10:15.665674 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000183F5C47F10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000183F5BC2550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000183F5F138B0>]}
[0m17:10:15.665674 [debug] [MainThread]: Flushing usage events


============================== 2023-02-03 17:10:26.641535 | be3e231b-6ba5-457e-a768-235df1b3716a ==============================
[0m17:10:26.641535 [info ] [MainThread]: Running with dbt=1.3.1
[0m17:10:26.642522 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m17:10:26.642522 [debug] [MainThread]: Tracking: tracking
[0m17:10:26.643493 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001892F854AF0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001892F854B50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001892F854BB0>]}
[0m17:10:26.736496 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:10:26.736496 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\stg\vehicle_event_log.sql
[0m17:10:26.750496 [debug] [MainThread]: 1603: static parser failed on stg\vehicle_event_log.sql
[0m17:10:26.768496 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\vehicle_event_log.sql
[0m17:10:26.787523 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'be3e231b-6ba5-457e-a768-235df1b3716a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001892FA350D0>]}
[0m17:10:26.794523 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'be3e231b-6ba5-457e-a768-235df1b3716a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001892F9D9130>]}
[0m17:10:26.794523 [info ] [MainThread]: Found 1 model, 0 tests, 0 snapshots, 0 analyses, 303 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m17:10:26.795500 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'be3e231b-6ba5-457e-a768-235df1b3716a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001892F9F0DC0>]}
[0m17:10:26.796523 [info ] [MainThread]: 
[0m17:10:26.797493 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m17:10:26.799549 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m17:10:26.812523 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m17:10:26.813523 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m17:10:26.813523 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:10:27.671616 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.86 seconds
[0m17:10:27.672617 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m17:10:27.806614 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m17:10:27.813632 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m17:10:27.813632 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT"} */
show terse objects in DOOR2DOOR_DWH.DBT
[0m17:10:27.814611 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:10:28.319644 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.51 seconds
[0m17:10:28.322657 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: Close
[0m17:10:28.470882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'be3e231b-6ba5-457e-a768-235df1b3716a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001892FA66310>]}
[0m17:10:28.471923 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:10:28.471923 [info ] [MainThread]: 
[0m17:10:28.478880 [debug] [Thread-1  ]: Began running node model.door2door_dwh.vehicle_event_log
[0m17:10:28.478880 [info ] [Thread-1  ]: 1 of 1 START sql incremental model DBT.vehicle_event_log ....................... [RUN]
[0m17:10:28.479924 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:10:28.480922 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.vehicle_event_log
[0m17:10:28.480922 [debug] [Thread-1  ]: Compiling model.door2door_dwh.vehicle_event_log
[0m17:10:28.487921 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.vehicle_event_log"
[0m17:10:28.488911 [debug] [Thread-1  ]: finished collecting timing info
[0m17:10:28.488911 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.vehicle_event_log
[0m17:10:28.546924 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:10:28.547930 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_event_log"} */
create or replace  view DOOR2DOOR_DWH.DBT.vehicle_event_log__dbt_tmp
  
   as (
    

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TIMESTAMP as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
        where event_at > (select max(event_at) from DOOR2DOOR_DWH.DBT.vehicle_event_log)
    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
  );
[0m17:10:28.547930 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:10:29.308155 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.76 seconds
[0m17:10:29.318155 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:10:29.318155 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_event_log"} */
describe table DOOR2DOOR_DWH.DBT.vehicle_event_log__dbt_tmp
[0m17:10:29.417268 [debug] [Thread-1  ]: SQL status: SUCCESS 9 in 0.1 seconds
[0m17:10:29.421256 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:10:29.421256 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_event_log"} */
describe table DOOR2DOOR_DWH.DBT.vehicle_event_log
[0m17:10:29.537506 [debug] [Thread-1  ]: SQL status: SUCCESS 9 in 0.12 seconds
[0m17:10:29.546532 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:10:29.546532 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_event_log"} */
describe table "DOOR2DOOR_DWH"."DBT"."VEHICLE_EVENT_LOG"
[0m17:10:29.632940 [debug] [Thread-1  ]: SQL status: SUCCESS 9 in 0.09 seconds
[0m17:10:29.649936 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.vehicle_event_log"
[0m17:10:29.651909 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:10:29.651909 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_event_log"} */
BEGIN
[0m17:10:29.769707 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.12 seconds
[0m17:10:29.770734 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:10:29.770734 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_event_log"} */
insert into DOOR2DOOR_DWH.DBT.vehicle_event_log ("EVENT", "EVENT_ON", "EVENT_AT", "DATA_ID", "DATA_LOCATION_LAT", "DATA_LOCATION_LNG", "DATA_LOCATION_AT", "DATA_START", "DATA_FINISH")
        (
            select "EVENT", "EVENT_ON", "EVENT_AT", "DATA_ID", "DATA_LOCATION_LAT", "DATA_LOCATION_LNG", "DATA_LOCATION_AT", "DATA_START", "DATA_FINISH"
            from DOOR2DOOR_DWH.DBT.vehicle_event_log__dbt_tmp
        );
[0m17:10:30.069538 [debug] [Thread-1  ]: SQL status: SUCCESS 0 in 0.3 seconds
[0m17:10:30.069538 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:10:30.070558 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_event_log"} */
COMMIT
[0m17:10:30.250977 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.18 seconds
[0m17:10:30.258971 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:10:30.259972 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_event_log"} */
drop view if exists DOOR2DOOR_DWH.DBT.vehicle_event_log__dbt_tmp cascade
[0m17:10:30.539644 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.28 seconds
[0m17:10:30.559640 [debug] [Thread-1  ]: finished collecting timing info
[0m17:10:30.559640 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: Close
[0m17:10:30.691625 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be3e231b-6ba5-457e-a768-235df1b3716a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001892FD5DE50>]}
[0m17:10:30.692627 [info ] [Thread-1  ]: 1 of 1 OK created sql incremental model DBT.vehicle_event_log .................. [[32mSUCCESS 0[0m in 2.21s]
[0m17:10:30.693627 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.vehicle_event_log
[0m17:10:30.695648 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m17:10:30.696655 [info ] [MainThread]: 
[0m17:10:30.697631 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 3.90 seconds (3.90s).
[0m17:10:30.697631 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:10:30.698654 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m17:10:30.698654 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT' was properly closed.
[0m17:10:30.698654 [debug] [MainThread]: Connection 'model.door2door_dwh.vehicle_event_log' was properly closed.
[0m17:10:30.705656 [info ] [MainThread]: 
[0m17:10:30.706656 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:10:30.708628 [info ] [MainThread]: 
[0m17:10:30.709677 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m17:10:30.710635 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001892FDCBB20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001892FDCB3A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001892FD35940>]}
[0m17:10:30.710635 [debug] [MainThread]: Flushing usage events


============================== 2023-02-03 17:11:38.551460 | 0fb07556-d707-45ff-ad08-85971ee45976 ==============================
[0m17:11:38.551460 [info ] [MainThread]: Running with dbt=1.3.1
[0m17:11:38.552447 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m17:11:38.553453 [debug] [MainThread]: Tracking: tracking
[0m17:11:38.553453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029760922A00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029760922A60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029760922AC0>]}
[0m17:11:38.646459 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:11:38.647448 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:11:38.658447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0fb07556-d707-45ff-ad08-85971ee45976', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029760AA60D0>]}
[0m17:11:38.665447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0fb07556-d707-45ff-ad08-85971ee45976', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002976098A4F0>]}
[0m17:11:38.666421 [info ] [MainThread]: Found 1 model, 0 tests, 0 snapshots, 0 analyses, 303 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m17:11:38.667446 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0fb07556-d707-45ff-ad08-85971ee45976', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002976098A790>]}
[0m17:11:38.668420 [info ] [MainThread]: 
[0m17:11:38.669418 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m17:11:38.671435 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m17:11:38.687473 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m17:11:38.688468 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m17:11:38.688468 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:11:39.702662 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.01 seconds
[0m17:11:39.703666 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m17:11:39.844536 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m17:11:39.851563 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m17:11:39.851563 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT"} */
show terse objects in DOOR2DOOR_DWH.DBT
[0m17:11:39.851563 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:11:40.624140 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.77 seconds
[0m17:11:40.626168 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: Close
[0m17:11:40.762985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0fb07556-d707-45ff-ad08-85971ee45976', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002976098A3A0>]}
[0m17:11:40.762985 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:11:40.763982 [info ] [MainThread]: 
[0m17:11:40.769982 [debug] [Thread-1  ]: Began running node model.door2door_dwh.vehicle_event_log
[0m17:11:40.769982 [info ] [Thread-1  ]: 1 of 1 START sql incremental model DBT.vehicle_event_log ....................... [RUN]
[0m17:11:40.772010 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:11:40.772010 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.vehicle_event_log
[0m17:11:40.773068 [debug] [Thread-1  ]: Compiling model.door2door_dwh.vehicle_event_log
[0m17:11:40.783984 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.vehicle_event_log"
[0m17:11:40.784985 [debug] [Thread-1  ]: finished collecting timing info
[0m17:11:40.786004 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.vehicle_event_log
[0m17:11:40.840023 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.vehicle_event_log"
[0m17:11:40.841981 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:11:40.841981 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_event_log"} */
create or replace transient table DOOR2DOOR_DWH.DBT.vehicle_event_log  as
        (

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TIMESTAMP as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
        );
[0m17:11:40.842981 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:11:42.404352 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.56 seconds
[0m17:11:42.412337 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:11:42.413337 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_event_log"} */
drop view if exists DOOR2DOOR_DWH.DBT.vehicle_event_log__dbt_tmp cascade
[0m17:11:42.580748 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.17 seconds
[0m17:11:42.604774 [debug] [Thread-1  ]: finished collecting timing info
[0m17:11:42.604774 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: Close
[0m17:11:42.744358 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0fb07556-d707-45ff-ad08-85971ee45976', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029760DD8E50>]}
[0m17:11:42.745363 [info ] [Thread-1  ]: 1 of 1 OK created sql incremental model DBT.vehicle_event_log .................. [[32mSUCCESS 1[0m in 1.97s]
[0m17:11:42.747355 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.vehicle_event_log
[0m17:11:42.749354 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m17:11:42.750355 [info ] [MainThread]: 
[0m17:11:42.751353 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 4.08 seconds (4.08s).
[0m17:11:42.752356 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:11:42.753352 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m17:11:42.753352 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT' was properly closed.
[0m17:11:42.754370 [debug] [MainThread]: Connection 'model.door2door_dwh.vehicle_event_log' was properly closed.
[0m17:11:42.763353 [info ] [MainThread]: 
[0m17:11:42.764156 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:11:42.765165 [info ] [MainThread]: 
[0m17:11:42.766171 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m17:11:42.768168 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029760A746A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002976098A490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029760D53190>]}
[0m17:11:42.768168 [debug] [MainThread]: Flushing usage events


============================== 2023-02-03 17:11:53.354399 | 10ce4723-5780-43cc-9950-99c2e3c5b5a9 ==============================
[0m17:11:53.354399 [info ] [MainThread]: Running with dbt=1.3.1
[0m17:11:53.355400 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m17:11:53.355400 [debug] [MainThread]: Tracking: tracking
[0m17:11:53.356370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F638C82B50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F638C82BB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F638C82C10>]}
[0m17:11:53.449373 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:11:53.449373 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\stg\vehicle_event_log.sql
[0m17:11:53.462372 [debug] [MainThread]: 1603: static parser failed on stg\vehicle_event_log.sql
[0m17:11:53.480374 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\vehicle_event_log.sql
[0m17:11:53.498374 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '10ce4723-5780-43cc-9950-99c2e3c5b5a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F638E660D0>]}
[0m17:11:53.507371 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '10ce4723-5780-43cc-9950-99c2e3c5b5a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F638E09160>]}
[0m17:11:53.507371 [info ] [MainThread]: Found 1 model, 0 tests, 0 snapshots, 0 analyses, 303 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m17:11:53.508390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '10ce4723-5780-43cc-9950-99c2e3c5b5a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F638CA0D60>]}
[0m17:11:53.509405 [info ] [MainThread]: 
[0m17:11:53.510373 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m17:11:53.512372 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m17:11:53.531416 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m17:11:53.531416 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m17:11:53.531416 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:11:54.444019 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.91 seconds
[0m17:11:54.445019 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m17:11:54.598084 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m17:11:54.606073 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m17:11:54.606073 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT"} */
show terse objects in DOOR2DOOR_DWH.DBT
[0m17:11:54.606073 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:11:55.035694 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.43 seconds
[0m17:11:55.037665 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: Close
[0m17:11:55.162075 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '10ce4723-5780-43cc-9950-99c2e3c5b5a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F638E98400>]}
[0m17:11:55.164096 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:11:55.165083 [info ] [MainThread]: 
[0m17:11:55.169717 [debug] [Thread-1  ]: Began running node model.door2door_dwh.vehicle_event_log
[0m17:11:55.170717 [info ] [Thread-1  ]: 1 of 1 START sql incremental model DBT.vehicle_event_log ....................... [RUN]
[0m17:11:55.171721 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:11:55.171721 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.vehicle_event_log
[0m17:11:55.172729 [debug] [Thread-1  ]: Compiling model.door2door_dwh.vehicle_event_log
[0m17:11:55.179720 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.vehicle_event_log"
[0m17:11:55.180719 [debug] [Thread-1  ]: finished collecting timing info
[0m17:11:55.181717 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.vehicle_event_log
[0m17:11:55.236719 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.vehicle_event_log"
[0m17:11:55.238721 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:11:55.238721 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_event_log"} */
create or replace transient table DOOR2DOOR_DWH.DBT.vehicle_event_log  as
        (

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TIMESTAMP as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
        );
[0m17:11:55.239721 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:11:56.594454 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.35 seconds
[0m17:11:56.602460 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:11:56.602460 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_event_log"} */
drop view if exists DOOR2DOOR_DWH.DBT.vehicle_event_log__dbt_tmp cascade
[0m17:11:56.685465 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m17:11:56.710460 [debug] [Thread-1  ]: finished collecting timing info
[0m17:11:56.710460 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: Close
[0m17:11:56.867272 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '10ce4723-5780-43cc-9950-99c2e3c5b5a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F63918DEB0>]}
[0m17:11:56.867272 [info ] [Thread-1  ]: 1 of 1 OK created sql incremental model DBT.vehicle_event_log .................. [[32mSUCCESS 1[0m in 1.69s]
[0m17:11:56.869248 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.vehicle_event_log
[0m17:11:56.871245 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m17:11:56.871245 [info ] [MainThread]: 
[0m17:11:56.872262 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 3.36 seconds (3.36s).
[0m17:11:56.873245 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:11:56.873245 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m17:11:56.873245 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT' was properly closed.
[0m17:11:56.874246 [debug] [MainThread]: Connection 'model.door2door_dwh.vehicle_event_log' was properly closed.
[0m17:11:56.881247 [info ] [MainThread]: 
[0m17:11:56.882961 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:11:56.884209 [info ] [MainThread]: 
[0m17:11:56.884209 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m17:11:56.885220 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F639195250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F639195C70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F639195130>]}
[0m17:11:56.886261 [debug] [MainThread]: Flushing usage events


============================== 2023-02-03 17:13:43.896212 | c1eb17d3-3e21-47c8-b974-22457c30e2b1 ==============================
[0m17:13:43.896212 [info ] [MainThread]: Running with dbt=1.3.1
[0m17:13:43.897207 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m17:13:43.897207 [debug] [MainThread]: Tracking: tracking
[0m17:13:43.897207 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029DB8703A30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029DB8703A90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029DB8703AF0>]}
[0m17:13:43.990182 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:13:43.990182 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:13:43.996182 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c1eb17d3-3e21-47c8-b974-22457c30e2b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029DB88860D0>]}
[0m17:13:44.004183 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c1eb17d3-3e21-47c8-b974-22457c30e2b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029DB876A550>]}
[0m17:13:44.004183 [info ] [MainThread]: Found 1 model, 0 tests, 0 snapshots, 0 analyses, 303 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m17:13:44.005474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c1eb17d3-3e21-47c8-b974-22457c30e2b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029DB884A4F0>]}
[0m17:13:44.006487 [info ] [MainThread]: 
[0m17:13:44.007395 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m17:13:44.009409 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m17:13:44.023433 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m17:13:44.023433 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m17:13:44.023433 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:13:45.078564 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.06 seconds
[0m17:13:45.080564 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m17:13:45.208694 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m17:13:45.214693 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m17:13:45.214693 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT"} */
show terse objects in DOOR2DOOR_DWH.DBT
[0m17:13:45.215695 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:13:45.631196 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.42 seconds
[0m17:13:45.632196 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: Close
[0m17:13:45.774109 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c1eb17d3-3e21-47c8-b974-22457c30e2b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029DB8725070>]}
[0m17:13:45.775084 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:13:45.776060 [info ] [MainThread]: 
[0m17:13:45.781677 [debug] [Thread-1  ]: Began running node model.door2door_dwh.vehicle_event_log
[0m17:13:45.782678 [info ] [Thread-1  ]: 1 of 1 START sql incremental model DBT.vehicle_event_log ....................... [RUN]
[0m17:13:45.783332 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:13:45.783332 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.vehicle_event_log
[0m17:13:45.784346 [debug] [Thread-1  ]: Compiling model.door2door_dwh.vehicle_event_log
[0m17:13:45.793375 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.vehicle_event_log"
[0m17:13:45.794346 [debug] [Thread-1  ]: finished collecting timing info
[0m17:13:45.794346 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.vehicle_event_log
[0m17:13:45.854370 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.vehicle_event_log"
[0m17:13:45.855345 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:13:45.856370 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_event_log"} */
create or replace transient table DOOR2DOOR_DWH.DBT.vehicle_event_log  as
        (

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TIMESTAMP as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
        );
[0m17:13:45.856370 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:13:51.426981 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: None
[0m17:13:51.427976 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 100071 (22000): Failed to cast variant value "vehicle" to TIMESTAMP_NTZ
[0m17:13:51.427976 [debug] [Thread-1  ]: finished collecting timing info
[0m17:13:51.428939 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: Close
[0m17:13:51.567201 [debug] [Thread-1  ]: Database Error in model vehicle_event_log (models\stg\vehicle_event_log.sql)
  100071 (22000): Failed to cast variant value "vehicle" to TIMESTAMP_NTZ
  compiled Code at target\run\door2door_dwh\models\stg\vehicle_event_log.sql
[0m17:13:51.567201 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1eb17d3-3e21-47c8-b974-22457c30e2b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029DB8B39CD0>]}
[0m17:13:51.568205 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model DBT.vehicle_event_log .............. [[31mERROR[0m in 5.78s]
[0m17:13:51.570201 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.vehicle_event_log
[0m17:13:51.573195 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m17:13:51.574195 [info ] [MainThread]: 
[0m17:13:51.575198 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 7.57 seconds (7.57s).
[0m17:13:51.576224 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:13:51.576224 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m17:13:51.577252 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT' was properly closed.
[0m17:13:51.577252 [debug] [MainThread]: Connection 'model.door2door_dwh.vehicle_event_log' was properly closed.
[0m17:13:51.591195 [info ] [MainThread]: 
[0m17:13:51.592194 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m17:13:51.593827 [info ] [MainThread]: 
[0m17:13:51.595815 [error] [MainThread]: [33mDatabase Error in model vehicle_event_log (models\stg\vehicle_event_log.sql)[0m
[0m17:13:51.600814 [error] [MainThread]:   100071 (22000): Failed to cast variant value "vehicle" to TIMESTAMP_NTZ
[0m17:13:51.601817 [error] [MainThread]:   compiled Code at target\run\door2door_dwh\models\stg\vehicle_event_log.sql
[0m17:13:51.603827 [info ] [MainThread]: 
[0m17:13:51.604814 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m17:13:51.606816 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029DB8BB9340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029DB8BB9280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029DB8BB9610>]}
[0m17:13:51.607815 [debug] [MainThread]: Flushing usage events


============================== 2023-02-03 17:14:49.318384 | e9dae43c-2adf-4927-b735-3cff086947d8 ==============================
[0m17:14:49.318384 [info ] [MainThread]: Running with dbt=1.3.1
[0m17:14:49.319353 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m17:14:49.319353 [debug] [MainThread]: Tracking: tracking
[0m17:14:49.320353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017EBADD2A00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017EBADD2A60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017EBADD2AC0>]}
[0m17:14:49.411384 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:14:49.411384 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\stg\vehicle_event_log.sql
[0m17:14:49.425383 [debug] [MainThread]: 1603: static parser failed on stg\vehicle_event_log.sql
[0m17:14:49.443383 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\vehicle_event_log.sql
[0m17:14:49.461383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e9dae43c-2adf-4927-b735-3cff086947d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017EBAFB60D0>]}
[0m17:14:49.469385 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e9dae43c-2adf-4927-b735-3cff086947d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017EBAF62D30>]}
[0m17:14:49.469385 [info ] [MainThread]: Found 1 model, 0 tests, 0 snapshots, 0 analyses, 303 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m17:14:49.470354 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e9dae43c-2adf-4927-b735-3cff086947d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017EBAF194C0>]}
[0m17:14:49.471354 [info ] [MainThread]: 
[0m17:14:49.472354 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m17:14:49.474385 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m17:14:49.490402 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m17:14:49.491354 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m17:14:49.491354 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:14:50.452872 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.96 seconds
[0m17:14:50.453885 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m17:14:50.615903 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m17:14:50.622927 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m17:14:50.622927 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT"} */
show terse objects in DOOR2DOOR_DWH.DBT
[0m17:14:50.622927 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:14:51.021773 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.4 seconds
[0m17:14:51.023799 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: Close
[0m17:14:51.188449 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e9dae43c-2adf-4927-b735-3cff086947d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017EBAF62790>]}
[0m17:14:51.189451 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:14:51.190450 [info ] [MainThread]: 
[0m17:14:51.195661 [debug] [Thread-1  ]: Began running node model.door2door_dwh.vehicle_event_log
[0m17:14:51.196658 [info ] [Thread-1  ]: 1 of 1 START sql incremental model DBT.vehicle_event_log ....................... [RUN]
[0m17:14:51.197658 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:14:51.197658 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.vehicle_event_log
[0m17:14:51.197658 [debug] [Thread-1  ]: Compiling model.door2door_dwh.vehicle_event_log
[0m17:14:51.204657 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.vehicle_event_log"
[0m17:14:51.205658 [debug] [Thread-1  ]: finished collecting timing info
[0m17:14:51.205658 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.vehicle_event_log
[0m17:14:51.272664 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.vehicle_event_log"
[0m17:14:51.274665 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:14:51.275663 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_event_log"} */
create or replace transient table DOOR2DOOR_DWH.DBT.vehicle_event_log  as
        (

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TEXT as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
        );
[0m17:14:51.275663 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:14:55.766457 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 4.49 seconds
[0m17:14:55.774490 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_event_log"
[0m17:14:55.774490 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_event_log"} */
drop view if exists DOOR2DOOR_DWH.DBT.vehicle_event_log__dbt_tmp cascade
[0m17:14:55.887601 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.11 seconds
[0m17:14:55.910624 [debug] [Thread-1  ]: finished collecting timing info
[0m17:14:55.910624 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_event_log: Close
[0m17:14:56.034163 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e9dae43c-2adf-4927-b735-3cff086947d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017EBB2DED60>]}
[0m17:14:56.035164 [info ] [Thread-1  ]: 1 of 1 OK created sql incremental model DBT.vehicle_event_log .................. [[32mSUCCESS 1[0m in 4.84s]
[0m17:14:56.036348 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.vehicle_event_log
[0m17:14:56.038400 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m17:14:56.038400 [info ] [MainThread]: 
[0m17:14:56.039400 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 6.57 seconds (6.57s).
[0m17:14:56.040400 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:14:56.040400 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m17:14:56.041401 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT' was properly closed.
[0m17:14:56.041401 [debug] [MainThread]: Connection 'model.door2door_dwh.vehicle_event_log' was properly closed.
[0m17:14:56.049402 [info ] [MainThread]: 
[0m17:14:56.050373 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:14:56.051378 [info ] [MainThread]: 
[0m17:14:56.052387 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m17:14:56.053362 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017EBB2E6730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017EBB2E6BB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017EBB2E62E0>]}
[0m17:14:56.053362 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 11:19:57.579629 | 3df6386f-d6bb-460a-8f46-0991a01acd8a ==============================
[0m11:19:57.579629 [info ] [MainThread]: Running with dbt=1.3.1
[0m11:19:57.581652 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m11:19:57.581652 [debug] [MainThread]: Tracking: tracking
[0m11:19:57.583640 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000196D4813AF0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000196D4813B50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000196D4813BB0>]}
[0m11:19:57.703638 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 6 files added, 0 files changed.
[0m11:19:57.703638 [debug] [MainThread]: Partial parsing: added file: door2door_dwh://models\dwh\fact_registration.sql
[0m11:19:57.704638 [debug] [MainThread]: Partial parsing: added file: door2door_dwh://models\dwh\dim_vehicle.sql
[0m11:19:57.704638 [debug] [MainThread]: Partial parsing: added file: door2door_dwh://models\dwh\fact_vehicle_location.sql
[0m11:19:57.704638 [debug] [MainThread]: Partial parsing: added file: door2door_dwh://models\dwh\dim_operating_period.sql
[0m11:19:57.705638 [debug] [MainThread]: Partial parsing: added file: door2door_dwh://models\stg\event_log.sql
[0m11:19:57.705638 [debug] [MainThread]: Partial parsing: added file: door2door_dwh://models\dwh\fact_deregistration.sql
[0m11:19:57.705638 [debug] [MainThread]: Partial parsing: deleted file: door2door_dwh://models\stg\vehicle_event_log.sql
[0m11:19:57.718638 [debug] [MainThread]: 1603: static parser failed on dwh\fact_registration.sql
[0m11:19:57.732639 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_registration.sql
[0m11:19:57.734639 [debug] [MainThread]: 1603: static parser failed on dwh\dim_vehicle.sql
[0m11:19:57.738639 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\dim_vehicle.sql
[0m11:19:57.740638 [debug] [MainThread]: 1603: static parser failed on dwh\fact_vehicle_location.sql
[0m11:19:57.745639 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_vehicle_location.sql
[0m11:19:57.746639 [debug] [MainThread]: 1603: static parser failed on dwh\dim_operating_period.sql
[0m11:19:57.750639 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\dim_operating_period.sql
[0m11:19:57.752639 [debug] [MainThread]: 1603: static parser failed on stg\event_log.sql
[0m11:19:57.760639 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\event_log.sql
[0m11:19:57.762639 [debug] [MainThread]: 1603: static parser failed on dwh\fact_deregistration.sql
[0m11:19:57.770640 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_deregistration.sql
[0m11:19:57.801641 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3df6386f-d6bb-460a-8f46-0991a01acd8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000196C14074C0>]}
[0m11:19:57.814654 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3df6386f-d6bb-460a-8f46-0991a01acd8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000196D4946250>]}
[0m11:19:57.814654 [info ] [MainThread]: Found 6 models, 0 tests, 0 snapshots, 0 analyses, 303 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m11:19:57.815639 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3df6386f-d6bb-460a-8f46-0991a01acd8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000196D4992070>]}
[0m11:19:57.817639 [info ] [MainThread]: 
[0m11:19:57.819639 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m11:19:57.822640 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m11:19:57.838637 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m11:19:57.839638 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m11:19:57.839638 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:19:59.012986 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.17 seconds
[0m11:19:59.015038 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m11:19:59.147609 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m11:19:59.154606 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m11:19:59.155608 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT"} */
show terse objects in DOOR2DOOR_DWH.DBT
[0m11:19:59.155608 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:19:59.724431 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.57 seconds
[0m11:19:59.726426 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: Close
[0m11:19:59.851998 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3df6386f-d6bb-460a-8f46-0991a01acd8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000196D48DC610>]}
[0m11:19:59.853029 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:19:59.854003 [info ] [MainThread]: 
[0m11:19:59.862999 [debug] [Thread-1  ]: Began running node model.door2door_dwh.event_log
[0m11:19:59.864028 [info ] [Thread-1  ]: 1 of 6 START sql incremental model DBT.event_log ............................... [RUN]
[0m11:19:59.864999 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.event_log"
[0m11:19:59.864999 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.event_log
[0m11:19:59.865999 [debug] [Thread-1  ]: Compiling model.door2door_dwh.event_log
[0m11:19:59.869999 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.event_log"
[0m11:19:59.870998 [debug] [Thread-1  ]: finished collecting timing info
[0m11:19:59.870998 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.event_log
[0m11:19:59.933000 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.event_log"
[0m11:19:59.935999 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event_log"
[0m11:19:59.935999 [debug] [Thread-1  ]: On model.door2door_dwh.event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event_log"} */
create or replace transient table DOOR2DOOR_DWH.DBT.event_log  as
        (

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TEXT as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
        );
[0m11:19:59.937001 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m11:20:12.155881 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 12.22 seconds
[0m11:20:12.162907 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event_log"
[0m11:20:12.163922 [debug] [Thread-1  ]: On model.door2door_dwh.event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event_log"} */
drop view if exists DOOR2DOOR_DWH.DBT.event_log__dbt_tmp cascade
[0m11:20:12.256356 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.09 seconds
[0m11:20:12.275351 [debug] [Thread-1  ]: finished collecting timing info
[0m11:20:12.276350 [debug] [Thread-1  ]: On model.door2door_dwh.event_log: Close
[0m11:20:12.399484 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3df6386f-d6bb-460a-8f46-0991a01acd8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000196D4D55D90>]}
[0m11:20:12.400484 [info ] [Thread-1  ]: 1 of 6 OK created sql incremental model DBT.event_log .......................... [[32mSUCCESS 1[0m in 12.53s]
[0m11:20:12.402456 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.event_log
[0m11:20:12.403456 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_operating_period
[0m11:20:12.403456 [info ] [Thread-1  ]: 2 of 6 START sql table model DBT.dim_operating_period .......................... [RUN]
[0m11:20:12.404484 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_operating_period"
[0m11:20:12.405484 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_operating_period
[0m11:20:12.405484 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_operating_period
[0m11:20:12.412319 [debug] [Thread-1  ]: finished collecting timing info
[0m11:20:12.413334 [debug] [Thread-1  ]: Compilation Error in model dim_operating_period (models\dwh\dim_operating_period.sql)
  'dbt_utils' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m11:20:12.413334 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3df6386f-d6bb-460a-8f46-0991a01acd8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000196D4D8BEB0>]}
[0m11:20:12.414329 [error] [Thread-1  ]: 2 of 6 ERROR creating sql table model DBT.dim_operating_period ................. [[31mERROR[0m in 0.01s]
[0m11:20:12.415364 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_operating_period
[0m11:20:12.415364 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_vehicle
[0m11:20:12.416445 [info ] [Thread-1  ]: 3 of 6 START sql table model DBT.dim_vehicle ................................... [RUN]
[0m11:20:12.417379 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_vehicle"
[0m11:20:12.418370 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_vehicle
[0m11:20:12.418370 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_vehicle
[0m11:20:12.421366 [debug] [Thread-1  ]: finished collecting timing info
[0m11:20:12.422366 [debug] [Thread-1  ]: Compilation Error in model dim_vehicle (models\dwh\dim_vehicle.sql)
  'dbt_utils' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m11:20:12.422366 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3df6386f-d6bb-460a-8f46-0991a01acd8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000196D4DC17C0>]}
[0m11:20:12.423366 [error] [Thread-1  ]: 3 of 6 ERROR creating sql table model DBT.dim_vehicle .......................... [[31mERROR[0m in 0.00s]
[0m11:20:12.425367 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_vehicle
[0m11:20:12.425367 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_deregistration
[0m11:20:12.426366 [info ] [Thread-1  ]: 4 of 6 SKIP relation DBT.fact_deregistration ................................... [[33mSKIP[0m]
[0m11:20:12.427367 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_deregistration
[0m11:20:12.428367 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_registration
[0m11:20:12.428367 [info ] [Thread-1  ]: 5 of 6 SKIP relation DBT.fact_registration ..................................... [[33mSKIP[0m]
[0m11:20:12.430367 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_registration
[0m11:20:12.430367 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_vehicle_location
[0m11:20:12.430367 [info ] [Thread-1  ]: 6 of 6 SKIP relation DBT.fact_vehicle_location ................................. [[33mSKIP[0m]
[0m11:20:12.432366 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_vehicle_location
[0m11:20:12.434409 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m11:20:12.435396 [info ] [MainThread]: 
[0m11:20:12.437385 [info ] [MainThread]: Finished running 1 incremental model, 5 table models in 0 hours 0 minutes and 14.62 seconds (14.62s).
[0m11:20:12.438399 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:20:12.438399 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m11:20:12.440406 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT' was properly closed.
[0m11:20:12.441389 [debug] [MainThread]: Connection 'model.door2door_dwh.dim_vehicle' was properly closed.
[0m11:20:12.449366 [info ] [MainThread]: 
[0m11:20:12.450389 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m11:20:12.451373 [info ] [MainThread]: 
[0m11:20:12.452367 [error] [MainThread]: [33mCompilation Error in model dim_operating_period (models\dwh\dim_operating_period.sql)[0m
[0m11:20:12.455381 [error] [MainThread]:   'dbt_utils' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m11:20:12.456375 [info ] [MainThread]: 
[0m11:20:12.457371 [error] [MainThread]: [33mCompilation Error in model dim_vehicle (models\dwh\dim_vehicle.sql)[0m
[0m11:20:12.459192 [error] [MainThread]:   'dbt_utils' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m11:20:12.459192 [info ] [MainThread]: 
[0m11:20:12.460202 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=2 SKIP=3 TOTAL=6
[0m11:20:12.461215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000196D4A4B0A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000196D48DCD60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000196D4D8B220>]}
[0m11:20:12.462201 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 11:20:21.515156 | 495e099c-c1f5-4f88-b25b-55276946e45f ==============================
[0m11:20:21.515156 [info ] [MainThread]: Running with dbt=1.3.1
[0m11:20:21.516157 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'deps', 'rpc_method': 'deps', 'indirect_selection': 'eager'}
[0m11:20:21.517158 [debug] [MainThread]: Tracking: tracking
[0m11:20:21.547120 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D969086190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D969086460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D969086220>]}
[0m11:20:21.547120 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m11:20:21.548124 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D9690861C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D969086220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D969086550>]}
[0m11:20:21.549159 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 11:21:03.022172 | 53d29bd0-9554-470b-b908-131b4f2a73da ==============================
[0m11:21:03.022172 [info ] [MainThread]: Running with dbt=1.3.1
[0m11:21:03.023131 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'deps', 'rpc_method': 'deps', 'indirect_selection': 'eager'}
[0m11:21:03.024128 [debug] [MainThread]: Tracking: tracking
[0m11:21:03.056129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024705E901F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024705E8B9A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024705E8BA90>]}
[0m11:21:03.058176 [debug] [MainThread]: Set downloads directory='C:\Users\Antun\AppData\Local\Temp\dbt-downloads-zlm7de97'
[0m11:21:03.059126 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m11:21:03.327702 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m11:21:03.328712 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json
[0m11:21:03.465359 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json 200
[0m11:21:03.466357 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `fishtown-analytics/dbt_utils` package is deprecated in favor of
`dbt-labs/dbt_utils`. Please update your `packages.yml` configuration to use
`dbt-labs/dbt_utils` instead.
[0m11:21:03.467359 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '53d29bd0-9554-470b-b908-131b4f2a73da', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024705E7D460>]}
[0m11:21:03.504396 [info ] [MainThread]: Installing fishtown-analytics/dbt_utils
[0m11:21:04.148702 [info ] [MainThread]:   Installed from version 0.7.0
[0m11:21:04.149704 [info ] [MainThread]:   Up to date!
[0m11:21:04.150752 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '53d29bd0-9554-470b-b908-131b4f2a73da', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024705EF6E20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024705EF6F40>]}
[0m11:21:04.151755 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024705E90850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024705E908E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024705E8B130>]}
[0m11:21:04.151755 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 11:21:10.313363 | e5eaee47-484f-4af2-aed4-ff7b0938fe34 ==============================
[0m11:21:10.313363 [info ] [MainThread]: Running with dbt=1.3.1
[0m11:21:10.314355 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m11:21:10.314355 [debug] [MainThread]: Tracking: tracking
[0m11:21:10.315338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025AB34B3A60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025AB34B3AC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025AB34B3B20>]}
[0m11:21:10.330373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025AB34E43D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025AB34E4E20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025AB34E43A0>]}
[0m11:21:10.331372 [debug] [MainThread]: Flushing usage events
[0m11:21:10.886342 [error] [MainThread]: Encountered an error:
Runtime Error
  Failed to read package: Runtime Error
    This version of dbt is not supported with the 'dbt_utils' package.
      Installed version of dbt: =1.3.1
      Required version of dbt for 'dbt_utils': ['>=0.20.0', '<0.21.0']
    Check for a different version of the 'dbt_utils' package, or run dbt again with --no-version-check
    
  
  Error encountered in C:\Users\Antun\Documents\loka\dbt\door2door_dwh\dbt_packages\dbt_utils\dbt_project.yml

Error encountered in C:\Users\Antun\Documents\loka\dbt\door2door_dwh\dbt_packages\dbt_utils


============================== 2023-02-05 11:22:07.028750 | 06bca1ff-6241-4c91-9a5b-050f95a4c58f ==============================
[0m11:22:07.028750 [info ] [MainThread]: Running with dbt=1.3.1
[0m11:22:07.029776 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': False, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m11:22:07.029776 [debug] [MainThread]: Tracking: tracking
[0m11:22:07.030723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002DEB1991790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002DEB19917F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002DEB1991850>]}
[0m11:22:07.072721 [info ] [MainThread]: Unable to do partial parsing because a project dependency has been added
[0m11:22:07.073721 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '06bca1ff-6241-4c91-9a5b-050f95a4c58f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002DEB19514C0>]}
[0m11:22:07.173757 [debug] [MainThread]: Parsing macros\adapters.sql
[0m11:22:07.216752 [debug] [MainThread]: Parsing macros\apply_grants.sql
[0m11:22:07.217752 [debug] [MainThread]: Parsing macros\catalog.sql
[0m11:22:07.219751 [debug] [MainThread]: Parsing macros\materializations\incremental.sql
[0m11:22:07.230721 [debug] [MainThread]: Parsing macros\materializations\merge.sql
[0m11:22:07.234727 [debug] [MainThread]: Parsing macros\materializations\seed.sql
[0m11:22:07.240722 [debug] [MainThread]: Parsing macros\materializations\snapshot.sql
[0m11:22:07.241722 [debug] [MainThread]: Parsing macros\materializations\table.sql
[0m11:22:07.246722 [debug] [MainThread]: Parsing macros\materializations\test.sql
[0m11:22:07.247722 [debug] [MainThread]: Parsing macros\materializations\view.sql
[0m11:22:07.248722 [debug] [MainThread]: Parsing macros\utils\array_construct.sql
[0m11:22:07.249722 [debug] [MainThread]: Parsing macros\utils\bool_or.sql
[0m11:22:07.250722 [debug] [MainThread]: Parsing macros\utils\escape_single_quotes.sql
[0m11:22:07.251722 [debug] [MainThread]: Parsing macros\utils\right.sql
[0m11:22:07.251722 [debug] [MainThread]: Parsing macros\utils\safe_cast.sql
[0m11:22:07.252722 [debug] [MainThread]: Parsing macros\utils\timestamps.sql
[0m11:22:07.254722 [debug] [MainThread]: Parsing macros\adapters\apply_grants.sql
[0m11:22:07.267721 [debug] [MainThread]: Parsing macros\adapters\columns.sql
[0m11:22:07.276722 [debug] [MainThread]: Parsing macros\adapters\freshness.sql
[0m11:22:07.278722 [debug] [MainThread]: Parsing macros\adapters\indexes.sql
[0m11:22:07.280722 [debug] [MainThread]: Parsing macros\adapters\metadata.sql
[0m11:22:07.287722 [debug] [MainThread]: Parsing macros\adapters\persist_docs.sql
[0m11:22:07.292722 [debug] [MainThread]: Parsing macros\adapters\relation.sql
[0m11:22:07.305722 [debug] [MainThread]: Parsing macros\adapters\schema.sql
[0m11:22:07.307722 [debug] [MainThread]: Parsing macros\adapters\timestamps.sql
[0m11:22:07.311722 [debug] [MainThread]: Parsing macros\etc\datetime.sql
[0m11:22:07.319722 [debug] [MainThread]: Parsing macros\etc\statement.sql
[0m11:22:07.324722 [debug] [MainThread]: Parsing macros\generic_test_sql\accepted_values.sql
[0m11:22:07.325722 [debug] [MainThread]: Parsing macros\generic_test_sql\not_null.sql
[0m11:22:07.326724 [debug] [MainThread]: Parsing macros\generic_test_sql\relationships.sql
[0m11:22:07.327723 [debug] [MainThread]: Parsing macros\generic_test_sql\unique.sql
[0m11:22:07.328723 [debug] [MainThread]: Parsing macros\get_custom_name\get_custom_alias.sql
[0m11:22:07.329723 [debug] [MainThread]: Parsing macros\get_custom_name\get_custom_database.sql
[0m11:22:07.331722 [debug] [MainThread]: Parsing macros\get_custom_name\get_custom_schema.sql
[0m11:22:07.333722 [debug] [MainThread]: Parsing macros\materializations\configs.sql
[0m11:22:07.336722 [debug] [MainThread]: Parsing macros\materializations\hooks.sql
[0m11:22:07.339722 [debug] [MainThread]: Parsing macros\materializations\models\incremental\column_helpers.sql
[0m11:22:07.347722 [debug] [MainThread]: Parsing macros\materializations\models\incremental\incremental.sql
[0m11:22:07.356722 [debug] [MainThread]: Parsing macros\materializations\models\incremental\is_incremental.sql
[0m11:22:07.358723 [debug] [MainThread]: Parsing macros\materializations\models\incremental\merge.sql
[0m11:22:07.371722 [debug] [MainThread]: Parsing macros\materializations\models\incremental\on_schema_change.sql
[0m11:22:07.386722 [debug] [MainThread]: Parsing macros\materializations\models\incremental\strategies.sql
[0m11:22:07.392722 [debug] [MainThread]: Parsing macros\materializations\models\table\create_table_as.sql
[0m11:22:07.396723 [debug] [MainThread]: Parsing macros\materializations\models\table\table.sql
[0m11:22:07.402750 [debug] [MainThread]: Parsing macros\materializations\models\view\create_or_replace_view.sql
[0m11:22:07.406751 [debug] [MainThread]: Parsing macros\materializations\models\view\create_view_as.sql
[0m11:22:07.408755 [debug] [MainThread]: Parsing macros\materializations\models\view\helpers.sql
[0m11:22:07.411765 [debug] [MainThread]: Parsing macros\materializations\models\view\view.sql
[0m11:22:07.417751 [debug] [MainThread]: Parsing macros\materializations\seeds\helpers.sql
[0m11:22:07.434750 [debug] [MainThread]: Parsing macros\materializations\seeds\seed.sql
[0m11:22:07.440751 [debug] [MainThread]: Parsing macros\materializations\snapshots\helpers.sql
[0m11:22:07.453754 [debug] [MainThread]: Parsing macros\materializations\snapshots\snapshot.sql
[0m11:22:07.465754 [debug] [MainThread]: Parsing macros\materializations\snapshots\snapshot_merge.sql
[0m11:22:07.467754 [debug] [MainThread]: Parsing macros\materializations\snapshots\strategies.sql
[0m11:22:07.484776 [debug] [MainThread]: Parsing macros\materializations\tests\helpers.sql
[0m11:22:07.486754 [debug] [MainThread]: Parsing macros\materializations\tests\test.sql
[0m11:22:07.490753 [debug] [MainThread]: Parsing macros\materializations\tests\where_subquery.sql
[0m11:22:07.492754 [debug] [MainThread]: Parsing macros\python_model\python.sql
[0m11:22:07.499755 [debug] [MainThread]: Parsing macros\utils\any_value.sql
[0m11:22:07.500753 [debug] [MainThread]: Parsing macros\utils\array_append.sql
[0m11:22:07.501726 [debug] [MainThread]: Parsing macros\utils\array_concat.sql
[0m11:22:07.502755 [debug] [MainThread]: Parsing macros\utils\array_construct.sql
[0m11:22:07.504753 [debug] [MainThread]: Parsing macros\utils\bool_or.sql
[0m11:22:07.505758 [debug] [MainThread]: Parsing macros\utils\cast_bool_to_text.sql
[0m11:22:07.507754 [debug] [MainThread]: Parsing macros\utils\concat.sql
[0m11:22:07.508755 [debug] [MainThread]: Parsing macros\utils\data_types.sql
[0m11:22:07.515754 [debug] [MainThread]: Parsing macros\utils\dateadd.sql
[0m11:22:07.517754 [debug] [MainThread]: Parsing macros\utils\datediff.sql
[0m11:22:07.519767 [debug] [MainThread]: Parsing macros\utils\date_trunc.sql
[0m11:22:07.520766 [debug] [MainThread]: Parsing macros\utils\escape_single_quotes.sql
[0m11:22:07.521725 [debug] [MainThread]: Parsing macros\utils\except.sql
[0m11:22:07.522769 [debug] [MainThread]: Parsing macros\utils\hash.sql
[0m11:22:07.524766 [debug] [MainThread]: Parsing macros\utils\intersect.sql
[0m11:22:07.525766 [debug] [MainThread]: Parsing macros\utils\last_day.sql
[0m11:22:07.527766 [debug] [MainThread]: Parsing macros\utils\length.sql
[0m11:22:07.528766 [debug] [MainThread]: Parsing macros\utils\listagg.sql
[0m11:22:07.530767 [debug] [MainThread]: Parsing macros\utils\literal.sql
[0m11:22:07.531766 [debug] [MainThread]: Parsing macros\utils\position.sql
[0m11:22:07.533753 [debug] [MainThread]: Parsing macros\utils\replace.sql
[0m11:22:07.534754 [debug] [MainThread]: Parsing macros\utils\right.sql
[0m11:22:07.536754 [debug] [MainThread]: Parsing macros\utils\safe_cast.sql
[0m11:22:07.537753 [debug] [MainThread]: Parsing macros\utils\split_part.sql
[0m11:22:07.539754 [debug] [MainThread]: Parsing tests\generic\builtin.sql
[0m11:22:07.542753 [debug] [MainThread]: Parsing macros\cross_db_utils\cast_bool_to_text.sql
[0m11:22:07.544766 [debug] [MainThread]: Parsing macros\cross_db_utils\concat.sql
[0m11:22:07.545766 [debug] [MainThread]: Parsing macros\cross_db_utils\current_timestamp.sql
[0m11:22:07.549767 [debug] [MainThread]: Parsing macros\cross_db_utils\datatypes.sql
[0m11:22:07.555753 [debug] [MainThread]: Parsing macros\cross_db_utils\dateadd.sql
[0m11:22:07.558753 [debug] [MainThread]: Parsing macros\cross_db_utils\datediff.sql
[0m11:22:07.567753 [debug] [MainThread]: Parsing macros\cross_db_utils\date_trunc.sql
[0m11:22:07.568753 [debug] [MainThread]: Parsing macros\cross_db_utils\except.sql
[0m11:22:07.569754 [debug] [MainThread]: Parsing macros\cross_db_utils\hash.sql
[0m11:22:07.571753 [debug] [MainThread]: Parsing macros\cross_db_utils\identifier.sql
[0m11:22:07.573754 [debug] [MainThread]: Parsing macros\cross_db_utils\intersect.sql
[0m11:22:07.574725 [debug] [MainThread]: Parsing macros\cross_db_utils\last_day.sql
[0m11:22:07.578753 [debug] [MainThread]: Parsing macros\cross_db_utils\length.sql
[0m11:22:07.579754 [debug] [MainThread]: Parsing macros\cross_db_utils\literal.sql
[0m11:22:07.580755 [debug] [MainThread]: Parsing macros\cross_db_utils\position.sql
[0m11:22:07.582753 [debug] [MainThread]: Parsing macros\cross_db_utils\replace.sql
[0m11:22:07.583754 [debug] [MainThread]: Parsing macros\cross_db_utils\right.sql
[0m11:22:07.585759 [debug] [MainThread]: Parsing macros\cross_db_utils\safe_cast.sql
[0m11:22:07.587754 [debug] [MainThread]: Parsing macros\cross_db_utils\split_part.sql
[0m11:22:07.589754 [debug] [MainThread]: Parsing macros\cross_db_utils\width_bucket.sql
[0m11:22:07.594754 [debug] [MainThread]: Parsing macros\cross_db_utils\_is_ephemeral.sql
[0m11:22:07.596753 [debug] [MainThread]: Parsing macros\cross_db_utils\_is_relation.sql
[0m11:22:07.597754 [debug] [MainThread]: Parsing macros\jinja_helpers\log_info.sql
[0m11:22:07.599754 [debug] [MainThread]: Parsing macros\jinja_helpers\pretty_log_format.sql
[0m11:22:07.600754 [debug] [MainThread]: Parsing macros\jinja_helpers\pretty_time.sql
[0m11:22:07.601725 [debug] [MainThread]: Parsing macros\jinja_helpers\slugify.sql
[0m11:22:07.602754 [debug] [MainThread]: Parsing macros\materializations\insert_by_period_materialization.sql
[0m11:22:07.624753 [debug] [MainThread]: Parsing macros\schema_tests\accepted_range.sql
[0m11:22:07.627758 [debug] [MainThread]: Parsing macros\schema_tests\at_least_one.sql
[0m11:22:07.628726 [debug] [MainThread]: Parsing macros\schema_tests\cardinality_equality.sql
[0m11:22:07.630759 [debug] [MainThread]: Parsing macros\schema_tests\equality.sql
[0m11:22:07.634725 [debug] [MainThread]: Parsing macros\schema_tests\equal_rowcount.sql
[0m11:22:07.637758 [debug] [MainThread]: Parsing macros\schema_tests\expression_is_true.sql
[0m11:22:07.639760 [debug] [MainThread]: Parsing macros\schema_tests\fewer_rows_than.sql
[0m11:22:07.641754 [debug] [MainThread]: Parsing macros\schema_tests\mutually_exclusive_ranges.sql
[0m11:22:07.649726 [debug] [MainThread]: Parsing macros\schema_tests\not_accepted_values.sql
[0m11:22:07.651759 [debug] [MainThread]: Parsing macros\schema_tests\not_constant.sql
[0m11:22:07.653754 [debug] [MainThread]: Parsing macros\schema_tests\recency.sql
[0m11:22:07.654754 [debug] [MainThread]: Parsing macros\schema_tests\relationships_where.sql
[0m11:22:07.657754 [debug] [MainThread]: Parsing macros\schema_tests\sequential_values.sql
[0m11:22:07.659754 [debug] [MainThread]: Parsing macros\schema_tests\test_not_null_where.sql
[0m11:22:07.661754 [debug] [MainThread]: Parsing macros\schema_tests\test_unique_where.sql
[0m11:22:07.662756 [debug] [MainThread]: Parsing macros\schema_tests\unique_combination_of_columns.sql
[0m11:22:07.665754 [debug] [MainThread]: Parsing macros\sql\date_spine.sql
[0m11:22:07.670754 [debug] [MainThread]: Parsing macros\sql\generate_series.sql
[0m11:22:07.674754 [debug] [MainThread]: Parsing macros\sql\get_column_values.sql
[0m11:22:07.678753 [debug] [MainThread]: Parsing macros\sql\get_query_results_as_dict.sql
[0m11:22:07.681753 [debug] [MainThread]: Parsing macros\sql\get_relations_by_pattern.sql
[0m11:22:07.684754 [debug] [MainThread]: Parsing macros\sql\get_relations_by_prefix.sql
[0m11:22:07.687754 [debug] [MainThread]: Parsing macros\sql\get_tables_by_pattern_sql.sql
[0m11:22:07.693754 [debug] [MainThread]: Parsing macros\sql\get_tables_by_prefix_sql.sql
[0m11:22:07.695754 [debug] [MainThread]: Parsing macros\sql\groupby.sql
[0m11:22:07.696755 [debug] [MainThread]: Parsing macros\sql\haversine_distance.sql
[0m11:22:07.702754 [debug] [MainThread]: Parsing macros\sql\nullcheck.sql
[0m11:22:07.703754 [debug] [MainThread]: Parsing macros\sql\nullcheck_table.sql
[0m11:22:07.705754 [debug] [MainThread]: Parsing macros\sql\pivot.sql
[0m11:22:07.709755 [debug] [MainThread]: Parsing macros\sql\safe_add.sql
[0m11:22:07.711754 [debug] [MainThread]: Parsing macros\sql\star.sql
[0m11:22:07.715754 [debug] [MainThread]: Parsing macros\sql\surrogate_key.sql
[0m11:22:07.718754 [debug] [MainThread]: Parsing macros\sql\union.sql
[0m11:22:07.726754 [debug] [MainThread]: Parsing macros\sql\unpivot.sql
[0m11:22:07.733754 [debug] [MainThread]: Parsing macros\web\get_url_host.sql
[0m11:22:07.735754 [debug] [MainThread]: Parsing macros\web\get_url_parameter.sql
[0m11:22:07.737726 [debug] [MainThread]: Parsing macros\web\get_url_path.sql
[0m11:22:08.149726 [debug] [MainThread]: 1603: static parser failed on dwh\dim_operating_period.sql
[0m11:22:08.163728 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\dim_operating_period.sql
[0m11:22:08.164728 [debug] [MainThread]: 1603: static parser failed on dwh\dim_vehicle.sql
[0m11:22:08.169727 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\dim_vehicle.sql
[0m11:22:08.170734 [debug] [MainThread]: 1603: static parser failed on dwh\fact_deregistration.sql
[0m11:22:08.176727 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_deregistration.sql
[0m11:22:08.178727 [debug] [MainThread]: 1603: static parser failed on dwh\fact_registration.sql
[0m11:22:08.183728 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_registration.sql
[0m11:22:08.185728 [debug] [MainThread]: 1603: static parser failed on dwh\fact_vehicle_location.sql
[0m11:22:08.190728 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_vehicle_location.sql
[0m11:22:08.192727 [debug] [MainThread]: 1603: static parser failed on stg\event_log.sql
[0m11:22:08.201729 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\event_log.sql
[0m11:22:08.238730 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'my_first_dbt_model' in the 'models' section of file 'models\dwh\schema.yml'
[0m11:22:08.241755 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'my_second_dbt_model' in the 'models' section of file 'models\dwh\schema.yml'
[0m11:22:08.259730 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.door2door_dwh.unique_my_first_dbt_model_id.16e066b321' (models\dwh\schema.yml) depends on a node named 'my_first_dbt_model' which was not found
[0m11:22:08.260730 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.door2door_dwh.not_null_my_first_dbt_model_id.5fb22c2710' (models\dwh\schema.yml) depends on a node named 'my_first_dbt_model' which was not found
[0m11:22:08.262737 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.door2door_dwh.unique_my_second_dbt_model_id.57a0f8c493' (models\dwh\schema.yml) depends on a node named 'my_second_dbt_model' which was not found
[0m11:22:08.263808 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.door2door_dwh.not_null_my_second_dbt_model_id.151b76d778' (models\dwh\schema.yml) depends on a node named 'my_second_dbt_model' which was not found
[0m11:22:08.311771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '06bca1ff-6241-4c91-9a5b-050f95a4c58f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002DEB1B52250>]}
[0m11:22:08.322758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '06bca1ff-6241-4c91-9a5b-050f95a4c58f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002DEB1BAADF0>]}
[0m11:22:08.322758 [info ] [MainThread]: Found 6 models, 0 tests, 0 snapshots, 0 analyses, 488 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m11:22:08.323728 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '06bca1ff-6241-4c91-9a5b-050f95a4c58f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002DEB1BE5100>]}
[0m11:22:08.325770 [info ] [MainThread]: 
[0m11:22:08.326774 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m11:22:08.328732 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m11:22:08.342732 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m11:22:08.342732 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m11:22:08.343732 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:22:09.438182 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.1 seconds
[0m11:22:09.439182 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m11:22:09.576043 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m11:22:09.583052 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m11:22:09.584043 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT"} */
show terse objects in DOOR2DOOR_DWH.DBT
[0m11:22:09.584043 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:22:09.988974 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.4 seconds
[0m11:22:09.989971 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: Close
[0m11:22:10.126164 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '06bca1ff-6241-4c91-9a5b-050f95a4c58f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002DEB1BF01F0>]}
[0m11:22:10.127166 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:22:10.128197 [info ] [MainThread]: 
[0m11:22:10.143706 [debug] [Thread-1  ]: Began running node model.door2door_dwh.event_log
[0m11:22:10.144714 [info ] [Thread-1  ]: 1 of 6 START sql incremental model DBT.event_log ............................... [RUN]
[0m11:22:10.145712 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.event_log"
[0m11:22:10.145712 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.event_log
[0m11:22:10.145712 [debug] [Thread-1  ]: Compiling model.door2door_dwh.event_log
[0m11:22:10.153708 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.event_log"
[0m11:22:10.153708 [debug] [Thread-1  ]: finished collecting timing info
[0m11:22:10.154707 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.event_log
[0m11:22:10.211735 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.event_log"
[0m11:22:10.213710 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event_log"
[0m11:22:10.213710 [debug] [Thread-1  ]: On model.door2door_dwh.event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event_log"} */
create or replace transient table DOOR2DOOR_DWH.DBT.event_log  as
        (

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TEXT as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
        );
[0m11:22:10.213710 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m11:22:16.392133 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 6.18 seconds
[0m11:22:16.401173 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event_log"
[0m11:22:16.401173 [debug] [Thread-1  ]: On model.door2door_dwh.event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event_log"} */
drop view if exists DOOR2DOOR_DWH.DBT.event_log__dbt_tmp cascade
[0m11:22:16.492132 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.09 seconds
[0m11:22:16.559556 [debug] [Thread-1  ]: finished collecting timing info
[0m11:22:16.560559 [debug] [Thread-1  ]: On model.door2door_dwh.event_log: Close
[0m11:22:16.701555 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06bca1ff-6241-4c91-9a5b-050f95a4c58f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002DEB1BF0FA0>]}
[0m11:22:16.701555 [info ] [Thread-1  ]: 1 of 6 OK created sql incremental model DBT.event_log .......................... [[32mSUCCESS 1[0m in 6.56s]
[0m11:22:16.703557 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.event_log
[0m11:22:16.704555 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_operating_period
[0m11:22:16.705556 [info ] [Thread-1  ]: 2 of 6 START sql table model DBT.dim_operating_period .......................... [RUN]
[0m11:22:16.706555 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_operating_period"
[0m11:22:16.706555 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_operating_period
[0m11:22:16.707587 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_operating_period
[0m11:22:16.717569 [debug] [Thread-1  ]: finished collecting timing info
[0m11:22:16.719557 [debug] [Thread-1  ]: Compilation Error in model dim_operating_period (models\dwh\dim_operating_period.sql)
  'dict object' has no attribute 'generate_surrogate_key'. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m11:22:16.719557 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06bca1ff-6241-4c91-9a5b-050f95a4c58f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002DEB1F48C40>]}
[0m11:22:16.719557 [error] [Thread-1  ]: 2 of 6 ERROR creating sql table model DBT.dim_operating_period ................. [[31mERROR[0m in 0.01s]
[0m11:22:16.721585 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_operating_period
[0m11:22:16.721585 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_vehicle
[0m11:22:16.723556 [info ] [Thread-1  ]: 3 of 6 START sql table model DBT.dim_vehicle ................................... [RUN]
[0m11:22:16.725558 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_vehicle"
[0m11:22:16.725558 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_vehicle
[0m11:22:16.726556 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_vehicle
[0m11:22:16.733556 [debug] [Thread-1  ]: finished collecting timing info
[0m11:22:16.734587 [debug] [Thread-1  ]: Compilation Error in model dim_vehicle (models\dwh\dim_vehicle.sql)
  'dict object' has no attribute 'generate_surrogate_key'. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m11:22:16.734587 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06bca1ff-6241-4c91-9a5b-050f95a4c58f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002DEB1F5FB20>]}
[0m11:22:16.735586 [error] [Thread-1  ]: 3 of 6 ERROR creating sql table model DBT.dim_vehicle .......................... [[31mERROR[0m in 0.01s]
[0m11:22:16.736558 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_vehicle
[0m11:22:16.736558 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_deregistration
[0m11:22:16.737555 [info ] [Thread-1  ]: 4 of 6 SKIP relation DBT.fact_deregistration ................................... [[33mSKIP[0m]
[0m11:22:16.739556 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_deregistration
[0m11:22:16.739556 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_registration
[0m11:22:16.740560 [info ] [Thread-1  ]: 5 of 6 SKIP relation DBT.fact_registration ..................................... [[33mSKIP[0m]
[0m11:22:16.741566 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_registration
[0m11:22:16.742556 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_vehicle_location
[0m11:22:16.744558 [info ] [Thread-1  ]: 6 of 6 SKIP relation DBT.fact_vehicle_location ................................. [[33mSKIP[0m]
[0m11:22:16.746568 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_vehicle_location
[0m11:22:16.749559 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m11:22:16.750561 [info ] [MainThread]: 
[0m11:22:16.751555 [info ] [MainThread]: Finished running 1 incremental model, 5 table models in 0 hours 0 minutes and 8.42 seconds (8.42s).
[0m11:22:16.752557 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:22:16.752557 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m11:22:16.752557 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT' was properly closed.
[0m11:22:16.753562 [debug] [MainThread]: Connection 'model.door2door_dwh.dim_vehicle' was properly closed.
[0m11:22:16.771556 [info ] [MainThread]: 
[0m11:22:16.772557 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m11:22:16.773556 [info ] [MainThread]: 
[0m11:22:16.774555 [error] [MainThread]: [33mCompilation Error in model dim_operating_period (models\dwh\dim_operating_period.sql)[0m
[0m11:22:16.775554 [error] [MainThread]:   'dict object' has no attribute 'generate_surrogate_key'. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m11:22:16.776557 [info ] [MainThread]: 
[0m11:22:16.776557 [error] [MainThread]: [33mCompilation Error in model dim_vehicle (models\dwh\dim_vehicle.sql)[0m
[0m11:22:16.778564 [error] [MainThread]:   'dict object' has no attribute 'generate_surrogate_key'. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m11:22:16.779559 [info ] [MainThread]: 
[0m11:22:16.780559 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=2 SKIP=3 TOTAL=6
[0m11:22:16.781555 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002DEAF599BE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002DEB1B52FA0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002DEB1BE56A0>]}
[0m11:22:16.782557 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 11:23:07.181492 | f948ad30-79a9-48f3-8678-493b59a359dc ==============================
[0m11:23:07.181492 [info ] [MainThread]: Running with dbt=1.3.1
[0m11:23:07.182492 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'deps', 'rpc_method': 'deps', 'indirect_selection': 'eager'}
[0m11:23:07.182492 [debug] [MainThread]: Tracking: tracking
[0m11:23:07.213500 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C6822E01F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C6822DB9A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C6822DBB50>]}
[0m11:23:07.214493 [debug] [MainThread]: Set downloads directory='C:\Users\Antun\AppData\Local\Temp\dbt-downloads-rda27fso'
[0m11:23:07.215494 [debug] [MainThread]: Executing "git clone --depth 1 https://github.com/dbt-labs/dbt-utils.git b03949bb53de3439f6a8057088ba4032"
[0m11:23:08.440507 [debug] [MainThread]: STDOUT: "b''"
[0m11:23:08.440507 [debug] [MainThread]: STDERR: "b"Cloning into 'b03949bb53de3439f6a8057088ba4032'...\n""
[0m11:23:08.440507 [debug] [MainThread]: Pulling new dependency b03949bb53de3439f6a8057088ba4032.
[0m11:23:08.441475 [debug] [MainThread]: Executing "git rev-parse HEAD"
[0m11:23:08.492476 [debug] [MainThread]: STDOUT: "b'eaa0e41b033bdf252eff0ae014ec11888f37ebff\n'"
[0m11:23:08.492476 [debug] [MainThread]: STDERR: "b''"
[0m11:23:08.493477 [debug] [MainThread]:   Checking out revision 1.0.0.
[0m11:23:08.493477 [debug] [MainThread]: Executing "git remote set-branches origin 1.0.0"
[0m11:23:08.546476 [debug] [MainThread]: STDOUT: "b''"
[0m11:23:08.547503 [debug] [MainThread]: STDERR: "b''"
[0m11:23:08.547503 [debug] [MainThread]: Executing "git fetch origin --depth 1 --tags 1.0.0"
[0m11:23:09.793829 [debug] [MainThread]: STDOUT: "b''"
[0m11:23:09.793829 [debug] [MainThread]: STDERR: "b'From https://github.com/dbt-labs/dbt-utils\n * tag               1.0.0      -> FETCH_HEAD\n * [new tag]         0.0.1      -> 0.0.1\n * [new tag]         0.1.0      -> 0.1.0\n * [new tag]         0.1.1      -> 0.1.1\n * [new tag]         0.1.10     -> 0.1.10\n * [new tag]         0.1.11     -> 0.1.11\n * [new tag]         0.1.12     -> 0.1.12\n * [new tag]         0.1.13     -> 0.1.13\n * [new tag]         0.1.14     -> 0.1.14\n * [new tag]         0.1.15     -> 0.1.15\n * [new tag]         0.1.16     -> 0.1.16\n * [new tag]         0.1.17     -> 0.1.17\n * [new tag]         0.1.18     -> 0.1.18\n * [new tag]         0.1.19     -> 0.1.19\n * [new tag]         0.1.2      -> 0.1.2\n * [new tag]         0.1.20     -> 0.1.20\n * [new tag]         0.1.21     -> 0.1.21\n * [new tag]         0.1.22     -> 0.1.22\n * [new tag]         0.1.23     -> 0.1.23\n * [new tag]         0.1.24     -> 0.1.24\n * [new tag]         0.1.25     -> 0.1.25\n * [new tag]         0.1.3      -> 0.1.3\n * [new tag]         0.1.4      -> 0.1.4\n * [new tag]         0.1.5      -> 0.1.5\n * [new tag]         0.1.6      -> 0.1.6\n * [new tag]         0.1.7      -> 0.1.7\n * [new tag]         0.1.8      -> 0.1.8\n * [new tag]         0.1.9      -> 0.1.9\n * [new tag]         0.2.0      -> 0.2.0\n * [new tag]         0.2.1      -> 0.2.1\n * [new tag]         0.2.2      -> 0.2.2\n * [new tag]         0.2.3      -> 0.2.3\n * [new tag]         0.2.4      -> 0.2.4\n * [new tag]         0.2.5      -> 0.2.5\n * [new tag]         0.3.0      -> 0.3.0\n * [new tag]         0.4.0      -> 0.4.0\n * [new tag]         0.4.1      -> 0.4.1\n * [new tag]         0.5.0      -> 0.5.0\n * [new tag]         0.5.1      -> 0.5.1\n * [new tag]         0.6.0      -> 0.6.0\n * [new tag]         0.6.1      -> 0.6.1\n * [new tag]         0.6.2      -> 0.6.2\n * [new tag]         0.6.3      -> 0.6.3\n * [new tag]         0.6.4      -> 0.6.4\n * [new tag]         0.6.5      -> 0.6.5\n * [new tag]         0.6.6      -> 0.6.6\n * [new tag]         0.7.0      -> 0.7.0\n * [new tag]         0.7.1      -> 0.7.1\n * [new tag]         0.7.2      -> 0.7.2\n * [new tag]         0.7.3      -> 0.7.3\n * [new tag]         0.7.4      -> 0.7.4\n * [new tag]         0.7.4-b1   -> 0.7.4-b1\n * [new tag]         0.7.4b1    -> 0.7.4b1\n * [new tag]         0.7.5      -> 0.7.5\n * [new tag]         0.7.6      -> 0.7.6\n * [new tag]         0.8.0      -> 0.8.0\n * [new tag]         0.8.1      -> 0.8.1\n * [new tag]         0.8.2      -> 0.8.2\n * [new tag]         0.8.3      -> 0.8.3\n * [new tag]         0.8.4      -> 0.8.4\n * [new tag]         0.8.5      -> 0.8.5\n * [new tag]         0.8.6      -> 0.8.6\n * [new tag]         0.9.0      -> 0.9.0\n * [new tag]         0.9.1      -> 0.9.1\n * [new tag]         0.9.2      -> 0.9.2\n * [new tag]         0.9.5      -> 0.9.5\n * [new tag]         0.9.6      -> 0.9.6\n * [new tag]         1.0.0      -> 1.0.0\n * [new tag]         1.0.0-b1   -> 1.0.0-b1\n * [new tag]         1.0.0-b2   -> 1.0.0-b2\n * [new tag]         1.0.0-rc1  -> 1.0.0-rc1\n'"
[0m11:23:09.794861 [debug] [MainThread]: Executing "git tag --list"
[0m11:23:09.867831 [debug] [MainThread]: STDOUT: "b'0.0.1\n0.1.0\n0.1.1\n0.1.10\n0.1.11\n0.1.12\n0.1.13\n0.1.14\n0.1.15\n0.1.16\n0.1.17\n0.1.18\n0.1.19\n0.1.2\n0.1.20\n0.1.21\n0.1.22\n0.1.23\n0.1.24\n0.1.25\n0.1.3\n0.1.4\n0.1.5\n0.1.6\n0.1.7\n0.1.8\n0.1.9\n0.2.0\n0.2.1\n0.2.2\n0.2.3\n0.2.4\n0.2.5\n0.3.0\n0.4.0\n0.4.1\n0.5.0\n0.5.1\n0.6.0\n0.6.1\n0.6.2\n0.6.3\n0.6.4\n0.6.5\n0.6.6\n0.7.0\n0.7.1\n0.7.2\n0.7.3\n0.7.4\n0.7.4-b1\n0.7.4b1\n0.7.5\n0.7.6\n0.8.0\n0.8.1\n0.8.2\n0.8.3\n0.8.4\n0.8.5\n0.8.6\n0.9.0\n0.9.1\n0.9.2\n0.9.5\n0.9.6\n1.0.0\n1.0.0-b1\n1.0.0-b2\n1.0.0-rc1\n'"
[0m11:23:09.868830 [debug] [MainThread]: STDERR: "b''"
[0m11:23:09.869830 [debug] [MainThread]: Executing "git reset --hard tags/1.0.0"
[0m11:23:09.991832 [debug] [MainThread]: STDOUT: "b'HEAD is now at 84cf0f2 Update CHANGELOG.md\n'"
[0m11:23:09.991832 [debug] [MainThread]: STDERR: "b''"
[0m11:23:09.992859 [debug] [MainThread]: Executing "git rev-parse HEAD"
[0m11:23:10.032831 [debug] [MainThread]: STDOUT: "b'84cf0f2971f5bf539b06c42373a5e80b59ba7047\n'"
[0m11:23:10.032831 [debug] [MainThread]: STDERR: "b''"
[0m11:23:10.033860 [debug] [MainThread]:   Checked out at 84cf0f2.
[0m11:23:10.039872 [debug] [MainThread]: Executing "git clone --depth 1 https://github.com/dbt-labs/dbt-utils.git b03949bb53de3439f6a8057088ba4032"
[0m11:23:10.078871 [debug] [MainThread]: STDOUT: "b''"
[0m11:23:10.078871 [debug] [MainThread]: STDERR: "b"fatal: destination path 'b03949bb53de3439f6a8057088ba4032' already exists and is not an empty directory.\n""
[0m11:23:10.078871 [debug] [MainThread]: command return code=128
[0m11:23:10.079834 [debug] [MainThread]: Updating existing dependency b03949bb53de3439f6a8057088ba4032.
[0m11:23:10.079834 [debug] [MainThread]: Executing "git rev-parse HEAD"
[0m11:23:10.119832 [debug] [MainThread]: STDOUT: "b'84cf0f2971f5bf539b06c42373a5e80b59ba7047\n'"
[0m11:23:10.119832 [debug] [MainThread]: STDERR: "b''"
[0m11:23:10.120828 [debug] [MainThread]:   Checking out revision 1.0.0.
[0m11:23:10.120828 [debug] [MainThread]: Executing "git remote set-branches origin 1.0.0"
[0m11:23:10.162831 [debug] [MainThread]: STDOUT: "b''"
[0m11:23:10.162831 [debug] [MainThread]: STDERR: "b''"
[0m11:23:10.162831 [debug] [MainThread]: Executing "git fetch origin --depth 1 --tags 1.0.0"
[0m11:23:10.980791 [debug] [MainThread]: STDOUT: "b''"
[0m11:23:10.981787 [debug] [MainThread]: STDERR: "b'From https://github.com/dbt-labs/dbt-utils\n * tag               1.0.0      -> FETCH_HEAD\n'"
[0m11:23:10.981787 [debug] [MainThread]: Executing "git tag --list"
[0m11:23:11.033787 [debug] [MainThread]: STDOUT: "b'0.0.1\n0.1.0\n0.1.1\n0.1.10\n0.1.11\n0.1.12\n0.1.13\n0.1.14\n0.1.15\n0.1.16\n0.1.17\n0.1.18\n0.1.19\n0.1.2\n0.1.20\n0.1.21\n0.1.22\n0.1.23\n0.1.24\n0.1.25\n0.1.3\n0.1.4\n0.1.5\n0.1.6\n0.1.7\n0.1.8\n0.1.9\n0.2.0\n0.2.1\n0.2.2\n0.2.3\n0.2.4\n0.2.5\n0.3.0\n0.4.0\n0.4.1\n0.5.0\n0.5.1\n0.6.0\n0.6.1\n0.6.2\n0.6.3\n0.6.4\n0.6.5\n0.6.6\n0.7.0\n0.7.1\n0.7.2\n0.7.3\n0.7.4\n0.7.4-b1\n0.7.4b1\n0.7.5\n0.7.6\n0.8.0\n0.8.1\n0.8.2\n0.8.3\n0.8.4\n0.8.5\n0.8.6\n0.9.0\n0.9.1\n0.9.2\n0.9.5\n0.9.6\n1.0.0\n1.0.0-b1\n1.0.0-b2\n1.0.0-rc1\n'"
[0m11:23:11.034788 [debug] [MainThread]: STDERR: "b''"
[0m11:23:11.034788 [debug] [MainThread]: Executing "git reset --hard tags/1.0.0"
[0m11:23:11.098787 [debug] [MainThread]: STDOUT: "b'HEAD is now at 84cf0f2 Update CHANGELOG.md\n'"
[0m11:23:11.098787 [debug] [MainThread]: STDERR: "b''"
[0m11:23:11.099787 [debug] [MainThread]: Executing "git rev-parse HEAD"
[0m11:23:11.138787 [debug] [MainThread]: STDOUT: "b'84cf0f2971f5bf539b06c42373a5e80b59ba7047\n'"
[0m11:23:11.138787 [debug] [MainThread]: STDERR: "b''"
[0m11:23:11.138787 [debug] [MainThread]: Already at 84cf0f2, nothing to do.
[0m11:23:11.144788 [info ] [MainThread]: Installing https://github.com/dbt-labs/dbt-utils.git
[0m11:23:11.192787 [debug] [MainThread]: Executing "git clone --depth 1 https://github.com/dbt-labs/dbt-utils.git b03949bb53de3439f6a8057088ba4032"
[0m11:23:11.233791 [debug] [MainThread]: STDOUT: "b''"
[0m11:23:11.233791 [debug] [MainThread]: STDERR: "b"fatal: destination path 'b03949bb53de3439f6a8057088ba4032' already exists and is not an empty directory.\n""
[0m11:23:11.234788 [debug] [MainThread]: command return code=128
[0m11:23:11.234788 [debug] [MainThread]: Updating existing dependency b03949bb53de3439f6a8057088ba4032.
[0m11:23:11.235788 [debug] [MainThread]: Executing "git rev-parse HEAD"
[0m11:23:11.275795 [debug] [MainThread]: STDOUT: "b'84cf0f2971f5bf539b06c42373a5e80b59ba7047\n'"
[0m11:23:11.275795 [debug] [MainThread]: STDERR: "b''"
[0m11:23:11.276788 [debug] [MainThread]:   Checking out revision 1.0.0.
[0m11:23:11.276788 [debug] [MainThread]: Executing "git remote set-branches origin 1.0.0"
[0m11:23:11.322790 [debug] [MainThread]: STDOUT: "b''"
[0m11:23:11.322790 [debug] [MainThread]: STDERR: "b''"
[0m11:23:11.323788 [debug] [MainThread]: Executing "git fetch origin --depth 1 --tags 1.0.0"
[0m11:23:12.096168 [debug] [MainThread]: STDOUT: "b''"
[0m11:23:12.096168 [debug] [MainThread]: STDERR: "b'From https://github.com/dbt-labs/dbt-utils\n * tag               1.0.0      -> FETCH_HEAD\n'"
[0m11:23:12.096168 [debug] [MainThread]: Executing "git tag --list"
[0m11:23:12.148113 [debug] [MainThread]: STDOUT: "b'0.0.1\n0.1.0\n0.1.1\n0.1.10\n0.1.11\n0.1.12\n0.1.13\n0.1.14\n0.1.15\n0.1.16\n0.1.17\n0.1.18\n0.1.19\n0.1.2\n0.1.20\n0.1.21\n0.1.22\n0.1.23\n0.1.24\n0.1.25\n0.1.3\n0.1.4\n0.1.5\n0.1.6\n0.1.7\n0.1.8\n0.1.9\n0.2.0\n0.2.1\n0.2.2\n0.2.3\n0.2.4\n0.2.5\n0.3.0\n0.4.0\n0.4.1\n0.5.0\n0.5.1\n0.6.0\n0.6.1\n0.6.2\n0.6.3\n0.6.4\n0.6.5\n0.6.6\n0.7.0\n0.7.1\n0.7.2\n0.7.3\n0.7.4\n0.7.4-b1\n0.7.4b1\n0.7.5\n0.7.6\n0.8.0\n0.8.1\n0.8.2\n0.8.3\n0.8.4\n0.8.5\n0.8.6\n0.9.0\n0.9.1\n0.9.2\n0.9.5\n0.9.6\n1.0.0\n1.0.0-b1\n1.0.0-b2\n1.0.0-rc1\n'"
[0m11:23:12.149112 [debug] [MainThread]: STDERR: "b''"
[0m11:23:12.149112 [debug] [MainThread]: Executing "git reset --hard tags/1.0.0"
[0m11:23:12.208125 [debug] [MainThread]: STDOUT: "b'HEAD is now at 84cf0f2 Update CHANGELOG.md\n'"
[0m11:23:12.208125 [debug] [MainThread]: STDERR: "b''"
[0m11:23:12.209113 [debug] [MainThread]: Executing "git rev-parse HEAD"
[0m11:23:12.250114 [debug] [MainThread]: STDOUT: "b'84cf0f2971f5bf539b06c42373a5e80b59ba7047\n'"
[0m11:23:12.250114 [debug] [MainThread]: STDERR: "b''"
[0m11:23:12.250114 [debug] [MainThread]: Already at 84cf0f2, nothing to do.
[0m11:23:12.253113 [info ] [MainThread]:   Installed from revision 1.0.0
[0m11:23:12.254114 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'f948ad30-79a9-48f3-8678-493b59a359dc', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C6823036A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C682303F70>]}
[0m11:23:12.254114 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C682303F70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C6823036A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C682303B80>]}
[0m11:23:12.255115 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 11:23:17.489565 | 0a23f7df-78b9-486c-881b-fe2dfe06e64d ==============================
[0m11:23:17.489565 [info ] [MainThread]: Running with dbt=1.3.1
[0m11:23:17.490535 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': False, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m11:23:17.490535 [debug] [MainThread]: Tracking: tracking
[0m11:23:17.491550 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF929307C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF92930820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF92930880>]}
[0m11:23:17.537535 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m11:23:17.538538 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '0a23f7df-78b9-486c-881b-fe2dfe06e64d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF928FF400>]}
[0m11:23:17.634538 [debug] [MainThread]: Parsing macros\adapters.sql
[0m11:23:17.682545 [debug] [MainThread]: Parsing macros\apply_grants.sql
[0m11:23:17.684536 [debug] [MainThread]: Parsing macros\catalog.sql
[0m11:23:17.686536 [debug] [MainThread]: Parsing macros\materializations\incremental.sql
[0m11:23:17.697536 [debug] [MainThread]: Parsing macros\materializations\merge.sql
[0m11:23:17.701537 [debug] [MainThread]: Parsing macros\materializations\seed.sql
[0m11:23:17.709538 [debug] [MainThread]: Parsing macros\materializations\snapshot.sql
[0m11:23:17.710538 [debug] [MainThread]: Parsing macros\materializations\table.sql
[0m11:23:17.716539 [debug] [MainThread]: Parsing macros\materializations\test.sql
[0m11:23:17.718538 [debug] [MainThread]: Parsing macros\materializations\view.sql
[0m11:23:17.719538 [debug] [MainThread]: Parsing macros\utils\array_construct.sql
[0m11:23:17.720565 [debug] [MainThread]: Parsing macros\utils\bool_or.sql
[0m11:23:17.721539 [debug] [MainThread]: Parsing macros\utils\escape_single_quotes.sql
[0m11:23:17.722567 [debug] [MainThread]: Parsing macros\utils\right.sql
[0m11:23:17.723539 [debug] [MainThread]: Parsing macros\utils\safe_cast.sql
[0m11:23:17.723539 [debug] [MainThread]: Parsing macros\utils\timestamps.sql
[0m11:23:17.726567 [debug] [MainThread]: Parsing macros\adapters\apply_grants.sql
[0m11:23:17.740566 [debug] [MainThread]: Parsing macros\adapters\columns.sql
[0m11:23:17.751569 [debug] [MainThread]: Parsing macros\adapters\freshness.sql
[0m11:23:17.754581 [debug] [MainThread]: Parsing macros\adapters\indexes.sql
[0m11:23:17.757535 [debug] [MainThread]: Parsing macros\adapters\metadata.sql
[0m11:23:17.765535 [debug] [MainThread]: Parsing macros\adapters\persist_docs.sql
[0m11:23:17.770535 [debug] [MainThread]: Parsing macros\adapters\relation.sql
[0m11:23:17.787566 [debug] [MainThread]: Parsing macros\adapters\schema.sql
[0m11:23:17.791566 [debug] [MainThread]: Parsing macros\adapters\timestamps.sql
[0m11:23:17.797567 [debug] [MainThread]: Parsing macros\etc\datetime.sql
[0m11:23:17.807540 [debug] [MainThread]: Parsing macros\etc\statement.sql
[0m11:23:17.812540 [debug] [MainThread]: Parsing macros\generic_test_sql\accepted_values.sql
[0m11:23:17.815537 [debug] [MainThread]: Parsing macros\generic_test_sql\not_null.sql
[0m11:23:17.816541 [debug] [MainThread]: Parsing macros\generic_test_sql\relationships.sql
[0m11:23:17.817541 [debug] [MainThread]: Parsing macros\generic_test_sql\unique.sql
[0m11:23:17.818541 [debug] [MainThread]: Parsing macros\get_custom_name\get_custom_alias.sql
[0m11:23:17.820540 [debug] [MainThread]: Parsing macros\get_custom_name\get_custom_database.sql
[0m11:23:17.821541 [debug] [MainThread]: Parsing macros\get_custom_name\get_custom_schema.sql
[0m11:23:17.824540 [debug] [MainThread]: Parsing macros\materializations\configs.sql
[0m11:23:17.826540 [debug] [MainThread]: Parsing macros\materializations\hooks.sql
[0m11:23:17.830540 [debug] [MainThread]: Parsing macros\materializations\models\incremental\column_helpers.sql
[0m11:23:17.838540 [debug] [MainThread]: Parsing macros\materializations\models\incremental\incremental.sql
[0m11:23:17.849539 [debug] [MainThread]: Parsing macros\materializations\models\incremental\is_incremental.sql
[0m11:23:17.850541 [debug] [MainThread]: Parsing macros\materializations\models\incremental\merge.sql
[0m11:23:17.864540 [debug] [MainThread]: Parsing macros\materializations\models\incremental\on_schema_change.sql
[0m11:23:17.882542 [debug] [MainThread]: Parsing macros\materializations\models\incremental\strategies.sql
[0m11:23:17.890551 [debug] [MainThread]: Parsing macros\materializations\models\table\create_table_as.sql
[0m11:23:17.894542 [debug] [MainThread]: Parsing macros\materializations\models\table\table.sql
[0m11:23:17.900541 [debug] [MainThread]: Parsing macros\materializations\models\view\create_or_replace_view.sql
[0m11:23:17.904542 [debug] [MainThread]: Parsing macros\materializations\models\view\create_view_as.sql
[0m11:23:17.907542 [debug] [MainThread]: Parsing macros\materializations\models\view\helpers.sql
[0m11:23:17.908543 [debug] [MainThread]: Parsing macros\materializations\models\view\view.sql
[0m11:23:17.914541 [debug] [MainThread]: Parsing macros\materializations\seeds\helpers.sql
[0m11:23:17.935556 [debug] [MainThread]: Parsing macros\materializations\seeds\seed.sql
[0m11:23:17.942544 [debug] [MainThread]: Parsing macros\materializations\snapshots\helpers.sql
[0m11:23:17.957555 [debug] [MainThread]: Parsing macros\materializations\snapshots\snapshot.sql
[0m11:23:17.970543 [debug] [MainThread]: Parsing macros\materializations\snapshots\snapshot_merge.sql
[0m11:23:17.972546 [debug] [MainThread]: Parsing macros\materializations\snapshots\strategies.sql
[0m11:23:17.990543 [debug] [MainThread]: Parsing macros\materializations\tests\helpers.sql
[0m11:23:17.993544 [debug] [MainThread]: Parsing macros\materializations\tests\test.sql
[0m11:23:17.997544 [debug] [MainThread]: Parsing macros\materializations\tests\where_subquery.sql
[0m11:23:18.000542 [debug] [MainThread]: Parsing macros\python_model\python.sql
[0m11:23:18.008545 [debug] [MainThread]: Parsing macros\utils\any_value.sql
[0m11:23:18.009546 [debug] [MainThread]: Parsing macros\utils\array_append.sql
[0m11:23:18.011543 [debug] [MainThread]: Parsing macros\utils\array_concat.sql
[0m11:23:18.012545 [debug] [MainThread]: Parsing macros\utils\array_construct.sql
[0m11:23:18.014545 [debug] [MainThread]: Parsing macros\utils\bool_or.sql
[0m11:23:18.016545 [debug] [MainThread]: Parsing macros\utils\cast_bool_to_text.sql
[0m11:23:18.017546 [debug] [MainThread]: Parsing macros\utils\concat.sql
[0m11:23:18.018543 [debug] [MainThread]: Parsing macros\utils\data_types.sql
[0m11:23:18.028546 [debug] [MainThread]: Parsing macros\utils\dateadd.sql
[0m11:23:18.030546 [debug] [MainThread]: Parsing macros\utils\datediff.sql
[0m11:23:18.032556 [debug] [MainThread]: Parsing macros\utils\date_trunc.sql
[0m11:23:18.034543 [debug] [MainThread]: Parsing macros\utils\escape_single_quotes.sql
[0m11:23:18.035543 [debug] [MainThread]: Parsing macros\utils\except.sql
[0m11:23:18.036563 [debug] [MainThread]: Parsing macros\utils\hash.sql
[0m11:23:18.038569 [debug] [MainThread]: Parsing macros\utils\intersect.sql
[0m11:23:18.039542 [debug] [MainThread]: Parsing macros\utils\last_day.sql
[0m11:23:18.041542 [debug] [MainThread]: Parsing macros\utils\length.sql
[0m11:23:18.043542 [debug] [MainThread]: Parsing macros\utils\listagg.sql
[0m11:23:18.046569 [debug] [MainThread]: Parsing macros\utils\literal.sql
[0m11:23:18.047569 [debug] [MainThread]: Parsing macros\utils\position.sql
[0m11:23:18.048569 [debug] [MainThread]: Parsing macros\utils\replace.sql
[0m11:23:18.050570 [debug] [MainThread]: Parsing macros\utils\right.sql
[0m11:23:18.052569 [debug] [MainThread]: Parsing macros\utils\safe_cast.sql
[0m11:23:18.053569 [debug] [MainThread]: Parsing macros\utils\split_part.sql
[0m11:23:18.055569 [debug] [MainThread]: Parsing tests\generic\builtin.sql
[0m11:23:18.059570 [debug] [MainThread]: Parsing macros\generic_tests\accepted_range.sql
[0m11:23:18.062569 [debug] [MainThread]: Parsing macros\generic_tests\at_least_one.sql
[0m11:23:18.064543 [debug] [MainThread]: Parsing macros\generic_tests\cardinality_equality.sql
[0m11:23:18.067570 [debug] [MainThread]: Parsing macros\generic_tests\equality.sql
[0m11:23:18.071543 [debug] [MainThread]: Parsing macros\generic_tests\equal_rowcount.sql
[0m11:23:18.075541 [debug] [MainThread]: Parsing macros\generic_tests\expression_is_true.sql
[0m11:23:18.078569 [debug] [MainThread]: Parsing macros\generic_tests\fewer_rows_than.sql
[0m11:23:18.083539 [debug] [MainThread]: Parsing macros\generic_tests\mutually_exclusive_ranges.sql
[0m11:23:18.097542 [debug] [MainThread]: Parsing macros\generic_tests\not_accepted_values.sql
[0m11:23:18.100542 [debug] [MainThread]: Parsing macros\generic_tests\not_constant.sql
[0m11:23:18.102543 [debug] [MainThread]: Parsing macros\generic_tests\not_empty_string.sql
[0m11:23:18.104543 [debug] [MainThread]: Parsing macros\generic_tests\not_null_proportion.sql
[0m11:23:18.108543 [debug] [MainThread]: Parsing macros\generic_tests\recency.sql
[0m11:23:18.112544 [debug] [MainThread]: Parsing macros\generic_tests\relationships_where.sql
[0m11:23:18.116543 [debug] [MainThread]: Parsing macros\generic_tests\sequential_values.sql
[0m11:23:18.120543 [debug] [MainThread]: Parsing macros\generic_tests\unique_combination_of_columns.sql
[0m11:23:18.124543 [debug] [MainThread]: Parsing macros\jinja_helpers\log_info.sql
[0m11:23:18.126562 [debug] [MainThread]: Parsing macros\jinja_helpers\pretty_log_format.sql
[0m11:23:18.127539 [debug] [MainThread]: Parsing macros\jinja_helpers\pretty_time.sql
[0m11:23:18.129544 [debug] [MainThread]: Parsing macros\jinja_helpers\slugify.sql
[0m11:23:18.131543 [debug] [MainThread]: Parsing macros\jinja_helpers\_is_ephemeral.sql
[0m11:23:18.134542 [debug] [MainThread]: Parsing macros\jinja_helpers\_is_relation.sql
[0m11:23:18.135544 [debug] [MainThread]: Parsing macros\sql\date_spine.sql
[0m11:23:18.140543 [debug] [MainThread]: Parsing macros\sql\deduplicate.sql
[0m11:23:18.145542 [debug] [MainThread]: Parsing macros\sql\generate_series.sql
[0m11:23:18.150543 [debug] [MainThread]: Parsing macros\sql\generate_surrogate_key.sql
[0m11:23:18.153542 [debug] [MainThread]: Parsing macros\sql\get_column_values.sql
[0m11:23:18.159542 [debug] [MainThread]: Parsing macros\sql\get_filtered_columns_in_relation.sql
[0m11:23:18.163542 [debug] [MainThread]: Parsing macros\sql\get_query_results_as_dict.sql
[0m11:23:18.166542 [debug] [MainThread]: Parsing macros\sql\get_relations_by_pattern.sql
[0m11:23:18.170542 [debug] [MainThread]: Parsing macros\sql\get_relations_by_prefix.sql
[0m11:23:18.174542 [debug] [MainThread]: Parsing macros\sql\get_single_value.sql
[0m11:23:18.177543 [debug] [MainThread]: Parsing macros\sql\get_tables_by_pattern_sql.sql
[0m11:23:18.185542 [debug] [MainThread]: Parsing macros\sql\get_tables_by_prefix_sql.sql
[0m11:23:18.187557 [debug] [MainThread]: Parsing macros\sql\get_table_types_sql.sql
[0m11:23:18.189564 [debug] [MainThread]: Parsing macros\sql\groupby.sql
[0m11:23:18.191544 [debug] [MainThread]: Parsing macros\sql\haversine_distance.sql
[0m11:23:18.198543 [debug] [MainThread]: Parsing macros\sql\nullcheck.sql
[0m11:23:18.200544 [debug] [MainThread]: Parsing macros\sql\nullcheck_table.sql
[0m11:23:18.202544 [debug] [MainThread]: Parsing macros\sql\pivot.sql
[0m11:23:18.207542 [debug] [MainThread]: Parsing macros\sql\safe_add.sql
[0m11:23:18.210542 [debug] [MainThread]: Parsing macros\sql\safe_divide.sql
[0m11:23:18.212543 [debug] [MainThread]: Parsing macros\sql\star.sql
[0m11:23:18.219562 [debug] [MainThread]: Parsing macros\sql\surrogate_key.sql
[0m11:23:18.223545 [debug] [MainThread]: Parsing macros\sql\union.sql
[0m11:23:18.238539 [debug] [MainThread]: Parsing macros\sql\unpivot.sql
[0m11:23:18.245539 [debug] [MainThread]: Parsing macros\sql\width_bucket.sql
[0m11:23:18.251539 [debug] [MainThread]: Parsing macros\web\get_url_host.sql
[0m11:23:18.254539 [debug] [MainThread]: Parsing macros\web\get_url_parameter.sql
[0m11:23:18.256540 [debug] [MainThread]: Parsing macros\web\get_url_path.sql
[0m11:23:18.677573 [debug] [MainThread]: 1603: static parser failed on dwh\dim_operating_period.sql
[0m11:23:18.705572 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\dim_operating_period.sql
[0m11:23:18.707571 [debug] [MainThread]: 1603: static parser failed on dwh\dim_vehicle.sql
[0m11:23:18.712572 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\dim_vehicle.sql
[0m11:23:18.714572 [debug] [MainThread]: 1603: static parser failed on dwh\fact_deregistration.sql
[0m11:23:18.722572 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_deregistration.sql
[0m11:23:18.724573 [debug] [MainThread]: 1603: static parser failed on dwh\fact_registration.sql
[0m11:23:18.732572 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_registration.sql
[0m11:23:18.734572 [debug] [MainThread]: 1603: static parser failed on dwh\fact_vehicle_location.sql
[0m11:23:18.742572 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_vehicle_location.sql
[0m11:23:18.743547 [debug] [MainThread]: 1603: static parser failed on stg\event_log.sql
[0m11:23:18.753551 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\event_log.sql
[0m11:23:18.853572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0a23f7df-78b9-486c-881b-fe2dfe06e64d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF929F5250>]}
[0m11:23:18.862547 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0a23f7df-78b9-486c-881b-fe2dfe06e64d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF929307C0>]}
[0m11:23:18.862547 [info ] [MainThread]: Found 6 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m11:23:18.863545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0a23f7df-78b9-486c-881b-fe2dfe06e64d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF929557F0>]}
[0m11:23:18.865573 [info ] [MainThread]: 
[0m11:23:18.866545 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m11:23:18.868546 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m11:23:18.883547 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m11:23:18.884548 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m11:23:18.884548 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:23:19.830584 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.95 seconds
[0m11:23:19.831584 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m11:23:19.957527 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m11:23:19.966527 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m11:23:19.966527 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT"} */
show terse objects in DOOR2DOOR_DWH.DBT
[0m11:23:19.967544 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:23:20.518102 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.55 seconds
[0m11:23:20.519097 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: Close
[0m11:23:20.662254 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0a23f7df-78b9-486c-881b-fe2dfe06e64d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF92A25580>]}
[0m11:23:20.663228 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:23:20.664256 [info ] [MainThread]: 
[0m11:23:20.669593 [debug] [Thread-1  ]: Began running node model.door2door_dwh.event_log
[0m11:23:20.670653 [info ] [Thread-1  ]: 1 of 6 START sql incremental model DBT.event_log ............................... [RUN]
[0m11:23:20.671613 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.event_log"
[0m11:23:20.671613 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.event_log
[0m11:23:20.671613 [debug] [Thread-1  ]: Compiling model.door2door_dwh.event_log
[0m11:23:20.678632 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.event_log"
[0m11:23:20.679632 [debug] [Thread-1  ]: finished collecting timing info
[0m11:23:20.680633 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.event_log
[0m11:23:20.733632 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.event_log"
[0m11:23:20.735648 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event_log"
[0m11:23:20.735648 [debug] [Thread-1  ]: On model.door2door_dwh.event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event_log"} */
create or replace transient table DOOR2DOOR_DWH.DBT.event_log  as
        (

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TEXT as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
        );
[0m11:23:20.736660 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m11:23:26.035185 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 5.3 seconds
[0m11:23:26.045227 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event_log"
[0m11:23:26.046187 [debug] [Thread-1  ]: On model.door2door_dwh.event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event_log"} */
drop view if exists DOOR2DOOR_DWH.DBT.event_log__dbt_tmp cascade
[0m11:23:26.123539 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m11:23:26.159521 [debug] [Thread-1  ]: finished collecting timing info
[0m11:23:26.159521 [debug] [Thread-1  ]: On model.door2door_dwh.event_log: Close
[0m11:23:26.298481 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0a23f7df-78b9-486c-881b-fe2dfe06e64d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF92E41F10>]}
[0m11:23:26.299481 [info ] [Thread-1  ]: 1 of 6 OK created sql incremental model DBT.event_log .......................... [[32mSUCCESS 1[0m in 5.63s]
[0m11:23:26.301481 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.event_log
[0m11:23:26.302481 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_operating_period
[0m11:23:26.302481 [info ] [Thread-1  ]: 2 of 6 START sql table model DBT.dim_operating_period .......................... [RUN]
[0m11:23:26.304483 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_operating_period"
[0m11:23:26.304483 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_operating_period
[0m11:23:26.304483 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_operating_period
[0m11:23:26.310481 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_operating_period"
[0m11:23:26.311481 [debug] [Thread-1  ]: finished collecting timing info
[0m11:23:26.311481 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_operating_period
[0m11:23:26.330523 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_operating_period"
[0m11:23:26.334494 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_operating_period"
[0m11:23:26.335495 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_operating_period"} */
create or replace transient table DOOR2DOOR_DWH.DBT.dim_operating_period  as
        (

with operating_periods as (
    SELECT
        data_id,
        data_start,
        data_finish,
        ROW_NUMBER() OVER (PARTITION BY data_id ORDER BY data_finish desc, data_start desc) as rn
    FROM DOOR2DOOR_DWH.DBT.event_log
    WHERE lower(event_on) = 'operating_period'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    data_id as operating_period_source_id,
    data_start as operating_period_start_time,
    data_finish as operating_period_finish_time
FROM operating_periods
        );
[0m11:23:26.336486 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:23:27.519791 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.18 seconds
[0m11:23:27.522782 [debug] [Thread-1  ]: finished collecting timing info
[0m11:23:27.523815 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: Close
[0m11:23:27.657460 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0a23f7df-78b9-486c-881b-fe2dfe06e64d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF92EBC040>]}
[0m11:23:27.657460 [info ] [Thread-1  ]: 2 of 6 OK created sql table model DBT.dim_operating_period ..................... [[32mSUCCESS 1[0m in 1.35s]
[0m11:23:27.659087 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_operating_period
[0m11:23:27.659087 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_vehicle
[0m11:23:27.660147 [info ] [Thread-1  ]: 3 of 6 START sql table model DBT.dim_vehicle ................................... [RUN]
[0m11:23:27.662102 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_vehicle"
[0m11:23:27.663100 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_vehicle
[0m11:23:27.663100 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_vehicle
[0m11:23:27.670100 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_vehicle"
[0m11:23:27.672097 [debug] [Thread-1  ]: finished collecting timing info
[0m11:23:27.672097 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_vehicle
[0m11:23:27.675097 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_vehicle"
[0m11:23:27.677098 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_vehicle"
[0m11:23:27.677098 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_vehicle"} */
create or replace transient table DOOR2DOOR_DWH.DBT.dim_vehicle  as
        (

with vehicles as (
    SELECT
        DISTINCT data_id
    FROM DOOR2DOOR_DWH.DBT.event_log
    WHERE lower(event_on) = 'vehicle'
)

    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
data_id as vehicle_source_id
FROM vehicles
        );
[0m11:23:27.677098 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:23:28.167147 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa204b-3201-9a27-0000-0001c1465085
[0m11:23:28.167147 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 12 at position 0 unexpected 'md5'.
syntax error line 12 at position 39 unexpected ','.
[0m11:23:28.167147 [debug] [Thread-1  ]: finished collecting timing info
[0m11:23:28.168146 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: Close
[0m11:23:28.294968 [debug] [Thread-1  ]: Database Error in model dim_vehicle (models\dwh\dim_vehicle.sql)
  001003 (42000): SQL compilation error:
  syntax error line 12 at position 0 unexpected 'md5'.
  syntax error line 12 at position 39 unexpected ','.
  compiled Code at target\run\door2door_dwh\models\dwh\dim_vehicle.sql
[0m11:23:28.295925 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0a23f7df-78b9-486c-881b-fe2dfe06e64d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF92DD76D0>]}
[0m11:23:28.296938 [error] [Thread-1  ]: 3 of 6 ERROR creating sql table model DBT.dim_vehicle .......................... [[31mERROR[0m in 0.63s]
[0m11:23:28.297929 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_vehicle
[0m11:23:28.298931 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_deregistration
[0m11:23:28.298931 [info ] [Thread-1  ]: 4 of 6 START sql table model DBT.fact_deregistration ........................... [RUN]
[0m11:23:28.299930 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_deregistration"
[0m11:23:28.300926 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_deregistration
[0m11:23:28.300926 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_deregistration
[0m11:23:28.309971 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_deregistration"
[0m11:23:28.310970 [debug] [Thread-1  ]: finished collecting timing info
[0m11:23:28.311931 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_deregistration
[0m11:23:28.314970 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_deregistration"
[0m11:23:28.316926 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m11:23:28.317968 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
create or replace transient table DOOR2DOOR_DWH.DBT.fact_deregistration  as
        (

with events as (
    SELECT
        event
        event_at,
        data_id
    FROM DOOR2DOOR_DWH.DBT.event_log e
    LEFT JOIN DOOR2DOOR_DWH.DBT.dim_operating_period op
        ON e.event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'deregister'
)
SELECT
    
    
md5(cast(coalesce(cast(event as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as deregistration_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    event_at at deregistration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
        );
[0m11:23:28.318926 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:23:28.739193 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa204b-3201-98a1-0000-0001c1462315
[0m11:23:28.739193 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 21 at position 16 unexpected 'deregistration_time'.
[0m11:23:28.739193 [debug] [Thread-1  ]: finished collecting timing info
[0m11:23:28.740163 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: Close
[0m11:23:28.871131 [debug] [Thread-1  ]: Database Error in model fact_deregistration (models\dwh\fact_deregistration.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 16 unexpected 'deregistration_time'.
  compiled Code at target\run\door2door_dwh\models\dwh\fact_deregistration.sql
[0m11:23:28.871131 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0a23f7df-78b9-486c-881b-fe2dfe06e64d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF92E16AC0>]}
[0m11:23:28.872131 [error] [Thread-1  ]: 4 of 6 ERROR creating sql table model DBT.fact_deregistration .................. [[31mERROR[0m in 0.57s]
[0m11:23:28.874105 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_deregistration
[0m11:23:28.875102 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_registration
[0m11:23:28.875102 [info ] [Thread-1  ]: 5 of 6 START sql table model DBT.fact_registration ............................. [RUN]
[0m11:23:28.876131 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_registration"
[0m11:23:28.877131 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_registration
[0m11:23:28.877131 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_registration
[0m11:23:28.884143 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_registration"
[0m11:23:28.885133 [debug] [Thread-1  ]: finished collecting timing info
[0m11:23:28.885133 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_registration
[0m11:23:28.889103 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_registration"
[0m11:23:28.891131 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m11:23:28.891131 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
create or replace transient table DOOR2DOOR_DWH.DBT.fact_registration  as
        (

with events as (
    SELECT
        event
        event_at,
        data_id
    FROM DOOR2DOOR_DWH.DBT.event_log e
    LEFT JOIN DOOR2DOOR_DWH.DBT.dim_operating_period op
        ON e.event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'register'
)
SELECT
    
    
md5(cast(coalesce(cast(event as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as registration_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    event_at at registration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
        );
[0m11:23:28.891131 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:23:29.304244 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa204b-3201-98a1-0000-0001c1462319
[0m11:23:29.305245 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 21 at position 16 unexpected 'registration_time'.
[0m11:23:29.305245 [debug] [Thread-1  ]: finished collecting timing info
[0m11:23:29.306245 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: Close
[0m11:23:29.441501 [debug] [Thread-1  ]: Database Error in model fact_registration (models\dwh\fact_registration.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 16 unexpected 'registration_time'.
  compiled Code at target\run\door2door_dwh\models\dwh\fact_registration.sql
[0m11:23:29.441501 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0a23f7df-78b9-486c-881b-fe2dfe06e64d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF92E28FD0>]}
[0m11:23:29.442504 [error] [Thread-1  ]: 5 of 6 ERROR creating sql table model DBT.fact_registration .................... [[31mERROR[0m in 0.57s]
[0m11:23:29.443507 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_registration
[0m11:23:29.444512 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_vehicle_location
[0m11:23:29.444512 [info ] [Thread-1  ]: 6 of 6 START sql table model DBT.fact_vehicle_location ......................... [RUN]
[0m11:23:29.445501 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m11:23:29.445501 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_vehicle_location
[0m11:23:29.446543 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_vehicle_location
[0m11:23:29.454502 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_vehicle_location"
[0m11:23:29.455502 [debug] [Thread-1  ]: finished collecting timing info
[0m11:23:29.455502 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_vehicle_location
[0m11:23:29.460503 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_vehicle_location"
[0m11:23:29.462502 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m11:23:29.463501 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
create or replace transient table DOOR2DOOR_DWH.DBT.fact_vehicle_location  as
        (

with locations as (
    SELECT
        event_at,
        data_id,
        data_location_lat,
        data_location_lng,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT.event_log e
    INNER JOIN DOOR2DOOR_DWH.DBT.dim_operating_period op
        ON e.event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event_on) = 'update'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_location_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    operating_period_key
    data_location_lat as vehicle_location_lat,
    data_location_lng as vehicle_location_lng
    event_at as vehicle_location_time
FROM locations


--- ASSUMPTION Events are recorded only if vehicle is registered to a operation period
        );
[0m11:23:29.463501 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:23:29.854503 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa204b-3201-9838-0000-0001c1463355
[0m11:23:29.855514 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 24 at position 22 unexpected 'as'.
[0m11:23:29.855514 [debug] [Thread-1  ]: finished collecting timing info
[0m11:23:29.855514 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: Close
[0m11:23:29.982505 [debug] [Thread-1  ]: Database Error in model fact_vehicle_location (models\dwh\fact_vehicle_location.sql)
  001003 (42000): SQL compilation error:
  syntax error line 24 at position 22 unexpected 'as'.
  compiled Code at target\run\door2door_dwh\models\dwh\fact_vehicle_location.sql
[0m11:23:29.983504 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0a23f7df-78b9-486c-881b-fe2dfe06e64d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF92ECCB80>]}
[0m11:23:29.984505 [error] [Thread-1  ]: 6 of 6 ERROR creating sql table model DBT.fact_vehicle_location ................ [[31mERROR[0m in 0.54s]
[0m11:23:29.985506 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_vehicle_location
[0m11:23:29.988505 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m11:23:29.989506 [info ] [MainThread]: 
[0m11:23:29.990505 [info ] [MainThread]: Finished running 1 incremental model, 5 table models in 0 hours 0 minutes and 11.12 seconds (11.12s).
[0m11:23:29.991513 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:23:29.992505 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m11:23:29.992505 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT' was properly closed.
[0m11:23:29.993506 [debug] [MainThread]: Connection 'model.door2door_dwh.fact_vehicle_location' was properly closed.
[0m11:23:30.011523 [info ] [MainThread]: 
[0m11:23:30.012518 [info ] [MainThread]: [31mCompleted with 4 errors and 0 warnings:[0m
[0m11:23:30.014506 [info ] [MainThread]: 
[0m11:23:30.015504 [error] [MainThread]: [33mDatabase Error in model dim_vehicle (models\dwh\dim_vehicle.sql)[0m
[0m11:23:30.016506 [error] [MainThread]:   001003 (42000): SQL compilation error:
[0m11:23:30.017506 [error] [MainThread]:   syntax error line 12 at position 0 unexpected 'md5'.
[0m11:23:30.018507 [error] [MainThread]:   syntax error line 12 at position 39 unexpected ','.
[0m11:23:30.020507 [error] [MainThread]:   compiled Code at target\run\door2door_dwh\models\dwh\dim_vehicle.sql
[0m11:23:30.021506 [info ] [MainThread]: 
[0m11:23:30.023515 [error] [MainThread]: [33mDatabase Error in model fact_deregistration (models\dwh\fact_deregistration.sql)[0m
[0m11:23:30.026505 [error] [MainThread]:   001003 (42000): SQL compilation error:
[0m11:23:30.027506 [error] [MainThread]:   syntax error line 21 at position 16 unexpected 'deregistration_time'.
[0m11:23:30.029506 [error] [MainThread]:   compiled Code at target\run\door2door_dwh\models\dwh\fact_deregistration.sql
[0m11:23:30.030506 [info ] [MainThread]: 
[0m11:23:30.031506 [error] [MainThread]: [33mDatabase Error in model fact_registration (models\dwh\fact_registration.sql)[0m
[0m11:23:30.033505 [error] [MainThread]:   001003 (42000): SQL compilation error:
[0m11:23:30.034505 [error] [MainThread]:   syntax error line 21 at position 16 unexpected 'registration_time'.
[0m11:23:30.035504 [error] [MainThread]:   compiled Code at target\run\door2door_dwh\models\dwh\fact_registration.sql
[0m11:23:30.036504 [info ] [MainThread]: 
[0m11:23:30.036504 [error] [MainThread]: [33mDatabase Error in model fact_vehicle_location (models\dwh\fact_vehicle_location.sql)[0m
[0m11:23:30.038505 [error] [MainThread]:   001003 (42000): SQL compilation error:
[0m11:23:30.039521 [error] [MainThread]:   syntax error line 24 at position 22 unexpected 'as'.
[0m11:23:30.040508 [error] [MainThread]:   compiled Code at target\run\door2door_dwh\models\dwh\fact_vehicle_location.sql
[0m11:23:30.042509 [info ] [MainThread]: 
[0m11:23:30.045509 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=4 SKIP=0 TOTAL=6
[0m11:23:30.047505 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF929F50A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF929F51C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF92CEE5E0>]}
[0m11:23:30.047505 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 11:25:25.087138 | 47ef6277-36bf-43ec-a0be-f6cfec3b2572 ==============================
[0m11:25:25.087138 [info ] [MainThread]: Running with dbt=1.3.1
[0m11:25:25.088144 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': False, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m11:25:25.088144 [debug] [MainThread]: Tracking: tracking
[0m11:25:25.089140 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002534FDB1790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002534FDB17F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002534FDB1850>]}
[0m11:25:25.219110 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m11:25:25.219110 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\fact_vehicle_location.sql
[0m11:25:25.234109 [debug] [MainThread]: 1603: static parser failed on dwh\fact_vehicle_location.sql
[0m11:25:25.263112 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_vehicle_location.sql
[0m11:25:25.283112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '47ef6277-36bf-43ec-a0be-f6cfec3b2572', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000253500500D0>]}
[0m11:25:25.292111 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '47ef6277-36bf-43ec-a0be-f6cfec3b2572', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002534FEE8850>]}
[0m11:25:25.292111 [info ] [MainThread]: Found 6 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m11:25:25.293111 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '47ef6277-36bf-43ec-a0be-f6cfec3b2572', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002534FF496A0>]}
[0m11:25:25.294138 [info ] [MainThread]: 
[0m11:25:25.296166 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m11:25:25.297417 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m11:25:25.312427 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m11:25:25.312427 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m11:25:25.312427 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:25:26.300601 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.99 seconds
[0m11:25:26.303590 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m11:25:26.475606 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m11:25:26.484596 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m11:25:26.484596 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT"} */
show terse objects in DOOR2DOOR_DWH.DBT
[0m11:25:26.484596 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:25:26.919879 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.44 seconds
[0m11:25:26.921917 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: Close
[0m11:25:27.046506 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '47ef6277-36bf-43ec-a0be-f6cfec3b2572', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002534FEE8790>]}
[0m11:25:27.047505 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:25:27.048468 [info ] [MainThread]: 
[0m11:25:27.053466 [debug] [Thread-1  ]: Began running node model.door2door_dwh.event_log
[0m11:25:27.054497 [info ] [Thread-1  ]: 1 of 6 START sql incremental model DBT.event_log ............................... [RUN]
[0m11:25:27.055470 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.event_log"
[0m11:25:27.056469 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.event_log
[0m11:25:27.057471 [debug] [Thread-1  ]: Compiling model.door2door_dwh.event_log
[0m11:25:27.069468 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.event_log"
[0m11:25:27.070481 [debug] [Thread-1  ]: finished collecting timing info
[0m11:25:27.071470 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.event_log
[0m11:25:27.137466 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.event_log"
[0m11:25:27.139465 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event_log"
[0m11:25:27.139465 [debug] [Thread-1  ]: On model.door2door_dwh.event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event_log"} */
create or replace transient table DOOR2DOOR_DWH.DBT.event_log  as
        (

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TEXT as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
        );
[0m11:25:27.139465 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m11:25:32.503332 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 5.36 seconds
[0m11:25:32.510328 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event_log"
[0m11:25:32.510328 [debug] [Thread-1  ]: On model.door2door_dwh.event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event_log"} */
drop view if exists DOOR2DOOR_DWH.DBT.event_log__dbt_tmp cascade
[0m11:25:32.587995 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m11:25:32.609990 [debug] [Thread-1  ]: finished collecting timing info
[0m11:25:32.610991 [debug] [Thread-1  ]: On model.door2door_dwh.event_log: Close
[0m11:25:32.739566 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '47ef6277-36bf-43ec-a0be-f6cfec3b2572', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000253502BE850>]}
[0m11:25:32.740567 [info ] [Thread-1  ]: 1 of 6 OK created sql incremental model DBT.event_log .......................... [[32mSUCCESS 1[0m in 5.68s]
[0m11:25:32.741458 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.event_log
[0m11:25:32.743469 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_operating_period
[0m11:25:32.743469 [info ] [Thread-1  ]: 2 of 6 START sql table model DBT.dim_operating_period .......................... [RUN]
[0m11:25:32.744480 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_operating_period"
[0m11:25:32.744480 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_operating_period
[0m11:25:32.745480 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_operating_period
[0m11:25:32.749470 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_operating_period"
[0m11:25:32.750470 [debug] [Thread-1  ]: finished collecting timing info
[0m11:25:32.750470 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_operating_period
[0m11:25:32.764480 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_operating_period"
[0m11:25:32.766473 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_operating_period"
[0m11:25:32.766473 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_operating_period"} */
create or replace transient table DOOR2DOOR_DWH.DBT.dim_operating_period  as
        (

with operating_periods as (
    SELECT
        data_id,
        data_start,
        data_finish,
        ROW_NUMBER() OVER (PARTITION BY data_id ORDER BY data_finish desc, data_start desc) as rn
    FROM DOOR2DOOR_DWH.DBT.event_log
    WHERE lower(event_on) = 'operating_period'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    data_id as operating_period_source_id,
    data_start as operating_period_start_time,
    data_finish as operating_period_finish_time
FROM operating_periods
        );
[0m11:25:32.767490 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:25:33.966927 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.2 seconds
[0m11:25:33.968925 [debug] [Thread-1  ]: finished collecting timing info
[0m11:25:33.969924 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: Close
[0m11:25:34.098553 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '47ef6277-36bf-43ec-a0be-f6cfec3b2572', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000253503EAD90>]}
[0m11:25:34.098553 [info ] [Thread-1  ]: 2 of 6 OK created sql table model DBT.dim_operating_period ..................... [[32mSUCCESS 1[0m in 1.35s]
[0m11:25:34.099555 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_operating_period
[0m11:25:34.100555 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_vehicle
[0m11:25:34.100555 [info ] [Thread-1  ]: 3 of 6 START sql table model DBT.dim_vehicle ................................... [RUN]
[0m11:25:34.101555 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_vehicle"
[0m11:25:34.101555 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_vehicle
[0m11:25:34.102555 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_vehicle
[0m11:25:34.107553 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_vehicle"
[0m11:25:34.107553 [debug] [Thread-1  ]: finished collecting timing info
[0m11:25:34.108555 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_vehicle
[0m11:25:34.111554 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_vehicle"
[0m11:25:34.112555 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_vehicle"
[0m11:25:34.112555 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_vehicle"} */
create or replace transient table DOOR2DOOR_DWH.DBT.dim_vehicle  as
        (

with vehicles as (
    SELECT
        DISTINCT data_id
    FROM DOOR2DOOR_DWH.DBT.event_log
    WHERE lower(event_on) = 'vehicle'
)

    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
data_id as vehicle_source_id
FROM vehicles
        );
[0m11:25:34.112555 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:25:34.509201 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa204d-3201-98a1-0000-0001c1462325
[0m11:25:34.509201 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 12 at position 0 unexpected 'md5'.
syntax error line 12 at position 39 unexpected ','.
[0m11:25:34.509201 [debug] [Thread-1  ]: finished collecting timing info
[0m11:25:34.510190 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: Close
[0m11:25:34.634386 [debug] [Thread-1  ]: Database Error in model dim_vehicle (models\dwh\dim_vehicle.sql)
  001003 (42000): SQL compilation error:
  syntax error line 12 at position 0 unexpected 'md5'.
  syntax error line 12 at position 39 unexpected ','.
  compiled Code at target\run\door2door_dwh\models\dwh\dim_vehicle.sql
[0m11:25:34.634386 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '47ef6277-36bf-43ec-a0be-f6cfec3b2572', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025350336C40>]}
[0m11:25:34.635387 [error] [Thread-1  ]: 3 of 6 ERROR creating sql table model DBT.dim_vehicle .......................... [[31mERROR[0m in 0.53s]
[0m11:25:34.636879 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_vehicle
[0m11:25:34.636879 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_deregistration
[0m11:25:34.637912 [info ] [Thread-1  ]: 4 of 6 START sql table model DBT.fact_deregistration ........................... [RUN]
[0m11:25:34.638906 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_deregistration"
[0m11:25:34.638906 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_deregistration
[0m11:25:34.639919 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_deregistration
[0m11:25:34.647893 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_deregistration"
[0m11:25:34.648920 [debug] [Thread-1  ]: finished collecting timing info
[0m11:25:34.648920 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_deregistration
[0m11:25:34.653924 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_deregistration"
[0m11:25:34.655929 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m11:25:34.655929 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
create or replace transient table DOOR2DOOR_DWH.DBT.fact_deregistration  as
        (

with events as (
    SELECT
        event
        event_at,
        data_id
    FROM DOOR2DOOR_DWH.DBT.event_log e
    LEFT JOIN DOOR2DOOR_DWH.DBT.dim_operating_period op
        ON e.event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'deregister'
)
SELECT
    
    
md5(cast(coalesce(cast(event as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as deregistration_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    event_at at deregistration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
        );
[0m11:25:34.655929 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:25:35.074667 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa204d-3201-9a27-0000-0001c146508d
[0m11:25:35.075660 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 21 at position 16 unexpected 'deregistration_time'.
[0m11:25:35.075660 [debug] [Thread-1  ]: finished collecting timing info
[0m11:25:35.075660 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: Close
[0m11:25:35.209693 [debug] [Thread-1  ]: Database Error in model fact_deregistration (models\dwh\fact_deregistration.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 16 unexpected 'deregistration_time'.
  compiled Code at target\run\door2door_dwh\models\dwh\fact_deregistration.sql
[0m11:25:35.209693 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '47ef6277-36bf-43ec-a0be-f6cfec3b2572', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000253504E1CA0>]}
[0m11:25:35.210694 [error] [Thread-1  ]: 4 of 6 ERROR creating sql table model DBT.fact_deregistration .................. [[31mERROR[0m in 0.57s]
[0m11:25:35.212705 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_deregistration
[0m11:25:35.212705 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_registration
[0m11:25:35.213701 [info ] [Thread-1  ]: 5 of 6 START sql table model DBT.fact_registration ............................. [RUN]
[0m11:25:35.214708 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_registration"
[0m11:25:35.214708 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_registration
[0m11:25:35.215723 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_registration
[0m11:25:35.222722 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_registration"
[0m11:25:35.223723 [debug] [Thread-1  ]: finished collecting timing info
[0m11:25:35.223723 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_registration
[0m11:25:35.226733 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_registration"
[0m11:25:35.228708 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m11:25:35.228708 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
create or replace transient table DOOR2DOOR_DWH.DBT.fact_registration  as
        (

with events as (
    SELECT
        event
        event_at,
        data_id
    FROM DOOR2DOOR_DWH.DBT.event_log e
    LEFT JOIN DOOR2DOOR_DWH.DBT.dim_operating_period op
        ON e.event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'register'
)
SELECT
    
    
md5(cast(coalesce(cast(event as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as registration_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    event_at at registration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
        );
[0m11:25:35.229724 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:25:35.624669 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa204d-3201-98a1-0000-0001c1462329
[0m11:25:35.625665 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 21 at position 16 unexpected 'registration_time'.
[0m11:25:35.625665 [debug] [Thread-1  ]: finished collecting timing info
[0m11:25:35.625665 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: Close
[0m11:25:35.755712 [debug] [Thread-1  ]: Database Error in model fact_registration (models\dwh\fact_registration.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 16 unexpected 'registration_time'.
  compiled Code at target\run\door2door_dwh\models\dwh\fact_registration.sql
[0m11:25:35.755712 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '47ef6277-36bf-43ec-a0be-f6cfec3b2572', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000253503347F0>]}
[0m11:25:35.756728 [error] [Thread-1  ]: 5 of 6 ERROR creating sql table model DBT.fact_registration .................... [[31mERROR[0m in 0.54s]
[0m11:25:35.758056 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_registration
[0m11:25:35.759075 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_vehicle_location
[0m11:25:35.759075 [info ] [Thread-1  ]: 6 of 6 START sql table model DBT.fact_vehicle_location ......................... [RUN]
[0m11:25:35.760119 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m11:25:35.760119 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_vehicle_location
[0m11:25:35.761066 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_vehicle_location
[0m11:25:35.768065 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_vehicle_location"
[0m11:25:35.769065 [debug] [Thread-1  ]: finished collecting timing info
[0m11:25:35.769065 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_vehicle_location
[0m11:25:35.772065 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_vehicle_location"
[0m11:25:35.774065 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m11:25:35.774065 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
create or replace transient table DOOR2DOOR_DWH.DBT.fact_vehicle_location  as
        (

with locations as (
    SELECT
        event_at,
        data_id,
        data_location_lat,
        data_location_lng,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT.event_log e
    INNER JOIN DOOR2DOOR_DWH.DBT.dim_operating_period op
        ON e.event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event_on) = 'update'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_location_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    operating_period_key,
    data_location_lat as vehicle_location_lat,
    data_location_lng as vehicle_location_lng
    event_at as vehicle_location_time
FROM locations


--- ASSUMPTION Events are recorded only if vehicle is registered to a operation period
        );
[0m11:25:35.774065 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:25:36.168478 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa204d-3201-9a27-0000-0001c1465091
[0m11:25:36.169474 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 26 at position 4 unexpected 'event_at'.
[0m11:25:36.169474 [debug] [Thread-1  ]: finished collecting timing info
[0m11:25:36.169474 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: Close
[0m11:25:36.302460 [debug] [Thread-1  ]: Database Error in model fact_vehicle_location (models\dwh\fact_vehicle_location.sql)
  001003 (42000): SQL compilation error:
  syntax error line 26 at position 4 unexpected 'event_at'.
  compiled Code at target\run\door2door_dwh\models\dwh\fact_vehicle_location.sql
[0m11:25:36.303460 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '47ef6277-36bf-43ec-a0be-f6cfec3b2572', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000253504E8640>]}
[0m11:25:36.303460 [error] [Thread-1  ]: 6 of 6 ERROR creating sql table model DBT.fact_vehicle_location ................ [[31mERROR[0m in 0.54s]
[0m11:25:36.305432 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_vehicle_location
[0m11:25:36.307462 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m11:25:36.307462 [info ] [MainThread]: 
[0m11:25:36.308434 [info ] [MainThread]: Finished running 1 incremental model, 5 table models in 0 hours 0 minutes and 11.01 seconds (11.01s).
[0m11:25:36.309468 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:25:36.309468 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m11:25:36.309468 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT' was properly closed.
[0m11:25:36.310480 [debug] [MainThread]: Connection 'model.door2door_dwh.fact_vehicle_location' was properly closed.
[0m11:25:36.370508 [info ] [MainThread]: 
[0m11:25:36.371477 [info ] [MainThread]: [31mCompleted with 4 errors and 0 warnings:[0m
[0m11:25:36.372488 [info ] [MainThread]: 
[0m11:25:36.373478 [error] [MainThread]: [33mDatabase Error in model dim_vehicle (models\dwh\dim_vehicle.sql)[0m
[0m11:25:36.374478 [error] [MainThread]:   001003 (42000): SQL compilation error:
[0m11:25:36.375477 [error] [MainThread]:   syntax error line 12 at position 0 unexpected 'md5'.
[0m11:25:36.375477 [error] [MainThread]:   syntax error line 12 at position 39 unexpected ','.
[0m11:25:36.376525 [error] [MainThread]:   compiled Code at target\run\door2door_dwh\models\dwh\dim_vehicle.sql
[0m11:25:36.377489 [info ] [MainThread]: 
[0m11:25:36.377489 [error] [MainThread]: [33mDatabase Error in model fact_deregistration (models\dwh\fact_deregistration.sql)[0m
[0m11:25:36.379484 [error] [MainThread]:   001003 (42000): SQL compilation error:
[0m11:25:36.379484 [error] [MainThread]:   syntax error line 21 at position 16 unexpected 'deregistration_time'.
[0m11:25:36.380507 [error] [MainThread]:   compiled Code at target\run\door2door_dwh\models\dwh\fact_deregistration.sql
[0m11:25:36.381479 [info ] [MainThread]: 
[0m11:25:36.381479 [error] [MainThread]: [33mDatabase Error in model fact_registration (models\dwh\fact_registration.sql)[0m
[0m11:25:36.383476 [error] [MainThread]:   001003 (42000): SQL compilation error:
[0m11:25:36.383476 [error] [MainThread]:   syntax error line 21 at position 16 unexpected 'registration_time'.
[0m11:25:36.384520 [error] [MainThread]:   compiled Code at target\run\door2door_dwh\models\dwh\fact_registration.sql
[0m11:25:36.385481 [info ] [MainThread]: 
[0m11:25:36.385481 [error] [MainThread]: [33mDatabase Error in model fact_vehicle_location (models\dwh\fact_vehicle_location.sql)[0m
[0m11:25:36.386480 [error] [MainThread]:   001003 (42000): SQL compilation error:
[0m11:25:36.387489 [error] [MainThread]:   syntax error line 26 at position 4 unexpected 'event_at'.
[0m11:25:36.388481 [error] [MainThread]:   compiled Code at target\run\door2door_dwh\models\dwh\fact_vehicle_location.sql
[0m11:25:36.389494 [info ] [MainThread]: 
[0m11:25:36.389494 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=4 SKIP=0 TOTAL=6
[0m11:25:36.390482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002533BB472E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002533C95EB50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002534FD7FF40>]}
[0m11:25:36.390482 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 11:26:20.188119 | 1ecb7419-901a-4f00-ad3a-364a0a11a85a ==============================
[0m11:26:20.188119 [info ] [MainThread]: Running with dbt=1.3.1
[0m11:26:20.188119 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': False, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m11:26:20.189119 [debug] [MainThread]: Tracking: tracking
[0m11:26:20.189119 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203A78A1760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203A78A17C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203A78A1820>]}
[0m11:26:20.337119 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m11:26:20.338120 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\dim_vehicle.sql
[0m11:26:20.352119 [debug] [MainThread]: 1603: static parser failed on dwh\dim_vehicle.sql
[0m11:26:20.387121 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\dim_vehicle.sql
[0m11:26:20.413122 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1ecb7419-901a-4f00-ad3a-364a0a11a85a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203A7B420D0>]}
[0m11:26:20.422123 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1ecb7419-901a-4f00-ad3a-364a0a11a85a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203A79BDF70>]}
[0m11:26:20.423122 [info ] [MainThread]: Found 6 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m11:26:20.424122 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1ecb7419-901a-4f00-ad3a-364a0a11a85a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203A7A393A0>]}
[0m11:26:20.426123 [info ] [MainThread]: 
[0m11:26:20.428120 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m11:26:20.430122 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m11:26:20.463124 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m11:26:20.464123 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m11:26:20.464123 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:26:21.363160 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.9 seconds
[0m11:26:21.364160 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m11:26:21.503139 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m11:26:21.510168 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m11:26:21.510168 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT"} */
show terse objects in DOOR2DOOR_DWH.DBT
[0m11:26:21.510168 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:26:22.129539 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.62 seconds
[0m11:26:22.131514 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: Close
[0m11:26:22.277014 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1ecb7419-901a-4f00-ad3a-364a0a11a85a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203A79721C0>]}
[0m11:26:22.277986 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:26:22.279015 [info ] [MainThread]: 
[0m11:26:22.283987 [debug] [Thread-1  ]: Began running node model.door2door_dwh.event_log
[0m11:26:22.283987 [info ] [Thread-1  ]: 1 of 6 START sql incremental model DBT.event_log ............................... [RUN]
[0m11:26:22.286028 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.event_log"
[0m11:26:22.286028 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.event_log
[0m11:26:22.286988 [debug] [Thread-1  ]: Compiling model.door2door_dwh.event_log
[0m11:26:22.299989 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.event_log"
[0m11:26:22.299989 [debug] [Thread-1  ]: finished collecting timing info
[0m11:26:22.300993 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.event_log
[0m11:26:22.357036 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.event_log"
[0m11:26:22.358017 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event_log"
[0m11:26:22.359033 [debug] [Thread-1  ]: On model.door2door_dwh.event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event_log"} */
create or replace transient table DOOR2DOOR_DWH.DBT.event_log  as
        (

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TEXT as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
        );
[0m11:26:22.359033 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m11:26:26.531194 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 4.17 seconds
[0m11:26:26.538191 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event_log"
[0m11:26:26.538191 [debug] [Thread-1  ]: On model.door2door_dwh.event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event_log"} */
drop view if exists DOOR2DOOR_DWH.DBT.event_log__dbt_tmp cascade
[0m11:26:26.616859 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m11:26:26.639885 [debug] [Thread-1  ]: finished collecting timing info
[0m11:26:26.640875 [debug] [Thread-1  ]: On model.door2door_dwh.event_log: Close
[0m11:26:26.768303 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1ecb7419-901a-4f00-ad3a-364a0a11a85a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203A7DB4460>]}
[0m11:26:26.769304 [info ] [Thread-1  ]: 1 of 6 OK created sql incremental model DBT.event_log .......................... [[32mSUCCESS 1[0m in 4.48s]
[0m11:26:26.770989 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.event_log
[0m11:26:26.771991 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_operating_period
[0m11:26:26.771991 [info ] [Thread-1  ]: 2 of 6 START sql table model DBT.dim_operating_period .......................... [RUN]
[0m11:26:26.772982 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_operating_period"
[0m11:26:26.773981 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_operating_period
[0m11:26:26.773981 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_operating_period
[0m11:26:26.778982 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_operating_period"
[0m11:26:26.779980 [debug] [Thread-1  ]: finished collecting timing info
[0m11:26:26.780995 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_operating_period
[0m11:26:26.791981 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_operating_period"
[0m11:26:26.794002 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_operating_period"
[0m11:26:26.794002 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_operating_period"} */
create or replace transient table DOOR2DOOR_DWH.DBT.dim_operating_period  as
        (

with operating_periods as (
    SELECT
        data_id,
        data_start,
        data_finish,
        ROW_NUMBER() OVER (PARTITION BY data_id ORDER BY data_finish desc, data_start desc) as rn
    FROM DOOR2DOOR_DWH.DBT.event_log
    WHERE lower(event_on) = 'operating_period'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    data_id as operating_period_source_id,
    data_start as operating_period_start_time,
    data_finish as operating_period_finish_time
FROM operating_periods
        );
[0m11:26:26.794982 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:26:27.891381 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.1 seconds
[0m11:26:27.893378 [debug] [Thread-1  ]: finished collecting timing info
[0m11:26:27.894378 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: Close
[0m11:26:28.029159 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1ecb7419-901a-4f00-ad3a-364a0a11a85a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203A7E04F70>]}
[0m11:26:28.030160 [info ] [Thread-1  ]: 2 of 6 OK created sql table model DBT.dim_operating_period ..................... [[32mSUCCESS 1[0m in 1.26s]
[0m11:26:28.031131 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_operating_period
[0m11:26:28.032130 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_vehicle
[0m11:26:28.032130 [info ] [Thread-1  ]: 3 of 6 START sql table model DBT.dim_vehicle ................................... [RUN]
[0m11:26:28.034163 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_vehicle"
[0m11:26:28.034163 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_vehicle
[0m11:26:28.034163 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_vehicle
[0m11:26:28.039159 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_vehicle"
[0m11:26:28.039159 [debug] [Thread-1  ]: finished collecting timing info
[0m11:26:28.040159 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_vehicle
[0m11:26:28.043133 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_vehicle"
[0m11:26:28.045132 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_vehicle"
[0m11:26:28.045132 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_vehicle"} */
create or replace transient table DOOR2DOOR_DWH.DBT.dim_vehicle  as
        (

with vehicles as (
    SELECT
        DISTINCT data_id
    FROM DOOR2DOOR_DWH.DBT.event_log
    WHERE lower(event_on) = 'vehicle'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    data_id as vehicle_source_id
FROM vehicles
        );
[0m11:26:28.045132 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:26:28.979525 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.93 seconds
[0m11:26:28.981523 [debug] [Thread-1  ]: finished collecting timing info
[0m11:26:28.982523 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: Close
[0m11:26:29.118109 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1ecb7419-901a-4f00-ad3a-364a0a11a85a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203A7CC40A0>]}
[0m11:26:29.118109 [info ] [Thread-1  ]: 3 of 6 OK created sql table model DBT.dim_vehicle .............................. [[32mSUCCESS 1[0m in 1.08s]
[0m11:26:29.120192 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_vehicle
[0m11:26:29.120192 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_deregistration
[0m11:26:29.121200 [info ] [Thread-1  ]: 4 of 6 START sql table model DBT.fact_deregistration ........................... [RUN]
[0m11:26:29.122203 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_deregistration"
[0m11:26:29.122203 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_deregistration
[0m11:26:29.122203 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_deregistration
[0m11:26:29.130201 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_deregistration"
[0m11:26:29.131206 [debug] [Thread-1  ]: finished collecting timing info
[0m11:26:29.132204 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_deregistration
[0m11:26:29.135202 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_deregistration"
[0m11:26:29.137206 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m11:26:29.137206 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
create or replace transient table DOOR2DOOR_DWH.DBT.fact_deregistration  as
        (

with events as (
    SELECT
        event
        event_at,
        data_id
    FROM DOOR2DOOR_DWH.DBT.event_log e
    LEFT JOIN DOOR2DOOR_DWH.DBT.dim_operating_period op
        ON e.event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'deregister'
)
SELECT
    
    
md5(cast(coalesce(cast(event as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as deregistration_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    event_at at deregistration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
        );
[0m11:26:29.138203 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:26:29.754938 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa204e-3201-98a1-0000-0001c1462335
[0m11:26:29.754938 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 21 at position 16 unexpected 'deregistration_time'.
[0m11:26:29.755939 [debug] [Thread-1  ]: finished collecting timing info
[0m11:26:29.755939 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: Close
[0m11:26:29.888413 [debug] [Thread-1  ]: Database Error in model fact_deregistration (models\dwh\fact_deregistration.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 16 unexpected 'deregistration_time'.
  compiled Code at target\run\door2door_dwh\models\dwh\fact_deregistration.sql
[0m11:26:29.889415 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1ecb7419-901a-4f00-ad3a-364a0a11a85a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203A7EF2F10>]}
[0m11:26:29.889415 [error] [Thread-1  ]: 4 of 6 ERROR creating sql table model DBT.fact_deregistration .................. [[31mERROR[0m in 0.77s]
[0m11:26:29.891434 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_deregistration
[0m11:26:29.892414 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_registration
[0m11:26:29.892414 [info ] [Thread-1  ]: 5 of 6 START sql table model DBT.fact_registration ............................. [RUN]
[0m11:26:29.893443 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_registration"
[0m11:26:29.894444 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_registration
[0m11:26:29.894444 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_registration
[0m11:26:29.901442 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_registration"
[0m11:26:29.902443 [debug] [Thread-1  ]: finished collecting timing info
[0m11:26:29.902443 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_registration
[0m11:26:29.912444 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_registration"
[0m11:26:29.913445 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m11:26:29.914449 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
create or replace transient table DOOR2DOOR_DWH.DBT.fact_registration  as
        (

with events as (
    SELECT
        event
        event_at,
        data_id
    FROM DOOR2DOOR_DWH.DBT.event_log e
    LEFT JOIN DOOR2DOOR_DWH.DBT.dim_operating_period op
        ON e.event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'register'
)
SELECT
    
    
md5(cast(coalesce(cast(event as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as registration_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    event_at at registration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
        );
[0m11:26:29.914449 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:26:30.315433 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa204e-3201-98a1-0000-0001c1462339
[0m11:26:30.315433 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 21 at position 16 unexpected 'registration_time'.
[0m11:26:30.316445 [debug] [Thread-1  ]: finished collecting timing info
[0m11:26:30.316445 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: Close
[0m11:26:30.447335 [debug] [Thread-1  ]: Database Error in model fact_registration (models\dwh\fact_registration.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 16 unexpected 'registration_time'.
  compiled Code at target\run\door2door_dwh\models\dwh\fact_registration.sql
[0m11:26:30.447335 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1ecb7419-901a-4f00-ad3a-364a0a11a85a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203A7E21730>]}
[0m11:26:30.448336 [error] [Thread-1  ]: 5 of 6 ERROR creating sql table model DBT.fact_registration .................... [[31mERROR[0m in 0.55s]
[0m11:26:30.450336 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_registration
[0m11:26:30.450336 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_vehicle_location
[0m11:26:30.451229 [info ] [Thread-1  ]: 6 of 6 START sql table model DBT.fact_vehicle_location ......................... [RUN]
[0m11:26:30.452242 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m11:26:30.452242 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_vehicle_location
[0m11:26:30.452242 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_vehicle_location
[0m11:26:30.460255 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_vehicle_location"
[0m11:26:30.461244 [debug] [Thread-1  ]: finished collecting timing info
[0m11:26:30.461244 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_vehicle_location
[0m11:26:30.464242 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_vehicle_location"
[0m11:26:30.465243 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m11:26:30.466242 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
create or replace transient table DOOR2DOOR_DWH.DBT.fact_vehicle_location  as
        (

with locations as (
    SELECT
        event_at,
        data_id,
        data_location_lat,
        data_location_lng,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT.event_log e
    INNER JOIN DOOR2DOOR_DWH.DBT.dim_operating_period op
        ON e.event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event_on) = 'update'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_location_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    operating_period_key,
    data_location_lat as vehicle_location_lat,
    data_location_lng as vehicle_location_lng
    event_at as vehicle_location_time
FROM locations


--- ASSUMPTION Events are recorded only if vehicle is registered to a operation period
        );
[0m11:26:30.466242 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:26:30.875592 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa204e-3201-98a1-0000-0001c146233d
[0m11:26:30.876585 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 26 at position 4 unexpected 'event_at'.
[0m11:26:30.876585 [debug] [Thread-1  ]: finished collecting timing info
[0m11:26:30.877557 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: Close
[0m11:26:31.005791 [debug] [Thread-1  ]: Database Error in model fact_vehicle_location (models\dwh\fact_vehicle_location.sql)
  001003 (42000): SQL compilation error:
  syntax error line 26 at position 4 unexpected 'event_at'.
  compiled Code at target\run\door2door_dwh\models\dwh\fact_vehicle_location.sql
[0m11:26:31.006793 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1ecb7419-901a-4f00-ad3a-364a0a11a85a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203A7F11EB0>]}
[0m11:26:31.006793 [error] [Thread-1  ]: 6 of 6 ERROR creating sql table model DBT.fact_vehicle_location ................ [[31mERROR[0m in 0.55s]
[0m11:26:31.008393 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_vehicle_location
[0m11:26:31.010424 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m11:26:31.011418 [info ] [MainThread]: 
[0m11:26:31.011418 [info ] [MainThread]: Finished running 1 incremental model, 5 table models in 0 hours 0 minutes and 10.58 seconds (10.58s).
[0m11:26:31.012416 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:26:31.012416 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m11:26:31.013476 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT' was properly closed.
[0m11:26:31.013476 [debug] [MainThread]: Connection 'model.door2door_dwh.fact_vehicle_location' was properly closed.
[0m11:26:31.077459 [info ] [MainThread]: 
[0m11:26:31.078454 [info ] [MainThread]: [31mCompleted with 3 errors and 0 warnings:[0m
[0m11:26:31.079424 [info ] [MainThread]: 
[0m11:26:31.080477 [error] [MainThread]: [33mDatabase Error in model fact_deregistration (models\dwh\fact_deregistration.sql)[0m
[0m11:26:31.081417 [error] [MainThread]:   001003 (42000): SQL compilation error:
[0m11:26:31.082496 [error] [MainThread]:   syntax error line 21 at position 16 unexpected 'deregistration_time'.
[0m11:26:31.083419 [error] [MainThread]:   compiled Code at target\run\door2door_dwh\models\dwh\fact_deregistration.sql
[0m11:26:31.083419 [info ] [MainThread]: 
[0m11:26:31.084416 [error] [MainThread]: [33mDatabase Error in model fact_registration (models\dwh\fact_registration.sql)[0m
[0m11:26:31.085417 [error] [MainThread]:   001003 (42000): SQL compilation error:
[0m11:26:31.086416 [error] [MainThread]:   syntax error line 21 at position 16 unexpected 'registration_time'.
[0m11:26:31.087462 [error] [MainThread]:   compiled Code at target\run\door2door_dwh\models\dwh\fact_registration.sql
[0m11:26:31.088419 [info ] [MainThread]: 
[0m11:26:31.088419 [error] [MainThread]: [33mDatabase Error in model fact_vehicle_location (models\dwh\fact_vehicle_location.sql)[0m
[0m11:26:31.089445 [error] [MainThread]:   001003 (42000): SQL compilation error:
[0m11:26:31.090416 [error] [MainThread]:   syntax error line 26 at position 4 unexpected 'event_at'.
[0m11:26:31.091466 [error] [MainThread]:   compiled Code at target\run\door2door_dwh\models\dwh\fact_vehicle_location.sql
[0m11:26:31.092418 [info ] [MainThread]: 
[0m11:26:31.092418 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=3 SKIP=0 TOTAL=6
[0m11:26:31.093458 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020394CC08B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203A7838130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203A7845AF0>]}
[0m11:26:31.093458 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 11:26:53.992481 | fcbbe865-674c-40c1-aad1-530fc1faa7dd ==============================
[0m11:26:53.992481 [info ] [MainThread]: Running with dbt=1.3.1
[0m11:26:53.993482 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': False, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m11:26:53.994478 [debug] [MainThread]: Tracking: tracking
[0m11:26:53.994478 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE8E382790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE8E3827F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE8E382850>]}
[0m11:26:54.146527 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m11:26:54.146527 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\fact_vehicle_location.sql
[0m11:26:54.163483 [debug] [MainThread]: 1603: static parser failed on dwh\fact_vehicle_location.sql
[0m11:26:54.202519 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_vehicle_location.sql
[0m11:26:54.227521 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fcbbe865-674c-40c1-aad1-530fc1faa7dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE8E5E40D0>]}
[0m11:26:54.236521 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fcbbe865-674c-40c1-aad1-530fc1faa7dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE8E4B9850>]}
[0m11:26:54.237481 [info ] [MainThread]: Found 6 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m11:26:54.238496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fcbbe865-674c-40c1-aad1-530fc1faa7dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE8E51B6A0>]}
[0m11:26:54.241523 [info ] [MainThread]: 
[0m11:26:54.242482 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m11:26:54.244519 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m11:26:54.267483 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m11:26:54.267483 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m11:26:54.268486 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:26:55.211074 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.94 seconds
[0m11:26:55.212071 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m11:26:55.346820 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m11:26:55.354829 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m11:26:55.355829 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT"} */
show terse objects in DOOR2DOOR_DWH.DBT
[0m11:26:55.355829 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:26:55.953884 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.6 seconds
[0m11:26:55.954883 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: Close
[0m11:26:56.078839 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fcbbe865-674c-40c1-aad1-530fc1faa7dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE8E4B9790>]}
[0m11:26:56.079873 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:26:56.080846 [info ] [MainThread]: 
[0m11:26:56.085791 [debug] [Thread-1  ]: Began running node model.door2door_dwh.event_log
[0m11:26:56.086778 [info ] [Thread-1  ]: 1 of 6 START sql incremental model DBT.event_log ............................... [RUN]
[0m11:26:56.087789 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.event_log"
[0m11:26:56.087789 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.event_log
[0m11:26:56.088808 [debug] [Thread-1  ]: Compiling model.door2door_dwh.event_log
[0m11:26:56.099822 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.event_log"
[0m11:26:56.100811 [debug] [Thread-1  ]: finished collecting timing info
[0m11:26:56.100811 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.event_log
[0m11:26:56.168779 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.event_log"
[0m11:26:56.170780 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event_log"
[0m11:26:56.170780 [debug] [Thread-1  ]: On model.door2door_dwh.event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event_log"} */
create or replace transient table DOOR2DOOR_DWH.DBT.event_log  as
        (

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TEXT as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
        );
[0m11:26:56.171779 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m11:27:01.463109 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 5.29 seconds
[0m11:27:01.473127 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event_log"
[0m11:27:01.474108 [debug] [Thread-1  ]: On model.door2door_dwh.event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event_log"} */
drop view if exists DOOR2DOOR_DWH.DBT.event_log__dbt_tmp cascade
[0m11:27:01.558726 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m11:27:01.583766 [debug] [Thread-1  ]: finished collecting timing info
[0m11:27:01.583766 [debug] [Thread-1  ]: On model.door2door_dwh.event_log: Close
[0m11:27:01.712087 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fcbbe865-674c-40c1-aad1-530fc1faa7dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE8E7DBB20>]}
[0m11:27:01.713088 [info ] [Thread-1  ]: 1 of 6 OK created sql incremental model DBT.event_log .......................... [[32mSUCCESS 1[0m in 5.62s]
[0m11:27:01.714148 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.event_log
[0m11:27:01.715161 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_operating_period
[0m11:27:01.716161 [info ] [Thread-1  ]: 2 of 6 START sql table model DBT.dim_operating_period .......................... [RUN]
[0m11:27:01.717187 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_operating_period"
[0m11:27:01.717187 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_operating_period
[0m11:27:01.717187 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_operating_period
[0m11:27:01.723186 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_operating_period"
[0m11:27:01.724161 [debug] [Thread-1  ]: finished collecting timing info
[0m11:27:01.724161 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_operating_period
[0m11:27:01.737160 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_operating_period"
[0m11:27:01.739159 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_operating_period"
[0m11:27:01.739159 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_operating_period"} */
create or replace transient table DOOR2DOOR_DWH.DBT.dim_operating_period  as
        (

with operating_periods as (
    SELECT
        data_id,
        data_start,
        data_finish,
        ROW_NUMBER() OVER (PARTITION BY data_id ORDER BY data_finish desc, data_start desc) as rn
    FROM DOOR2DOOR_DWH.DBT.event_log
    WHERE lower(event_on) = 'operating_period'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    data_id as operating_period_source_id,
    data_start as operating_period_start_time,
    data_finish as operating_period_finish_time
FROM operating_periods
        );
[0m11:27:01.740161 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:27:02.794186 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.05 seconds
[0m11:27:02.797184 [debug] [Thread-1  ]: finished collecting timing info
[0m11:27:02.797184 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: Close
[0m11:27:02.925513 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fcbbe865-674c-40c1-aad1-530fc1faa7dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE8E5E43D0>]}
[0m11:27:02.926528 [info ] [Thread-1  ]: 2 of 6 OK created sql table model DBT.dim_operating_period ..................... [[32mSUCCESS 1[0m in 1.21s]
[0m11:27:02.928557 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_operating_period
[0m11:27:02.928557 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_vehicle
[0m11:27:02.929599 [info ] [Thread-1  ]: 3 of 6 START sql table model DBT.dim_vehicle ................................... [RUN]
[0m11:27:02.930566 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_vehicle"
[0m11:27:02.931567 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_vehicle
[0m11:27:02.931567 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_vehicle
[0m11:27:02.937566 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_vehicle"
[0m11:27:02.938566 [debug] [Thread-1  ]: finished collecting timing info
[0m11:27:02.938566 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_vehicle
[0m11:27:02.943566 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_vehicle"
[0m11:27:02.944566 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_vehicle"
[0m11:27:02.944566 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_vehicle"} */
create or replace transient table DOOR2DOOR_DWH.DBT.dim_vehicle  as
        (

with vehicles as (
    SELECT
        DISTINCT data_id
    FROM DOOR2DOOR_DWH.DBT.event_log
    WHERE lower(event_on) = 'vehicle'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    data_id as vehicle_source_id
FROM vehicles
        );
[0m11:27:02.945566 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:27:04.074562 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.13 seconds
[0m11:27:04.077546 [debug] [Thread-1  ]: finished collecting timing info
[0m11:27:04.078580 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: Close
[0m11:27:04.203754 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fcbbe865-674c-40c1-aad1-530fc1faa7dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE8E7A4910>]}
[0m11:27:04.204755 [info ] [Thread-1  ]: 3 of 6 OK created sql table model DBT.dim_vehicle .............................. [[32mSUCCESS 1[0m in 1.27s]
[0m11:27:04.205766 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_vehicle
[0m11:27:04.206754 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_deregistration
[0m11:27:04.206754 [info ] [Thread-1  ]: 4 of 6 START sql table model DBT.fact_deregistration ........................... [RUN]
[0m11:27:04.208297 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_deregistration"
[0m11:27:04.208297 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_deregistration
[0m11:27:04.208297 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_deregistration
[0m11:27:04.216320 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_deregistration"
[0m11:27:04.217325 [debug] [Thread-1  ]: finished collecting timing info
[0m11:27:04.217325 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_deregistration
[0m11:27:04.221321 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_deregistration"
[0m11:27:04.223320 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m11:27:04.223320 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
create or replace transient table DOOR2DOOR_DWH.DBT.fact_deregistration  as
        (

with events as (
    SELECT
        event
        event_at,
        data_id
    FROM DOOR2DOOR_DWH.DBT.event_log e
    LEFT JOIN DOOR2DOOR_DWH.DBT.dim_operating_period op
        ON e.event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'deregister'
)
SELECT
    
    
md5(cast(coalesce(cast(event as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as deregistration_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    event_at at deregistration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
        );
[0m11:27:04.223320 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:27:04.615297 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa204f-3201-9a27-0000-0001c14650b1
[0m11:27:04.615297 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 21 at position 16 unexpected 'deregistration_time'.
[0m11:27:04.616308 [debug] [Thread-1  ]: finished collecting timing info
[0m11:27:04.617298 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: Close
[0m11:27:04.741223 [debug] [Thread-1  ]: Database Error in model fact_deregistration (models\dwh\fact_deregistration.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 16 unexpected 'deregistration_time'.
  compiled Code at target\run\door2door_dwh\models\dwh\fact_deregistration.sql
[0m11:27:04.741223 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fcbbe865-674c-40c1-aad1-530fc1faa7dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE8E9CDFD0>]}
[0m11:27:04.742224 [error] [Thread-1  ]: 4 of 6 ERROR creating sql table model DBT.fact_deregistration .................. [[31mERROR[0m in 0.53s]
[0m11:27:04.744227 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_deregistration
[0m11:27:04.744227 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_registration
[0m11:27:04.745225 [info ] [Thread-1  ]: 5 of 6 START sql table model DBT.fact_registration ............................. [RUN]
[0m11:27:04.746253 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_registration"
[0m11:27:04.746253 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_registration
[0m11:27:04.746253 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_registration
[0m11:27:04.753254 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_registration"
[0m11:27:04.754253 [debug] [Thread-1  ]: finished collecting timing info
[0m11:27:04.754253 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_registration
[0m11:27:04.757258 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_registration"
[0m11:27:04.760226 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m11:27:04.761254 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
create or replace transient table DOOR2DOOR_DWH.DBT.fact_registration  as
        (

with events as (
    SELECT
        event
        event_at,
        data_id
    FROM DOOR2DOOR_DWH.DBT.event_log e
    LEFT JOIN DOOR2DOOR_DWH.DBT.dim_operating_period op
        ON e.event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'register'
)
SELECT
    
    
md5(cast(coalesce(cast(event as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as registration_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    event_at at registration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
        );
[0m11:27:04.761254 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:27:05.164244 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa204f-3201-9a27-0000-0001c14650b5
[0m11:27:05.164244 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 21 at position 16 unexpected 'registration_time'.
[0m11:27:05.164244 [debug] [Thread-1  ]: finished collecting timing info
[0m11:27:05.165221 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: Close
[0m11:27:05.303081 [debug] [Thread-1  ]: Database Error in model fact_registration (models\dwh\fact_registration.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 16 unexpected 'registration_time'.
  compiled Code at target\run\door2door_dwh\models\dwh\fact_registration.sql
[0m11:27:05.303081 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fcbbe865-674c-40c1-aad1-530fc1faa7dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE8E9F1040>]}
[0m11:27:05.304082 [error] [Thread-1  ]: 5 of 6 ERROR creating sql table model DBT.fact_registration .................... [[31mERROR[0m in 0.56s]
[0m11:27:05.305965 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_registration
[0m11:27:05.305965 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_vehicle_location
[0m11:27:05.305965 [info ] [Thread-1  ]: 6 of 6 START sql table model DBT.fact_vehicle_location ......................... [RUN]
[0m11:27:05.307992 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m11:27:05.307992 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_vehicle_location
[0m11:27:05.307992 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_vehicle_location
[0m11:27:05.315993 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_vehicle_location"
[0m11:27:05.315993 [debug] [Thread-1  ]: finished collecting timing info
[0m11:27:05.316967 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_vehicle_location
[0m11:27:05.319992 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_vehicle_location"
[0m11:27:05.320976 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m11:27:05.321994 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
create or replace transient table DOOR2DOOR_DWH.DBT.fact_vehicle_location  as
        (

with locations as (
    SELECT
        event_at,
        data_id,
        data_location_lat,
        data_location_lng,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT.event_log e
    INNER JOIN DOOR2DOOR_DWH.DBT.dim_operating_period op
        ON e.event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event_on) = 'update'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_location_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    operating_period_key,
    data_location_lat as vehicle_location_lat,
    data_location_lng as vehicle_location_lng,
    event_at as vehicle_location_time
FROM locations


--- ASSUMPTION Events are recorded only if vehicle is registered to a operation period
        );
[0m11:27:05.321994 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:27:06.466862 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.14 seconds
[0m11:27:06.468859 [debug] [Thread-1  ]: finished collecting timing info
[0m11:27:06.468859 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: Close
[0m11:27:06.610866 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fcbbe865-674c-40c1-aad1-530fc1faa7dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE8E9E66A0>]}
[0m11:27:06.611894 [info ] [Thread-1  ]: 6 of 6 OK created sql table model DBT.fact_vehicle_location .................... [[32mSUCCESS 1[0m in 1.30s]
[0m11:27:06.613357 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_vehicle_location
[0m11:27:06.615390 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m11:27:06.616371 [info ] [MainThread]: 
[0m11:27:06.616371 [info ] [MainThread]: Finished running 1 incremental model, 5 table models in 0 hours 0 minutes and 12.37 seconds (12.37s).
[0m11:27:06.617371 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:27:06.617371 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m11:27:06.618372 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT' was properly closed.
[0m11:27:06.618372 [debug] [MainThread]: Connection 'model.door2door_dwh.fact_vehicle_location' was properly closed.
[0m11:27:06.680372 [info ] [MainThread]: 
[0m11:27:06.681370 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m11:27:06.682368 [info ] [MainThread]: 
[0m11:27:06.683371 [error] [MainThread]: [33mDatabase Error in model fact_deregistration (models\dwh\fact_deregistration.sql)[0m
[0m11:27:06.684372 [error] [MainThread]:   001003 (42000): SQL compilation error:
[0m11:27:06.685371 [error] [MainThread]:   syntax error line 21 at position 16 unexpected 'deregistration_time'.
[0m11:27:06.685371 [error] [MainThread]:   compiled Code at target\run\door2door_dwh\models\dwh\fact_deregistration.sql
[0m11:27:06.686369 [info ] [MainThread]: 
[0m11:27:06.687409 [error] [MainThread]: [33mDatabase Error in model fact_registration (models\dwh\fact_registration.sql)[0m
[0m11:27:06.688379 [error] [MainThread]:   001003 (42000): SQL compilation error:
[0m11:27:06.689375 [error] [MainThread]:   syntax error line 21 at position 16 unexpected 'registration_time'.
[0m11:27:06.689375 [error] [MainThread]:   compiled Code at target\run\door2door_dwh\models\dwh\fact_registration.sql
[0m11:27:06.690381 [info ] [MainThread]: 
[0m11:27:06.691382 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=2 SKIP=0 TOTAL=6
[0m11:27:06.692368 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CEFA1172E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE8E3151C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE8E325D90>]}
[0m11:27:06.692368 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 11:27:12.055385 | 4b396e68-83be-4196-99c4-44059f65e447 ==============================
[0m11:27:12.055385 [info ] [MainThread]: Running with dbt=1.3.1
[0m11:27:12.056360 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': False, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m11:27:12.056360 [debug] [MainThread]: Tracking: tracking
[0m11:27:12.057356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EE1BF306D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EE1BF30730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EE1BF30790>]}
[0m11:27:12.183385 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m11:27:12.184380 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\fact_deregistration.sql
[0m11:27:12.184380 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\fact_registration.sql
[0m11:27:12.197386 [debug] [MainThread]: 1603: static parser failed on dwh\fact_deregistration.sql
[0m11:27:12.228386 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_deregistration.sql
[0m11:27:12.229387 [debug] [MainThread]: 1603: static parser failed on dwh\fact_registration.sql
[0m11:27:12.238386 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_registration.sql
[0m11:27:12.256356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4b396e68-83be-4196-99c4-44059f65e447', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EE1C1EFEE0>]}
[0m11:27:12.265356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4b396e68-83be-4196-99c4-44059f65e447', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EE1C184790>]}
[0m11:27:12.265356 [info ] [MainThread]: Found 6 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m11:27:12.266722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4b396e68-83be-4196-99c4-44059f65e447', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EE1C184A00>]}
[0m11:27:12.267732 [info ] [MainThread]: 
[0m11:27:12.268732 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m11:27:12.270798 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m11:27:12.285774 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m11:27:12.285774 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m11:27:12.285774 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:27:13.168906 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.88 seconds
[0m11:27:13.169907 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m11:27:13.306657 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m11:27:13.313687 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT"
[0m11:27:13.313687 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT"} */
show terse objects in DOOR2DOOR_DWH.DBT
[0m11:27:13.314660 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:27:13.746534 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.43 seconds
[0m11:27:13.748531 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT: Close
[0m11:27:13.897786 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4b396e68-83be-4196-99c4-44059f65e447', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EE1C158A90>]}
[0m11:27:13.898821 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:27:13.899815 [info ] [MainThread]: 
[0m11:27:13.904942 [debug] [Thread-1  ]: Began running node model.door2door_dwh.event_log
[0m11:27:13.904942 [info ] [Thread-1  ]: 1 of 6 START sql incremental model DBT.event_log ............................... [RUN]
[0m11:27:13.906959 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.event_log"
[0m11:27:13.906959 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.event_log
[0m11:27:13.907944 [debug] [Thread-1  ]: Compiling model.door2door_dwh.event_log
[0m11:27:13.917951 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.event_log"
[0m11:27:13.918930 [debug] [Thread-1  ]: finished collecting timing info
[0m11:27:13.918930 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.event_log
[0m11:27:13.974934 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.event_log"
[0m11:27:13.976935 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event_log"
[0m11:27:13.976935 [debug] [Thread-1  ]: On model.door2door_dwh.event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event_log"} */
create or replace transient table DOOR2DOOR_DWH.DBT.event_log  as
        (

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TEXT as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
        );
[0m11:27:13.976935 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m11:27:18.086575 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 4.11 seconds
[0m11:27:18.093571 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event_log"
[0m11:27:18.093571 [debug] [Thread-1  ]: On model.door2door_dwh.event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event_log"} */
drop view if exists DOOR2DOOR_DWH.DBT.event_log__dbt_tmp cascade
[0m11:27:18.184827 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.09 seconds
[0m11:27:18.206823 [debug] [Thread-1  ]: finished collecting timing info
[0m11:27:18.206823 [debug] [Thread-1  ]: On model.door2door_dwh.event_log: Close
[0m11:27:18.329924 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4b396e68-83be-4196-99c4-44059f65e447', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EE1C4C3E80>]}
[0m11:27:18.330925 [info ] [Thread-1  ]: 1 of 6 OK created sql incremental model DBT.event_log .......................... [[32mSUCCESS 1[0m in 4.42s]
[0m11:27:18.331817 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.event_log
[0m11:27:18.333848 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_operating_period
[0m11:27:18.333848 [info ] [Thread-1  ]: 2 of 6 START sql table model DBT.dim_operating_period .......................... [RUN]
[0m11:27:18.334848 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_operating_period"
[0m11:27:18.334848 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_operating_period
[0m11:27:18.335850 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_operating_period
[0m11:27:18.340850 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_operating_period"
[0m11:27:18.341849 [debug] [Thread-1  ]: finished collecting timing info
[0m11:27:18.342851 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_operating_period
[0m11:27:18.353850 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_operating_period"
[0m11:27:18.355851 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_operating_period"
[0m11:27:18.355851 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_operating_period"} */
create or replace transient table DOOR2DOOR_DWH.DBT.dim_operating_period  as
        (

with operating_periods as (
    SELECT
        data_id,
        data_start,
        data_finish,
        ROW_NUMBER() OVER (PARTITION BY data_id ORDER BY data_finish desc, data_start desc) as rn
    FROM DOOR2DOOR_DWH.DBT.event_log
    WHERE lower(event_on) = 'operating_period'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    data_id as operating_period_source_id,
    data_start as operating_period_start_time,
    data_finish as operating_period_finish_time
FROM operating_periods
        );
[0m11:27:18.355851 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:27:19.297673 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.94 seconds
[0m11:27:19.299670 [debug] [Thread-1  ]: finished collecting timing info
[0m11:27:19.300669 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: Close
[0m11:27:19.445616 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4b396e68-83be-4196-99c4-44059f65e447', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EE1C52C220>]}
[0m11:27:19.446616 [info ] [Thread-1  ]: 2 of 6 OK created sql table model DBT.dim_operating_period ..................... [[32mSUCCESS 1[0m in 1.11s]
[0m11:27:19.448635 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_operating_period
[0m11:27:19.448635 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_vehicle
[0m11:27:19.449631 [info ] [Thread-1  ]: 3 of 6 START sql table model DBT.dim_vehicle ................................... [RUN]
[0m11:27:19.451618 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_vehicle"
[0m11:27:19.452620 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_vehicle
[0m11:27:19.452620 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_vehicle
[0m11:27:19.461614 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_vehicle"
[0m11:27:19.462616 [debug] [Thread-1  ]: finished collecting timing info
[0m11:27:19.463617 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_vehicle
[0m11:27:19.471617 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_vehicle"
[0m11:27:19.475618 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_vehicle"
[0m11:27:19.478616 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_vehicle"} */
create or replace transient table DOOR2DOOR_DWH.DBT.dim_vehicle  as
        (

with vehicles as (
    SELECT
        DISTINCT data_id
    FROM DOOR2DOOR_DWH.DBT.event_log
    WHERE lower(event_on) = 'vehicle'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    data_id as vehicle_source_id
FROM vehicles
        );
[0m11:27:19.482618 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:27:20.601419 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.12 seconds
[0m11:27:20.606421 [debug] [Thread-1  ]: finished collecting timing info
[0m11:27:20.607424 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: Close
[0m11:27:20.749161 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4b396e68-83be-4196-99c4-44059f65e447', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EE1C4C3280>]}
[0m11:27:20.749161 [info ] [Thread-1  ]: 3 of 6 OK created sql table model DBT.dim_vehicle .............................. [[32mSUCCESS 1[0m in 1.30s]
[0m11:27:20.751119 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_vehicle
[0m11:27:20.752123 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_deregistration
[0m11:27:20.752123 [info ] [Thread-1  ]: 4 of 6 START sql table model DBT.fact_deregistration ........................... [RUN]
[0m11:27:20.754138 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_deregistration"
[0m11:27:20.754138 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_deregistration
[0m11:27:20.755161 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_deregistration
[0m11:27:20.763160 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_deregistration"
[0m11:27:20.764161 [debug] [Thread-1  ]: finished collecting timing info
[0m11:27:20.764161 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_deregistration
[0m11:27:20.768160 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_deregistration"
[0m11:27:20.770159 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m11:27:20.770159 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
create or replace transient table DOOR2DOOR_DWH.DBT.fact_deregistration  as
        (

with events as (
    SELECT
        event
        event_at,
        data_id
    FROM DOOR2DOOR_DWH.DBT.event_log e
    LEFT JOIN DOOR2DOOR_DWH.DBT.dim_operating_period op
        ON e.event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'deregister'
)
SELECT
    
    
md5(cast(coalesce(cast(event as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as deregistration_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    event_at as deregistration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
        );
[0m11:27:20.770159 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:27:21.192987 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa204f-3201-98a1-0000-0001c146234d
[0m11:27:21.192987 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 17 at position 23
invalid identifier 'EVENT'
[0m11:27:21.192987 [debug] [Thread-1  ]: finished collecting timing info
[0m11:27:21.193958 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: Close
[0m11:27:21.318928 [debug] [Thread-1  ]: Database Error in model fact_deregistration (models\dwh\fact_deregistration.sql)
  000904 (42000): SQL compilation error: error line 17 at position 23
  invalid identifier 'EVENT'
  compiled Code at target\run\door2door_dwh\models\dwh\fact_deregistration.sql
[0m11:27:21.318928 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4b396e68-83be-4196-99c4-44059f65e447', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EE1C4C3DC0>]}
[0m11:27:21.319946 [error] [Thread-1  ]: 4 of 6 ERROR creating sql table model DBT.fact_deregistration .................. [[31mERROR[0m in 0.57s]
[0m11:27:21.320901 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_deregistration
[0m11:27:21.321928 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_registration
[0m11:27:21.321928 [info ] [Thread-1  ]: 5 of 6 START sql table model DBT.fact_registration ............................. [RUN]
[0m11:27:21.322919 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_registration"
[0m11:27:21.323918 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_registration
[0m11:27:21.323918 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_registration
[0m11:27:21.331928 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_registration"
[0m11:27:21.332912 [debug] [Thread-1  ]: finished collecting timing info
[0m11:27:21.332912 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_registration
[0m11:27:21.335927 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_registration"
[0m11:27:21.337900 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m11:27:21.337900 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
create or replace transient table DOOR2DOOR_DWH.DBT.fact_registration  as
        (

with events as (
    SELECT
        event
        event_at,
        data_id
    FROM DOOR2DOOR_DWH.DBT.event_log e
    LEFT JOIN DOOR2DOOR_DWH.DBT.dim_operating_period op
        ON e.event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'register'
)
SELECT
    
    
md5(cast(coalesce(cast(event as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as registration_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    event_at as registration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
        );
[0m11:27:21.337900 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:27:21.988603 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa204f-3201-9a27-0000-0001c14650c1
[0m11:27:21.989587 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 17 at position 23
invalid identifier 'EVENT'
[0m11:27:21.989587 [debug] [Thread-1  ]: finished collecting timing info
[0m11:27:21.990595 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: Close
[0m11:27:22.125197 [debug] [Thread-1  ]: Database Error in model fact_registration (models\dwh\fact_registration.sql)
  000904 (42000): SQL compilation error: error line 17 at position 23
  invalid identifier 'EVENT'
  compiled Code at target\run\door2door_dwh\models\dwh\fact_registration.sql
[0m11:27:22.125197 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4b396e68-83be-4196-99c4-44059f65e447', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EE1C4C3D90>]}
[0m11:27:22.126184 [error] [Thread-1  ]: 5 of 6 ERROR creating sql table model DBT.fact_registration .................... [[31mERROR[0m in 0.80s]
[0m11:27:22.127162 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_registration
[0m11:27:22.128185 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_vehicle_location
[0m11:27:22.128185 [info ] [Thread-1  ]: 6 of 6 START sql table model DBT.fact_vehicle_location ......................... [RUN]
[0m11:27:22.129175 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m11:27:22.130185 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_vehicle_location
[0m11:27:22.130185 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_vehicle_location
[0m11:27:22.138183 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_vehicle_location"
[0m11:27:22.139156 [debug] [Thread-1  ]: finished collecting timing info
[0m11:27:22.139156 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_vehicle_location
[0m11:27:22.194157 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_vehicle_location"
[0m11:27:22.196196 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m11:27:22.197159 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
create or replace transient table DOOR2DOOR_DWH.DBT.fact_vehicle_location  as
        (

with locations as (
    SELECT
        event_at,
        data_id,
        data_location_lat,
        data_location_lng,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT.event_log e
    INNER JOIN DOOR2DOOR_DWH.DBT.dim_operating_period op
        ON e.event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event_on) = 'update'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_location_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    operating_period_key,
    data_location_lat as vehicle_location_lat,
    data_location_lng as vehicle_location_lng,
    event_at as vehicle_location_time
FROM locations


--- ASSUMPTION Events are recorded only if vehicle is registered to a operation period
        );
[0m11:27:22.197159 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:27:23.102329 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.91 seconds
[0m11:27:23.105324 [debug] [Thread-1  ]: finished collecting timing info
[0m11:27:23.105324 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: Close
[0m11:27:23.248586 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4b396e68-83be-4196-99c4-44059f65e447', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EE1C66BDF0>]}
[0m11:27:23.248586 [info ] [Thread-1  ]: 6 of 6 OK created sql table model DBT.fact_vehicle_location .................... [[32mSUCCESS 1[0m in 1.12s]
[0m11:27:23.252591 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_vehicle_location
[0m11:27:23.255586 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m11:27:23.258591 [info ] [MainThread]: 
[0m11:27:23.259588 [info ] [MainThread]: Finished running 1 incremental model, 5 table models in 0 hours 0 minutes and 10.99 seconds (10.99s).
[0m11:27:23.261586 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:27:23.261586 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m11:27:23.262595 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT' was properly closed.
[0m11:27:23.264605 [debug] [MainThread]: Connection 'model.door2door_dwh.fact_vehicle_location' was properly closed.
[0m11:27:23.285596 [info ] [MainThread]: 
[0m11:27:23.288595 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m11:27:23.291590 [info ] [MainThread]: 
[0m11:27:23.292586 [error] [MainThread]: [33mDatabase Error in model fact_deregistration (models\dwh\fact_deregistration.sql)[0m
[0m11:27:23.293589 [error] [MainThread]:   000904 (42000): SQL compilation error: error line 17 at position 23
[0m11:27:23.294587 [error] [MainThread]:   invalid identifier 'EVENT'
[0m11:27:23.295586 [error] [MainThread]:   compiled Code at target\run\door2door_dwh\models\dwh\fact_deregistration.sql
[0m11:27:23.297600 [info ] [MainThread]: 
[0m11:27:23.299586 [error] [MainThread]: [33mDatabase Error in model fact_registration (models\dwh\fact_registration.sql)[0m
[0m11:27:23.302600 [error] [MainThread]:   000904 (42000): SQL compilation error: error line 17 at position 23
[0m11:27:23.304604 [error] [MainThread]:   invalid identifier 'EVENT'
[0m11:27:23.306598 [error] [MainThread]:   compiled Code at target\run\door2door_dwh\models\dwh\fact_registration.sql
[0m11:27:23.309589 [info ] [MainThread]: 
[0m11:27:23.311588 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=2 SKIP=0 TOTAL=6
[0m11:27:23.312587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EE19B39BE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EE0531CE80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EE1C68ABE0>]}
[0m11:27:23.312587 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 11:29:13.665613 | 75d3afa3-2b29-4455-b42a-bcfa02cf25cd ==============================
[0m11:29:13.665613 [info ] [MainThread]: Running with dbt=1.3.1
[0m11:29:13.666614 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': False, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m11:29:13.666614 [debug] [MainThread]: Tracking: tracking
[0m11:29:13.667613 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7D9793A30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7D9793A90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7D9793AF0>]}
[0m11:29:13.714623 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m11:29:13.715616 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '75d3afa3-2b29-4455-b42a-bcfa02cf25cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7D97B5CA0>]}
[0m11:29:13.809616 [debug] [MainThread]: Parsing macros\adapters.sql
[0m11:29:13.849617 [debug] [MainThread]: Parsing macros\apply_grants.sql
[0m11:29:13.850618 [debug] [MainThread]: Parsing macros\catalog.sql
[0m11:29:13.852617 [debug] [MainThread]: Parsing macros\materializations\incremental.sql
[0m11:29:13.863638 [debug] [MainThread]: Parsing macros\materializations\merge.sql
[0m11:29:13.866617 [debug] [MainThread]: Parsing macros\materializations\seed.sql
[0m11:29:13.871617 [debug] [MainThread]: Parsing macros\materializations\snapshot.sql
[0m11:29:13.873617 [debug] [MainThread]: Parsing macros\materializations\table.sql
[0m11:29:13.880614 [debug] [MainThread]: Parsing macros\materializations\test.sql
[0m11:29:13.881625 [debug] [MainThread]: Parsing macros\materializations\view.sql
[0m11:29:13.883614 [debug] [MainThread]: Parsing macros\utils\array_construct.sql
[0m11:29:13.884616 [debug] [MainThread]: Parsing macros\utils\bool_or.sql
[0m11:29:13.884616 [debug] [MainThread]: Parsing macros\utils\escape_single_quotes.sql
[0m11:29:13.885614 [debug] [MainThread]: Parsing macros\utils\right.sql
[0m11:29:13.886614 [debug] [MainThread]: Parsing macros\utils\safe_cast.sql
[0m11:29:13.887614 [debug] [MainThread]: Parsing macros\utils\timestamps.sql
[0m11:29:13.889614 [debug] [MainThread]: Parsing macros\adapters\apply_grants.sql
[0m11:29:13.902613 [debug] [MainThread]: Parsing macros\adapters\columns.sql
[0m11:29:13.910614 [debug] [MainThread]: Parsing macros\adapters\freshness.sql
[0m11:29:13.912614 [debug] [MainThread]: Parsing macros\adapters\indexes.sql
[0m11:29:13.915614 [debug] [MainThread]: Parsing macros\adapters\metadata.sql
[0m11:29:13.922614 [debug] [MainThread]: Parsing macros\adapters\persist_docs.sql
[0m11:29:13.926614 [debug] [MainThread]: Parsing macros\adapters\relation.sql
[0m11:29:13.939625 [debug] [MainThread]: Parsing macros\adapters\schema.sql
[0m11:29:13.941614 [debug] [MainThread]: Parsing macros\adapters\timestamps.sql
[0m11:29:13.945614 [debug] [MainThread]: Parsing macros\etc\datetime.sql
[0m11:29:13.953614 [debug] [MainThread]: Parsing macros\etc\statement.sql
[0m11:29:13.958614 [debug] [MainThread]: Parsing macros\generic_test_sql\accepted_values.sql
[0m11:29:13.959614 [debug] [MainThread]: Parsing macros\generic_test_sql\not_null.sql
[0m11:29:13.960615 [debug] [MainThread]: Parsing macros\generic_test_sql\relationships.sql
[0m11:29:13.961614 [debug] [MainThread]: Parsing macros\generic_test_sql\unique.sql
[0m11:29:13.962615 [debug] [MainThread]: Parsing macros\get_custom_name\get_custom_alias.sql
[0m11:29:13.963614 [debug] [MainThread]: Parsing macros\get_custom_name\get_custom_database.sql
[0m11:29:13.965614 [debug] [MainThread]: Parsing macros\get_custom_name\get_custom_schema.sql
[0m11:29:13.967614 [debug] [MainThread]: Parsing macros\materializations\configs.sql
[0m11:29:13.970614 [debug] [MainThread]: Parsing macros\materializations\hooks.sql
[0m11:29:13.973614 [debug] [MainThread]: Parsing macros\materializations\models\incremental\column_helpers.sql
[0m11:29:13.981614 [debug] [MainThread]: Parsing macros\materializations\models\incremental\incremental.sql
[0m11:29:13.990614 [debug] [MainThread]: Parsing macros\materializations\models\incremental\is_incremental.sql
[0m11:29:13.991614 [debug] [MainThread]: Parsing macros\materializations\models\incremental\merge.sql
[0m11:29:14.005615 [debug] [MainThread]: Parsing macros\materializations\models\incremental\on_schema_change.sql
[0m11:29:14.019614 [debug] [MainThread]: Parsing macros\materializations\models\incremental\strategies.sql
[0m11:29:14.026614 [debug] [MainThread]: Parsing macros\materializations\models\table\create_table_as.sql
[0m11:29:14.029614 [debug] [MainThread]: Parsing macros\materializations\models\table\table.sql
[0m11:29:14.034614 [debug] [MainThread]: Parsing macros\materializations\models\view\create_or_replace_view.sql
[0m11:29:14.038615 [debug] [MainThread]: Parsing macros\materializations\models\view\create_view_as.sql
[0m11:29:14.040614 [debug] [MainThread]: Parsing macros\materializations\models\view\helpers.sql
[0m11:29:14.041615 [debug] [MainThread]: Parsing macros\materializations\models\view\view.sql
[0m11:29:14.046614 [debug] [MainThread]: Parsing macros\materializations\seeds\helpers.sql
[0m11:29:14.062614 [debug] [MainThread]: Parsing macros\materializations\seeds\seed.sql
[0m11:29:14.068614 [debug] [MainThread]: Parsing macros\materializations\snapshots\helpers.sql
[0m11:29:14.079614 [debug] [MainThread]: Parsing macros\materializations\snapshots\snapshot.sql
[0m11:29:14.090614 [debug] [MainThread]: Parsing macros\materializations\snapshots\snapshot_merge.sql
[0m11:29:14.091615 [debug] [MainThread]: Parsing macros\materializations\snapshots\strategies.sql
[0m11:29:14.105614 [debug] [MainThread]: Parsing macros\materializations\tests\helpers.sql
[0m11:29:14.107615 [debug] [MainThread]: Parsing macros\materializations\tests\test.sql
[0m11:29:14.111614 [debug] [MainThread]: Parsing macros\materializations\tests\where_subquery.sql
[0m11:29:14.113615 [debug] [MainThread]: Parsing macros\python_model\python.sql
[0m11:29:14.119615 [debug] [MainThread]: Parsing macros\utils\any_value.sql
[0m11:29:14.120616 [debug] [MainThread]: Parsing macros\utils\array_append.sql
[0m11:29:14.122615 [debug] [MainThread]: Parsing macros\utils\array_concat.sql
[0m11:29:14.123615 [debug] [MainThread]: Parsing macros\utils\array_construct.sql
[0m11:29:14.124615 [debug] [MainThread]: Parsing macros\utils\bool_or.sql
[0m11:29:14.126615 [debug] [MainThread]: Parsing macros\utils\cast_bool_to_text.sql
[0m11:29:14.127615 [debug] [MainThread]: Parsing macros\utils\concat.sql
[0m11:29:14.128615 [debug] [MainThread]: Parsing macros\utils\data_types.sql
[0m11:29:14.135615 [debug] [MainThread]: Parsing macros\utils\dateadd.sql
[0m11:29:14.137621 [debug] [MainThread]: Parsing macros\utils\datediff.sql
[0m11:29:14.139627 [debug] [MainThread]: Parsing macros\utils\date_trunc.sql
[0m11:29:14.141617 [debug] [MainThread]: Parsing macros\utils\escape_single_quotes.sql
[0m11:29:14.142616 [debug] [MainThread]: Parsing macros\utils\except.sql
[0m11:29:14.143616 [debug] [MainThread]: Parsing macros\utils\hash.sql
[0m11:29:14.144615 [debug] [MainThread]: Parsing macros\utils\intersect.sql
[0m11:29:14.145616 [debug] [MainThread]: Parsing macros\utils\last_day.sql
[0m11:29:14.147615 [debug] [MainThread]: Parsing macros\utils\length.sql
[0m11:29:14.149615 [debug] [MainThread]: Parsing macros\utils\listagg.sql
[0m11:29:14.151615 [debug] [MainThread]: Parsing macros\utils\literal.sql
[0m11:29:14.152616 [debug] [MainThread]: Parsing macros\utils\position.sql
[0m11:29:14.153616 [debug] [MainThread]: Parsing macros\utils\replace.sql
[0m11:29:14.155615 [debug] [MainThread]: Parsing macros\utils\right.sql
[0m11:29:14.156615 [debug] [MainThread]: Parsing macros\utils\safe_cast.sql
[0m11:29:14.157616 [debug] [MainThread]: Parsing macros\utils\split_part.sql
[0m11:29:14.159615 [debug] [MainThread]: Parsing tests\generic\builtin.sql
[0m11:29:14.162615 [debug] [MainThread]: Parsing macros\generic_tests\accepted_range.sql
[0m11:29:14.164615 [debug] [MainThread]: Parsing macros\generic_tests\at_least_one.sql
[0m11:29:14.167615 [debug] [MainThread]: Parsing macros\generic_tests\cardinality_equality.sql
[0m11:29:14.169615 [debug] [MainThread]: Parsing macros\generic_tests\equality.sql
[0m11:29:14.172615 [debug] [MainThread]: Parsing macros\generic_tests\equal_rowcount.sql
[0m11:29:14.177656 [debug] [MainThread]: Parsing macros\generic_tests\expression_is_true.sql
[0m11:29:14.179658 [debug] [MainThread]: Parsing macros\generic_tests\fewer_rows_than.sql
[0m11:29:14.183655 [debug] [MainThread]: Parsing macros\generic_tests\mutually_exclusive_ranges.sql
[0m11:29:14.192643 [debug] [MainThread]: Parsing macros\generic_tests\not_accepted_values.sql
[0m11:29:14.194644 [debug] [MainThread]: Parsing macros\generic_tests\not_constant.sql
[0m11:29:14.196644 [debug] [MainThread]: Parsing macros\generic_tests\not_empty_string.sql
[0m11:29:14.198644 [debug] [MainThread]: Parsing macros\generic_tests\not_null_proportion.sql
[0m11:29:14.201644 [debug] [MainThread]: Parsing macros\generic_tests\recency.sql
[0m11:29:14.205644 [debug] [MainThread]: Parsing macros\generic_tests\relationships_where.sql
[0m11:29:14.207643 [debug] [MainThread]: Parsing macros\generic_tests\sequential_values.sql
[0m11:29:14.211644 [debug] [MainThread]: Parsing macros\generic_tests\unique_combination_of_columns.sql
[0m11:29:14.214647 [debug] [MainThread]: Parsing macros\jinja_helpers\log_info.sql
[0m11:29:14.216645 [debug] [MainThread]: Parsing macros\jinja_helpers\pretty_log_format.sql
[0m11:29:14.217644 [debug] [MainThread]: Parsing macros\jinja_helpers\pretty_time.sql
[0m11:29:14.218616 [debug] [MainThread]: Parsing macros\jinja_helpers\slugify.sql
[0m11:29:14.220650 [debug] [MainThread]: Parsing macros\jinja_helpers\_is_ephemeral.sql
[0m11:29:14.222643 [debug] [MainThread]: Parsing macros\jinja_helpers\_is_relation.sql
[0m11:29:14.223644 [debug] [MainThread]: Parsing macros\sql\date_spine.sql
[0m11:29:14.227645 [debug] [MainThread]: Parsing macros\sql\deduplicate.sql
[0m11:29:14.231646 [debug] [MainThread]: Parsing macros\sql\generate_series.sql
[0m11:29:14.235645 [debug] [MainThread]: Parsing macros\sql\generate_surrogate_key.sql
[0m11:29:14.237645 [debug] [MainThread]: Parsing macros\sql\get_column_values.sql
[0m11:29:14.245619 [debug] [MainThread]: Parsing macros\sql\get_filtered_columns_in_relation.sql
[0m11:29:14.248659 [debug] [MainThread]: Parsing macros\sql\get_query_results_as_dict.sql
[0m11:29:14.251658 [debug] [MainThread]: Parsing macros\sql\get_relations_by_pattern.sql
[0m11:29:14.254666 [debug] [MainThread]: Parsing macros\sql\get_relations_by_prefix.sql
[0m11:29:14.259618 [debug] [MainThread]: Parsing macros\sql\get_single_value.sql
[0m11:29:14.262660 [debug] [MainThread]: Parsing macros\sql\get_tables_by_pattern_sql.sql
[0m11:29:14.270666 [debug] [MainThread]: Parsing macros\sql\get_tables_by_prefix_sql.sql
[0m11:29:14.271662 [debug] [MainThread]: Parsing macros\sql\get_table_types_sql.sql
[0m11:29:14.274617 [debug] [MainThread]: Parsing macros\sql\groupby.sql
[0m11:29:14.276659 [debug] [MainThread]: Parsing macros\sql\haversine_distance.sql
[0m11:29:14.284661 [debug] [MainThread]: Parsing macros\sql\nullcheck.sql
[0m11:29:14.285658 [debug] [MainThread]: Parsing macros\sql\nullcheck_table.sql
[0m11:29:14.288659 [debug] [MainThread]: Parsing macros\sql\pivot.sql
[0m11:29:14.293618 [debug] [MainThread]: Parsing macros\sql\safe_add.sql
[0m11:29:14.296658 [debug] [MainThread]: Parsing macros\sql\safe_divide.sql
[0m11:29:14.297618 [debug] [MainThread]: Parsing macros\sql\star.sql
[0m11:29:14.304657 [debug] [MainThread]: Parsing macros\sql\surrogate_key.sql
[0m11:29:14.306616 [debug] [MainThread]: Parsing macros\sql\union.sql
[0m11:29:14.321617 [debug] [MainThread]: Parsing macros\sql\unpivot.sql
[0m11:29:14.329617 [debug] [MainThread]: Parsing macros\sql\width_bucket.sql
[0m11:29:14.334662 [debug] [MainThread]: Parsing macros\web\get_url_host.sql
[0m11:29:14.337628 [debug] [MainThread]: Parsing macros\web\get_url_parameter.sql
[0m11:29:14.339659 [debug] [MainThread]: Parsing macros\web\get_url_path.sql
[0m11:29:14.774621 [debug] [MainThread]: 1603: static parser failed on dwh\dim_operating_period.sql
[0m11:29:14.800626 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\dim_operating_period.sql
[0m11:29:14.801623 [debug] [MainThread]: 1603: static parser failed on dwh\dim_vehicle.sql
[0m11:29:14.807622 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\dim_vehicle.sql
[0m11:29:14.808623 [debug] [MainThread]: 1603: static parser failed on dwh\fact_deregistration.sql
[0m11:29:14.817622 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_deregistration.sql
[0m11:29:14.818623 [debug] [MainThread]: 1603: static parser failed on dwh\fact_registration.sql
[0m11:29:14.826622 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_registration.sql
[0m11:29:14.828623 [debug] [MainThread]: 1603: static parser failed on dwh\fact_vehicle_location.sql
[0m11:29:14.836622 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_vehicle_location.sql
[0m11:29:14.838623 [debug] [MainThread]: 1603: static parser failed on stg\event_log.sql
[0m11:29:14.846622 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\event_log.sql
[0m11:29:14.943623 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '75d3afa3-2b29-4455-b42a-bcfa02cf25cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7D99359D0>]}
[0m11:29:14.952624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '75d3afa3-2b29-4455-b42a-bcfa02cf25cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7D97ABBB0>]}
[0m11:29:14.953621 [info ] [MainThread]: Found 6 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m11:29:14.953621 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '75d3afa3-2b29-4455-b42a-bcfa02cf25cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7D97B53A0>]}
[0m11:29:14.955620 [info ] [MainThread]: 
[0m11:29:14.956620 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m11:29:14.958649 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m11:29:14.974652 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m11:29:14.974652 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m11:29:14.975620 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:29:15.990303 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.01 seconds
[0m11:29:15.991304 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m11:29:16.117594 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m11:29:16.119595 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m11:29:16.119595 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m11:29:16.120596 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:29:16.695329 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.57 seconds
[0m11:29:16.696323 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m11:29:16.825920 [debug] [ThreadPool]: Acquiring new snowflake connection "create_DOOR2DOOR_DWH_DBT_dwh"
[0m11:29:16.826949 [debug] [ThreadPool]: Acquiring new snowflake connection "create_DOOR2DOOR_DWH_DBT_dwh"
[0m11:29:16.826949 [debug] [ThreadPool]: Creating schema "_ReferenceKey(database='door2door_dwh', schema='dbt_dwh', identifier=None)"
[0m11:29:16.832948 [debug] [ThreadPool]: Using snowflake connection "create_DOOR2DOOR_DWH_DBT_dwh"
[0m11:29:16.832948 [debug] [ThreadPool]: On create_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "create_DOOR2DOOR_DWH_DBT_dwh"} */
create schema if not exists DOOR2DOOR_DWH.DBT_dwh
[0m11:29:16.832948 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:29:17.489763 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.66 seconds
[0m11:29:17.490757 [debug] [ThreadPool]: On create_DOOR2DOOR_DWH_DBT_dwh: Close
[0m11:29:17.618025 [debug] [ThreadPool]: Acquiring new snowflake connection "create_DOOR2DOOR_DWH_DBT_stg"
[0m11:29:17.619039 [debug] [ThreadPool]: Acquiring new snowflake connection "create_DOOR2DOOR_DWH_DBT_stg"
[0m11:29:17.619039 [debug] [ThreadPool]: Creating schema "_ReferenceKey(database='door2door_dwh', schema='dbt_stg', identifier=None)"
[0m11:29:17.622997 [debug] [ThreadPool]: Using snowflake connection "create_DOOR2DOOR_DWH_DBT_stg"
[0m11:29:17.623996 [debug] [ThreadPool]: On create_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "create_DOOR2DOOR_DWH_DBT_stg"} */
create schema if not exists DOOR2DOOR_DWH.DBT_stg
[0m11:29:17.623996 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:29:18.056658 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.43 seconds
[0m11:29:18.057657 [debug] [ThreadPool]: On create_DOOR2DOOR_DWH_DBT_stg: Close
[0m11:29:18.192705 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m11:29:18.200705 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m11:29:18.200705 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m11:29:18.200705 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:29:18.623352 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.42 seconds
[0m11:29:18.624351 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m11:29:18.769660 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m11:29:18.772662 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m11:29:18.772662 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m11:29:18.773660 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:29:19.182223 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.41 seconds
[0m11:29:19.183217 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m11:29:19.315632 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '75d3afa3-2b29-4455-b42a-bcfa02cf25cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7D9B0A7F0>]}
[0m11:29:19.317604 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:29:19.318635 [info ] [MainThread]: 
[0m11:29:19.324294 [debug] [Thread-1  ]: Began running node model.door2door_dwh.event_log
[0m11:29:19.324294 [info ] [Thread-1  ]: 1 of 6 START sql incremental model DBT_stg.event_log ........................... [RUN]
[0m11:29:19.325295 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.event_log"
[0m11:29:19.326317 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.event_log
[0m11:29:19.326317 [debug] [Thread-1  ]: Compiling model.door2door_dwh.event_log
[0m11:29:19.331295 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.event_log"
[0m11:29:19.331295 [debug] [Thread-1  ]: finished collecting timing info
[0m11:29:19.332295 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.event_log
[0m11:29:19.390325 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.event_log"
[0m11:29:19.392325 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event_log"
[0m11:29:19.392325 [debug] [Thread-1  ]: On model.door2door_dwh.event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event_log"} */
create or replace transient table DOOR2DOOR_DWH.DBT_stg.event_log  as
        (

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TEXT as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
        );
[0m11:29:19.392325 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m11:29:25.206055 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 5.81 seconds
[0m11:29:25.213050 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event_log"
[0m11:29:25.213050 [debug] [Thread-1  ]: On model.door2door_dwh.event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event_log"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.event_log__dbt_tmp cascade
[0m11:29:25.295030 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m11:29:25.315027 [debug] [Thread-1  ]: finished collecting timing info
[0m11:29:25.315027 [debug] [Thread-1  ]: On model.door2door_dwh.event_log: Close
[0m11:29:25.454548 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '75d3afa3-2b29-4455-b42a-bcfa02cf25cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7D9C88F70>]}
[0m11:29:25.455549 [info ] [Thread-1  ]: 1 of 6 OK created sql incremental model DBT_stg.event_log ...................... [[32mSUCCESS 1[0m in 6.13s]
[0m11:29:25.456689 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.event_log
[0m11:29:25.457702 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_operating_period
[0m11:29:25.458766 [info ] [Thread-1  ]: 2 of 6 START sql table model DBT_dwh.dim_operating_period ...................... [RUN]
[0m11:29:25.459710 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_operating_period"
[0m11:29:25.460711 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_operating_period
[0m11:29:25.460711 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_operating_period
[0m11:29:25.465701 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_operating_period"
[0m11:29:25.466700 [debug] [Thread-1  ]: finished collecting timing info
[0m11:29:25.467713 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_operating_period
[0m11:29:25.478701 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_operating_period"
[0m11:29:25.480702 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_operating_period"
[0m11:29:25.480702 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_operating_period"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_operating_period  as
        (

with operating_periods as (
    SELECT
        data_id,
        data_start,
        data_finish,
        ROW_NUMBER() OVER (PARTITION BY data_id ORDER BY data_finish desc, data_start desc) as rn
    FROM DOOR2DOOR_DWH.DBT_stg.event_log
    WHERE lower(event_on) = 'operating_period'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    data_id as operating_period_source_id,
    data_start as operating_period_start_time,
    data_finish as operating_period_finish_time
FROM operating_periods
        );
[0m11:29:25.480702 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:29:26.502770 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.02 seconds
[0m11:29:26.505774 [debug] [Thread-1  ]: finished collecting timing info
[0m11:29:26.506775 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: Close
[0m11:29:26.630039 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '75d3afa3-2b29-4455-b42a-bcfa02cf25cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7D9D3A280>]}
[0m11:29:26.631038 [info ] [Thread-1  ]: 2 of 6 OK created sql table model DBT_dwh.dim_operating_period ................. [[32mSUCCESS 1[0m in 1.17s]
[0m11:29:26.633039 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_operating_period
[0m11:29:26.634037 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_vehicle
[0m11:29:26.635050 [info ] [Thread-1  ]: 3 of 6 START sql table model DBT_dwh.dim_vehicle ............................... [RUN]
[0m11:29:26.636039 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_vehicle"
[0m11:29:26.637039 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_vehicle
[0m11:29:26.637039 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_vehicle
[0m11:29:26.644054 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_vehicle"
[0m11:29:26.645094 [debug] [Thread-1  ]: finished collecting timing info
[0m11:29:26.645094 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_vehicle
[0m11:29:26.648036 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_vehicle"
[0m11:29:26.650036 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_vehicle"
[0m11:29:26.650036 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_vehicle"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_vehicle  as
        (

with vehicles as (
    SELECT
        DISTINCT data_id
    FROM DOOR2DOOR_DWH.DBT_stg.event_log
    WHERE lower(event_on) = 'vehicle'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    data_id as vehicle_source_id
FROM vehicles
        );
[0m11:29:26.650036 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:29:27.717511 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.07 seconds
[0m11:29:27.720506 [debug] [Thread-1  ]: finished collecting timing info
[0m11:29:27.721505 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: Close
[0m11:29:27.846180 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '75d3afa3-2b29-4455-b42a-bcfa02cf25cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7D9AFC610>]}
[0m11:29:27.846180 [info ] [Thread-1  ]: 3 of 6 OK created sql table model DBT_dwh.dim_vehicle .......................... [[32mSUCCESS 1[0m in 1.21s]
[0m11:29:27.848142 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_vehicle
[0m11:29:27.848142 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_deregistration
[0m11:29:27.849148 [info ] [Thread-1  ]: 4 of 6 START sql table model DBT_dwh.fact_deregistration ....................... [RUN]
[0m11:29:27.850145 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_deregistration"
[0m11:29:27.850145 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_deregistration
[0m11:29:27.850145 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_deregistration
[0m11:29:27.858133 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_deregistration"
[0m11:29:27.859133 [debug] [Thread-1  ]: finished collecting timing info
[0m11:29:27.859133 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_deregistration
[0m11:29:27.862133 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_deregistration"
[0m11:29:27.864133 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m11:29:27.864133 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_deregistration  as
        (

with events as (
    SELECT
        event
        event_at,
        data_id
    FROM DOOR2DOOR_DWH.DBT_stg.event_log e
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON e.event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'deregister'
)
SELECT
    
    
md5(cast(coalesce(cast(event as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as deregistration_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    event_at as deregistration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
        );
[0m11:29:27.865133 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:29:28.497751 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa2051-3201-98a1-0000-0001c1462369
[0m11:29:28.497751 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 17 at position 23
invalid identifier 'EVENT'
[0m11:29:28.497751 [debug] [Thread-1  ]: finished collecting timing info
[0m11:29:28.498752 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: Close
[0m11:29:28.626256 [debug] [Thread-1  ]: Database Error in model fact_deregistration (models\dwh\fact_deregistration.sql)
  000904 (42000): SQL compilation error: error line 17 at position 23
  invalid identifier 'EVENT'
  compiled Code at target\run\door2door_dwh\models\dwh\fact_deregistration.sql
[0m11:29:28.627257 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '75d3afa3-2b29-4455-b42a-bcfa02cf25cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7D9CDC4F0>]}
[0m11:29:28.627257 [error] [Thread-1  ]: 4 of 6 ERROR creating sql table model DBT_dwh.fact_deregistration .............. [[31mERROR[0m in 0.78s]
[0m11:29:28.628661 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_deregistration
[0m11:29:28.629671 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_registration
[0m11:29:28.629671 [info ] [Thread-1  ]: 5 of 6 START sql table model DBT_dwh.fact_registration ......................... [RUN]
[0m11:29:28.631699 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_registration"
[0m11:29:28.631699 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_registration
[0m11:29:28.631699 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_registration
[0m11:29:28.638699 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_registration"
[0m11:29:28.639699 [debug] [Thread-1  ]: finished collecting timing info
[0m11:29:28.639699 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_registration
[0m11:29:28.650668 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_registration"
[0m11:29:28.652672 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m11:29:28.652672 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_registration  as
        (

with events as (
    SELECT
        event
        event_at,
        data_id
    FROM DOOR2DOOR_DWH.DBT_stg.event_log e
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON e.event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'register'
)
SELECT
    
    
md5(cast(coalesce(cast(event as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as registration_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    event_at as registration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
        );
[0m11:29:28.652672 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:29:29.138088 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa2051-3201-9a27-0000-0001c14650f9
[0m11:29:29.138088 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 17 at position 23
invalid identifier 'EVENT'
[0m11:29:29.139073 [debug] [Thread-1  ]: finished collecting timing info
[0m11:29:29.139073 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: Close
[0m11:29:29.274915 [debug] [Thread-1  ]: Database Error in model fact_registration (models\dwh\fact_registration.sql)
  000904 (42000): SQL compilation error: error line 17 at position 23
  invalid identifier 'EVENT'
  compiled Code at target\run\door2door_dwh\models\dwh\fact_registration.sql
[0m11:29:29.274915 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '75d3afa3-2b29-4455-b42a-bcfa02cf25cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7D9CDCE20>]}
[0m11:29:29.275926 [error] [Thread-1  ]: 5 of 6 ERROR creating sql table model DBT_dwh.fact_registration ................ [[31mERROR[0m in 0.64s]
[0m11:29:29.276944 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_registration
[0m11:29:29.277958 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_vehicle_location
[0m11:29:29.277958 [info ] [Thread-1  ]: 6 of 6 START sql table model DBT_dwh.fact_vehicle_location ..................... [RUN]
[0m11:29:29.278915 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m11:29:29.279983 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_vehicle_location
[0m11:29:29.279983 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_vehicle_location
[0m11:29:29.287954 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_vehicle_location"
[0m11:29:29.288914 [debug] [Thread-1  ]: finished collecting timing info
[0m11:29:29.288914 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_vehicle_location
[0m11:29:29.291954 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_vehicle_location"
[0m11:29:29.294936 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m11:29:29.295914 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location  as
        (

with locations as (
    SELECT
        event_at,
        data_id,
        data_location_lat,
        data_location_lng,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.event_log e
    INNER JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON e.event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event_on) = 'update'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_location_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    operating_period_key,
    data_location_lat as vehicle_location_lat,
    data_location_lng as vehicle_location_lng,
    event_at as vehicle_location_time
FROM locations


--- ASSUMPTION Events are recorded only if vehicle is registered to a operation period
        );
[0m11:29:29.295914 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:29:30.014220 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.72 seconds
[0m11:29:30.016246 [debug] [Thread-1  ]: finished collecting timing info
[0m11:29:30.017246 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: Close
[0m11:29:30.167926 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '75d3afa3-2b29-4455-b42a-bcfa02cf25cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7D9E4DC70>]}
[0m11:29:30.168892 [info ] [Thread-1  ]: 6 of 6 OK created sql table model DBT_dwh.fact_vehicle_location ................ [[32mSUCCESS 1[0m in 0.89s]
[0m11:29:30.169891 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_vehicle_location
[0m11:29:30.171891 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m11:29:30.173909 [info ] [MainThread]: 
[0m11:29:30.174939 [info ] [MainThread]: Finished running 1 incremental model, 5 table models in 0 hours 0 minutes and 15.22 seconds (15.22s).
[0m11:29:30.175893 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:29:30.176893 [debug] [MainThread]: Connection 'create_DOOR2DOOR_DWH_DBT_stg' was properly closed.
[0m11:29:30.176893 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_stg' was properly closed.
[0m11:29:30.176893 [debug] [MainThread]: Connection 'model.door2door_dwh.fact_vehicle_location' was properly closed.
[0m11:29:30.187901 [info ] [MainThread]: 
[0m11:29:30.188895 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m11:29:30.191893 [info ] [MainThread]: 
[0m11:29:30.191893 [error] [MainThread]: [33mDatabase Error in model fact_deregistration (models\dwh\fact_deregistration.sql)[0m
[0m11:29:30.193894 [error] [MainThread]:   000904 (42000): SQL compilation error: error line 17 at position 23
[0m11:29:30.193894 [error] [MainThread]:   invalid identifier 'EVENT'
[0m11:29:30.194896 [error] [MainThread]:   compiled Code at target\run\door2door_dwh\models\dwh\fact_deregistration.sql
[0m11:29:30.195907 [info ] [MainThread]: 
[0m11:29:30.196895 [error] [MainThread]: [33mDatabase Error in model fact_registration (models\dwh\fact_registration.sql)[0m
[0m11:29:30.197905 [error] [MainThread]:   000904 (42000): SQL compilation error: error line 17 at position 23
[0m11:29:30.199955 [error] [MainThread]:   invalid identifier 'EVENT'
[0m11:29:30.200895 [error] [MainThread]:   compiled Code at target\run\door2door_dwh\models\dwh\fact_registration.sql
[0m11:29:30.201900 [info ] [MainThread]: 
[0m11:29:30.202942 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=2 SKIP=0 TOTAL=6
[0m11:29:30.203906 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7D9CD5430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7D9CD5E80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7D9B6C220>]}
[0m11:29:30.203906 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 11:30:35.942737 | cbbab847-d128-4ad6-a985-e950889e925e ==============================
[0m11:30:35.942737 [info ] [MainThread]: Running with dbt=1.3.1
[0m11:30:35.943739 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m11:30:35.943739 [debug] [MainThread]: Tracking: tracking
[0m11:30:35.944739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B5B0F08D00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B5B0F08D60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B5B0F08DC0>]}
[0m11:30:36.067738 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m11:30:36.068739 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\fact_registration.sql
[0m11:30:36.068739 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\fact_deregistration.sql
[0m11:30:36.081738 [debug] [MainThread]: 1603: static parser failed on dwh\fact_registration.sql
[0m11:30:36.110739 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_registration.sql
[0m11:30:36.112739 [debug] [MainThread]: 1603: static parser failed on dwh\fact_deregistration.sql
[0m11:30:36.120739 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_deregistration.sql
[0m11:30:36.139739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cbbab847-d128-4ad6-a985-e950889e925e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B5B11B1F10>]}
[0m11:30:36.148741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cbbab847-d128-4ad6-a985-e950889e925e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B5B115E9A0>]}
[0m11:30:36.148741 [info ] [MainThread]: Found 6 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m11:30:36.149753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cbbab847-d128-4ad6-a985-e950889e925e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B5B115E790>]}
[0m11:30:36.150741 [info ] [MainThread]: 
[0m11:30:36.151740 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m11:30:36.153738 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m11:30:36.167737 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m11:30:36.167737 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m11:30:36.168741 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:30:37.086407 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.92 seconds
[0m11:30:37.087409 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m11:30:37.226633 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m11:30:37.228659 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m11:30:37.229659 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m11:30:37.229659 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:30:37.649119 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.42 seconds
[0m11:30:37.651114 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m11:30:37.801397 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m11:30:37.808443 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m11:30:37.808443 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m11:30:37.809425 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:30:38.237784 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.43 seconds
[0m11:30:38.238781 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m11:30:38.546306 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m11:30:38.548305 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m11:30:38.548305 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m11:30:38.549303 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:30:39.177057 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.63 seconds
[0m11:30:39.178059 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m11:30:39.324712 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cbbab847-d128-4ad6-a985-e950889e925e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B5B113A640>]}
[0m11:30:39.325712 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:30:39.326720 [info ] [MainThread]: 
[0m11:30:39.331682 [debug] [Thread-1  ]: Began running node model.door2door_dwh.event_log
[0m11:30:39.331682 [info ] [Thread-1  ]: 1 of 6 START sql incremental model DBT_stg.event_log ........................... [RUN]
[0m11:30:39.333682 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.event_log"
[0m11:30:39.333682 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.event_log
[0m11:30:39.333682 [debug] [Thread-1  ]: Compiling model.door2door_dwh.event_log
[0m11:30:39.344682 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.event_log"
[0m11:30:39.344682 [debug] [Thread-1  ]: finished collecting timing info
[0m11:30:39.345682 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.event_log
[0m11:30:39.403714 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.event_log"
[0m11:30:39.404711 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event_log"
[0m11:30:39.405714 [debug] [Thread-1  ]: On model.door2door_dwh.event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event_log"} */
create or replace transient table DOOR2DOOR_DWH.DBT_stg.event_log  as
        (

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TEXT as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
        );
[0m11:30:39.405714 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m11:30:44.677958 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 5.27 seconds
[0m11:30:44.684957 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event_log"
[0m11:30:44.684957 [debug] [Thread-1  ]: On model.door2door_dwh.event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event_log"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.event_log__dbt_tmp cascade
[0m11:30:44.759096 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.07 seconds
[0m11:30:44.785097 [debug] [Thread-1  ]: finished collecting timing info
[0m11:30:44.785097 [debug] [Thread-1  ]: On model.door2door_dwh.event_log: Close
[0m11:30:44.925751 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cbbab847-d128-4ad6-a985-e950889e925e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B5B14A68B0>]}
[0m11:30:44.925751 [info ] [Thread-1  ]: 1 of 6 OK created sql incremental model DBT_stg.event_log ...................... [[32mSUCCESS 1[0m in 5.59s]
[0m11:30:44.927666 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.event_log
[0m11:30:44.928694 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_operating_period
[0m11:30:44.928694 [info ] [Thread-1  ]: 2 of 6 START sql table model DBT_dwh.dim_operating_period ...................... [RUN]
[0m11:30:44.930691 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_operating_period"
[0m11:30:44.930691 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_operating_period
[0m11:30:44.930691 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_operating_period
[0m11:30:44.935691 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_operating_period"
[0m11:30:44.935691 [debug] [Thread-1  ]: finished collecting timing info
[0m11:30:44.936692 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_operating_period
[0m11:30:44.948692 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_operating_period"
[0m11:30:44.950698 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_operating_period"
[0m11:30:44.950698 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_operating_period"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_operating_period  as
        (

with operating_periods as (
    SELECT
        data_id,
        data_start,
        data_finish,
        ROW_NUMBER() OVER (PARTITION BY data_id ORDER BY data_finish desc, data_start desc) as rn
    FROM DOOR2DOOR_DWH.DBT_stg.event_log
    WHERE lower(event_on) = 'operating_period'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    data_id as operating_period_source_id,
    data_start as operating_period_start_time,
    data_finish as operating_period_finish_time
FROM operating_periods
        );
[0m11:30:44.951710 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:30:46.174298 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.22 seconds
[0m11:30:46.177335 [debug] [Thread-1  ]: finished collecting timing info
[0m11:30:46.177335 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: Close
[0m11:30:46.307603 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cbbab847-d128-4ad6-a985-e950889e925e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B5B155DF70>]}
[0m11:30:46.308607 [info ] [Thread-1  ]: 2 of 6 OK created sql table model DBT_dwh.dim_operating_period ................. [[32mSUCCESS 1[0m in 1.38s]
[0m11:30:46.309572 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_operating_period
[0m11:30:46.310602 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_vehicle
[0m11:30:46.311579 [info ] [Thread-1  ]: 3 of 6 START sql table model DBT_dwh.dim_vehicle ............................... [RUN]
[0m11:30:46.312574 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_vehicle"
[0m11:30:46.312574 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_vehicle
[0m11:30:46.312574 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_vehicle
[0m11:30:46.318602 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_vehicle"
[0m11:30:46.318602 [debug] [Thread-1  ]: finished collecting timing info
[0m11:30:46.319572 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_vehicle
[0m11:30:46.322574 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_vehicle"
[0m11:30:46.323572 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_vehicle"
[0m11:30:46.324573 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_vehicle"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_vehicle  as
        (

with vehicles as (
    SELECT
        DISTINCT data_id
    FROM DOOR2DOOR_DWH.DBT_stg.event_log
    WHERE lower(event_on) = 'vehicle'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    data_id as vehicle_source_id
FROM vehicles
        );
[0m11:30:46.324573 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:30:47.364924 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.04 seconds
[0m11:30:47.366919 [debug] [Thread-1  ]: finished collecting timing info
[0m11:30:47.367921 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: Close
[0m11:30:47.497400 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cbbab847-d128-4ad6-a985-e950889e925e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B5B1538970>]}
[0m11:30:47.498401 [info ] [Thread-1  ]: 3 of 6 OK created sql table model DBT_dwh.dim_vehicle .......................... [[32mSUCCESS 1[0m in 1.19s]
[0m11:30:47.499528 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_vehicle
[0m11:30:47.499528 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_deregistration
[0m11:30:47.500588 [info ] [Thread-1  ]: 4 of 6 START sql table model DBT_dwh.fact_deregistration ....................... [RUN]
[0m11:30:47.501538 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_deregistration"
[0m11:30:47.501538 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_deregistration
[0m11:30:47.502541 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_deregistration
[0m11:30:47.509566 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_deregistration"
[0m11:30:47.510553 [debug] [Thread-1  ]: finished collecting timing info
[0m11:30:47.510553 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_deregistration
[0m11:30:47.514566 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_deregistration"
[0m11:30:47.515541 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m11:30:47.516539 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_deregistration  as
        (

with events as (
    SELECT
        event,
        event_at,
        data_id
    FROM DOOR2DOOR_DWH.DBT_stg.event_log e
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON e.event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'deregister'
)
SELECT
    
    
md5(cast(coalesce(cast(event as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as deregistration_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    event_at as deregistration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
        );
[0m11:30:47.516539 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:30:48.701155 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.18 seconds
[0m11:30:48.703152 [debug] [Thread-1  ]: finished collecting timing info
[0m11:30:48.703152 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: Close
[0m11:30:48.844463 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cbbab847-d128-4ad6-a985-e950889e925e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B5B15245E0>]}
[0m11:30:48.845464 [info ] [Thread-1  ]: 4 of 6 OK created sql table model DBT_dwh.fact_deregistration .................. [[32mSUCCESS 1[0m in 1.34s]
[0m11:30:48.846434 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_deregistration
[0m11:30:48.847434 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_registration
[0m11:30:48.847434 [info ] [Thread-1  ]: 5 of 6 START sql table model DBT_dwh.fact_registration ......................... [RUN]
[0m11:30:48.848435 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_registration"
[0m11:30:48.849433 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_registration
[0m11:30:48.849433 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_registration
[0m11:30:48.905463 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_registration"
[0m11:30:48.906465 [debug] [Thread-1  ]: finished collecting timing info
[0m11:30:48.907464 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_registration
[0m11:30:48.910464 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_registration"
[0m11:30:48.912463 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m11:30:48.912463 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_registration  as
        (

with events as (
    SELECT
        event,
        event_at,
        data_id
    FROM DOOR2DOOR_DWH.DBT_stg.event_log e
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON e.event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'register'
)
SELECT
    
    
md5(cast(coalesce(cast(event as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as registration_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    event_at as registration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
        );
[0m11:30:48.912463 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:30:50.182518 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.27 seconds
[0m11:30:50.184513 [debug] [Thread-1  ]: finished collecting timing info
[0m11:30:50.185493 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: Close
[0m11:30:50.313820 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cbbab847-d128-4ad6-a985-e950889e925e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B5B135A4C0>]}
[0m11:30:50.314793 [info ] [Thread-1  ]: 5 of 6 OK created sql table model DBT_dwh.fact_registration .................... [[32mSUCCESS 1[0m in 1.47s]
[0m11:30:50.315931 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_registration
[0m11:30:50.316994 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_vehicle_location
[0m11:30:50.316994 [info ] [Thread-1  ]: 6 of 6 START sql table model DBT_dwh.fact_vehicle_location ..................... [RUN]
[0m11:30:50.317984 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m11:30:50.317984 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_vehicle_location
[0m11:30:50.318957 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_vehicle_location
[0m11:30:50.325983 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_vehicle_location"
[0m11:30:50.326959 [debug] [Thread-1  ]: finished collecting timing info
[0m11:30:50.326959 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_vehicle_location
[0m11:30:50.330956 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_vehicle_location"
[0m11:30:50.332966 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m11:30:50.332966 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location  as
        (

with locations as (
    SELECT
        event_at,
        data_id,
        data_location_lat,
        data_location_lng,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.event_log e
    INNER JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON e.event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event_on) = 'update'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_location_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    operating_period_key,
    data_location_lat as vehicle_location_lat,
    data_location_lng as vehicle_location_lng,
    event_at as vehicle_location_time
FROM locations


--- ASSUMPTION Events are recorded only if vehicle is registered to a operation period
        );
[0m11:30:50.333959 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:30:51.205173 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.87 seconds
[0m11:30:51.207169 [debug] [Thread-1  ]: finished collecting timing info
[0m11:30:51.208169 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: Close
[0m11:30:51.344723 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cbbab847-d128-4ad6-a985-e950889e925e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B5AF986610>]}
[0m11:30:51.345737 [info ] [Thread-1  ]: 6 of 6 OK created sql table model DBT_dwh.fact_vehicle_location ................ [[32mSUCCESS 1[0m in 1.03s]
[0m11:30:51.347734 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_vehicle_location
[0m11:30:51.348724 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m11:30:51.349726 [info ] [MainThread]: 
[0m11:30:51.350728 [info ] [MainThread]: Finished running 1 incremental model, 5 table models in 0 hours 0 minutes and 15.20 seconds (15.20s).
[0m11:30:51.351747 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:30:51.351747 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m11:30:51.351747 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_dwh' was properly closed.
[0m11:30:51.352723 [debug] [MainThread]: Connection 'model.door2door_dwh.fact_vehicle_location' was properly closed.
[0m11:30:51.361722 [info ] [MainThread]: 
[0m11:30:51.362722 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:30:51.363724 [info ] [MainThread]: 
[0m11:30:51.364721 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m11:30:51.365854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B5B14C3070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B5B14C3D00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B5B14C3BE0>]}
[0m11:30:51.365854 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 11:31:58.876885 | c7af7de4-fdf9-4395-9301-aa0e81798ec1 ==============================
[0m11:31:58.876885 [info ] [MainThread]: Running with dbt=1.3.1
[0m11:31:58.877886 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m11:31:58.877886 [debug] [MainThread]: Tracking: tracking
[0m11:31:58.878888 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002223FA09C70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002223FA09CD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002223FA09D30>]}
[0m11:31:59.014916 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m11:31:59.014916 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\fact_vehicle_location.sql
[0m11:31:59.027916 [debug] [MainThread]: 1603: static parser failed on dwh\fact_vehicle_location.sql
[0m11:31:59.058917 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_vehicle_location.sql
[0m11:31:59.077916 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c7af7de4-fdf9-4395-9301-aa0e81798ec1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002223FC5AF40>]}
[0m11:31:59.085916 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c7af7de4-fdf9-4395-9301-aa0e81798ec1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002223FBBA940>]}
[0m11:31:59.086887 [info ] [MainThread]: Found 6 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m11:31:59.087889 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c7af7de4-fdf9-4395-9301-aa0e81798ec1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002223FB9D6D0>]}
[0m11:31:59.088889 [info ] [MainThread]: 
[0m11:31:59.089917 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m11:31:59.091889 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m11:31:59.107917 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m11:31:59.107917 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m11:31:59.108890 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:32:00.157298 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 1.05 seconds
[0m11:32:00.158297 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m11:32:00.289610 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m11:32:00.294583 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m11:32:00.294583 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m11:32:00.295582 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:32:00.714374 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.42 seconds
[0m11:32:00.715368 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m11:32:00.849117 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m11:32:00.856146 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m11:32:00.857116 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m11:32:00.857116 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:32:01.262176 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.41 seconds
[0m11:32:01.264163 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m11:32:01.402793 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m11:32:01.405820 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m11:32:01.405820 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m11:32:01.405820 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:32:01.878205 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.47 seconds
[0m11:32:01.880205 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m11:32:02.022206 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c7af7de4-fdf9-4395-9301-aa0e81798ec1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002223FBBAEE0>]}
[0m11:32:02.023219 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:32:02.025208 [info ] [MainThread]: 
[0m11:32:02.031207 [debug] [Thread-1  ]: Began running node model.door2door_dwh.event_log
[0m11:32:02.032206 [info ] [Thread-1  ]: 1 of 6 START sql incremental model DBT_stg.event_log ........................... [RUN]
[0m11:32:02.033242 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.event_log"
[0m11:32:02.034205 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.event_log
[0m11:32:02.034205 [debug] [Thread-1  ]: Compiling model.door2door_dwh.event_log
[0m11:32:02.046204 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.event_log"
[0m11:32:02.048213 [debug] [Thread-1  ]: finished collecting timing info
[0m11:32:02.048213 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.event_log
[0m11:32:02.104238 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.event_log"
[0m11:32:02.106240 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event_log"
[0m11:32:02.106240 [debug] [Thread-1  ]: On model.door2door_dwh.event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event_log"} */
create or replace transient table DOOR2DOOR_DWH.DBT_stg.event_log  as
        (

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TEXT as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
        );
[0m11:32:02.106240 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m11:32:07.720312 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 5.61 seconds
[0m11:32:07.727309 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event_log"
[0m11:32:07.727309 [debug] [Thread-1  ]: On model.door2door_dwh.event_log: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event_log"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.event_log__dbt_tmp cascade
[0m11:32:07.807084 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m11:32:07.830078 [debug] [Thread-1  ]: finished collecting timing info
[0m11:32:07.831079 [debug] [Thread-1  ]: On model.door2door_dwh.event_log: Close
[0m11:32:07.970579 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c7af7de4-fdf9-4395-9301-aa0e81798ec1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002223FF98DF0>]}
[0m11:32:07.972576 [info ] [Thread-1  ]: 1 of 6 OK created sql incremental model DBT_stg.event_log ...................... [[32mSUCCESS 1[0m in 5.94s]
[0m11:32:07.974573 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.event_log
[0m11:32:07.975570 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_operating_period
[0m11:32:07.976573 [info ] [Thread-1  ]: 2 of 6 START sql table model DBT_dwh.dim_operating_period ...................... [RUN]
[0m11:32:07.978570 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_operating_period"
[0m11:32:07.979570 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_operating_period
[0m11:32:07.980578 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_operating_period
[0m11:32:07.991570 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_operating_period"
[0m11:32:07.992570 [debug] [Thread-1  ]: finished collecting timing info
[0m11:32:07.993569 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_operating_period
[0m11:32:08.013567 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_operating_period"
[0m11:32:08.015567 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_operating_period"
[0m11:32:08.015567 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_operating_period"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_operating_period  as
        (

with operating_periods as (
    SELECT
        data_id,
        data_start,
        data_finish,
        ROW_NUMBER() OVER (PARTITION BY data_id ORDER BY data_finish desc, data_start desc) as rn
    FROM DOOR2DOOR_DWH.DBT_stg.event_log
    WHERE lower(event_on) = 'operating_period'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    data_id as operating_period_source_id,
    data_start as operating_period_start_time,
    data_finish as operating_period_finish_time
FROM operating_periods
        );
[0m11:32:08.016570 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:32:09.471721 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.46 seconds
[0m11:32:09.473719 [debug] [Thread-1  ]: finished collecting timing info
[0m11:32:09.474691 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: Close
[0m11:32:09.614903 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c7af7de4-fdf9-4395-9301-aa0e81798ec1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002224004EC10>]}
[0m11:32:09.614903 [info ] [Thread-1  ]: 2 of 6 OK created sql table model DBT_dwh.dim_operating_period ................. [[32mSUCCESS 1[0m in 1.64s]
[0m11:32:09.616655 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_operating_period
[0m11:32:09.616655 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_vehicle
[0m11:32:09.617669 [info ] [Thread-1  ]: 3 of 6 START sql table model DBT_dwh.dim_vehicle ............................... [RUN]
[0m11:32:09.618668 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_vehicle"
[0m11:32:09.619667 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_vehicle
[0m11:32:09.619667 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_vehicle
[0m11:32:09.624667 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_vehicle"
[0m11:32:09.625675 [debug] [Thread-1  ]: finished collecting timing info
[0m11:32:09.625675 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_vehicle
[0m11:32:09.629668 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_vehicle"
[0m11:32:09.630669 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_vehicle"
[0m11:32:09.630669 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_vehicle"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_vehicle  as
        (

with vehicles as (
    SELECT
        DISTINCT data_id
    FROM DOOR2DOOR_DWH.DBT_stg.event_log
    WHERE lower(event_on) = 'vehicle'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    data_id as vehicle_source_id
FROM vehicles
        );
[0m11:32:09.631671 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:32:10.641809 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.01 seconds
[0m11:32:10.643803 [debug] [Thread-1  ]: finished collecting timing info
[0m11:32:10.644803 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: Close
[0m11:32:10.776227 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c7af7de4-fdf9-4395-9301-aa0e81798ec1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002223FF21D00>]}
[0m11:32:10.776227 [info ] [Thread-1  ]: 3 of 6 OK created sql table model DBT_dwh.dim_vehicle .......................... [[32mSUCCESS 1[0m in 1.16s]
[0m11:32:10.778063 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_vehicle
[0m11:32:10.779103 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_deregistration
[0m11:32:10.779103 [info ] [Thread-1  ]: 4 of 6 START sql table model DBT_dwh.fact_deregistration ....................... [RUN]
[0m11:32:10.780102 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_deregistration"
[0m11:32:10.780102 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_deregistration
[0m11:32:10.781076 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_deregistration
[0m11:32:10.788101 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_deregistration"
[0m11:32:10.789076 [debug] [Thread-1  ]: finished collecting timing info
[0m11:32:10.789076 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_deregistration
[0m11:32:10.792101 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_deregistration"
[0m11:32:10.794074 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m11:32:10.794074 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_deregistration  as
        (

with events as (
    SELECT
        event,
        event_at,
        data_id
    FROM DOOR2DOOR_DWH.DBT_stg.event_log e
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON e.event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'deregister'
)
SELECT
    
    
md5(cast(coalesce(cast(event as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as deregistration_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    event_at as deregistration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
        );
[0m11:32:10.794074 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:32:12.061946 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.27 seconds
[0m11:32:12.067970 [debug] [Thread-1  ]: finished collecting timing info
[0m11:32:12.067970 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: Close
[0m11:32:12.221948 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c7af7de4-fdf9-4395-9301-aa0e81798ec1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002223FFF9CD0>]}
[0m11:32:12.222948 [info ] [Thread-1  ]: 4 of 6 OK created sql table model DBT_dwh.fact_deregistration .................. [[32mSUCCESS 1[0m in 1.44s]
[0m11:32:12.223967 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_deregistration
[0m11:32:12.224946 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_registration
[0m11:32:12.225945 [info ] [Thread-1  ]: 5 of 6 START sql table model DBT_dwh.fact_registration ......................... [RUN]
[0m11:32:12.226946 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_registration"
[0m11:32:12.226946 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_registration
[0m11:32:12.227946 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_registration
[0m11:32:12.239952 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_registration"
[0m11:32:12.240967 [debug] [Thread-1  ]: finished collecting timing info
[0m11:32:12.241949 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_registration
[0m11:32:12.340950 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_registration"
[0m11:32:12.344949 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m11:32:12.344949 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_registration  as
        (

with events as (
    SELECT
        event,
        event_at,
        data_id
    FROM DOOR2DOOR_DWH.DBT_stg.event_log e
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON e.event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'register'
)
SELECT
    
    
md5(cast(coalesce(cast(event as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as registration_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    event_at as registration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
        );
[0m11:32:12.345950 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:32:13.245146 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.9 seconds
[0m11:32:13.247137 [debug] [Thread-1  ]: finished collecting timing info
[0m11:32:13.248154 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: Close
[0m11:32:13.374073 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c7af7de4-fdf9-4395-9301-aa0e81798ec1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002223FF98A60>]}
[0m11:32:13.374073 [info ] [Thread-1  ]: 5 of 6 OK created sql table model DBT_dwh.fact_registration .................... [[32mSUCCESS 1[0m in 1.15s]
[0m11:32:13.376033 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_registration
[0m11:32:13.376033 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_vehicle_location
[0m11:32:13.377033 [info ] [Thread-1  ]: 6 of 6 START sql table model DBT_dwh.fact_vehicle_location ..................... [RUN]
[0m11:32:13.378031 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m11:32:13.379041 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_vehicle_location
[0m11:32:13.379041 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_vehicle_location
[0m11:32:13.387077 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_vehicle_location"
[0m11:32:13.388075 [debug] [Thread-1  ]: finished collecting timing info
[0m11:32:13.388075 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_vehicle_location
[0m11:32:13.392059 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_vehicle_location"
[0m11:32:13.393075 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m11:32:13.394063 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location  as
        (

with locations as (
    SELECT
        event_at,
        data_id,
        data_location_lat,
        data_location_lng,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.event_log e
    INNER JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON e.event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'update'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_location_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    operating_period_key,
    data_location_lat as vehicle_location_lat,
    data_location_lng as vehicle_location_lng,
    event_at as vehicle_location_time
FROM locations


--- ASSUMPTION Events are recorded only if vehicle is registered to a operation period
        );
[0m11:32:13.394063 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:32:14.963913 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.57 seconds
[0m11:32:14.968909 [debug] [Thread-1  ]: finished collecting timing info
[0m11:32:14.968909 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: Close
[0m11:32:15.099915 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c7af7de4-fdf9-4395-9301-aa0e81798ec1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002223FBF9DF0>]}
[0m11:32:15.100916 [info ] [Thread-1  ]: 6 of 6 OK created sql table model DBT_dwh.fact_vehicle_location ................ [[32mSUCCESS 1[0m in 1.72s]
[0m11:32:15.101920 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_vehicle_location
[0m11:32:15.103914 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m11:32:15.104941 [info ] [MainThread]: 
[0m11:32:15.105969 [info ] [MainThread]: Finished running 1 incremental model, 5 table models in 0 hours 0 minutes and 16.02 seconds (16.02s).
[0m11:32:15.105969 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:32:15.106912 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m11:32:15.106912 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_stg' was properly closed.
[0m11:32:15.106912 [debug] [MainThread]: Connection 'model.door2door_dwh.fact_vehicle_location' was properly closed.
[0m11:32:15.117923 [info ] [MainThread]: 
[0m11:32:15.118911 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:32:15.119956 [info ] [MainThread]: 
[0m11:32:15.121917 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m11:32:15.122940 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002223FA093D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002223FC17E20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002223FC6EEE0>]}
[0m11:32:15.123944 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 13:58:33.515740 | fbe15f51-de07-4091-b8fe-6f5f72cb6964 ==============================
[0m13:58:33.515740 [info ] [MainThread]: Running with dbt=1.3.1
[0m13:58:33.516740 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m13:58:33.516740 [debug] [MainThread]: Tracking: tracking
[0m13:58:33.517741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014E7EEF9CD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014E7EEF9D30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014E7EEF9D90>]}
[0m13:58:33.711741 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 2 files added, 1 files changed.
[0m13:58:33.711741 [debug] [MainThread]: Partial parsing: added file: door2door_dwh://models\stg\event.sql
[0m13:58:33.712743 [debug] [MainThread]: Partial parsing: added file: door2door_dwh://models\stg\registration_events_grouped.sql
[0m13:58:33.712743 [debug] [MainThread]: Partial parsing: deleted file: door2door_dwh://models\stg\event_log.sql
[0m13:58:33.713744 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\fact_registration.sql
[0m13:58:33.728743 [debug] [MainThread]: 1603: static parser failed on stg\event.sql
[0m13:58:33.750744 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\event.sql
[0m13:58:33.752743 [debug] [MainThread]: 1603: static parser failed on stg\registration_events_grouped.sql
[0m13:58:33.756743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014E7F0B4190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014E7F1314C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014E7F131550>]}
[0m13:58:33.756743 [debug] [MainThread]: Flushing usage events
[0m13:58:34.350419 [error] [MainThread]: Encountered an error:
Compilation Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)
  expected token ',', got 'sort'
    line 4
      sort='event_at',


============================== 2023-02-05 14:00:00.728896 | c0ec11a5-13a3-490d-b721-00108a9dab5d ==============================
[0m14:00:00.728896 [info ] [MainThread]: Running with dbt=1.3.1
[0m14:00:00.729885 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['registration_events_grouped'], 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m14:00:00.729885 [debug] [MainThread]: Tracking: tracking
[0m14:00:00.730882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002390F728D60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002390F728DC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002390F728E20>]}
[0m14:00:00.881891 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 2 files added, 1 files changed.
[0m14:00:00.882922 [debug] [MainThread]: Partial parsing: added file: door2door_dwh://models\stg\event.sql
[0m14:00:00.882922 [debug] [MainThread]: Partial parsing: added file: door2door_dwh://models\stg\registration_events_grouped.sql
[0m14:00:00.883928 [debug] [MainThread]: Partial parsing: deleted file: door2door_dwh://models\stg\event_log.sql
[0m14:00:00.883928 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\fact_registration.sql
[0m14:00:00.899922 [debug] [MainThread]: 1603: static parser failed on stg\event.sql
[0m14:00:00.922886 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\event.sql
[0m14:00:00.924923 [debug] [MainThread]: 1603: static parser failed on stg\registration_events_grouped.sql
[0m14:00:00.950945 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\registration_events_grouped.sql
[0m14:00:00.951984 [debug] [MainThread]: 1603: static parser failed on dwh\fact_deregistration.sql
[0m14:00:00.961994 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_deregistration.sql
[0m14:00:00.964996 [debug] [MainThread]: 1603: static parser failed on dwh\fact_registration.sql
[0m14:00:00.974994 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_registration.sql
[0m14:00:00.976994 [debug] [MainThread]: 1603: static parser failed on dwh\fact_vehicle_location.sql
[0m14:00:00.987035 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_vehicle_location.sql
[0m14:00:00.988030 [debug] [MainThread]: 1603: static parser failed on dwh\dim_operating_period.sql
[0m14:00:00.995030 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\dim_operating_period.sql
[0m14:00:00.997030 [debug] [MainThread]: 1603: static parser failed on dwh\dim_vehicle.sql
[0m14:00:01.005030 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\dim_vehicle.sql
[0m14:00:01.005995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002390F8F54C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002390F99CF40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002390F99C340>]}
[0m14:00:01.005995 [debug] [MainThread]: Flushing usage events
[0m14:00:01.593481 [error] [MainThread]: Encountered an error:
Compilation Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)
  Model 'model.door2door_dwh.registration_events_grouped' (models\stg\registration_events_grouped.sql) depends on a node named 'event_log' which was not found


============================== 2023-02-05 14:00:19.683572 | 5510c647-a99e-42e4-b9da-e9c50156bf70 ==============================
[0m14:00:19.683572 [info ] [MainThread]: Running with dbt=1.3.1
[0m14:00:19.684573 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['registration_events_grouped'], 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m14:00:19.685573 [debug] [MainThread]: Tracking: tracking
[0m14:00:19.686570 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000249DF9A9CD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000249DF9A9D30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000249DF9A9D90>]}
[0m14:00:19.939569 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 2 files added, 1 files changed.
[0m14:00:19.939569 [debug] [MainThread]: Partial parsing: added file: door2door_dwh://models\stg\registration_events_grouped.sql
[0m14:00:19.940571 [debug] [MainThread]: Partial parsing: added file: door2door_dwh://models\stg\event.sql
[0m14:00:19.941571 [debug] [MainThread]: Partial parsing: deleted file: door2door_dwh://models\stg\event_log.sql
[0m14:00:19.944572 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\fact_registration.sql
[0m14:00:19.970569 [debug] [MainThread]: 1603: static parser failed on stg\registration_events_grouped.sql
[0m14:00:20.026571 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\registration_events_grouped.sql
[0m14:00:20.029570 [debug] [MainThread]: 1603: static parser failed on stg\event.sql
[0m14:00:20.040572 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\event.sql
[0m14:00:20.043572 [debug] [MainThread]: 1603: static parser failed on dwh\fact_deregistration.sql
[0m14:00:20.056568 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_deregistration.sql
[0m14:00:20.057568 [debug] [MainThread]: 1603: static parser failed on dwh\fact_registration.sql
[0m14:00:20.069570 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_registration.sql
[0m14:00:20.071568 [debug] [MainThread]: 1603: static parser failed on dwh\fact_vehicle_location.sql
[0m14:00:20.083572 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_vehicle_location.sql
[0m14:00:20.086570 [debug] [MainThread]: 1603: static parser failed on dwh\dim_operating_period.sql
[0m14:00:20.094568 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\dim_operating_period.sql
[0m14:00:20.096574 [debug] [MainThread]: 1603: static parser failed on dwh\dim_vehicle.sql
[0m14:00:20.104571 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\dim_vehicle.sql
[0m14:00:20.105570 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000249DFB75430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000249DFBF5550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000249DFBF5070>]}
[0m14:00:20.105570 [debug] [MainThread]: Flushing usage events
[0m14:00:20.655886 [error] [MainThread]: Encountered an error:
Compilation Error in model fact_deregistration (models\dwh\fact_deregistration.sql)
  Model 'model.door2door_dwh.fact_deregistration' (models\dwh\fact_deregistration.sql) depends on a node named 'event_log' which was not found


============================== 2023-02-05 14:01:34.893082 | 87759a95-a0bd-4e9c-a377-c62d8b8ec76e ==============================
[0m14:01:34.893082 [info ] [MainThread]: Running with dbt=1.3.1
[0m14:01:34.894055 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['registration_events_grouped'], 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m14:01:34.894055 [debug] [MainThread]: Tracking: tracking
[0m14:01:34.894055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002082CEE9CD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002082CEE9D30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002082CEE9D90>]}
[0m14:01:35.026053 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 2 files added, 5 files changed.
[0m14:01:35.026053 [debug] [MainThread]: Partial parsing: added file: door2door_dwh://models\stg\registration_events_grouped.sql
[0m14:01:35.027109 [debug] [MainThread]: Partial parsing: added file: door2door_dwh://models\stg\event.sql
[0m14:01:35.027109 [debug] [MainThread]: Partial parsing: deleted file: door2door_dwh://models\stg\event_log.sql
[0m14:01:35.028083 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\fact_vehicle_location.sql
[0m14:01:35.028083 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\fact_deregistration.sql
[0m14:01:35.029058 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\dim_vehicle.sql
[0m14:01:35.029058 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\fact_registration.sql
[0m14:01:35.029058 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\dim_operating_period.sql
[0m14:01:35.044060 [debug] [MainThread]: 1603: static parser failed on stg\registration_events_grouped.sql
[0m14:01:35.077053 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\registration_events_grouped.sql
[0m14:01:35.079054 [debug] [MainThread]: 1603: static parser failed on stg\event.sql
[0m14:01:35.084054 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\event.sql
[0m14:01:35.085054 [debug] [MainThread]: 1603: static parser failed on dwh\fact_deregistration.sql
[0m14:01:35.093054 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_deregistration.sql
[0m14:01:35.095054 [debug] [MainThread]: 1603: static parser failed on dwh\fact_registration.sql
[0m14:01:35.102053 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_registration.sql
[0m14:01:35.103054 [debug] [MainThread]: 1603: static parser failed on dwh\fact_vehicle_location.sql
[0m14:01:35.111053 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_vehicle_location.sql
[0m14:01:35.112054 [debug] [MainThread]: 1603: static parser failed on dwh\dim_operating_period.sql
[0m14:01:35.118054 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\dim_operating_period.sql
[0m14:01:35.119058 [debug] [MainThread]: 1603: static parser failed on dwh\dim_vehicle.sql
[0m14:01:35.128055 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\dim_vehicle.sql
[0m14:01:35.150054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '87759a95-a0bd-4e9c-a377-c62d8b8ec76e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002082D1610D0>]}
[0m14:01:35.160096 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '87759a95-a0bd-4e9c-a377-c62d8b8ec76e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002082D01EF70>]}
[0m14:01:35.161058 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m14:01:35.162055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '87759a95-a0bd-4e9c-a377-c62d8b8ec76e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002082D07D790>]}
[0m14:01:35.163055 [info ] [MainThread]: 
[0m14:01:35.164054 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:01:35.166055 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:01:35.182082 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:01:35.182082 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:01:35.182082 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:01:36.431958 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 1.25 seconds
[0m14:01:36.432960 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:01:36.565376 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:01:36.573418 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:01:36.574438 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m14:01:36.574438 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:01:37.259139 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.68 seconds
[0m14:01:37.260134 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m14:01:37.388830 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:01:37.391831 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:01:37.391831 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m14:01:37.392801 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:01:37.812215 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.42 seconds
[0m14:01:37.813210 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m14:01:37.950138 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '87759a95-a0bd-4e9c-a377-c62d8b8ec76e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002082CFEC400>]}
[0m14:01:37.950138 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:01:37.951166 [info ] [MainThread]: 
[0m14:01:37.956148 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m14:01:37.957134 [info ] [Thread-1  ]: 1 of 1 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m14:01:37.958137 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:01:37.958137 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m14:01:37.959165 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m14:01:37.967157 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m14:01:37.970440 [debug] [Thread-1  ]: finished collecting timing info
[0m14:01:37.971455 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m14:01:38.024484 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.registration_events_grouped"
[0m14:01:38.026666 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:01:38.026666 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace transient table DOOR2DOOR_DWH.DBT_stg.registration_events_grouped  as
        (

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    WHERE lower(event) in ('register', 'deregister')

    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key,
    FROM new_events
    WHERE lower(event) = 'register'
)



SELECT * FROM new_registers
        );
[0m14:01:38.026666 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:01:38.633773 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa20e9-3201-98a1-0000-0001c146241d
[0m14:01:38.633773 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 24 at position 0 unexpected 'md5'.
syntax error line 24 at position 4 unexpected 'cast'.
syntax error line 24 at position 39 unexpected ','.
[0m14:01:38.634775 [debug] [Thread-1  ]: finished collecting timing info
[0m14:01:38.634775 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m14:01:38.780626 [debug] [Thread-1  ]: Database Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)
  001003 (42000): SQL compilation error:
  syntax error line 24 at position 0 unexpected 'md5'.
  syntax error line 24 at position 4 unexpected 'cast'.
  syntax error line 24 at position 39 unexpected ','.
  compiled Code at target\run\door2door_dwh\models\stg\registration_events_grouped.sql
[0m14:01:38.781625 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '87759a95-a0bd-4e9c-a377-c62d8b8ec76e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002082D350C40>]}
[0m14:01:38.781625 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model DBT_stg.registration_events_grouped  [[31mERROR[0m in 0.82s]
[0m14:01:38.783604 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m14:01:38.785623 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:01:38.786645 [info ] [MainThread]: 
[0m14:01:38.786645 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 3.62 seconds (3.62s).
[0m14:01:38.787649 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:01:38.787649 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m14:01:38.788644 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_dwh' was properly closed.
[0m14:01:38.788644 [debug] [MainThread]: Connection 'model.door2door_dwh.registration_events_grouped' was properly closed.
[0m14:01:38.798615 [info ] [MainThread]: 
[0m14:01:38.799622 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:01:38.801615 [info ] [MainThread]: 
[0m14:01:38.802676 [error] [MainThread]: [33mDatabase Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)[0m
[0m14:01:38.804633 [error] [MainThread]:   001003 (42000): SQL compilation error:
[0m14:01:38.805656 [error] [MainThread]:   syntax error line 24 at position 0 unexpected 'md5'.
[0m14:01:38.806630 [error] [MainThread]:   syntax error line 24 at position 4 unexpected 'cast'.
[0m14:01:38.806630 [error] [MainThread]:   syntax error line 24 at position 39 unexpected ','.
[0m14:01:38.807615 [error] [MainThread]:   compiled Code at target\run\door2door_dwh\models\stg\registration_events_grouped.sql
[0m14:01:38.808659 [info ] [MainThread]: 
[0m14:01:38.809637 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:01:38.810618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002082CFEC550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002082D4B1D60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002082D4B1D00>]}
[0m14:01:38.810618 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 14:02:02.330424 | d88daf5f-672e-4770-a903-44edf8fc1e7a ==============================
[0m14:02:02.330424 [info ] [MainThread]: Running with dbt=1.3.1
[0m14:02:02.331421 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['registration_events_grouped'], 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m14:02:02.331421 [debug] [MainThread]: Tracking: tracking
[0m14:02:02.332413 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FFC2F28D00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FFC2F28D60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FFC2F28DC0>]}
[0m14:02:02.463409 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:02:02.464410 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\stg\registration_events_grouped.sql
[0m14:02:02.477431 [debug] [MainThread]: 1603: static parser failed on stg\registration_events_grouped.sql
[0m14:02:02.509409 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\registration_events_grouped.sql
[0m14:02:02.528410 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd88daf5f-672e-4770-a903-44edf8fc1e7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FFC31820D0>]}
[0m14:02:02.537413 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd88daf5f-672e-4770-a903-44edf8fc1e7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FFC315A0A0>]}
[0m14:02:02.538439 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m14:02:02.539379 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd88daf5f-672e-4770-a903-44edf8fc1e7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FFC30DDA30>]}
[0m14:02:02.540411 [info ] [MainThread]: 
[0m14:02:02.541383 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:02:02.542396 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:02:02.557410 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:02:02.557410 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:02:02.557410 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:02:03.499014 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.94 seconds
[0m14:02:03.500973 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:02:03.635573 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:02:03.641567 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:02:03.642567 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m14:02:03.642567 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:02:04.066793 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.42 seconds
[0m14:02:04.068819 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m14:02:04.204721 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:02:04.207749 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:02:04.207749 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m14:02:04.208719 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:02:04.638914 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.43 seconds
[0m14:02:04.640951 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m14:02:04.770923 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd88daf5f-672e-4770-a903-44edf8fc1e7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FFC3035790>]}
[0m14:02:04.771950 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:02:04.771950 [info ] [MainThread]: 
[0m14:02:04.777558 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m14:02:04.777558 [info ] [Thread-1  ]: 1 of 1 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m14:02:04.779569 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:02:04.779569 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m14:02:04.779569 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m14:02:04.786539 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m14:02:04.786539 [debug] [Thread-1  ]: finished collecting timing info
[0m14:02:04.787539 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m14:02:04.847542 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.registration_events_grouped"
[0m14:02:04.848542 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:02:04.849541 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace transient table DOOR2DOOR_DWH.DBT_stg.registration_events_grouped  as
        (

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    WHERE lower(event) in ('register', 'deregister')

    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



SELECT * FROM new_registers
        );
[0m14:02:04.849541 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:02:05.252642 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa20ea-3201-98a1-0000-0001c1462421
[0m14:02:05.252642 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'DOOR2DOOR_DWH.DBT_STG.EVENT' does not exist or not authorized.
[0m14:02:05.253642 [debug] [Thread-1  ]: finished collecting timing info
[0m14:02:05.253642 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m14:02:05.382804 [debug] [Thread-1  ]: Database Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)
  002003 (42S02): SQL compilation error:
  Object 'DOOR2DOOR_DWH.DBT_STG.EVENT' does not exist or not authorized.
  compiled Code at target\run\door2door_dwh\models\stg\registration_events_grouped.sql
[0m14:02:05.383806 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd88daf5f-672e-4770-a903-44edf8fc1e7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FFC34DFA60>]}
[0m14:02:05.383806 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model DBT_stg.registration_events_grouped  [[31mERROR[0m in 0.60s]
[0m14:02:05.385255 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m14:02:05.387278 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:02:05.388309 [info ] [MainThread]: 
[0m14:02:05.388309 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 2.85 seconds (2.85s).
[0m14:02:05.389289 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:02:05.389289 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m14:02:05.390309 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_dwh' was properly closed.
[0m14:02:05.390309 [debug] [MainThread]: Connection 'model.door2door_dwh.registration_events_grouped' was properly closed.
[0m14:02:05.408340 [info ] [MainThread]: 
[0m14:02:05.409330 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:02:05.411278 [info ] [MainThread]: 
[0m14:02:05.412299 [error] [MainThread]: [33mDatabase Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)[0m
[0m14:02:05.413694 [error] [MainThread]:   002003 (42S02): SQL compilation error:
[0m14:02:05.413694 [error] [MainThread]:   Object 'DOOR2DOOR_DWH.DBT_STG.EVENT' does not exist or not authorized.
[0m14:02:05.414724 [error] [MainThread]:   compiled Code at target\run\door2door_dwh\models\stg\registration_events_grouped.sql
[0m14:02:05.415706 [info ] [MainThread]: 
[0m14:02:05.416728 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:02:05.417747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FFC314B370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FFC3388550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FFC34DF9A0>]}
[0m14:02:05.418725 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 14:02:20.227170 | 00100175-c7a2-43a0-b6d0-6bebeb029fca ==============================
[0m14:02:20.227170 [info ] [MainThread]: Running with dbt=1.3.1
[0m14:02:20.228171 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['+registration_events_grouped'], 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m14:02:20.229172 [debug] [MainThread]: Tracking: tracking
[0m14:02:20.229172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025701F98D30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025701F98D90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025701F98DF0>]}
[0m14:02:20.361172 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:02:20.361172 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:02:20.370176 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '00100175-c7a2-43a0-b6d0-6bebeb029fca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002570218A0D0>]}
[0m14:02:20.379172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '00100175-c7a2-43a0-b6d0-6bebeb029fca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000257020A6820>]}
[0m14:02:20.379172 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m14:02:20.380186 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '00100175-c7a2-43a0-b6d0-6bebeb029fca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000257020A6940>]}
[0m14:02:20.382186 [info ] [MainThread]: 
[0m14:02:20.383160 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:02:20.385172 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:02:20.402148 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:02:20.402148 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:02:20.403145 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:02:21.228733 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.83 seconds
[0m14:02:21.229733 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:02:21.366889 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:02:21.373918 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:02:21.373918 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m14:02:21.373918 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:02:22.001966 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.63 seconds
[0m14:02:22.002963 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m14:02:22.140354 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:02:22.142353 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:02:22.143354 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m14:02:22.143354 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:02:22.570670 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.43 seconds
[0m14:02:22.571670 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m14:02:22.710003 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '00100175-c7a2-43a0-b6d0-6bebeb029fca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000257020A6520>]}
[0m14:02:22.711018 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:02:22.712013 [info ] [MainThread]: 
[0m14:02:22.716566 [debug] [Thread-1  ]: Began running node model.door2door_dwh.event
[0m14:02:22.717606 [info ] [Thread-1  ]: 1 of 2 START sql incremental model DBT_stg.event ............................... [RUN]
[0m14:02:22.718575 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.event"
[0m14:02:22.718575 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.event
[0m14:02:22.719579 [debug] [Thread-1  ]: Compiling model.door2door_dwh.event
[0m14:02:22.727620 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.event"
[0m14:02:22.728618 [debug] [Thread-1  ]: finished collecting timing info
[0m14:02:22.729585 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.event
[0m14:02:22.785605 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.event"
[0m14:02:22.787579 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event"
[0m14:02:22.787579 [debug] [Thread-1  ]: On model.door2door_dwh.event: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event"} */
create or replace transient table DOOR2DOOR_DWH.DBT_stg.event  as
        (

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TEXT as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
        );
[0m14:02:22.788579 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:02:31.150831 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 8.36 seconds
[0m14:02:31.157827 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event"
[0m14:02:31.158797 [debug] [Thread-1  ]: On model.door2door_dwh.event: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.event__dbt_tmp cascade
[0m14:02:31.239136 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m14:02:31.260188 [debug] [Thread-1  ]: finished collecting timing info
[0m14:02:31.260188 [debug] [Thread-1  ]: On model.door2door_dwh.event: Close
[0m14:02:31.389800 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '00100175-c7a2-43a0-b6d0-6bebeb029fca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000257024C1AC0>]}
[0m14:02:31.390778 [info ] [Thread-1  ]: 1 of 2 OK created sql incremental model DBT_stg.event .......................... [[32mSUCCESS 1[0m in 8.67s]
[0m14:02:31.391877 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.event
[0m14:02:31.392954 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m14:02:31.393907 [info ] [Thread-1  ]: 2 of 2 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m14:02:31.394910 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:02:31.394910 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m14:02:31.395937 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m14:02:31.417951 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m14:02:31.418950 [debug] [Thread-1  ]: finished collecting timing info
[0m14:02:31.419908 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m14:02:31.423950 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.registration_events_grouped"
[0m14:02:31.425951 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:02:31.425951 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace transient table DOOR2DOOR_DWH.DBT_stg.registration_events_grouped  as
        (

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    WHERE lower(event) in ('register', 'deregister')

    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



SELECT * FROM new_registers
        );
[0m14:02:31.426524 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:02:32.508469 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.08 seconds
[0m14:02:32.511487 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:02:32.512458 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp cascade
[0m14:02:32.612764 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.1 seconds
[0m14:02:32.614760 [debug] [Thread-1  ]: finished collecting timing info
[0m14:02:32.614760 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m14:02:32.751484 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '00100175-c7a2-43a0-b6d0-6bebeb029fca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025702461610>]}
[0m14:02:32.752486 [info ] [Thread-1  ]: 2 of 2 OK created sql incremental model DBT_stg.registration_events_grouped .... [[32mSUCCESS 1[0m in 1.36s]
[0m14:02:32.753769 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m14:02:32.755791 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:02:32.756783 [info ] [MainThread]: 
[0m14:02:32.756783 [info ] [MainThread]: Finished running 2 incremental models in 0 hours 0 minutes and 12.37 seconds (12.37s).
[0m14:02:32.757781 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:02:32.757781 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m14:02:32.758781 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_dwh' was properly closed.
[0m14:02:32.758781 [debug] [MainThread]: Connection 'model.door2door_dwh.registration_events_grouped' was properly closed.
[0m14:02:32.767783 [info ] [MainThread]: 
[0m14:02:32.768781 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:02:32.769788 [info ] [MainThread]: 
[0m14:02:32.770779 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m14:02:32.771781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025702156640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000257020A62B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002570245F7C0>]}
[0m14:02:32.771781 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 14:04:55.624880 | 534a20fa-1f23-4115-9595-ef07999431bf ==============================
[0m14:04:55.624880 [info ] [MainThread]: Running with dbt=1.3.1
[0m14:04:55.625881 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['+registration_events_grouped'], 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m14:04:55.625881 [debug] [MainThread]: Tracking: tracking
[0m14:04:55.626881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000149061F8D00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000149061F8D60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000149061F8DC0>]}
[0m14:04:55.752881 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:04:55.753882 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\stg\registration_events_grouped.sql
[0m14:04:55.765881 [debug] [MainThread]: 1603: static parser failed on stg\registration_events_grouped.sql
[0m14:04:55.796881 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\registration_events_grouped.sql
[0m14:04:55.814882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '534a20fa-1f23-4115-9595-ef07999431bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000149064520D0>]}
[0m14:04:55.823882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '534a20fa-1f23-4115-9595-ef07999431bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001490642B0A0>]}
[0m14:04:55.823882 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m14:04:55.824895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '534a20fa-1f23-4115-9595-ef07999431bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000149063ADA30>]}
[0m14:04:55.825882 [info ] [MainThread]: 
[0m14:04:55.826900 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:04:55.828882 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:04:55.842881 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:04:55.842881 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:04:55.842881 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:04:56.785864 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.94 seconds
[0m14:04:56.786864 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:04:57.020536 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:04:57.027559 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:04:57.027559 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m14:04:57.027559 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:04:57.697330 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.67 seconds
[0m14:04:57.699326 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m14:04:57.889897 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:04:57.892927 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:04:57.893926 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m14:04:57.893926 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:04:58.286945 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.39 seconds
[0m14:04:58.287950 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m14:04:58.464831 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '534a20fa-1f23-4115-9595-ef07999431bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001490620FA00>]}
[0m14:04:58.465862 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:04:58.466868 [info ] [MainThread]: 
[0m14:04:58.471832 [debug] [Thread-1  ]: Began running node model.door2door_dwh.event
[0m14:04:58.472833 [info ] [Thread-1  ]: 1 of 2 START sql incremental model DBT_stg.event ............................... [RUN]
[0m14:04:58.473833 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.event"
[0m14:04:58.474838 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.event
[0m14:04:58.474838 [debug] [Thread-1  ]: Compiling model.door2door_dwh.event
[0m14:04:58.482935 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.event"
[0m14:04:58.483856 [debug] [Thread-1  ]: finished collecting timing info
[0m14:04:58.483856 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.event
[0m14:04:58.543863 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.event"
[0m14:04:58.545836 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event"
[0m14:04:58.546831 [debug] [Thread-1  ]: On model.door2door_dwh.event: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event"} */
create or replace transient table DOOR2DOOR_DWH.DBT_stg.event  as
        (

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TEXT as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
        );
[0m14:04:58.546831 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:05:06.452538 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 7.91 seconds
[0m14:05:06.459535 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event"
[0m14:05:06.460535 [debug] [Thread-1  ]: On model.door2door_dwh.event: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.event__dbt_tmp cascade
[0m14:05:06.542931 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m14:05:06.567933 [debug] [Thread-1  ]: finished collecting timing info
[0m14:05:06.568937 [debug] [Thread-1  ]: On model.door2door_dwh.event: Close
[0m14:05:06.704788 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '534a20fa-1f23-4115-9595-ef07999431bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000149067D5430>]}
[0m14:05:06.704788 [info ] [Thread-1  ]: 1 of 2 OK created sql incremental model DBT_stg.event .......................... [[32mSUCCESS 1[0m in 8.23s]
[0m14:05:06.707214 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.event
[0m14:05:06.708213 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m14:05:06.708213 [info ] [Thread-1  ]: 2 of 2 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m14:05:06.709216 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:05:06.710216 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m14:05:06.710216 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m14:05:06.716215 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m14:05:06.717216 [debug] [Thread-1  ]: finished collecting timing info
[0m14:05:06.717216 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m14:05:06.723215 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.registration_events_grouped"
[0m14:05:06.725214 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:05:06.725214 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace transient table DOOR2DOOR_DWH.DBT_stg.registration_events_grouped  as
        (

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    WHERE lower(event) in ('register', 'deregister')
        AND event_at <= '2019-06-01 18:17:04.088'

    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



SELECT * FROM new_registers
        );
[0m14:05:06.725214 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:05:07.946461 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.22 seconds
[0m14:05:07.949457 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:05:07.950456 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp cascade
[0m14:05:08.035237 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m14:05:08.037237 [debug] [Thread-1  ]: finished collecting timing info
[0m14:05:08.038236 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m14:05:08.170642 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '534a20fa-1f23-4115-9595-ef07999431bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000149067D5EE0>]}
[0m14:05:08.170642 [info ] [Thread-1  ]: 2 of 2 OK created sql incremental model DBT_stg.registration_events_grouped .... [[32mSUCCESS 1[0m in 1.46s]
[0m14:05:08.172645 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m14:05:08.174538 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:05:08.174538 [info ] [MainThread]: 
[0m14:05:08.175510 [info ] [MainThread]: Finished running 2 incremental models in 0 hours 0 minutes and 12.35 seconds (12.35s).
[0m14:05:08.176539 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:05:08.176539 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m14:05:08.176539 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_stg' was properly closed.
[0m14:05:08.177539 [debug] [MainThread]: Connection 'model.door2door_dwh.registration_events_grouped' was properly closed.
[0m14:05:08.187524 [info ] [MainThread]: 
[0m14:05:08.188509 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:05:08.190514 [info ] [MainThread]: 
[0m14:05:08.190514 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m14:05:08.192001 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000149065610D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014906863850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000149068639A0>]}
[0m14:05:08.192001 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 14:05:46.111458 | 7d320700-2bcb-4c3c-a245-ed8da58d3a95 ==============================
[0m14:05:46.111458 [info ] [MainThread]: Running with dbt=1.3.1
[0m14:05:46.112458 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['registration_events_grouped'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m14:05:46.112458 [debug] [MainThread]: Tracking: tracking
[0m14:05:46.113471 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BBEE3A8D00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BBEE3A8D60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BBEE3A8DC0>]}
[0m14:05:46.245459 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:05:46.245459 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\stg\registration_events_grouped.sql
[0m14:05:46.258458 [debug] [MainThread]: 1603: static parser failed on stg\registration_events_grouped.sql
[0m14:05:46.288459 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\registration_events_grouped.sql
[0m14:05:46.311459 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7d320700-2bcb-4c3c-a245-ed8da58d3a95', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BBEE6020D0>]}
[0m14:05:46.320460 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7d320700-2bcb-4c3c-a245-ed8da58d3a95', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BBEE5DA0A0>]}
[0m14:05:46.320460 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m14:05:46.321459 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7d320700-2bcb-4c3c-a245-ed8da58d3a95', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BBEE55EA30>]}
[0m14:05:46.322460 [info ] [MainThread]: 
[0m14:05:46.323459 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:05:46.325459 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:05:46.339458 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:05:46.339458 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:05:46.339458 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:05:47.318564 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.98 seconds
[0m14:05:47.320560 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:05:47.470764 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:05:47.477792 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:05:47.477792 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m14:05:47.477792 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:05:48.228321 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.75 seconds
[0m14:05:48.230337 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m14:05:48.364027 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:05:48.367028 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:05:48.368027 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m14:05:48.368027 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:05:48.772918 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.4 seconds
[0m14:05:48.773912 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m14:05:48.911264 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7d320700-2bcb-4c3c-a245-ed8da58d3a95', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BBEE3BEA00>]}
[0m14:05:48.911264 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:05:48.912291 [info ] [MainThread]: 
[0m14:05:48.917554 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m14:05:48.918542 [info ] [Thread-1  ]: 1 of 1 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m14:05:48.919542 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:05:48.919542 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m14:05:48.919542 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m14:05:48.929570 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m14:05:48.930573 [debug] [Thread-1  ]: finished collecting timing info
[0m14:05:48.931543 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m14:05:48.982568 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:05:48.983569 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace  view DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp
  
   as (
    

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    WHERE lower(event) in ('register', 'deregister')
        AND event_at <= '2019-06-01 18:17:04.089'

    
        and event_at > (select max(event_at) from DOOR2DOOR_DWH.DBT_stg.registration_events_grouped)
    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



    ,new_deregisters as (
        SELECT
            data_id,
            event_at
        FROM new_events d
        LEFT JOIN new_registers r
            ON d.data_id = r.data_id AND d.event_at = r.deregister_event_at
        WHERE 
            lower(d.event) = 'deregister'
    ),
    updated_existing_registers (
        SELECT
            r.data_id,
            r.register_event_at,
            d.event_at as deregister_event_at
            r._unique_key,   
        FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
        LEFT JOIN new_deregisters d ON
            r.data_id = d.data_id   
        WHERE r.deregister_event_at IS NULL
    )

    SELECT * FROM updated_existing_registers
    UNION ALL



SELECT * FROM new_registers
  );
[0m14:05:48.983569 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:05:49.688493 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa20ed-3201-9838-0000-0001c1463469
[0m14:05:49.688493 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 47 at position 8 unexpected 'SELECT'.
syntax error line 49 at position 13 unexpected '.'.
syntax error line 50 at position 13 unexpected '.'.
syntax error line 52 at position 8 unexpected 'FROM'.
syntax error line 64 at position 2 unexpected ')'.
[0m14:05:49.689473 [debug] [Thread-1  ]: finished collecting timing info
[0m14:05:49.689473 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m14:05:49.847015 [debug] [Thread-1  ]: Database Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)
  001003 (42000): SQL compilation error:
  syntax error line 47 at position 8 unexpected 'SELECT'.
  syntax error line 49 at position 13 unexpected '.'.
  syntax error line 50 at position 13 unexpected '.'.
  syntax error line 52 at position 8 unexpected 'FROM'.
  syntax error line 64 at position 2 unexpected ')'.
[0m14:05:49.848015 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7d320700-2bcb-4c3c-a245-ed8da58d3a95', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BBEE965FA0>]}
[0m14:05:49.848015 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model DBT_stg.registration_events_grouped  [[31mERROR[0m in 0.93s]
[0m14:05:49.850004 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m14:05:49.852015 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:05:49.852015 [info ] [MainThread]: 
[0m14:05:49.853016 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 3.53 seconds (3.53s).
[0m14:05:49.853989 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:05:49.853989 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m14:05:49.853989 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_stg' was properly closed.
[0m14:05:49.854986 [debug] [MainThread]: Connection 'model.door2door_dwh.registration_events_grouped' was properly closed.
[0m14:05:49.864985 [info ] [MainThread]: 
[0m14:05:49.865817 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:05:49.866831 [info ] [MainThread]: 
[0m14:05:49.867826 [error] [MainThread]: [33mDatabase Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)[0m
[0m14:05:49.868828 [error] [MainThread]:   001003 (42000): SQL compilation error:
[0m14:05:49.869840 [error] [MainThread]:   syntax error line 47 at position 8 unexpected 'SELECT'.
[0m14:05:49.869840 [error] [MainThread]:   syntax error line 49 at position 13 unexpected '.'.
[0m14:05:49.870826 [error] [MainThread]:   syntax error line 50 at position 13 unexpected '.'.
[0m14:05:49.871831 [error] [MainThread]:   syntax error line 52 at position 8 unexpected 'FROM'.
[0m14:05:49.872833 [error] [MainThread]:   syntax error line 64 at position 2 unexpected ')'.
[0m14:05:49.873829 [info ] [MainThread]: 
[0m14:05:49.874827 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:05:49.876842 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BBEE70F0D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BBEE9605B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BBEE960700>]}
[0m14:05:49.877828 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 14:06:20.180878 | 23b940bb-85b0-4959-a9b9-366e0e8467b6 ==============================
[0m14:06:20.180878 [info ] [MainThread]: Running with dbt=1.3.1
[0m14:06:20.181849 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['registration_events_grouped'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m14:06:20.181849 [debug] [MainThread]: Tracking: tracking
[0m14:06:20.182853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C44CB19CA0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C44CB19D00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C44CB19D60>]}
[0m14:06:20.315880 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:06:20.316846 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\stg\registration_events_grouped.sql
[0m14:06:20.329877 [debug] [MainThread]: 1603: static parser failed on stg\registration_events_grouped.sql
[0m14:06:20.361877 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\registration_events_grouped.sql
[0m14:06:20.380877 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '23b940bb-85b0-4959-a9b9-366e0e8467b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C44CD740D0>]}
[0m14:06:20.389847 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '23b940bb-85b0-4959-a9b9-366e0e8467b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C44CD4A0A0>]}
[0m14:06:20.389847 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m14:06:20.390856 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '23b940bb-85b0-4959-a9b9-366e0e8467b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C44CCCE9D0>]}
[0m14:06:20.391877 [info ] [MainThread]: 
[0m14:06:20.392848 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:06:20.394850 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:06:20.409878 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:06:20.409878 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:06:20.410878 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:06:21.324554 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.91 seconds
[0m14:06:21.325554 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:06:21.479813 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:06:21.485813 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:06:21.486814 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m14:06:21.486814 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:06:22.155144 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.67 seconds
[0m14:06:22.156138 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m14:06:22.292377 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:06:22.296377 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:06:22.296377 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m14:06:22.296377 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:06:22.919241 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.62 seconds
[0m14:06:22.920235 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m14:06:23.049724 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '23b940bb-85b0-4959-a9b9-366e0e8467b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C44CD5A3A0>]}
[0m14:06:23.050724 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:06:23.051724 [info ] [MainThread]: 
[0m14:06:23.056694 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m14:06:23.057696 [info ] [Thread-1  ]: 1 of 1 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m14:06:23.059197 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:06:23.059197 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m14:06:23.059197 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m14:06:23.068612 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m14:06:23.069615 [debug] [Thread-1  ]: finished collecting timing info
[0m14:06:23.070571 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m14:06:23.120601 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:06:23.121602 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace  view DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp
  
   as (
    

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    WHERE lower(event) in ('register', 'deregister')
        AND event_at <= '2019-06-01 18:17:04.089'

    
        and event_at > (select max(event_at) from DOOR2DOOR_DWH.DBT_stg.registration_events_grouped)
    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



    ,new_deregisters as (
        SELECT
            data_id,
            event_at
        FROM new_events d
        LEFT JOIN new_registers r
            ON d.data_id = r.data_id AND d.event_at = r.deregister_event_at
        WHERE 
            lower(d.event) = 'deregister'
    )
    ,updated_existing_registers as (
        SELECT
            r.data_id,
            r.register_event_at,
            d.event_at as deregister_event_at
            r._unique_key,   
        FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
        LEFT JOIN new_deregisters d ON
            r.data_id = d.data_id   
        WHERE r.deregister_event_at IS NULL
    )

    SELECT * FROM updated_existing_registers
    UNION ALL



SELECT * FROM new_registers
  );
[0m14:06:23.121602 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:06:23.530452 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa20ee-3201-9838-0000-0001c1463475
[0m14:06:23.530452 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 51 at position 12 unexpected 'r'.
syntax error line 52 at position 8 unexpected 'FROM'.
syntax error line 64 at position 2 unexpected ')'.
[0m14:06:23.531459 [debug] [Thread-1  ]: finished collecting timing info
[0m14:06:23.531459 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m14:06:23.669243 [debug] [Thread-1  ]: Database Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)
  001003 (42000): SQL compilation error:
  syntax error line 51 at position 12 unexpected 'r'.
  syntax error line 52 at position 8 unexpected 'FROM'.
  syntax error line 64 at position 2 unexpected ')'.
[0m14:06:23.669243 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '23b940bb-85b0-4959-a9b9-366e0e8467b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C44D0760A0>]}
[0m14:06:23.670245 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model DBT_stg.registration_events_grouped  [[31mERROR[0m in 0.61s]
[0m14:06:23.672214 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m14:06:23.674228 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:06:23.675248 [info ] [MainThread]: 
[0m14:06:23.676215 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 3.28 seconds (3.28s).
[0m14:06:23.676627 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:06:23.676627 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m14:06:23.676627 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_stg' was properly closed.
[0m14:06:23.677641 [debug] [MainThread]: Connection 'model.door2door_dwh.registration_events_grouped' was properly closed.
[0m14:06:23.686639 [info ] [MainThread]: 
[0m14:06:23.687636 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:06:23.688644 [info ] [MainThread]: 
[0m14:06:23.689641 [error] [MainThread]: [33mDatabase Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)[0m
[0m14:06:23.690642 [error] [MainThread]:   001003 (42000): SQL compilation error:
[0m14:06:23.691641 [error] [MainThread]:   syntax error line 51 at position 12 unexpected 'r'.
[0m14:06:23.692657 [error] [MainThread]:   syntax error line 52 at position 8 unexpected 'FROM'.
[0m14:06:23.692657 [error] [MainThread]:   syntax error line 64 at position 2 unexpected ')'.
[0m14:06:23.693642 [info ] [MainThread]: 
[0m14:06:23.694644 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:06:23.694644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C44CC50670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C44CDCBCD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C44D0D0DC0>]}
[0m14:06:23.695641 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 14:07:52.948002 | b78bad6f-8462-41a3-b07b-d7c5aa446a3f ==============================
[0m14:07:52.948002 [info ] [MainThread]: Running with dbt=1.3.1
[0m14:07:52.948002 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['registration_events_grouped'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m14:07:52.948972 [debug] [MainThread]: Tracking: tracking
[0m14:07:52.948972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000012219159D60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000012219159DC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000012219159E20>]}
[0m14:07:53.078972 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:07:53.079971 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\stg\registration_events_grouped.sql
[0m14:07:53.093972 [debug] [MainThread]: 1603: static parser failed on stg\registration_events_grouped.sql
[0m14:07:53.137007 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\registration_events_grouped.sql
[0m14:07:53.157014 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b78bad6f-8462-41a3-b07b-d7c5aa446a3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000122193B00D0>]}
[0m14:07:53.174007 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b78bad6f-8462-41a3-b07b-d7c5aa446a3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001221938A0A0>]}
[0m14:07:53.174007 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m14:07:53.175010 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b78bad6f-8462-41a3-b07b-d7c5aa446a3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001221930DA90>]}
[0m14:07:53.176003 [info ] [MainThread]: 
[0m14:07:53.177018 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:07:53.179003 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:07:53.193013 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:07:53.194003 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:07:53.194003 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:07:54.180789 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.99 seconds
[0m14:07:54.181792 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:07:54.311901 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:07:54.318927 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:07:54.318927 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m14:07:54.319900 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:07:54.730387 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.41 seconds
[0m14:07:54.732398 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m14:07:54.861658 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:07:54.865627 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:07:54.866628 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m14:07:54.866628 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:07:55.267388 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.4 seconds
[0m14:07:55.268381 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m14:07:55.404331 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b78bad6f-8462-41a3-b07b-d7c5aa446a3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001221916E4F0>]}
[0m14:07:55.405331 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:07:55.406303 [info ] [MainThread]: 
[0m14:07:55.411418 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m14:07:55.411418 [info ] [Thread-1  ]: 1 of 1 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m14:07:55.412418 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:07:55.413417 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m14:07:55.413417 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m14:07:55.423418 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m14:07:55.424417 [debug] [Thread-1  ]: finished collecting timing info
[0m14:07:55.424417 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m14:07:55.473447 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:07:55.474447 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace  view DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp
  
   as (
    

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    WHERE lower(event) in ('register', 'deregister')
        AND event_at <= '2019-06-01 18:17:04.089'

    
        and event_at > (select max(event_at) from DOOR2DOOR_DWH.DBT_stg.registration_events_grouped)
    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



    ,new_deregisters as (
        SELECT
            data_id,
            event_at
        FROM new_events d
        LEFT JOIN new_registers r
            ON d.data_id = r.data_id AND d.event_at = r.deregister_event_at
        WHERE 
            lower(d.event) = 'deregister'
            AND r.deregister_event_at IS NULL
    )
    ,updated_existing_registers as (
        SELECT
            r.data_id,
            r.register_event_at,
            d.event_at as deregister_event_at,
            r._unique_key
        FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
        LEFT JOIN new_deregisters d ON
            r.data_id = d.data_id   
        WHERE r.deregister_event_at IS NULL
    )

    SELECT * FROM updated_existing_registers
    UNION ALL



SELECT * FROM new_registers
  );
[0m14:07:55.474447 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:07:56.262521 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa20ef-3201-9a27-0000-0001c14651ed
[0m14:07:56.262521 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 002028 (42601): SQL compilation error:
ambiguous column name 'DATA_ID'
[0m14:07:56.263504 [debug] [Thread-1  ]: finished collecting timing info
[0m14:07:56.263504 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m14:07:56.397019 [debug] [Thread-1  ]: Database Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)
  002028 (42601): SQL compilation error:
  ambiguous column name 'DATA_ID'
[0m14:07:56.397985 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b78bad6f-8462-41a3-b07b-d7c5aa446a3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000122196BF3D0>]}
[0m14:07:56.399014 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model DBT_stg.registration_events_grouped  [[31mERROR[0m in 0.99s]
[0m14:07:56.400168 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m14:07:56.402193 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:07:56.402193 [info ] [MainThread]: 
[0m14:07:56.403207 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 3.23 seconds (3.23s).
[0m14:07:56.404207 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:07:56.404207 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m14:07:56.405193 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_stg' was properly closed.
[0m14:07:56.405193 [debug] [MainThread]: Connection 'model.door2door_dwh.registration_events_grouped' was properly closed.
[0m14:07:56.415219 [info ] [MainThread]: 
[0m14:07:56.416564 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:07:56.417473 [info ] [MainThread]: 
[0m14:07:56.418502 [error] [MainThread]: [33mDatabase Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)[0m
[0m14:07:56.419482 [error] [MainThread]:   002028 (42601): SQL compilation error:
[0m14:07:56.419482 [error] [MainThread]:   ambiguous column name 'DATA_ID'
[0m14:07:56.420483 [info ] [MainThread]: 
[0m14:07:56.421483 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:07:56.422493 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001221937C310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000122196C9700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000122196C9E80>]}
[0m14:07:56.422493 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 14:08:16.966226 | f4160537-cde5-47a6-9d39-6784905f08a2 ==============================
[0m14:08:16.966226 [info ] [MainThread]: Running with dbt=1.3.1
[0m14:08:16.967245 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['registration_events_grouped'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m14:08:16.967245 [debug] [MainThread]: Tracking: tracking
[0m14:08:16.967245 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022F0EF58CD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022F0EF58D30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022F0EF58D90>]}
[0m14:08:17.100229 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:08:17.101229 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\stg\registration_events_grouped.sql
[0m14:08:17.115198 [debug] [MainThread]: 1603: static parser failed on stg\registration_events_grouped.sql
[0m14:08:17.150199 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\registration_events_grouped.sql
[0m14:08:17.171226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f4160537-cde5-47a6-9d39-6784905f08a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022F0F1B20D0>]}
[0m14:08:17.180199 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f4160537-cde5-47a6-9d39-6784905f08a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022F0F18B0A0>]}
[0m14:08:17.181199 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m14:08:17.182199 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f4160537-cde5-47a6-9d39-6784905f08a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022F0F10EA00>]}
[0m14:08:17.183242 [info ] [MainThread]: 
[0m14:08:17.184204 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:08:17.186203 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:08:17.203202 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:08:17.203202 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:08:17.203202 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:08:18.103706 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.9 seconds
[0m14:08:18.105734 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:08:18.233515 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:08:18.239515 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:08:18.240515 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m14:08:18.240515 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:08:18.639278 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.4 seconds
[0m14:08:18.641277 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m14:08:18.775684 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:08:18.778685 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:08:18.779684 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m14:08:18.779684 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:08:19.352776 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.57 seconds
[0m14:08:19.353772 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m14:08:19.489141 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f4160537-cde5-47a6-9d39-6784905f08a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022F0EF6ED60>]}
[0m14:08:19.489141 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:08:19.490141 [info ] [MainThread]: 
[0m14:08:19.495153 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m14:08:19.496134 [info ] [Thread-1  ]: 1 of 1 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m14:08:19.497136 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:08:19.497136 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m14:08:19.498165 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m14:08:19.507134 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m14:08:19.508134 [debug] [Thread-1  ]: finished collecting timing info
[0m14:08:19.508134 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m14:08:19.562133 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:08:19.562133 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace  view DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp
  
   as (
    

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    WHERE lower(event) in ('register', 'deregister')
        AND event_at <= '2019-06-01 18:17:04.089'

    
        and event_at > (select max(event_at) from DOOR2DOOR_DWH.DBT_stg.registration_events_grouped)
    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



    ,new_deregisters as (
        SELECT
            d.data_id,
            d.event_at
        FROM new_events d
        LEFT JOIN new_registers r
            ON d.data_id = r.data_id AND d.event_at = r.deregister_event_at
        WHERE 
            lower(d.event) = 'deregister'
            AND r.deregister_event_at IS NULL
    )
    ,updated_existing_registers as (
        SELECT
            r.data_id,
            r.register_event_at,
            d.event_at as deregister_event_at,
            r._unique_key
        FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
        LEFT JOIN new_deregisters d ON
            r.data_id = d.data_id   
        WHERE r.deregister_event_at IS NULL
    )

    SELECT * FROM updated_existing_registers
    UNION ALL



SELECT * FROM new_registers
  );
[0m14:08:19.562133 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:08:20.003892 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa20f0-3201-9a27-0000-0001c14651f5
[0m14:08:20.003892 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 002036 (42601): SQL compilation error:
Subquery containing correlated aggregate function [MAX(E.EVENT_AT)] can only appear in having or select clause
[0m14:08:20.003892 [debug] [Thread-1  ]: finished collecting timing info
[0m14:08:20.004886 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m14:08:20.136752 [debug] [Thread-1  ]: Database Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)
  002036 (42601): SQL compilation error:
  Subquery containing correlated aggregate function [MAX(E.EVENT_AT)] can only appear in having or select clause
[0m14:08:20.137753 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f4160537-cde5-47a6-9d39-6784905f08a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022F0F46CEB0>]}
[0m14:08:20.137753 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model DBT_stg.registration_events_grouped  [[31mERROR[0m in 0.64s]
[0m14:08:20.139802 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m14:08:20.140805 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:08:20.141831 [info ] [MainThread]: 
[0m14:08:20.142807 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 2.96 seconds (2.96s).
[0m14:08:20.143816 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:08:20.143816 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m14:08:20.144805 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_dwh' was properly closed.
[0m14:08:20.144805 [debug] [MainThread]: Connection 'model.door2door_dwh.registration_events_grouped' was properly closed.
[0m14:08:20.153824 [info ] [MainThread]: 
[0m14:08:20.155170 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:08:20.156180 [info ] [MainThread]: 
[0m14:08:20.157180 [error] [MainThread]: [33mDatabase Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)[0m
[0m14:08:20.158192 [error] [MainThread]:   002036 (42601): SQL compilation error:
[0m14:08:20.159641 [error] [MainThread]:   Subquery containing correlated aggregate function [MAX(E.EVENT_AT)] can only appear in having or select clause
[0m14:08:20.159641 [info ] [MainThread]: 
[0m14:08:20.160654 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:08:20.161654 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022F0F08E670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022F0F510250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022F0F5106A0>]}
[0m14:08:20.161654 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 14:10:08.210692 | b263c17f-437e-47af-b31c-1a91fe62dbbd ==============================
[0m14:10:08.210692 [info ] [MainThread]: Running with dbt=1.3.1
[0m14:10:08.211693 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['registration_events_grouped'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m14:10:08.211693 [debug] [MainThread]: Tracking: tracking
[0m14:10:08.212698 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F231C09D00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F231C09D60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F231C09DC0>]}
[0m14:10:08.350691 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:10:08.351693 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\stg\registration_events_grouped.sql
[0m14:10:08.364693 [debug] [MainThread]: 1603: static parser failed on stg\registration_events_grouped.sql
[0m14:10:08.399693 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\registration_events_grouped.sql
[0m14:10:08.420694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b263c17f-437e-47af-b31c-1a91fe62dbbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F231E620D0>]}
[0m14:10:08.430697 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b263c17f-437e-47af-b31c-1a91fe62dbbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F231E3B0A0>]}
[0m14:10:08.430697 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m14:10:08.431703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b263c17f-437e-47af-b31c-1a91fe62dbbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F231DBEA30>]}
[0m14:10:08.432695 [info ] [MainThread]: 
[0m14:10:08.433695 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:10:08.435694 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:10:08.450693 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:10:08.450693 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:10:08.451695 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:10:09.380046 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.93 seconds
[0m14:10:09.382046 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:10:09.517832 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:10:09.525829 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:10:09.525829 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m14:10:09.526829 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:10:09.935267 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.41 seconds
[0m14:10:09.937271 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m14:10:10.071093 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:10:10.073623 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:10:10.074622 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m14:10:10.074622 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:10:10.675273 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.6 seconds
[0m14:10:10.677279 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m14:10:10.807303 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b263c17f-437e-47af-b31c-1a91fe62dbbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F231E49430>]}
[0m14:10:10.808272 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:10:10.809272 [info ] [MainThread]: 
[0m14:10:10.815273 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m14:10:10.815273 [info ] [Thread-1  ]: 1 of 1 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m14:10:10.817272 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:10:10.817272 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m14:10:10.817272 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m14:10:10.829273 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m14:10:10.830277 [debug] [Thread-1  ]: finished collecting timing info
[0m14:10:10.830277 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m14:10:10.890272 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:10:10.891301 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace  view DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp
  
   as (
    

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LAG(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as prev_event_at
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    WHERE lower(event) in ('register', 'deregister')
        AND event_at <= '2019-06-01 18:17:04.089'

    
        and event_at > (select max(event_at) from DOOR2DOOR_DWH.DBT_stg.registration_events_grouped)
    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



    ,new_deregisters as (
        SELECT
            data_id,
            event_at
        FROM new_events
        WHERE 
            lower(d.event) = 'deregister'
            AND prev_event_at IS NULL
    )
    ,updated_existing_registers as (
        SELECT
            r.data_id,
            r.register_event_at,
            d.event_at as deregister_event_at,
            r._unique_key
        FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
        LEFT JOIN new_deregisters d ON
            r.data_id = d.data_id   
        WHERE r.deregister_event_at IS NULL
    )

    SELECT * FROM updated_existing_registers
    UNION ALL



SELECT * FROM new_registers
  );
[0m14:10:10.891301 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:10:11.323758 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa20f2-3201-9a27-0000-0001c14651fd
[0m14:10:11.323758 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 14 at position 8 unexpected 'LEAD'.
syntax error line 14 at position 13 unexpected 'event_at'.
syntax error line 14 at position 23 unexpected 'OVER'.
syntax error line 14 at position 67 unexpected ')'.
[0m14:10:11.324757 [debug] [Thread-1  ]: finished collecting timing info
[0m14:10:11.324757 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m14:10:11.460287 [debug] [Thread-1  ]: Database Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)
  001003 (42000): SQL compilation error:
  syntax error line 14 at position 8 unexpected 'LEAD'.
  syntax error line 14 at position 13 unexpected 'event_at'.
  syntax error line 14 at position 23 unexpected 'OVER'.
  syntax error line 14 at position 67 unexpected ')'.
[0m14:10:11.461287 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b263c17f-437e-47af-b31c-1a91fe62dbbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F2321C6F40>]}
[0m14:10:11.461287 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model DBT_stg.registration_events_grouped  [[31mERROR[0m in 0.65s]
[0m14:10:11.462287 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m14:10:11.464287 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:10:11.465288 [info ] [MainThread]: 
[0m14:10:11.466290 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 3.03 seconds (3.03s).
[0m14:10:11.467296 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:10:11.467296 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m14:10:11.467296 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_dwh' was properly closed.
[0m14:10:11.467296 [debug] [MainThread]: Connection 'model.door2door_dwh.registration_events_grouped' was properly closed.
[0m14:10:11.478287 [info ] [MainThread]: 
[0m14:10:11.478287 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:10:11.480289 [info ] [MainThread]: 
[0m14:10:11.480289 [error] [MainThread]: [33mDatabase Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)[0m
[0m14:10:11.482294 [error] [MainThread]:   001003 (42000): SQL compilation error:
[0m14:10:11.483508 [error] [MainThread]:   syntax error line 14 at position 8 unexpected 'LEAD'.
[0m14:10:11.483508 [error] [MainThread]:   syntax error line 14 at position 13 unexpected 'event_at'.
[0m14:10:11.484835 [error] [MainThread]:   syntax error line 14 at position 23 unexpected 'OVER'.
[0m14:10:11.484835 [error] [MainThread]:   syntax error line 14 at position 67 unexpected ')'.
[0m14:10:11.485846 [info ] [MainThread]: 
[0m14:10:11.486860 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:10:11.487845 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F231F6F0D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F231D3E670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F2321C1310>]}
[0m14:10:11.487845 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 14:10:27.226965 | 7f00b791-f0a3-46b7-a393-3e81f60a1fb9 ==============================
[0m14:10:27.226965 [info ] [MainThread]: Running with dbt=1.3.1
[0m14:10:27.226965 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['registration_events_grouped'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m14:10:27.227923 [debug] [MainThread]: Tracking: tracking
[0m14:10:27.227923 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A150C18CA0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A150C18D00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A150C18D60>]}
[0m14:10:27.365922 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:10:27.367924 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\stg\registration_events_grouped.sql
[0m14:10:27.395923 [debug] [MainThread]: 1603: static parser failed on stg\registration_events_grouped.sql
[0m14:10:27.436925 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\registration_events_grouped.sql
[0m14:10:27.459963 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7f00b791-f0a3-46b7-a393-3e81f60a1fb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A150E720D0>]}
[0m14:10:27.468952 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7f00b791-f0a3-46b7-a393-3e81f60a1fb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A150E4A0A0>]}
[0m14:10:27.468952 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m14:10:27.469952 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7f00b791-f0a3-46b7-a393-3e81f60a1fb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A150DCE9D0>]}
[0m14:10:27.470953 [info ] [MainThread]: 
[0m14:10:27.472952 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:10:27.473925 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:10:27.489953 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:10:27.489953 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:10:27.489953 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:10:28.354480 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.86 seconds
[0m14:10:28.355478 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:10:28.538265 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:10:28.545265 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:10:28.546265 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m14:10:28.546265 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:10:29.135317 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.59 seconds
[0m14:10:29.136310 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m14:10:29.273027 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:10:29.277053 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:10:29.277053 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m14:10:29.277053 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:10:29.918873 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.64 seconds
[0m14:10:29.920847 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m14:10:30.091335 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7f00b791-f0a3-46b7-a393-3e81f60a1fb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A150C2FD00>]}
[0m14:10:30.092367 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:10:30.093383 [info ] [MainThread]: 
[0m14:10:30.098134 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m14:10:30.099133 [info ] [Thread-1  ]: 1 of 1 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m14:10:30.100087 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:10:30.100087 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m14:10:30.101163 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m14:10:30.110152 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m14:10:30.111115 [debug] [Thread-1  ]: finished collecting timing info
[0m14:10:30.111115 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m14:10:30.162141 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:10:30.162141 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace  view DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp
  
   as (
    

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LAG(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as prev_event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    WHERE lower(event) in ('register', 'deregister')
        AND event_at <= '2019-06-01 18:17:04.089'

    
        and event_at > (select max(event_at) from DOOR2DOOR_DWH.DBT_stg.registration_events_grouped)
    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



    ,new_deregisters as (
        SELECT
            data_id,
            event_at
        FROM new_events
        WHERE 
            lower(d.event) = 'deregister'
            AND prev_event_at IS NULL
    )
    ,updated_existing_registers as (
        SELECT
            r.data_id,
            r.register_event_at,
            d.event_at as deregister_event_at,
            r._unique_key
        FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
        LEFT JOIN new_deregisters d ON
            r.data_id = d.data_id   
        WHERE r.deregister_event_at IS NULL
    )

    SELECT * FROM updated_existing_registers
    UNION ALL



SELECT * FROM new_registers
  );
[0m14:10:30.162141 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:10:30.612685 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa20f2-3201-98a1-0000-0001c1462471
[0m14:10:30.613685 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 43 at position 18
invalid identifier 'D.EVENT'
[0m14:10:30.613685 [debug] [Thread-1  ]: finished collecting timing info
[0m14:10:30.614693 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m14:10:30.751906 [debug] [Thread-1  ]: Database Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)
  000904 (42000): SQL compilation error: error line 43 at position 18
  invalid identifier 'D.EVENT'
[0m14:10:30.752907 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f00b791-f0a3-46b7-a393-3e81f60a1fb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A15113CF40>]}
[0m14:10:30.752907 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model DBT_stg.registration_events_grouped  [[31mERROR[0m in 0.65s]
[0m14:10:30.754896 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m14:10:30.756880 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:10:30.756880 [info ] [MainThread]: 
[0m14:10:30.757881 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 3.28 seconds (3.28s).
[0m14:10:30.758879 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:10:30.758879 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m14:10:30.759896 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_dwh' was properly closed.
[0m14:10:30.759896 [debug] [MainThread]: Connection 'model.door2door_dwh.registration_events_grouped' was properly closed.
[0m14:10:30.768201 [info ] [MainThread]: 
[0m14:10:30.769912 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:10:30.770982 [info ] [MainThread]: 
[0m14:10:30.772000 [error] [MainThread]: [33mDatabase Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)[0m
[0m14:10:30.772991 [error] [MainThread]:   000904 (42000): SQL compilation error: error line 43 at position 18
[0m14:10:30.774008 [error] [MainThread]:   invalid identifier 'D.EVENT'
[0m14:10:30.774992 [info ] [MainThread]: 
[0m14:10:30.774992 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:10:30.775991 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A150E3B250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A150D4F670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A1511D0400>]}
[0m14:10:30.775991 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 14:10:43.097679 | d8bb0654-7abe-4faf-a1b4-af8e53120c54 ==============================
[0m14:10:43.097679 [info ] [MainThread]: Running with dbt=1.3.1
[0m14:10:43.098667 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['registration_events_grouped'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m14:10:43.098667 [debug] [MainThread]: Tracking: tracking
[0m14:10:43.099667 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021A55629CA0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021A55629D00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021A55629D60>]}
[0m14:10:43.226666 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:10:43.226666 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\stg\registration_events_grouped.sql
[0m14:10:43.239666 [debug] [MainThread]: 1603: static parser failed on stg\registration_events_grouped.sql
[0m14:10:43.270666 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\registration_events_grouped.sql
[0m14:10:43.288666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd8bb0654-7abe-4faf-a1b4-af8e53120c54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021A558820D0>]}
[0m14:10:43.297667 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd8bb0654-7abe-4faf-a1b4-af8e53120c54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021A5585B0A0>]}
[0m14:10:43.298667 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m14:10:43.298667 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd8bb0654-7abe-4faf-a1b4-af8e53120c54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021A557DE9D0>]}
[0m14:10:43.299666 [info ] [MainThread]: 
[0m14:10:43.300664 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:10:43.302673 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:10:43.316664 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:10:43.316664 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:10:43.316664 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:10:44.258351 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.94 seconds
[0m14:10:44.259350 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:10:44.394467 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:10:44.400475 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:10:44.401476 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m14:10:44.401476 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:10:44.800913 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.4 seconds
[0m14:10:44.802938 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m14:10:44.933836 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:10:44.936866 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:10:44.936866 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m14:10:44.937838 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:10:45.535882 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.6 seconds
[0m14:10:45.536879 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m14:10:45.672956 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd8bb0654-7abe-4faf-a1b4-af8e53120c54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021A558693A0>]}
[0m14:10:45.673958 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:10:45.674987 [info ] [MainThread]: 
[0m14:10:45.679880 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m14:10:45.680930 [info ] [Thread-1  ]: 1 of 1 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m14:10:45.681906 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:10:45.682892 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m14:10:45.682892 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m14:10:45.691918 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m14:10:45.692890 [debug] [Thread-1  ]: finished collecting timing info
[0m14:10:45.692890 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m14:10:45.743930 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:10:45.744920 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace  view DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp
  
   as (
    

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LAG(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as prev_event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    WHERE lower(event) in ('register', 'deregister')
        AND event_at <= '2019-06-01 18:17:04.089'

    
        and event_at > (select max(event_at) from DOOR2DOOR_DWH.DBT_stg.registration_events_grouped)
    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



    ,new_deregisters as (
        SELECT
            data_id,
            event_at
        FROM new_events
        WHERE 
            lower(event) = 'deregister'
            AND prev_event_at IS NULL
    )
    ,updated_existing_registers as (
        SELECT
            r.data_id,
            r.register_event_at,
            d.event_at as deregister_event_at,
            r._unique_key
        FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
        LEFT JOIN new_deregisters d ON
            r.data_id = d.data_id   
        WHERE r.deregister_event_at IS NULL
    )

    SELECT * FROM updated_existing_registers
    UNION ALL



SELECT * FROM new_registers
  );
[0m14:10:45.744920 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:10:46.216542 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa20f2-3201-98a1-0000-0001c1462475
[0m14:10:46.216542 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 002036 (42601): SQL compilation error:
Subquery containing correlated aggregate function [MAX(E.EVENT_AT)] can only appear in having or select clause
[0m14:10:46.217543 [debug] [Thread-1  ]: finished collecting timing info
[0m14:10:46.217543 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m14:10:46.352829 [debug] [Thread-1  ]: Database Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)
  002036 (42601): SQL compilation error:
  Subquery containing correlated aggregate function [MAX(E.EVENT_AT)] can only appear in having or select clause
[0m14:10:46.353830 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd8bb0654-7abe-4faf-a1b4-af8e53120c54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021A55B850A0>]}
[0m14:10:46.353830 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model DBT_stg.registration_events_grouped  [[31mERROR[0m in 0.67s]
[0m14:10:46.355804 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m14:10:46.357801 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:10:46.357801 [info ] [MainThread]: 
[0m14:10:46.358799 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 3.06 seconds (3.06s).
[0m14:10:46.359819 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:10:46.359819 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m14:10:46.359819 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_stg' was properly closed.
[0m14:10:46.360801 [debug] [MainThread]: Connection 'model.door2door_dwh.registration_events_grouped' was properly closed.
[0m14:10:46.370799 [info ] [MainThread]: 
[0m14:10:46.370799 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:10:46.372372 [info ] [MainThread]: 
[0m14:10:46.373393 [error] [MainThread]: [33mDatabase Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)[0m
[0m14:10:46.374383 [error] [MainThread]:   002036 (42601): SQL compilation error:
[0m14:10:46.375396 [error] [MainThread]:   Subquery containing correlated aggregate function [MAX(E.EVENT_AT)] can only appear in having or select clause
[0m14:10:46.376443 [info ] [MainThread]: 
[0m14:10:46.376443 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:10:46.377384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021A5575E670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021A558DBCD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021A55BEFAC0>]}
[0m14:10:46.378381 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 14:17:46.208724 | 6273e7db-6f14-48e3-baef-d90421f4aedb ==============================
[0m14:17:46.208724 [info ] [MainThread]: Running with dbt=1.3.1
[0m14:17:46.208724 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['registration_events_grouped'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m14:17:46.209731 [debug] [MainThread]: Tracking: tracking
[0m14:17:46.210723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226A5E48C40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226A5E48CA0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226A5E48D00>]}
[0m14:17:46.337720 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:17:46.337720 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\stg\registration_events_grouped.sql
[0m14:17:46.351731 [debug] [MainThread]: 1603: static parser failed on stg\registration_events_grouped.sql
[0m14:17:46.384720 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\registration_events_grouped.sql
[0m14:17:46.403722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6273e7db-6f14-48e3-baef-d90421f4aedb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226A60A20D0>]}
[0m14:17:46.411722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6273e7db-6f14-48e3-baef-d90421f4aedb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226A606C2E0>]}
[0m14:17:46.412723 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m14:17:46.413722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6273e7db-6f14-48e3-baef-d90421f4aedb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226A5E22D30>]}
[0m14:17:46.414722 [info ] [MainThread]: 
[0m14:17:46.415722 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:17:46.417749 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:17:46.433719 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:17:46.434720 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:17:46.434720 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:17:47.416152 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.98 seconds
[0m14:17:47.418150 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:17:47.552107 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:17:47.559125 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:17:47.560127 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m14:17:47.560127 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:17:48.149077 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.59 seconds
[0m14:17:48.150074 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m14:17:48.290392 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:17:48.294365 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:17:48.294365 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m14:17:48.295363 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:17:48.686301 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.39 seconds
[0m14:17:48.687300 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m14:17:48.817384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6273e7db-6f14-48e3-baef-d90421f4aedb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226A5E5ECA0>]}
[0m14:17:48.818387 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:17:48.819414 [info ] [MainThread]: 
[0m14:17:48.825384 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m14:17:48.825384 [info ] [Thread-1  ]: 1 of 1 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m14:17:48.826384 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:17:48.827417 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m14:17:48.827417 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m14:17:48.838426 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m14:17:48.839424 [debug] [Thread-1  ]: finished collecting timing info
[0m14:17:48.840386 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m14:17:48.893415 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:17:48.893415 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace  view DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp
  
   as (
    

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    WHERE lower(event) in ('register', 'deregister')
        AND event_at <= '2019-06-01 18:17:04.089'

    
        and event_at > (select max(event_at) from DOOR2DOOR_DWH.DBT_stg.registration_events_grouped)
    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



    ,new_deregisters as (
        SELECT
            data_id,
            event_at
        FROM new_events d
        LEFT JOIN new_registers r
            ON d.data_id = r.data_id AND d.event_at = r.deregister_event_at
        WHERE 
            lower(d.event) = 'deregister'
            AND r.deregister_event_at IS NULL
    )
    ,updated_existing_registers as (
        SELECT
            r.data_id,
            r.register_event_at,
            d.event_at as deregister_event_at,
            r._unique_key
        FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
        LEFT JOIN new_deregisters d ON
            r.data_id = d.data_id   
        WHERE r.deregister_event_at IS NULL
    )

    SELECT * FROM updated_existing_registers
    UNION ALL



SELECT * FROM new_registers
  );
[0m14:17:48.894414 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:17:49.356279 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa20f9-3201-9838-0000-0001c1463499
[0m14:17:49.356279 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 002028 (42601): SQL compilation error:
ambiguous column name 'DATA_ID'
[0m14:17:49.356279 [debug] [Thread-1  ]: finished collecting timing info
[0m14:17:49.357250 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m14:17:49.488683 [debug] [Thread-1  ]: Database Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)
  002028 (42601): SQL compilation error:
  ambiguous column name 'DATA_ID'
[0m14:17:49.489683 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6273e7db-6f14-48e3-baef-d90421f4aedb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226A6405EE0>]}
[0m14:17:49.489683 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model DBT_stg.registration_events_grouped  [[31mERROR[0m in 0.66s]
[0m14:17:49.491684 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m14:17:49.493684 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:17:49.493684 [info ] [MainThread]: 
[0m14:17:49.494716 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 3.08 seconds (3.08s).
[0m14:17:49.495685 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:17:49.495685 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m14:17:49.496685 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_stg' was properly closed.
[0m14:17:49.496685 [debug] [MainThread]: Connection 'model.door2door_dwh.registration_events_grouped' was properly closed.
[0m14:17:49.505686 [info ] [MainThread]: 
[0m14:17:49.506706 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:17:49.507730 [info ] [MainThread]: 
[0m14:17:49.508703 [error] [MainThread]: [33mDatabase Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)[0m
[0m14:17:49.509683 [error] [MainThread]:   002028 (42601): SQL compilation error:
[0m14:17:49.510685 [error] [MainThread]:   ambiguous column name 'DATA_ID'
[0m14:17:49.511685 [info ] [MainThread]: 
[0m14:17:49.513104 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:17:49.514134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226A5E483A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226A5E67730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226A640EAF0>]}
[0m14:17:49.514134 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 14:18:23.421122 | ab615e91-8a90-4040-b3ed-427eb82fef26 ==============================
[0m14:18:23.421122 [info ] [MainThread]: Running with dbt=1.3.1
[0m14:18:23.422123 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['registration_events_grouped'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m14:18:23.423122 [debug] [MainThread]: Tracking: tracking
[0m14:18:23.423122 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019D5D569DC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019D5D569E20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019D5D569E80>]}
[0m14:18:23.558153 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:18:23.558153 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\stg\registration_events_grouped.sql
[0m14:18:23.571153 [debug] [MainThread]: 1603: static parser failed on stg\registration_events_grouped.sql
[0m14:18:23.604154 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\registration_events_grouped.sql
[0m14:18:23.626132 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ab615e91-8a90-4040-b3ed-427eb82fef26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019D5D7C10D0>]}
[0m14:18:23.635137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ab615e91-8a90-4040-b3ed-427eb82fef26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019D5D79A0A0>]}
[0m14:18:23.635137 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m14:18:23.636124 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ab615e91-8a90-4040-b3ed-427eb82fef26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019D5D71DAF0>]}
[0m14:18:23.638154 [info ] [MainThread]: 
[0m14:18:23.639154 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:18:23.641154 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:18:23.655164 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:18:23.656164 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:18:23.656164 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:18:24.531245 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.88 seconds
[0m14:18:24.533244 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:18:24.678876 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:18:24.685904 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:18:24.685904 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m14:18:24.685904 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:18:25.290109 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.6 seconds
[0m14:18:25.292103 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m14:18:25.423985 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:18:25.426984 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:18:25.427959 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m14:18:25.427959 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:18:25.813490 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.39 seconds
[0m14:18:25.815451 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m14:18:25.957546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ab615e91-8a90-4040-b3ed-427eb82fef26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019D5D672850>]}
[0m14:18:25.958518 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:18:25.959519 [info ] [MainThread]: 
[0m14:18:25.964507 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m14:18:25.964507 [info ] [Thread-1  ]: 1 of 1 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m14:18:25.966545 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:18:25.966545 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m14:18:25.966545 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m14:18:25.976544 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m14:18:25.977519 [debug] [Thread-1  ]: finished collecting timing info
[0m14:18:25.977519 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m14:18:26.028518 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:18:26.029519 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace  view DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp
  
   as (
    

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    WHERE lower(event) in ('register', 'deregister')
        AND event_at <= '2019-06-01 18:17:04.089'

    
        and event_at > (select max(event_at) from DOOR2DOOR_DWH.DBT_stg.registration_events_grouped)
    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



    ,new_deregisters as (
        SELECT
            d.data_id,
            d.event_at
        FROM new_events d
        LEFT JOIN new_registers r
            ON d.data_id = r.data_id AND d.event_at = r.deregister_event_at
        WHERE 
            lower(d.event) = 'deregister'
            AND r.deregister_event_at IS NULL
    )
    ,updated_existing_registers as (
        SELECT
            r.data_id,
            r.register_event_at,
            d.event_at as deregister_event_at,
            r._unique_key
        FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
        LEFT JOIN new_deregisters d ON
            r.data_id = d.data_id   
        WHERE r.deregister_event_at IS NULL
    )

    SELECT * FROM updated_existing_registers
    UNION ALL



SELECT * FROM new_registers
  );
[0m14:18:26.029519 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:18:26.473522 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa20fa-3201-9838-0000-0001c14634a5
[0m14:18:26.474523 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 002036 (42601): SQL compilation error:
Subquery containing correlated aggregate function [MAX(E.EVENT_AT)] can only appear in having or select clause
[0m14:18:26.474523 [debug] [Thread-1  ]: finished collecting timing info
[0m14:18:26.475522 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m14:18:26.630716 [debug] [Thread-1  ]: Database Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)
  002036 (42601): SQL compilation error:
  Subquery containing correlated aggregate function [MAX(E.EVENT_AT)] can only appear in having or select clause
[0m14:18:26.631683 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ab615e91-8a90-4040-b3ed-427eb82fef26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019D5DB25F10>]}
[0m14:18:26.631683 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model DBT_stg.registration_events_grouped  [[31mERROR[0m in 0.67s]
[0m14:18:26.633232 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m14:18:26.635276 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:18:26.636284 [info ] [MainThread]: 
[0m14:18:26.636284 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 3.00 seconds (3.00s).
[0m14:18:26.637285 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:18:26.637285 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m14:18:26.638268 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_stg' was properly closed.
[0m14:18:26.638268 [debug] [MainThread]: Connection 'model.door2door_dwh.registration_events_grouped' was properly closed.
[0m14:18:26.647261 [info ] [MainThread]: 
[0m14:18:26.648270 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:18:26.650166 [info ] [MainThread]: 
[0m14:18:26.650166 [error] [MainThread]: [33mDatabase Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)[0m
[0m14:18:26.652189 [error] [MainThread]:   002036 (42601): SQL compilation error:
[0m14:18:26.653190 [error] [MainThread]:   Subquery containing correlated aggregate function [MAX(E.EVENT_AT)] can only appear in having or select clause
[0m14:18:26.653190 [info ] [MainThread]: 
[0m14:18:26.654189 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:18:26.655195 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019D5D78FBE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019D5DACDDF0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019D5DACDC70>]}
[0m14:18:26.655195 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 14:20:05.467686 | 25f5c36a-c6d6-4f81-8ebe-4766cde7cb94 ==============================
[0m14:20:05.467686 [info ] [MainThread]: Running with dbt=1.3.1
[0m14:20:05.468694 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['registration_events_grouped'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m14:20:05.468694 [debug] [MainThread]: Tracking: tracking
[0m14:20:05.468694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029F877B9D60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029F877B9DC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029F877B9E20>]}
[0m14:20:05.599691 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:20:05.600691 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\stg\registration_events_grouped.sql
[0m14:20:05.613690 [debug] [MainThread]: 1603: static parser failed on stg\registration_events_grouped.sql
[0m14:20:05.650691 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\registration_events_grouped.sql
[0m14:20:05.671688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '25f5c36a-c6d6-4f81-8ebe-4766cde7cb94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029F87A100D0>]}
[0m14:20:05.681687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '25f5c36a-c6d6-4f81-8ebe-4766cde7cb94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029F879EB0A0>]}
[0m14:20:05.681687 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m14:20:05.682688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '25f5c36a-c6d6-4f81-8ebe-4766cde7cb94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029F8796DA90>]}
[0m14:20:05.683689 [info ] [MainThread]: 
[0m14:20:05.684707 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:20:05.686710 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:20:05.700717 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:20:05.701718 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:20:05.701718 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:20:06.660586 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.96 seconds
[0m14:20:06.662559 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:20:06.795867 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:20:06.802867 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:20:06.802867 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m14:20:06.803839 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:20:07.383890 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.58 seconds
[0m14:20:07.385916 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m14:20:07.522034 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:20:07.524570 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:20:07.525569 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m14:20:07.525569 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:20:07.949361 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.42 seconds
[0m14:20:07.950354 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m14:20:08.085892 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '25f5c36a-c6d6-4f81-8ebe-4766cde7cb94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029F879FB430>]}
[0m14:20:08.086873 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:20:08.086873 [info ] [MainThread]: 
[0m14:20:08.092602 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m14:20:08.093612 [info ] [Thread-1  ]: 1 of 1 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m14:20:08.094613 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:20:08.094613 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m14:20:08.094613 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m14:20:08.104613 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m14:20:08.105641 [debug] [Thread-1  ]: finished collecting timing info
[0m14:20:08.106611 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m14:20:08.156654 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:20:08.157651 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace  view DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp
  
   as (
    

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    WHERE lower(event) in ('register', 'deregister')
        AND event_at <= '2019-06-01 18:17:04.089'

    
        and event_at > (select max(event_at) from DOOR2DOOR_DWH.DBT_stg.registration_events_grouped)
    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



    ,new_deregisters as (
        SELECT
            d.data_id,
            d.event_at
        FROM new_events d
        LEFT JOIN new_registers r
            ON d.data_id = r.data_id AND d.event_at = r.deregister_event_at
        WHERE 
            lower(d.event) = 'deregister'
            AND r.deregister_event_at IS NULL
    )
    ,open_registers as (
        SELECT *
        FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped
        WHERE r.deregister_event_at IS NULL
    )
    ,updated_existing_registers as (
        SELECT
            r.data_id,
            r.register_event_at,
            d.event_at as deregister_event_at,
            r._unique_key
        FROM new_deregisters d
        LEFT JOIN open_registers r ON
            r.data_id = d.data_id
    )

    SELECT * FROM updated_existing_registers
    UNION ALL



SELECT * FROM new_registers
  );
[0m14:20:08.157651 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:20:08.591644 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa20fc-3201-98a1-0000-0001c146247d
[0m14:20:08.592643 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 50 at position 14
invalid identifier 'R.DEREGISTER_EVENT_AT'
[0m14:20:08.592643 [debug] [Thread-1  ]: finished collecting timing info
[0m14:20:08.592643 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m14:20:08.725549 [debug] [Thread-1  ]: Database Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)
  000904 (42000): SQL compilation error: error line 50 at position 14
  invalid identifier 'R.DEREGISTER_EVENT_AT'
[0m14:20:08.726549 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '25f5c36a-c6d6-4f81-8ebe-4766cde7cb94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029F87D76F40>]}
[0m14:20:08.726549 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model DBT_stg.registration_events_grouped  [[31mERROR[0m in 0.63s]
[0m14:20:08.728546 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m14:20:08.730548 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:20:08.730548 [info ] [MainThread]: 
[0m14:20:08.731547 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 3.05 seconds (3.05s).
[0m14:20:08.732548 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:20:08.732548 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m14:20:08.732548 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_dwh' was properly closed.
[0m14:20:08.733548 [debug] [MainThread]: Connection 'model.door2door_dwh.registration_events_grouped' was properly closed.
[0m14:20:08.743602 [info ] [MainThread]: 
[0m14:20:08.744547 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:20:08.745547 [info ] [MainThread]: 
[0m14:20:08.746573 [error] [MainThread]: [33mDatabase Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)[0m
[0m14:20:08.747548 [error] [MainThread]:   000904 (42000): SQL compilation error: error line 50 at position 14
[0m14:20:08.748549 [error] [MainThread]:   invalid identifier 'R.DEREGISTER_EVENT_AT'
[0m14:20:08.748549 [info ] [MainThread]: 
[0m14:20:08.749548 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:20:08.750550 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029F879DD310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029F87C19340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029F87C19940>]}
[0m14:20:08.750550 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 14:20:29.914727 | 7168bdf5-43b3-42ef-8ae1-38bad838c748 ==============================
[0m14:20:29.914727 [info ] [MainThread]: Running with dbt=1.3.1
[0m14:20:29.915731 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['registration_events_grouped'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m14:20:29.915731 [debug] [MainThread]: Tracking: tracking
[0m14:20:29.916707 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E75B968D90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E75B968DF0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E75B968E50>]}
[0m14:20:30.044727 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:20:30.045728 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\stg\registration_events_grouped.sql
[0m14:20:30.057739 [debug] [MainThread]: 1603: static parser failed on stg\registration_events_grouped.sql
[0m14:20:30.089729 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\registration_events_grouped.sql
[0m14:20:30.108727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7168bdf5-43b3-42ef-8ae1-38bad838c748', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E75BBC30D0>]}
[0m14:20:30.117729 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7168bdf5-43b3-42ef-8ae1-38bad838c748', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E75BB9A0A0>]}
[0m14:20:30.118701 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m14:20:30.118701 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7168bdf5-43b3-42ef-8ae1-38bad838c748', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E75BB1DAC0>]}
[0m14:20:30.120703 [info ] [MainThread]: 
[0m14:20:30.121728 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:20:30.122698 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:20:30.136698 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:20:30.137699 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:20:30.137699 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:20:30.982103 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.84 seconds
[0m14:20:30.983103 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:20:31.106029 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:20:31.114029 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:20:31.114029 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m14:20:31.115029 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:20:31.508023 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.39 seconds
[0m14:20:31.509018 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m14:20:31.641250 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:20:31.645215 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:20:31.646214 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m14:20:31.646214 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:20:32.044032 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.4 seconds
[0m14:20:32.045026 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m14:20:32.174076 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7168bdf5-43b3-42ef-8ae1-38bad838c748', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E75B97E640>]}
[0m14:20:32.175075 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:20:32.176050 [info ] [MainThread]: 
[0m14:20:32.181050 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m14:20:32.182075 [info ] [Thread-1  ]: 1 of 1 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m14:20:32.183051 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:20:32.183051 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m14:20:32.184047 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m14:20:32.193085 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m14:20:32.193085 [debug] [Thread-1  ]: finished collecting timing info
[0m14:20:32.194080 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m14:20:32.245047 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:20:32.245047 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace  view DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp
  
   as (
    

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    WHERE lower(event) in ('register', 'deregister')
        AND event_at <= '2019-06-01 18:17:04.089'

    
        and event_at > (select max(event_at) from DOOR2DOOR_DWH.DBT_stg.registration_events_grouped)
    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



    ,new_deregisters as (
        SELECT
            d.data_id,
            d.event_at
        FROM new_events d
        LEFT JOIN new_registers r
            ON d.data_id = r.data_id AND d.event_at = r.deregister_event_at
        WHERE 
            lower(d.event) = 'deregister'
            AND r.deregister_event_at IS NULL
    )
    ,open_registers as (
        SELECT *
        FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped
        WHERE deregister_event_at IS NULL
    )
    ,updated_existing_registers as (
        SELECT
            r.data_id,
            r.register_event_at,
            d.event_at as deregister_event_at,
            r._unique_key
        FROM new_deregisters d
        LEFT JOIN open_registers r ON
            r.data_id = d.data_id
    )

    SELECT * FROM updated_existing_registers
    UNION ALL



SELECT * FROM new_registers
  );
[0m14:20:32.246048 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:20:32.671183 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa20fc-3201-9838-0000-0001c14634b5
[0m14:20:32.671183 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 002036 (42601): SQL compilation error:
Subquery containing correlated aggregate function [MAX(E.EVENT_AT)] can only appear in having or select clause
[0m14:20:32.672154 [debug] [Thread-1  ]: finished collecting timing info
[0m14:20:32.672663 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m14:20:32.799985 [debug] [Thread-1  ]: Database Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)
  002036 (42601): SQL compilation error:
  Subquery containing correlated aggregate function [MAX(E.EVENT_AT)] can only appear in having or select clause
[0m14:20:32.800979 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7168bdf5-43b3-42ef-8ae1-38bad838c748', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E75BF23670>]}
[0m14:20:32.800979 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model DBT_stg.registration_events_grouped  [[31mERROR[0m in 0.62s]
[0m14:20:32.801978 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m14:20:32.803978 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:20:32.803978 [info ] [MainThread]: 
[0m14:20:32.804977 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 2.68 seconds (2.68s).
[0m14:20:32.805980 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:20:32.805980 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m14:20:32.805980 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_dwh' was properly closed.
[0m14:20:32.805980 [debug] [MainThread]: Connection 'model.door2door_dwh.registration_events_grouped' was properly closed.
[0m14:20:32.816982 [info ] [MainThread]: 
[0m14:20:32.817983 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:20:32.819997 [info ] [MainThread]: 
[0m14:20:32.820986 [error] [MainThread]: [33mDatabase Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)[0m
[0m14:20:32.822012 [error] [MainThread]:   002036 (42601): SQL compilation error:
[0m14:20:32.822989 [error] [MainThread]:   Subquery containing correlated aggregate function [MAX(E.EVENT_AT)] can only appear in having or select clause
[0m14:20:32.823986 [info ] [MainThread]: 
[0m14:20:32.825071 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:20:32.827980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E75BB8C340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E75BF212B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E75BF21FA0>]}
[0m14:20:32.827980 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 14:20:54.224872 | b15061a4-a631-4dd5-aac2-5ead40e59f88 ==============================
[0m14:20:54.224872 [info ] [MainThread]: Running with dbt=1.3.1
[0m14:20:54.225872 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['registration_events_grouped'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m14:20:54.225872 [debug] [MainThread]: Tracking: tracking
[0m14:20:54.226842 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B991F18C40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B991F18CA0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B991F18D00>]}
[0m14:20:54.357872 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:20:54.357872 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\stg\registration_events_grouped.sql
[0m14:20:54.372890 [debug] [MainThread]: 1603: static parser failed on stg\registration_events_grouped.sql
[0m14:20:54.405875 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\registration_events_grouped.sql
[0m14:20:54.425842 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b15061a4-a631-4dd5-aac2-5ead40e59f88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9921740D0>]}
[0m14:20:54.434843 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b15061a4-a631-4dd5-aac2-5ead40e59f88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B99213C2E0>]}
[0m14:20:54.435844 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m14:20:54.436847 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b15061a4-a631-4dd5-aac2-5ead40e59f88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B991EF1D30>]}
[0m14:20:54.437843 [info ] [MainThread]: 
[0m14:20:54.438850 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:20:54.439845 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:20:54.453872 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:20:54.453872 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:20:54.454872 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:20:55.285832 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.83 seconds
[0m14:20:55.286832 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:20:55.422823 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:20:55.429823 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:20:55.429823 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m14:20:55.429823 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:20:56.023400 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.59 seconds
[0m14:20:56.024395 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m14:20:56.159303 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:20:56.162306 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:20:56.163303 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m14:20:56.163303 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:20:56.561898 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.4 seconds
[0m14:20:56.563890 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m14:20:56.694919 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b15061a4-a631-4dd5-aac2-5ead40e59f88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B991F2ECA0>]}
[0m14:20:56.695905 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:20:56.696904 [info ] [MainThread]: 
[0m14:20:56.701574 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m14:20:56.702613 [info ] [Thread-1  ]: 1 of 1 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m14:20:56.703584 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:20:56.703584 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m14:20:56.704587 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m14:20:56.713612 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m14:20:56.714587 [debug] [Thread-1  ]: finished collecting timing info
[0m14:20:56.714587 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m14:20:56.764612 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:20:56.764612 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace  view DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp
  
   as (
    

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    WHERE lower(event) in ('register', 'deregister')
        AND event_at <= '2019-06-01 18:17:04.089'

    
        and event_at > (select max(event_at) from DOOR2DOOR_DWH.DBT_stg.registration_events_grouped)
    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



    ,new_deregisters as (
        SELECT
            d.data_id,
            d.event_at
        FROM new_events d
        LEFT JOIN new_registers r
            ON d.data_id = r.data_id AND d.event_at = r.deregister_event_at
        WHERE 
            lower(d.event) = 'deregister'
            AND r.deregister_event_at IS NULL
    )
    ,open_registers as (
        SELECT *
        FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped
        WHERE deregister_event_at IS NULL
    )
    ,updated_existing_registers as (
        SELECT
            r.data_id,
            r.register_event_at,
            d.event_at as deregister_event_at,
            r._unique_key
        FROM new_deregisters d
        LEFT JOIN open_registers r ON
            r.data_id = d.data_id
    )



SELECT * FROM updated_existing_registers
UNION ALL
SELECT * FROM new_registers
  );
[0m14:20:56.764612 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:20:57.207698 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa20fc-3201-9838-0000-0001c14634c1
[0m14:20:57.207698 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 002036 (42601): SQL compilation error:
Subquery containing correlated aggregate function [MAX(E.EVENT_AT)] can only appear in having or select clause
[0m14:20:57.208694 [debug] [Thread-1  ]: finished collecting timing info
[0m14:20:57.208694 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m14:20:57.344646 [debug] [Thread-1  ]: Database Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)
  002036 (42601): SQL compilation error:
  Subquery containing correlated aggregate function [MAX(E.EVENT_AT)] can only appear in having or select clause
[0m14:20:57.345647 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b15061a4-a631-4dd5-aac2-5ead40e59f88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B992321B50>]}
[0m14:20:57.345647 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model DBT_stg.registration_events_grouped  [[31mERROR[0m in 0.64s]
[0m14:20:57.346891 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m14:20:57.348924 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:20:57.349955 [info ] [MainThread]: 
[0m14:20:57.350930 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 2.91 seconds (2.91s).
[0m14:20:57.350930 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:20:57.351939 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m14:20:57.351939 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_dwh' was properly closed.
[0m14:20:57.351939 [debug] [MainThread]: Connection 'model.door2door_dwh.registration_events_grouped' was properly closed.
[0m14:20:57.362921 [info ] [MainThread]: 
[0m14:20:57.363925 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:20:57.364937 [info ] [MainThread]: 
[0m14:20:57.366957 [error] [MainThread]: [33mDatabase Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)[0m
[0m14:20:57.368921 [error] [MainThread]:   002036 (42601): SQL compilation error:
[0m14:20:57.368921 [error] [MainThread]:   Subquery containing correlated aggregate function [MAX(E.EVENT_AT)] can only appear in having or select clause
[0m14:20:57.369950 [info ] [MainThread]: 
[0m14:20:57.370972 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:20:57.371925 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9922C2D90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B991F39730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9924DEAF0>]}
[0m14:20:57.371925 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 14:28:06.646532 | 88896ff4-cd9f-4856-be70-a76e0516e523 ==============================
[0m14:28:06.646532 [info ] [MainThread]: Running with dbt=1.3.1
[0m14:28:06.647513 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['registration_events_grouped'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m14:28:06.647513 [debug] [MainThread]: Tracking: tracking
[0m14:28:06.648483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F2C7B89D60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F2C7B89DC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F2C7B89E20>]}
[0m14:28:06.865486 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:28:06.865486 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\stg\registration_events_grouped.sql
[0m14:28:06.885484 [debug] [MainThread]: 1603: static parser failed on stg\registration_events_grouped.sql
[0m14:28:06.930483 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\registration_events_grouped.sql
[0m14:28:06.955485 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '88896ff4-cd9f-4856-be70-a76e0516e523', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F2C7DE20D0>]}
[0m14:28:06.966488 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '88896ff4-cd9f-4856-be70-a76e0516e523', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F2C7DBA0A0>]}
[0m14:28:06.967495 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m14:28:06.968486 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '88896ff4-cd9f-4856-be70-a76e0516e523', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F2C7D3DA90>]}
[0m14:28:06.969485 [info ] [MainThread]: 
[0m14:28:06.970494 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:28:06.972484 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:28:06.992524 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:28:06.992524 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:28:06.992524 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:28:08.033649 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 1.04 seconds
[0m14:28:08.034650 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:28:08.173222 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:28:08.180232 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:28:08.180232 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m14:28:08.180232 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:28:08.760153 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.58 seconds
[0m14:28:08.761147 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m14:28:08.892720 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:28:08.896682 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:28:08.897682 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m14:28:08.897682 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:28:09.320986 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.42 seconds
[0m14:28:09.322971 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m14:28:09.457021 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '88896ff4-cd9f-4856-be70-a76e0516e523', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F2C7B9E4F0>]}
[0m14:28:09.457021 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:28:09.458021 [info ] [MainThread]: 
[0m14:28:09.464272 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m14:28:09.464272 [info ] [Thread-1  ]: 1 of 1 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m14:28:09.465282 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:28:09.466314 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m14:28:09.466314 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m14:28:09.476284 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m14:28:09.477282 [debug] [Thread-1  ]: finished collecting timing info
[0m14:28:09.477282 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m14:28:09.526280 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:28:09.526280 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace  view DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp
  
   as (
    

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LAG(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as prev_event_at
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    WHERE lower(event) in ('register', 'deregister')
        AND event_at <= '2019-06-01 18:17:04.089'

    
        and event_at > (select max(event_at) from DOOR2DOOR_DWH.DBT_stg.registration_events_grouped)
    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



    ,new_deregisters as (
        SELECT
            data_id,
            event_at
        FROM new_events
        WHERE 
            lower(d.event) = 'deregister'
            AND prev_event_at IS NULL
    )
    ,open_registers as (
        SELECT *
        FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped
        WHERE deregister_event_at IS NULL
    )
    ,updated_existing_registers as (
        SELECT
            r.data_id,
            r.register_event_at,
            d.event_at as deregister_event_at,
            r._unique_key
        FROM new_deregisters d
        INNER JOIN open_registers r ON
            r.data_id = d.data_id
    )



SELECT * FROM updated_existing_registers
UNION ALL
SELECT * FROM new_registers
  );
[0m14:28:09.526280 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:28:09.918802 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa2104-3201-9a27-0000-0001c1465255
[0m14:28:09.918802 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 14 at position 8 unexpected 'LEAD'.
syntax error line 14 at position 13 unexpected 'event_at'.
syntax error line 14 at position 23 unexpected 'OVER'.
syntax error line 14 at position 67 unexpected ')'.
[0m14:28:09.918802 [debug] [Thread-1  ]: finished collecting timing info
[0m14:28:09.920042 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m14:28:10.046055 [debug] [Thread-1  ]: Database Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)
  001003 (42000): SQL compilation error:
  syntax error line 14 at position 8 unexpected 'LEAD'.
  syntax error line 14 at position 13 unexpected 'event_at'.
  syntax error line 14 at position 23 unexpected 'OVER'.
  syntax error line 14 at position 67 unexpected ')'.
[0m14:28:10.047054 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '88896ff4-cd9f-4856-be70-a76e0516e523', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F2C80EE3D0>]}
[0m14:28:10.047054 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model DBT_stg.registration_events_grouped  [[31mERROR[0m in 0.58s]
[0m14:28:10.049025 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m14:28:10.051025 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:28:10.051025 [info ] [MainThread]: 
[0m14:28:10.052024 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 3.08 seconds (3.08s).
[0m14:28:10.053029 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:28:10.053029 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m14:28:10.053029 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_stg' was properly closed.
[0m14:28:10.054029 [debug] [MainThread]: Connection 'model.door2door_dwh.registration_events_grouped' was properly closed.
[0m14:28:10.064029 [info ] [MainThread]: 
[0m14:28:10.065078 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:28:10.066093 [info ] [MainThread]: 
[0m14:28:10.066093 [error] [MainThread]: [33mDatabase Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)[0m
[0m14:28:10.068109 [error] [MainThread]:   001003 (42000): SQL compilation error:
[0m14:28:10.068109 [error] [MainThread]:   syntax error line 14 at position 8 unexpected 'LEAD'.
[0m14:28:10.069089 [error] [MainThread]:   syntax error line 14 at position 13 unexpected 'event_at'.
[0m14:28:10.070108 [error] [MainThread]:   syntax error line 14 at position 23 unexpected 'OVER'.
[0m14:28:10.070108 [error] [MainThread]:   syntax error line 14 at position 67 unexpected ')'.
[0m14:28:10.071100 [info ] [MainThread]: 
[0m14:28:10.072090 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:28:10.072090 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F2C7DAD310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F2C80EC880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F2C80EC370>]}
[0m14:28:10.073090 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 14:28:20.643064 | 4cec787e-08a7-4fc2-ad9e-71feb44cc31e ==============================
[0m14:28:20.643064 [info ] [MainThread]: Running with dbt=1.3.1
[0m14:28:20.644064 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['registration_events_grouped'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m14:28:20.644064 [debug] [MainThread]: Tracking: tracking
[0m14:28:20.645061 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000195F5DA9CA0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000195F5DA9D00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000195F5DA9D60>]}
[0m14:28:20.779091 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:28:20.780091 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\stg\registration_events_grouped.sql
[0m14:28:20.794090 [debug] [MainThread]: 1603: static parser failed on stg\registration_events_grouped.sql
[0m14:28:20.829091 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\registration_events_grouped.sql
[0m14:28:20.847091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4cec787e-08a7-4fc2-ad9e-71feb44cc31e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000195F60040D0>]}
[0m14:28:20.857062 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4cec787e-08a7-4fc2-ad9e-71feb44cc31e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000195F5FDB0A0>]}
[0m14:28:20.857062 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m14:28:20.858072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4cec787e-08a7-4fc2-ad9e-71feb44cc31e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000195F5F5E9D0>]}
[0m14:28:20.859062 [info ] [MainThread]: 
[0m14:28:20.860063 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:28:20.862107 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:28:20.876112 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:28:20.877122 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:28:20.877122 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:28:21.821772 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.94 seconds
[0m14:28:21.822774 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:28:21.958848 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:28:21.965873 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:28:21.966847 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m14:28:21.966847 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:28:22.549820 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.58 seconds
[0m14:28:22.551871 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m14:28:22.680586 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:28:22.684616 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:28:22.684616 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m14:28:22.684616 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:28:23.279411 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.59 seconds
[0m14:28:23.281438 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m14:28:23.407895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4cec787e-08a7-4fc2-ad9e-71feb44cc31e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000195F5DBECD0>]}
[0m14:28:23.408872 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:28:23.409843 [info ] [MainThread]: 
[0m14:28:23.414400 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m14:28:23.414400 [info ] [Thread-1  ]: 1 of 1 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m14:28:23.416400 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:28:23.416400 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m14:28:23.417403 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m14:28:23.428450 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m14:28:23.429402 [debug] [Thread-1  ]: finished collecting timing info
[0m14:28:23.429402 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m14:28:23.480401 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:28:23.480401 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace  view DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp
  
   as (
    

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LAG(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as prev_event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    WHERE lower(event) in ('register', 'deregister')
        AND event_at <= '2019-06-01 18:17:04.089'

    
        and event_at > (select max(event_at) from DOOR2DOOR_DWH.DBT_stg.registration_events_grouped)
    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



    ,new_deregisters as (
        SELECT
            data_id,
            event_at
        FROM new_events
        WHERE 
            lower(d.event) = 'deregister'
            AND prev_event_at IS NULL
    )
    ,open_registers as (
        SELECT *
        FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped
        WHERE deregister_event_at IS NULL
    )
    ,updated_existing_registers as (
        SELECT
            r.data_id,
            r.register_event_at,
            d.event_at as deregister_event_at,
            r._unique_key
        FROM new_deregisters d
        INNER JOIN open_registers r ON
            r.data_id = d.data_id
    )



SELECT * FROM updated_existing_registers
UNION ALL
SELECT * FROM new_registers
  );
[0m14:28:23.480401 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:28:23.919134 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa2104-3201-9838-0000-0001c14634d5
[0m14:28:23.919134 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 43 at position 18
invalid identifier 'D.EVENT'
[0m14:28:23.920105 [debug] [Thread-1  ]: finished collecting timing info
[0m14:28:23.920105 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m14:28:24.052959 [debug] [Thread-1  ]: Database Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)
  000904 (42000): SQL compilation error: error line 43 at position 18
  invalid identifier 'D.EVENT'
[0m14:28:24.053958 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4cec787e-08a7-4fc2-ad9e-71feb44cc31e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000195F62C6130>]}
[0m14:28:24.053958 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model DBT_stg.registration_events_grouped  [[31mERROR[0m in 0.64s]
[0m14:28:24.055962 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m14:28:24.056959 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:28:24.057960 [info ] [MainThread]: 
[0m14:28:24.058960 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 3.20 seconds (3.20s).
[0m14:28:24.058960 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:28:24.059960 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m14:28:24.059960 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_dwh' was properly closed.
[0m14:28:24.059960 [debug] [MainThread]: Connection 'model.door2door_dwh.registration_events_grouped' was properly closed.
[0m14:28:24.072959 [info ] [MainThread]: 
[0m14:28:24.072959 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:28:24.074963 [info ] [MainThread]: 
[0m14:28:24.075980 [error] [MainThread]: [33mDatabase Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)[0m
[0m14:28:24.078971 [error] [MainThread]:   000904 (42000): SQL compilation error: error line 43 at position 18
[0m14:28:24.079961 [error] [MainThread]:   invalid identifier 'D.EVENT'
[0m14:28:24.080962 [info ] [MainThread]: 
[0m14:28:24.080962 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:28:24.081961 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000195F5FCC250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000195F5EDF670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000195F6362190>]}
[0m14:28:24.082959 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 14:28:34.211185 | 39b08db0-006e-4d36-98a2-fa6b7196637b ==============================
[0m14:28:34.211185 [info ] [MainThread]: Running with dbt=1.3.1
[0m14:28:34.211185 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['registration_events_grouped'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m14:28:34.212142 [debug] [MainThread]: Tracking: tracking
[0m14:28:34.212142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F8FF7C8D00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F8FF7C8D60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F8FF7C8DC0>]}
[0m14:28:34.354139 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:28:34.355140 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\stg\registration_events_grouped.sql
[0m14:28:34.367139 [debug] [MainThread]: 1603: static parser failed on stg\registration_events_grouped.sql
[0m14:28:34.418142 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\registration_events_grouped.sql
[0m14:28:34.463142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '39b08db0-006e-4d36-98a2-fa6b7196637b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F8FFA230D0>]}
[0m14:28:34.484142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '39b08db0-006e-4d36-98a2-fa6b7196637b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F8FF9FA0A0>]}
[0m14:28:34.485141 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m14:28:34.486141 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '39b08db0-006e-4d36-98a2-fa6b7196637b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F8FF97DA30>]}
[0m14:28:34.488142 [info ] [MainThread]: 
[0m14:28:34.490143 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:28:34.492142 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:28:34.514142 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:28:34.515144 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:28:34.517151 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:28:35.337254 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.82 seconds
[0m14:28:35.339284 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:28:35.468746 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:28:35.475744 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:28:35.476743 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m14:28:35.476743 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:28:35.882819 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.41 seconds
[0m14:28:35.884823 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m14:28:36.012964 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:28:36.017960 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:28:36.017960 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m14:28:36.018963 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:28:36.601273 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.58 seconds
[0m14:28:36.603290 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m14:28:36.736914 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '39b08db0-006e-4d36-98a2-fa6b7196637b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F8FFA0B430>]}
[0m14:28:36.738966 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:28:36.739914 [info ] [MainThread]: 
[0m14:28:36.744680 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m14:28:36.745709 [info ] [Thread-1  ]: 1 of 1 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m14:28:36.746722 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:28:36.747722 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m14:28:36.747722 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m14:28:36.759747 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m14:28:36.760722 [debug] [Thread-1  ]: finished collecting timing info
[0m14:28:36.760722 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m14:28:36.819721 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:28:36.819721 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace  view DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp
  
   as (
    

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LAG(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as prev_event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    WHERE lower(event) in ('register', 'deregister')
        AND event_at <= '2019-06-01 18:17:04.089'

    
        and event_at > (select max(event_at) from DOOR2DOOR_DWH.DBT_stg.registration_events_grouped)
    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



    ,new_deregisters as (
        SELECT
            data_id,
            event_at
        FROM new_events
        WHERE 
            lower(event) = 'deregister'
            AND prev_event_at IS NULL
    )
    ,open_registers as (
        SELECT *
        FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped
        WHERE deregister_event_at IS NULL
    )
    ,updated_existing_registers as (
        SELECT
            r.data_id,
            r.register_event_at,
            d.event_at as deregister_event_at,
            r._unique_key
        FROM new_deregisters d
        INNER JOIN open_registers r ON
            r.data_id = d.data_id
    )



SELECT * FROM updated_existing_registers
UNION ALL
SELECT * FROM new_registers
  );
[0m14:28:36.819721 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:28:37.425075 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa2104-3201-98a1-0000-0001c146249d
[0m14:28:37.425075 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 002036 (42601): SQL compilation error:
Subquery containing correlated aggregate function [MAX(E.EVENT_AT)] can only appear in having or select clause
[0m14:28:37.426073 [debug] [Thread-1  ]: finished collecting timing info
[0m14:28:37.426073 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m14:28:37.564936 [debug] [Thread-1  ]: Database Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)
  002036 (42601): SQL compilation error:
  Subquery containing correlated aggregate function [MAX(E.EVENT_AT)] can only appear in having or select clause
[0m14:28:37.565941 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '39b08db0-006e-4d36-98a2-fa6b7196637b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F8FFD85F40>]}
[0m14:28:37.566938 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model DBT_stg.registration_events_grouped  [[31mERROR[0m in 0.82s]
[0m14:28:37.567699 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m14:28:37.569725 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:28:37.570738 [info ] [MainThread]: 
[0m14:28:37.571716 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 3.08 seconds (3.08s).
[0m14:28:37.571716 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:28:37.572709 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m14:28:37.572709 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_dwh' was properly closed.
[0m14:28:37.572709 [debug] [MainThread]: Connection 'model.door2door_dwh.registration_events_grouped' was properly closed.
[0m14:28:37.582714 [info ] [MainThread]: 
[0m14:28:37.583759 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:28:37.584710 [info ] [MainThread]: 
[0m14:28:37.585709 [error] [MainThread]: [33mDatabase Error in model registration_events_grouped (models\stg\registration_events_grouped.sql)[0m
[0m14:28:37.587592 [error] [MainThread]:   002036 (42601): SQL compilation error:
[0m14:28:37.587592 [error] [MainThread]:   Subquery containing correlated aggregate function [MAX(E.EVENT_AT)] can only appear in having or select clause
[0m14:28:37.588622 [info ] [MainThread]: 
[0m14:28:37.589601 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:28:37.589601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F8FFB300D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F8FF8FF670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F8FFD82610>]}
[0m14:28:37.590632 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 14:32:30.354768 | e2157723-8b52-4557-b3df-34b1f35d60ed ==============================
[0m14:32:30.354768 [info ] [MainThread]: Running with dbt=1.3.1
[0m14:32:30.354768 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['registration_events_grouped'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m14:32:30.355759 [debug] [MainThread]: Tracking: tracking
[0m14:32:30.356745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020A02498C40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020A02498CA0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020A02498D00>]}
[0m14:32:30.511743 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:32:30.511743 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\stg\registration_events_grouped.sql
[0m14:32:30.532143 [debug] [MainThread]: 1603: static parser failed on stg\registration_events_grouped.sql
[0m14:32:30.593128 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\registration_events_grouped.sql
[0m14:32:30.637129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e2157723-8b52-4557-b3df-34b1f35d60ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020A026F30D0>]}
[0m14:32:30.657127 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e2157723-8b52-4557-b3df-34b1f35d60ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020A026BCE80>]}
[0m14:32:30.658128 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m14:32:30.659129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e2157723-8b52-4557-b3df-34b1f35d60ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020A02471070>]}
[0m14:32:30.661131 [info ] [MainThread]: 
[0m14:32:30.663130 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:32:30.667128 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:32:30.701132 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:32:30.702128 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:32:30.703128 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:32:31.778207 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 1.08 seconds
[0m14:32:31.780210 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:32:31.933018 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:32:31.941030 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:32:31.941992 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m14:32:31.941992 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:32:32.550984 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.61 seconds
[0m14:32:32.552986 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m14:32:32.692590 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:32:32.697592 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:32:32.698600 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m14:32:32.698600 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:32:33.368015 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.67 seconds
[0m14:32:33.370017 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m14:32:33.508013 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e2157723-8b52-4557-b3df-34b1f35d60ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020A024AFCA0>]}
[0m14:32:33.509015 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:32:33.510015 [info ] [MainThread]: 
[0m14:32:33.515015 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m14:32:33.516016 [info ] [Thread-1  ]: 1 of 1 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m14:32:33.517044 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:32:33.517044 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m14:32:33.518014 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m14:32:33.531014 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m14:32:33.532046 [debug] [Thread-1  ]: finished collecting timing info
[0m14:32:33.532046 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m14:32:33.596054 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:32:33.596054 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace  view DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp
  
   as (
    

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    WHERE lower(event) in ('register', 'deregister')
        AND event_at <= '2019-06-01 18:17:04.089'

    
        and event_at > (select max(register_event_at) from DOOR2DOOR_DWH.DBT_stg.registration_events_grouped)
    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



    ,new_deregisters as (
        SELECT
            d.data_id,
            d.event_at
        FROM new_events d
        LEFT JOIN new_registers r
            ON d.data_id = r.data_id AND d.event_at = r.deregister_event_at
        WHERE 
            lower(d.event) = 'deregister'
            AND r.deregister_event_at IS NULL
    )
    ,updated_existing_registers as (
        SELECT
            r.data_id,
            r.register_event_at,
            d.event_at as deregister_event_at,
            r._unique_key
        FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
        LEFT JOIN new_deregisters d ON
            r.data_id = d.data_id   
        WHERE r.deregister_event_at IS NULL
    )

    SELECT * FROM updated_existing_registers
    UNION ALL



SELECT * FROM new_registers
  );
[0m14:32:33.596054 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:32:34.097288 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.5 seconds
[0m14:32:34.110299 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:32:34.111292 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
describe table DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp
[0m14:32:34.204755 [debug] [Thread-1  ]: SQL status: SUCCESS 4 in 0.09 seconds
[0m14:32:34.211754 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:32:34.211754 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
describe table DOOR2DOOR_DWH.DBT_stg.registration_events_grouped
[0m14:32:34.300425 [debug] [Thread-1  ]: SQL status: SUCCESS 4 in 0.09 seconds
[0m14:32:34.317422 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:32:34.318422 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
describe table "DOOR2DOOR_DWH"."DBT_STG"."REGISTRATION_EVENTS_GROUPED"
[0m14:32:34.401622 [debug] [Thread-1  ]: SQL status: SUCCESS 4 in 0.08 seconds
[0m14:32:34.453625 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.registration_events_grouped"
[0m14:32:34.456622 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:32:34.456622 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
BEGIN
[0m14:32:34.577888 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.12 seconds
[0m14:32:34.578891 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:32:34.578891 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
merge into DOOR2DOOR_DWH.DBT_stg.registration_events_grouped as DBT_INTERNAL_DEST
        using DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp as DBT_INTERNAL_SOURCE
        on 
                DBT_INTERNAL_SOURCE._unique_key = DBT_INTERNAL_DEST._unique_key
            

    
    when matched then update set
        "DATA_ID" = DBT_INTERNAL_SOURCE."DATA_ID","REGISTER_EVENT_AT" = DBT_INTERNAL_SOURCE."REGISTER_EVENT_AT","DEREGISTER_EVENT_AT" = DBT_INTERNAL_SOURCE."DEREGISTER_EVENT_AT","_UNIQUE_KEY" = DBT_INTERNAL_SOURCE."_UNIQUE_KEY"
    

    when not matched then insert
        ("DATA_ID", "REGISTER_EVENT_AT", "DEREGISTER_EVENT_AT", "_UNIQUE_KEY")
    values
        ("DATA_ID", "REGISTER_EVENT_AT", "DEREGISTER_EVENT_AT", "_UNIQUE_KEY")

;
[0m14:32:35.691403 [debug] [Thread-1  ]: SQL status: SUCCESS 56 in 1.11 seconds
[0m14:32:35.692435 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:32:35.692435 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
COMMIT
[0m14:32:35.939543 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.25 seconds
[0m14:32:35.946539 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:32:35.946539 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp cascade
[0m14:32:36.053998 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.11 seconds
[0m14:32:36.072994 [debug] [Thread-1  ]: finished collecting timing info
[0m14:32:36.072994 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m14:32:36.209331 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2157723-8b52-4557-b3df-34b1f35d60ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020A02A5EFD0>]}
[0m14:32:36.210331 [info ] [Thread-1  ]: 1 of 1 OK created sql incremental model DBT_stg.registration_events_grouped .... [[32mSUCCESS 56[0m in 2.69s]
[0m14:32:36.212520 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m14:32:36.214569 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:32:36.214569 [info ] [MainThread]: 
[0m14:32:36.215533 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 5.55 seconds (5.55s).
[0m14:32:36.216628 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:32:36.216628 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m14:32:36.216628 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_dwh' was properly closed.
[0m14:32:36.217637 [debug] [MainThread]: Connection 'model.door2door_dwh.registration_events_grouped' was properly closed.
[0m14:32:36.225638 [info ] [MainThread]: 
[0m14:32:36.226639 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:32:36.228638 [info ] [MainThread]: 
[0m14:32:36.229639 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m14:32:36.229639 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020A025A2430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020A024C7340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020A0274AD90>]}
[0m14:32:36.230639 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 14:33:13.006775 | 2856cca4-f689-4bdd-bdcf-8157a2367af9 ==============================
[0m14:33:13.006775 [info ] [MainThread]: Running with dbt=1.3.1
[0m14:33:13.007759 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['registration_events_grouped'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m14:33:13.007759 [debug] [MainThread]: Tracking: tracking
[0m14:33:13.007759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CB98389D60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CB98389DC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CB98389E20>]}
[0m14:33:13.136776 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:33:13.136776 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\stg\registration_events_grouped.sql
[0m14:33:13.149776 [debug] [MainThread]: 1603: static parser failed on stg\registration_events_grouped.sql
[0m14:33:13.182749 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\registration_events_grouped.sql
[0m14:33:13.203777 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2856cca4-f689-4bdd-bdcf-8157a2367af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CB985E00D0>]}
[0m14:33:13.213747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2856cca4-f689-4bdd-bdcf-8157a2367af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CB985BA0A0>]}
[0m14:33:13.213747 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m14:33:13.214747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2856cca4-f689-4bdd-bdcf-8157a2367af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CB9853DA90>]}
[0m14:33:13.215747 [info ] [MainThread]: 
[0m14:33:13.217750 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:33:13.218778 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:33:13.233789 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:33:13.234793 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:33:13.234793 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:33:14.180532 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.95 seconds
[0m14:33:14.181531 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:33:14.389646 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:33:14.396646 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:33:14.396646 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m14:33:14.397646 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:33:15.021779 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.62 seconds
[0m14:33:15.023806 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m14:33:15.152114 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:33:15.156145 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:33:15.156145 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m14:33:15.156145 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:33:15.590377 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.43 seconds
[0m14:33:15.591374 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m14:33:15.724482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2856cca4-f689-4bdd-bdcf-8157a2367af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CB9839E4F0>]}
[0m14:33:15.725545 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:33:15.726513 [info ] [MainThread]: 
[0m14:33:15.731404 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m14:33:15.732403 [info ] [Thread-1  ]: 1 of 1 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m14:33:15.733154 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:33:15.733154 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m14:33:15.734232 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m14:33:15.743176 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m14:33:15.744190 [debug] [Thread-1  ]: finished collecting timing info
[0m14:33:15.745176 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m14:33:15.793179 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:33:15.793179 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace  view DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp
  
   as (
    

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    WHERE lower(event) in ('register', 'deregister')
        -- AND event_at <= '2019-06-01 18:17:04.089'

    
        and event_at > (select max(register_event_at) from DOOR2DOOR_DWH.DBT_stg.registration_events_grouped)
    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



    ,new_deregisters as (
        SELECT
            d.data_id,
            d.event_at
        FROM new_events d
        LEFT JOIN new_registers r
            ON d.data_id = r.data_id AND d.event_at = r.deregister_event_at
        WHERE 
            lower(d.event) = 'deregister'
            AND r.deregister_event_at IS NULL
    )
    ,updated_existing_registers as (
        SELECT
            r.data_id,
            r.register_event_at,
            d.event_at as deregister_event_at,
            r._unique_key
        FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
        LEFT JOIN new_deregisters d ON
            r.data_id = d.data_id   
        WHERE r.deregister_event_at IS NULL
    )

    SELECT * FROM updated_existing_registers
    UNION ALL



SELECT * FROM new_registers
  );
[0m14:33:15.793179 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:33:16.285895 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.49 seconds
[0m14:33:16.293890 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:33:16.294918 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
describe table DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp
[0m14:33:16.400324 [debug] [Thread-1  ]: SQL status: SUCCESS 4 in 0.11 seconds
[0m14:33:16.405330 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:33:16.405330 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
describe table DOOR2DOOR_DWH.DBT_stg.registration_events_grouped
[0m14:33:16.482435 [debug] [Thread-1  ]: SQL status: SUCCESS 4 in 0.08 seconds
[0m14:33:16.490445 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:33:16.490445 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
describe table "DOOR2DOOR_DWH"."DBT_STG"."REGISTRATION_EVENTS_GROUPED"
[0m14:33:16.577525 [debug] [Thread-1  ]: SQL status: SUCCESS 4 in 0.09 seconds
[0m14:33:16.607558 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.registration_events_grouped"
[0m14:33:16.609558 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:33:16.609558 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
BEGIN
[0m14:33:16.725900 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.12 seconds
[0m14:33:16.726902 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:33:16.726902 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
merge into DOOR2DOOR_DWH.DBT_stg.registration_events_grouped as DBT_INTERNAL_DEST
        using DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp as DBT_INTERNAL_SOURCE
        on 
                DBT_INTERNAL_SOURCE._unique_key = DBT_INTERNAL_DEST._unique_key
            

    
    when matched then update set
        "DATA_ID" = DBT_INTERNAL_SOURCE."DATA_ID","REGISTER_EVENT_AT" = DBT_INTERNAL_SOURCE."REGISTER_EVENT_AT","DEREGISTER_EVENT_AT" = DBT_INTERNAL_SOURCE."DEREGISTER_EVENT_AT","_UNIQUE_KEY" = DBT_INTERNAL_SOURCE."_UNIQUE_KEY"
    

    when not matched then insert
        ("DATA_ID", "REGISTER_EVENT_AT", "DEREGISTER_EVENT_AT", "_UNIQUE_KEY")
    values
        ("DATA_ID", "REGISTER_EVENT_AT", "DEREGISTER_EVENT_AT", "_UNIQUE_KEY")

;
[0m14:33:17.841144 [debug] [Thread-1  ]: SQL status: SUCCESS 100 in 1.11 seconds
[0m14:33:17.841144 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:33:17.842174 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
COMMIT
[0m14:33:18.116787 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.27 seconds
[0m14:33:18.123783 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:33:18.123783 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp cascade
[0m14:33:18.229307 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.11 seconds
[0m14:33:18.249346 [debug] [Thread-1  ]: finished collecting timing info
[0m14:33:18.249346 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m14:33:18.390139 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2856cca4-f689-4bdd-bdcf-8157a2367af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CB988EE3D0>]}
[0m14:33:18.391112 [info ] [Thread-1  ]: 1 of 1 OK created sql incremental model DBT_stg.registration_events_grouped .... [[32mSUCCESS 100[0m in 2.66s]
[0m14:33:18.392130 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m14:33:18.395114 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:33:18.395114 [info ] [MainThread]: 
[0m14:33:18.396140 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 5.18 seconds (5.18s).
[0m14:33:18.397139 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:33:18.397139 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m14:33:18.397139 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_stg' was properly closed.
[0m14:33:18.398132 [debug] [MainThread]: Connection 'model.door2door_dwh.registration_events_grouped' was properly closed.
[0m14:33:18.406126 [info ] [MainThread]: 
[0m14:33:18.407245 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:33:18.408252 [info ] [MainThread]: 
[0m14:33:18.409255 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m14:33:18.410258 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CB985AFC40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CB988FBF70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CB9861C1F0>]}
[0m14:33:18.410258 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 14:41:00.158261 | e8433c8c-9c9e-4b49-bbb6-cd973df52c3d ==============================
[0m14:41:00.158261 [info ] [MainThread]: Running with dbt=1.3.1
[0m14:41:00.159228 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m14:41:00.160261 [debug] [MainThread]: Tracking: tracking
[0m14:41:00.160261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB68089C70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB68089CD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB68089D30>]}
[0m14:41:00.326277 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m14:41:00.327229 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\fact_deregistration.sql
[0m14:41:00.328231 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\fact_registration.sql
[0m14:41:00.346231 [debug] [MainThread]: 1603: static parser failed on dwh\fact_deregistration.sql
[0m14:41:00.389231 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_deregistration.sql
[0m14:41:00.392236 [debug] [MainThread]: 1603: static parser failed on dwh\fact_registration.sql
[0m14:41:00.402250 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_registration.sql
[0m14:41:00.433232 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e8433c8c-9c9e-4b49-bbb6-cd973df52c3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB683350D0>]}
[0m14:41:00.445275 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e8433c8c-9c9e-4b49-bbb6-cd973df52c3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB682AA520>]}
[0m14:41:00.446233 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m14:41:00.447233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e8433c8c-9c9e-4b49-bbb6-cd973df52c3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB68281250>]}
[0m14:41:00.449245 [info ] [MainThread]: 
[0m14:41:00.450270 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:41:00.453232 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:41:00.472231 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:41:00.473303 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:41:00.474253 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:41:01.600613 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 1.13 seconds
[0m14:41:01.602614 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:41:01.829415 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:41:01.833417 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:41:01.833417 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:41:01.833417 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:41:02.234532 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.4 seconds
[0m14:41:02.235526 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:41:02.371191 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:41:02.380177 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:41:02.380177 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m14:41:02.381177 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:41:02.786122 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.4 seconds
[0m14:41:02.788115 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m14:41:02.936371 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:41:02.941373 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:41:02.942372 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m14:41:02.942372 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:41:03.535496 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.59 seconds
[0m14:41:03.537453 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m14:41:03.669582 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e8433c8c-9c9e-4b49-bbb6-cd973df52c3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB6829E280>]}
[0m14:41:03.670581 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:41:03.685581 [info ] [MainThread]: 
[0m14:41:03.694582 [debug] [Thread-1  ]: Began running node model.door2door_dwh.event
[0m14:41:03.695582 [info ] [Thread-1  ]: 1 of 7 START sql incremental model DBT_stg.event ............................... [RUN]
[0m14:41:03.697579 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.event"
[0m14:41:03.697579 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.event
[0m14:41:03.698581 [debug] [Thread-1  ]: Compiling model.door2door_dwh.event
[0m14:41:03.720608 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.event"
[0m14:41:03.723594 [debug] [Thread-1  ]: finished collecting timing info
[0m14:41:03.724580 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.event
[0m14:41:03.798576 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.event"
[0m14:41:03.800578 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event"
[0m14:41:03.800578 [debug] [Thread-1  ]: On model.door2door_dwh.event: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event"} */
create or replace transient table DOOR2DOOR_DWH.DBT_stg.event  as
        (

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TEXT as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
        );
[0m14:41:03.801579 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:41:10.253162 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 6.45 seconds
[0m14:41:10.260159 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event"
[0m14:41:10.261158 [debug] [Thread-1  ]: On model.door2door_dwh.event: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.event__dbt_tmp cascade
[0m14:41:10.346242 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.09 seconds
[0m14:41:10.375241 [debug] [Thread-1  ]: finished collecting timing info
[0m14:41:10.376243 [debug] [Thread-1  ]: On model.door2door_dwh.event: Close
[0m14:41:10.507244 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8433c8c-9c9e-4b49-bbb6-cd973df52c3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB6861E9D0>]}
[0m14:41:10.507244 [info ] [Thread-1  ]: 1 of 7 OK created sql incremental model DBT_stg.event .......................... [[32mSUCCESS 1[0m in 6.81s]
[0m14:41:10.509254 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.event
[0m14:41:10.510244 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_operating_period
[0m14:41:10.511247 [info ] [Thread-1  ]: 2 of 7 START sql table model DBT_dwh.dim_operating_period ...................... [RUN]
[0m14:41:10.513244 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_operating_period"
[0m14:41:10.513244 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_operating_period
[0m14:41:10.513244 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_operating_period
[0m14:41:10.519243 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_operating_period"
[0m14:41:10.520244 [debug] [Thread-1  ]: finished collecting timing info
[0m14:41:10.521249 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_operating_period
[0m14:41:10.539247 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_operating_period"
[0m14:41:10.542243 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_operating_period"
[0m14:41:10.542243 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_operating_period"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_operating_period  as
        (

with operating_periods as (
    SELECT
        data_id,
        data_start,
        data_finish,
        ROW_NUMBER() OVER (PARTITION BY data_id ORDER BY data_finish desc, data_start desc) as rn
    FROM DOOR2DOOR_DWH.DBT_stg.event
    WHERE lower(event_on) = 'operating_period'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    data_id as operating_period_source_id,
    data_start as operating_period_start_time,
    data_finish as operating_period_finish_time
FROM operating_periods
        );
[0m14:41:10.543243 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:41:11.512578 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.97 seconds
[0m14:41:11.514608 [debug] [Thread-1  ]: finished collecting timing info
[0m14:41:11.515576 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: Close
[0m14:41:11.654607 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8433c8c-9c9e-4b49-bbb6-cd973df52c3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB685F1250>]}
[0m14:41:11.655607 [info ] [Thread-1  ]: 2 of 7 OK created sql table model DBT_dwh.dim_operating_period ................. [[32mSUCCESS 1[0m in 1.14s]
[0m14:41:11.656590 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_operating_period
[0m14:41:11.657577 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_vehicle
[0m14:41:11.657577 [info ] [Thread-1  ]: 3 of 7 START sql table model DBT_dwh.dim_vehicle ............................... [RUN]
[0m14:41:11.659607 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_vehicle"
[0m14:41:11.659607 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_vehicle
[0m14:41:11.659607 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_vehicle
[0m14:41:11.664607 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_vehicle"
[0m14:41:11.665581 [debug] [Thread-1  ]: finished collecting timing info
[0m14:41:11.665581 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_vehicle
[0m14:41:11.669620 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_vehicle"
[0m14:41:11.670620 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_vehicle"
[0m14:41:11.670620 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_vehicle"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_vehicle  as
        (

with vehicles as (
    SELECT
        DISTINCT data_id
    FROM DOOR2DOOR_DWH.DBT_stg.event
    WHERE lower(event_on) = 'vehicle'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    data_id as vehicle_source_id
FROM vehicles
        );
[0m14:41:11.670620 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:41:12.650602 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.98 seconds
[0m14:41:12.653596 [debug] [Thread-1  ]: finished collecting timing info
[0m14:41:12.653596 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: Close
[0m14:41:12.784600 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8433c8c-9c9e-4b49-bbb6-cd973df52c3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB6860CAC0>]}
[0m14:41:12.785599 [info ] [Thread-1  ]: 3 of 7 OK created sql table model DBT_dwh.dim_vehicle .......................... [[32mSUCCESS 1[0m in 1.13s]
[0m14:41:12.787601 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_vehicle
[0m14:41:12.788599 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m14:41:12.788599 [info ] [Thread-1  ]: 4 of 7 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m14:41:12.789596 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:41:12.790596 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m14:41:12.790596 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m14:41:12.805597 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m14:41:12.807598 [debug] [Thread-1  ]: finished collecting timing info
[0m14:41:12.808599 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m14:41:12.813613 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.registration_events_grouped"
[0m14:41:12.816598 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:41:12.816598 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace transient table DOOR2DOOR_DWH.DBT_stg.registration_events_grouped  as
        (

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    WHERE lower(event) in ('register', 'deregister')
        -- AND event_at <= '2019-06-01 18:17:04.089'

    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



SELECT * FROM new_registers
        );
[0m14:41:12.817610 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:41:13.733119 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.92 seconds
[0m14:41:13.778147 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:41:13.779144 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp cascade
[0m14:41:13.940600 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.16 seconds
[0m14:41:13.944596 [debug] [Thread-1  ]: finished collecting timing info
[0m14:41:13.944596 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m14:41:14.083087 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8433c8c-9c9e-4b49-bbb6-cd973df52c3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB68650550>]}
[0m14:41:14.083087 [info ] [Thread-1  ]: 4 of 7 OK created sql incremental model DBT_stg.registration_events_grouped .... [[32mSUCCESS 1[0m in 1.29s]
[0m14:41:14.085147 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m14:41:14.085147 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_vehicle_location
[0m14:41:14.086070 [info ] [Thread-1  ]: 5 of 7 START sql table model DBT_dwh.fact_vehicle_location ..................... [RUN]
[0m14:41:14.087056 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m14:41:14.087056 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_vehicle_location
[0m14:41:14.088086 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_vehicle_location
[0m14:41:14.095087 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_vehicle_location"
[0m14:41:14.096089 [debug] [Thread-1  ]: finished collecting timing info
[0m14:41:14.097059 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_vehicle_location
[0m14:41:14.100062 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_vehicle_location"
[0m14:41:14.103059 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m14:41:14.103059 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location  as
        (

with locations as (
    SELECT
        event_at,
        data_id,
        data_location_lat,
        data_location_lng,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    INNER JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON e.event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'update'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_location_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    operating_period_key,
    data_location_lat as vehicle_location_lat,
    data_location_lng as vehicle_location_lng,
    event_at as vehicle_location_time
FROM locations


--- ASSUMPTION Events are recorded only if vehicle is registered to a operation period
        );
[0m14:41:14.103059 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:41:15.556168 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.45 seconds
[0m14:41:15.560182 [debug] [Thread-1  ]: finished collecting timing info
[0m14:41:15.561167 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: Close
[0m14:41:15.695253 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8433c8c-9c9e-4b49-bbb6-cd973df52c3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB686BFA60>]}
[0m14:41:15.696255 [info ] [Thread-1  ]: 5 of 7 OK created sql table model DBT_dwh.fact_vehicle_location ................ [[32mSUCCESS 1[0m in 1.61s]
[0m14:41:15.697242 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_vehicle_location
[0m14:41:15.698281 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_deregistration
[0m14:41:15.698281 [info ] [Thread-1  ]: 6 of 7 START sql table model DBT_dwh.fact_deregistration ....................... [RUN]
[0m14:41:15.700281 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_deregistration"
[0m14:41:15.700281 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_deregistration
[0m14:41:15.700281 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_deregistration
[0m14:41:15.707239 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_deregistration"
[0m14:41:15.708238 [debug] [Thread-1  ]: finished collecting timing info
[0m14:41:15.708238 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_deregistration
[0m14:41:15.712241 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_deregistration"
[0m14:41:15.714240 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m14:41:15.714240 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_deregistration  as
        (

with events as (
    SELECT
        r.event,
        r.data_id,
        r.deregister_event_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time AND op.operating_period_finish_time
    WHERE r.deregister_event_at IS NOT NULL
)
SELECT
    
    
md5(cast(coalesce(cast(event as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(deregister_event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as deregistration_key,
    operating_period_key,
    deregister_event_at as deregistration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
        );
[0m14:41:15.715239 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:41:16.331629 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa2111-3201-9a27-0000-0001c14652b1
[0m14:41:16.332630 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 6 at position 8
invalid identifier 'R.EVENT'
[0m14:41:16.332630 [debug] [Thread-1  ]: finished collecting timing info
[0m14:41:16.332630 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: Close
[0m14:41:16.456654 [debug] [Thread-1  ]: Database Error in model fact_deregistration (models\dwh\fact_deregistration.sql)
  000904 (42000): SQL compilation error: error line 6 at position 8
  invalid identifier 'R.EVENT'
  compiled Code at target\run\door2door_dwh\models\dwh\fact_deregistration.sql
[0m14:41:16.456654 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8433c8c-9c9e-4b49-bbb6-cd973df52c3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB53A995E0>]}
[0m14:41:16.457655 [error] [Thread-1  ]: 6 of 7 ERROR creating sql table model DBT_dwh.fact_deregistration .............. [[31mERROR[0m in 0.76s]
[0m14:41:16.458969 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_deregistration
[0m14:41:16.459995 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_registration
[0m14:41:16.459995 [info ] [Thread-1  ]: 7 of 7 START sql table model DBT_dwh.fact_registration ......................... [RUN]
[0m14:41:16.460995 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_registration"
[0m14:41:16.462022 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_registration
[0m14:41:16.462022 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_registration
[0m14:41:16.468033 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_registration"
[0m14:41:16.468033 [debug] [Thread-1  ]: finished collecting timing info
[0m14:41:16.468995 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_registration
[0m14:41:16.472033 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_registration"
[0m14:41:16.474015 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m14:41:16.475027 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_registration  as
        (

with events as (
    SELECT
        r.event,
        r.data_id,
        r.register_event_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
)
SELECT
    
    
md5(cast(coalesce(cast(event as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(register_event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as registration_key,
    operating_period_key,
    register_event_at as registration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
-- QUESTION:   Difference between event_on and data_location_at
        );
[0m14:41:16.475027 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:41:17.091399 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa2111-3201-9838-0000-0001c146351d
[0m14:41:17.091399 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 6 at position 8
invalid identifier 'R.EVENT'
[0m14:41:17.091399 [debug] [Thread-1  ]: finished collecting timing info
[0m14:41:17.092358 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: Close
[0m14:41:17.218638 [debug] [Thread-1  ]: Database Error in model fact_registration (models\dwh\fact_registration.sql)
  000904 (42000): SQL compilation error: error line 6 at position 8
  invalid identifier 'R.EVENT'
  compiled Code at target\run\door2door_dwh\models\dwh\fact_registration.sql
[0m14:41:17.219640 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8433c8c-9c9e-4b49-bbb6-cd973df52c3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB686E8C70>]}
[0m14:41:17.220640 [error] [Thread-1  ]: 7 of 7 ERROR creating sql table model DBT_dwh.fact_registration ................ [[31mERROR[0m in 0.76s]
[0m14:41:17.222651 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_registration
[0m14:41:17.224645 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:41:17.225641 [info ] [MainThread]: 
[0m14:41:17.226652 [info ] [MainThread]: Finished running 2 incremental models, 5 table models in 0 hours 0 minutes and 16.78 seconds (16.78s).
[0m14:41:17.227638 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:41:17.227638 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m14:41:17.228646 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_stg' was properly closed.
[0m14:41:17.228646 [debug] [MainThread]: Connection 'model.door2door_dwh.fact_registration' was properly closed.
[0m14:41:17.240641 [info ] [MainThread]: 
[0m14:41:17.241640 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m14:41:17.242639 [info ] [MainThread]: 
[0m14:41:17.243639 [error] [MainThread]: [33mDatabase Error in model fact_deregistration (models\dwh\fact_deregistration.sql)[0m
[0m14:41:17.244637 [error] [MainThread]:   000904 (42000): SQL compilation error: error line 6 at position 8
[0m14:41:17.245639 [error] [MainThread]:   invalid identifier 'R.EVENT'
[0m14:41:17.246639 [error] [MainThread]:   compiled Code at target\run\door2door_dwh\models\dwh\fact_deregistration.sql
[0m14:41:17.247639 [info ] [MainThread]: 
[0m14:41:17.248644 [error] [MainThread]: [33mDatabase Error in model fact_registration (models\dwh\fact_registration.sql)[0m
[0m14:41:17.250657 [error] [MainThread]:   000904 (42000): SQL compilation error: error line 6 at position 8
[0m14:41:17.251657 [error] [MainThread]:   invalid identifier 'R.EVENT'
[0m14:41:17.253650 [error] [MainThread]:   compiled Code at target\run\door2door_dwh\models\dwh\fact_registration.sql
[0m14:41:17.254640 [info ] [MainThread]: 
[0m14:41:17.255655 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=2 SKIP=0 TOTAL=7
[0m14:41:17.256640 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB65547D00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB686E8EE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB686509D0>]}
[0m14:41:17.257641 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 14:41:47.571154 | be771d28-3c03-402e-ae90-8f7e5312db9f ==============================
[0m14:41:47.571154 [info ] [MainThread]: Running with dbt=1.3.1
[0m14:41:47.572139 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m14:41:47.573113 [debug] [MainThread]: Tracking: tracking
[0m14:41:47.573113 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FD24138D60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FD24138DC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FD24138E20>]}
[0m14:41:47.707140 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m14:41:47.707140 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\fact_deregistration.sql
[0m14:41:47.708155 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\fact_registration.sql
[0m14:41:47.721140 [debug] [MainThread]: 1603: static parser failed on dwh\fact_deregistration.sql
[0m14:41:47.749141 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_deregistration.sql
[0m14:41:47.751141 [debug] [MainThread]: 1603: static parser failed on dwh\fact_registration.sql
[0m14:41:47.758140 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_registration.sql
[0m14:41:47.777114 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'be771d28-3c03-402e-ae90-8f7e5312db9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FD243E50D0>]}
[0m14:41:47.786115 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'be771d28-3c03-402e-ae90-8f7e5312db9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FD2434EEB0>]}
[0m14:41:47.787116 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m14:41:47.788114 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'be771d28-3c03-402e-ae90-8f7e5312db9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FD2432F340>]}
[0m14:41:47.789116 [info ] [MainThread]: 
[0m14:41:47.790115 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:41:47.793143 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:41:47.808155 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:41:47.808155 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:41:47.808155 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:41:48.648541 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.84 seconds
[0m14:41:48.649542 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:41:48.782965 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:41:48.785965 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:41:48.785965 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:41:48.785965 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:41:49.393508 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.61 seconds
[0m14:41:49.395532 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:41:49.525053 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:41:49.532063 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:41:49.533064 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m14:41:49.533064 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:41:49.937954 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.4 seconds
[0m14:41:49.938952 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m14:41:50.073675 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:41:50.076675 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:41:50.076675 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m14:41:50.076675 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:41:50.676231 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.6 seconds
[0m14:41:50.678221 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m14:41:50.853374 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'be771d28-3c03-402e-ae90-8f7e5312db9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FD24359C70>]}
[0m14:41:50.853374 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:41:50.854364 [info ] [MainThread]: 
[0m14:41:50.859333 [debug] [Thread-1  ]: Began running node model.door2door_dwh.event
[0m14:41:50.860334 [info ] [Thread-1  ]: 1 of 7 START sql incremental model DBT_stg.event ............................... [RUN]
[0m14:41:50.861411 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.event"
[0m14:41:50.861411 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.event
[0m14:41:50.861411 [debug] [Thread-1  ]: Compiling model.door2door_dwh.event
[0m14:41:50.873422 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.event"
[0m14:41:50.874420 [debug] [Thread-1  ]: finished collecting timing info
[0m14:41:50.874420 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.event
[0m14:41:50.932424 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.event"
[0m14:41:50.934424 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event"
[0m14:41:50.934424 [debug] [Thread-1  ]: On model.door2door_dwh.event: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event"} */
create or replace transient table DOOR2DOOR_DWH.DBT_stg.event  as
        (

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TEXT as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
        );
[0m14:41:50.935437 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:41:55.000422 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 4.06 seconds
[0m14:41:55.007419 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event"
[0m14:41:55.007419 [debug] [Thread-1  ]: On model.door2door_dwh.event: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.event__dbt_tmp cascade
[0m14:41:55.082127 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.07 seconds
[0m14:41:55.105122 [debug] [Thread-1  ]: finished collecting timing info
[0m14:41:55.105122 [debug] [Thread-1  ]: On model.door2door_dwh.event: Close
[0m14:41:55.239137 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be771d28-3c03-402e-ae90-8f7e5312db9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FD246CEDC0>]}
[0m14:41:55.240137 [info ] [Thread-1  ]: 1 of 7 OK created sql incremental model DBT_stg.event .......................... [[32mSUCCESS 1[0m in 4.38s]
[0m14:41:55.241873 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.event
[0m14:41:55.242878 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_operating_period
[0m14:41:55.243903 [info ] [Thread-1  ]: 2 of 7 START sql table model DBT_dwh.dim_operating_period ...................... [RUN]
[0m14:41:55.244873 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_operating_period"
[0m14:41:55.244873 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_operating_period
[0m14:41:55.244873 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_operating_period
[0m14:41:55.249873 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_operating_period"
[0m14:41:55.250874 [debug] [Thread-1  ]: finished collecting timing info
[0m14:41:55.251874 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_operating_period
[0m14:41:55.262873 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_operating_period"
[0m14:41:55.264873 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_operating_period"
[0m14:41:55.265874 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_operating_period"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_operating_period  as
        (

with operating_periods as (
    SELECT
        data_id,
        data_start,
        data_finish,
        ROW_NUMBER() OVER (PARTITION BY data_id ORDER BY data_finish desc, data_start desc) as rn
    FROM DOOR2DOOR_DWH.DBT_stg.event
    WHERE lower(event_on) = 'operating_period'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    data_id as operating_period_source_id,
    data_start as operating_period_start_time,
    data_finish as operating_period_finish_time
FROM operating_periods
        );
[0m14:41:55.265874 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:41:56.258212 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.99 seconds
[0m14:41:56.260206 [debug] [Thread-1  ]: finished collecting timing info
[0m14:41:56.261206 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: Close
[0m14:41:56.393321 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be771d28-3c03-402e-ae90-8f7e5312db9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FD24795DC0>]}
[0m14:41:56.393321 [info ] [Thread-1  ]: 2 of 7 OK created sql table model DBT_dwh.dim_operating_period ................. [[32mSUCCESS 1[0m in 1.15s]
[0m14:41:56.395303 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_operating_period
[0m14:41:56.395303 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_vehicle
[0m14:41:56.396295 [info ] [Thread-1  ]: 3 of 7 START sql table model DBT_dwh.dim_vehicle ............................... [RUN]
[0m14:41:56.397295 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_vehicle"
[0m14:41:56.397295 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_vehicle
[0m14:41:56.398333 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_vehicle
[0m14:41:56.403336 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_vehicle"
[0m14:41:56.403336 [debug] [Thread-1  ]: finished collecting timing info
[0m14:41:56.404295 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_vehicle
[0m14:41:56.407334 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_vehicle"
[0m14:41:56.408295 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_vehicle"
[0m14:41:56.408295 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_vehicle"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_vehicle  as
        (

with vehicles as (
    SELECT
        DISTINCT data_id
    FROM DOOR2DOOR_DWH.DBT_stg.event
    WHERE lower(event_on) = 'vehicle'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    data_id as vehicle_source_id
FROM vehicles
        );
[0m14:41:56.409295 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:41:57.273876 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.86 seconds
[0m14:41:57.275872 [debug] [Thread-1  ]: finished collecting timing info
[0m14:41:57.275872 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: Close
[0m14:41:57.415083 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be771d28-3c03-402e-ae90-8f7e5312db9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FD2469DDC0>]}
[0m14:41:57.416053 [info ] [Thread-1  ]: 3 of 7 OK created sql table model DBT_dwh.dim_vehicle .......................... [[32mSUCCESS 1[0m in 1.02s]
[0m14:41:57.418052 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_vehicle
[0m14:41:57.418052 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m14:41:57.419050 [info ] [Thread-1  ]: 4 of 7 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m14:41:57.420052 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:41:57.420052 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m14:41:57.420052 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m14:41:57.427093 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m14:41:57.428080 [debug] [Thread-1  ]: finished collecting timing info
[0m14:41:57.428080 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m14:41:57.433094 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.registration_events_grouped"
[0m14:41:57.434082 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:41:57.435095 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace transient table DOOR2DOOR_DWH.DBT_stg.registration_events_grouped  as
        (

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    WHERE lower(event) in ('register', 'deregister')
        -- AND event_at <= '2019-06-01 18:17:04.089'

    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



SELECT * FROM new_registers
        );
[0m14:41:57.435470 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:41:58.303257 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.87 seconds
[0m14:41:58.346254 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:41:58.347254 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp cascade
[0m14:41:58.438648 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.09 seconds
[0m14:41:58.441644 [debug] [Thread-1  ]: finished collecting timing info
[0m14:41:58.441644 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m14:41:58.577148 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be771d28-3c03-402e-ae90-8f7e5312db9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FD24748D30>]}
[0m14:41:58.578148 [info ] [Thread-1  ]: 4 of 7 OK created sql incremental model DBT_stg.registration_events_grouped .... [[32mSUCCESS 1[0m in 1.16s]
[0m14:41:58.579119 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m14:41:58.580148 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_vehicle_location
[0m14:41:58.580148 [info ] [Thread-1  ]: 5 of 7 START sql table model DBT_dwh.fact_vehicle_location ..................... [RUN]
[0m14:41:58.581131 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m14:41:58.582118 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_vehicle_location
[0m14:41:58.582118 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_vehicle_location
[0m14:41:58.589118 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_vehicle_location"
[0m14:41:58.590118 [debug] [Thread-1  ]: finished collecting timing info
[0m14:41:58.591118 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_vehicle_location
[0m14:41:58.593119 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_vehicle_location"
[0m14:41:58.595118 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m14:41:58.595118 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location  as
        (

with locations as (
    SELECT
        event_at,
        data_id,
        data_location_lat,
        data_location_lng,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    INNER JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON e.event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'update'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_location_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    operating_period_key,
    data_location_lat as vehicle_location_lat,
    data_location_lng as vehicle_location_lng,
    event_at as vehicle_location_time
FROM locations


--- ASSUMPTION Events are recorded only if vehicle is registered to a operation period
        );
[0m14:41:58.596130 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:41:59.790199 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.19 seconds
[0m14:41:59.792197 [debug] [Thread-1  ]: finished collecting timing info
[0m14:41:59.793196 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: Close
[0m14:41:59.919921 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be771d28-3c03-402e-ae90-8f7e5312db9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FD247349D0>]}
[0m14:41:59.920921 [info ] [Thread-1  ]: 5 of 7 OK created sql table model DBT_dwh.fact_vehicle_location ................ [[32mSUCCESS 1[0m in 1.34s]
[0m14:41:59.921914 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_vehicle_location
[0m14:41:59.922892 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_deregistration
[0m14:41:59.922892 [info ] [Thread-1  ]: 6 of 7 START sql table model DBT_dwh.fact_deregistration ....................... [RUN]
[0m14:41:59.923893 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_deregistration"
[0m14:41:59.924892 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_deregistration
[0m14:41:59.924892 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_deregistration
[0m14:41:59.930891 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_deregistration"
[0m14:41:59.931891 [debug] [Thread-1  ]: finished collecting timing info
[0m14:41:59.931891 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_deregistration
[0m14:41:59.934892 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_deregistration"
[0m14:41:59.935892 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m14:41:59.936891 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_deregistration  as
        (

with events as (
    SELECT
        r.data_id,
        r.deregister_event_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time AND op.operating_period_finish_time
    WHERE r.deregister_event_at IS NOT NULL
)
SELECT
    
    
md5(cast(coalesce(cast(event as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(deregister_event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as deregistration_key,
    operating_period_key,
    deregister_event_at as deregistration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
        );
[0m14:41:59.936891 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:42:00.348149 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa2112-3201-98a1-0000-0001c1462529
[0m14:42:00.349150 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 17 at position 23
invalid identifier 'EVENT'
[0m14:42:00.349150 [debug] [Thread-1  ]: finished collecting timing info
[0m14:42:00.349150 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: Close
[0m14:42:00.471466 [debug] [Thread-1  ]: Database Error in model fact_deregistration (models\dwh\fact_deregistration.sql)
  000904 (42000): SQL compilation error: error line 17 at position 23
  invalid identifier 'EVENT'
  compiled Code at target\run\door2door_dwh\models\dwh\fact_deregistration.sql
[0m14:42:00.472467 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be771d28-3c03-402e-ae90-8f7e5312db9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FD24702BB0>]}
[0m14:42:00.472467 [error] [Thread-1  ]: 6 of 7 ERROR creating sql table model DBT_dwh.fact_deregistration .............. [[31mERROR[0m in 0.55s]
[0m14:42:00.474055 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_deregistration
[0m14:42:00.475110 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_registration
[0m14:42:00.475110 [info ] [Thread-1  ]: 7 of 7 START sql table model DBT_dwh.fact_registration ......................... [RUN]
[0m14:42:00.476080 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_registration"
[0m14:42:00.477109 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_registration
[0m14:42:00.477109 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_registration
[0m14:42:00.483110 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_registration"
[0m14:42:00.483110 [debug] [Thread-1  ]: finished collecting timing info
[0m14:42:00.484110 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_registration
[0m14:42:00.487119 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_registration"
[0m14:42:00.488109 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m14:42:00.489120 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_registration  as
        (

with events as (
    SELECT
        r.data_id,
        r.register_event_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
)
SELECT
    
    
md5(cast(coalesce(cast(event as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(register_event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as registration_key,
    operating_period_key,
    register_event_at as registration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
-- QUESTION:   Difference between event_on and data_location_at
        );
[0m14:42:00.489120 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:42:01.268301 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa2112-3201-9838-0000-0001c1463529
[0m14:42:01.268301 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 16 at position 23
invalid identifier 'EVENT'
[0m14:42:01.269273 [debug] [Thread-1  ]: finished collecting timing info
[0m14:42:01.269273 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: Close
[0m14:42:01.403701 [debug] [Thread-1  ]: Database Error in model fact_registration (models\dwh\fact_registration.sql)
  000904 (42000): SQL compilation error: error line 16 at position 23
  invalid identifier 'EVENT'
  compiled Code at target\run\door2door_dwh\models\dwh\fact_registration.sql
[0m14:42:01.403701 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be771d28-3c03-402e-ae90-8f7e5312db9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FD24726B20>]}
[0m14:42:01.404676 [error] [Thread-1  ]: 7 of 7 ERROR creating sql table model DBT_dwh.fact_registration ................ [[31mERROR[0m in 0.93s]
[0m14:42:01.405523 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_registration
[0m14:42:01.408538 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:42:01.409538 [info ] [MainThread]: 
[0m14:42:01.409538 [info ] [MainThread]: Finished running 2 incremental models, 5 table models in 0 hours 0 minutes and 13.62 seconds (13.62s).
[0m14:42:01.410537 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:42:01.410537 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m14:42:01.411536 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_dwh' was properly closed.
[0m14:42:01.411536 [debug] [MainThread]: Connection 'model.door2door_dwh.fact_registration' was properly closed.
[0m14:42:01.419537 [info ] [MainThread]: 
[0m14:42:01.420537 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m14:42:01.421536 [info ] [MainThread]: 
[0m14:42:01.422536 [error] [MainThread]: [33mDatabase Error in model fact_deregistration (models\dwh\fact_deregistration.sql)[0m
[0m14:42:01.423536 [error] [MainThread]:   000904 (42000): SQL compilation error: error line 17 at position 23
[0m14:42:01.424555 [error] [MainThread]:   invalid identifier 'EVENT'
[0m14:42:01.425537 [error] [MainThread]:   compiled Code at target\run\door2door_dwh\models\dwh\fact_deregistration.sql
[0m14:42:01.426534 [info ] [MainThread]: 
[0m14:42:01.427545 [error] [MainThread]: [33mDatabase Error in model fact_registration (models\dwh\fact_registration.sql)[0m
[0m14:42:01.428113 [error] [MainThread]:   000904 (42000): SQL compilation error: error line 16 at position 23
[0m14:42:01.429104 [error] [MainThread]:   invalid identifier 'EVENT'
[0m14:42:01.430095 [error] [MainThread]:   compiled Code at target\run\door2door_dwh\models\dwh\fact_registration.sql
[0m14:42:01.430095 [info ] [MainThread]: 
[0m14:42:01.431104 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=2 SKIP=0 TOTAL=7
[0m14:42:01.432104 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FD2438F6A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FD2438F040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FD24702E20>]}
[0m14:42:01.432104 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 14:43:41.652758 | ffa01cec-41a8-457e-bc6c-74bffef13a83 ==============================
[0m14:43:41.652758 [info ] [MainThread]: Running with dbt=1.3.1
[0m14:43:41.653800 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m14:43:41.654759 [debug] [MainThread]: Tracking: tracking
[0m14:43:41.654759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025C6EA49C40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025C6EA49CA0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025C6EA49D00>]}
[0m14:43:41.806802 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m14:43:41.807764 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\fact_registration.sql
[0m14:43:41.808760 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\fact_deregistration.sql
[0m14:43:41.824760 [debug] [MainThread]: 1603: static parser failed on dwh\fact_registration.sql
[0m14:43:41.859759 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_registration.sql
[0m14:43:41.861759 [debug] [MainThread]: 1603: static parser failed on dwh\fact_deregistration.sql
[0m14:43:41.868759 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_deregistration.sql
[0m14:43:41.891775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ffa01cec-41a8-457e-bc6c-74bffef13a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025C6ECEFF40>]}
[0m14:43:41.901759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ffa01cec-41a8-457e-bc6c-74bffef13a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025C6EC4DFA0>]}
[0m14:43:41.902759 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m14:43:41.903758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ffa01cec-41a8-457e-bc6c-74bffef13a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025C6EC3F220>]}
[0m14:43:41.906760 [info ] [MainThread]: 
[0m14:43:41.907760 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:43:41.909800 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:43:41.927801 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:43:41.927801 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:43:41.928794 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:43:42.883797 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.96 seconds
[0m14:43:42.884799 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:43:43.060929 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:43:43.063930 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:43:43.063930 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:43:43.063930 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:43:43.659699 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.6 seconds
[0m14:43:43.661698 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:43:43.786525 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:43:43.793525 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:43:43.793525 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m14:43:43.793525 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:43:44.256707 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.46 seconds
[0m14:43:44.258707 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m14:43:44.397079 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:43:44.400078 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:43:44.400078 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m14:43:44.400078 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:43:44.976509 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.58 seconds
[0m14:43:44.977499 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m14:43:45.139438 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ffa01cec-41a8-457e-bc6c-74bffef13a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025C6EC5D430>]}
[0m14:43:45.140438 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:43:45.141426 [info ] [MainThread]: 
[0m14:43:45.146681 [debug] [Thread-1  ]: Began running node model.door2door_dwh.event
[0m14:43:45.146681 [info ] [Thread-1  ]: 1 of 7 START sql incremental model DBT_stg.event ............................... [RUN]
[0m14:43:45.147731 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.event"
[0m14:43:45.148732 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.event
[0m14:43:45.148732 [debug] [Thread-1  ]: Compiling model.door2door_dwh.event
[0m14:43:45.158732 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.event"
[0m14:43:45.158732 [debug] [Thread-1  ]: finished collecting timing info
[0m14:43:45.159691 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.event
[0m14:43:45.214720 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.event"
[0m14:43:45.216692 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event"
[0m14:43:45.216692 [debug] [Thread-1  ]: On model.door2door_dwh.event: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event"} */
create or replace transient table DOOR2DOOR_DWH.DBT_stg.event  as
        (

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TEXT as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
        );
[0m14:43:45.217720 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:43:51.125562 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 5.91 seconds
[0m14:43:51.132558 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event"
[0m14:43:51.133559 [debug] [Thread-1  ]: On model.door2door_dwh.event: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.event__dbt_tmp cascade
[0m14:43:51.216564 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m14:43:51.238561 [debug] [Thread-1  ]: finished collecting timing info
[0m14:43:51.238561 [debug] [Thread-1  ]: On model.door2door_dwh.event: Close
[0m14:43:51.375738 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ffa01cec-41a8-457e-bc6c-74bffef13a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025C6EC7DD60>]}
[0m14:43:51.375738 [info ] [Thread-1  ]: 1 of 7 OK created sql incremental model DBT_stg.event .......................... [[32mSUCCESS 1[0m in 6.23s]
[0m14:43:51.377726 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.event
[0m14:43:51.378728 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_operating_period
[0m14:43:51.378728 [info ] [Thread-1  ]: 2 of 7 START sql table model DBT_dwh.dim_operating_period ...................... [RUN]
[0m14:43:51.379710 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_operating_period"
[0m14:43:51.380724 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_operating_period
[0m14:43:51.380724 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_operating_period
[0m14:43:51.385738 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_operating_period"
[0m14:43:51.386708 [debug] [Thread-1  ]: finished collecting timing info
[0m14:43:51.386708 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_operating_period
[0m14:43:51.399752 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_operating_period"
[0m14:43:51.401709 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_operating_period"
[0m14:43:51.401709 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_operating_period"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_operating_period  as
        (

with operating_periods as (
    SELECT
        data_id,
        data_start,
        data_finish,
        ROW_NUMBER() OVER (PARTITION BY data_id ORDER BY data_finish desc, data_start desc) as rn
    FROM DOOR2DOOR_DWH.DBT_stg.event
    WHERE lower(event_on) = 'operating_period'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    data_id as operating_period_source_id,
    data_start as operating_period_start_time,
    data_finish as operating_period_finish_time
FROM operating_periods
        );
[0m14:43:51.402708 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:43:52.425227 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.02 seconds
[0m14:43:52.427221 [debug] [Thread-1  ]: finished collecting timing info
[0m14:43:52.427221 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: Close
[0m14:43:52.557475 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ffa01cec-41a8-457e-bc6c-74bffef13a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025C6F08FEE0>]}
[0m14:43:52.557475 [info ] [Thread-1  ]: 2 of 7 OK created sql table model DBT_dwh.dim_operating_period ................. [[32mSUCCESS 1[0m in 1.18s]
[0m14:43:52.559485 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_operating_period
[0m14:43:52.559485 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_vehicle
[0m14:43:52.560476 [info ] [Thread-1  ]: 3 of 7 START sql table model DBT_dwh.dim_vehicle ............................... [RUN]
[0m14:43:52.561505 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_vehicle"
[0m14:43:52.562508 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_vehicle
[0m14:43:52.562508 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_vehicle
[0m14:43:52.567504 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_vehicle"
[0m14:43:52.567504 [debug] [Thread-1  ]: finished collecting timing info
[0m14:43:52.568506 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_vehicle
[0m14:43:52.571505 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_vehicle"
[0m14:43:52.572505 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_vehicle"
[0m14:43:52.572505 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_vehicle"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_vehicle  as
        (

with vehicles as (
    SELECT
        DISTINCT data_id
    FROM DOOR2DOOR_DWH.DBT_stg.event
    WHERE lower(event_on) = 'vehicle'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    data_id as vehicle_source_id
FROM vehicles
        );
[0m14:43:52.573477 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:43:53.562887 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.99 seconds
[0m14:43:53.564884 [debug] [Thread-1  ]: finished collecting timing info
[0m14:43:53.565884 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: Close
[0m14:43:53.809077 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ffa01cec-41a8-457e-bc6c-74bffef13a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025C6F091FD0>]}
[0m14:43:53.810074 [info ] [Thread-1  ]: 3 of 7 OK created sql table model DBT_dwh.dim_vehicle .......................... [[32mSUCCESS 1[0m in 1.25s]
[0m14:43:53.811057 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_vehicle
[0m14:43:53.812044 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m14:43:53.812044 [info ] [Thread-1  ]: 4 of 7 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m14:43:53.813073 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:43:53.814044 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m14:43:53.814044 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m14:43:53.821044 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m14:43:53.822043 [debug] [Thread-1  ]: finished collecting timing info
[0m14:43:53.822043 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m14:43:53.827044 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.registration_events_grouped"
[0m14:43:53.829045 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:43:53.829045 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace transient table DOOR2DOOR_DWH.DBT_stg.registration_events_grouped  as
        (

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    WHERE lower(event) in ('register', 'deregister')
        -- AND event_at <= '2019-06-01 18:17:04.089'

    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



SELECT * FROM new_registers
        );
[0m14:43:53.830045 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:43:54.979230 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.15 seconds
[0m14:43:55.025227 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:43:55.025227 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp cascade
[0m14:43:55.108379 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m14:43:55.111383 [debug] [Thread-1  ]: finished collecting timing info
[0m14:43:55.111383 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m14:43:55.242747 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ffa01cec-41a8-457e-bc6c-74bffef13a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025C6F012760>]}
[0m14:43:55.242747 [info ] [Thread-1  ]: 4 of 7 OK created sql incremental model DBT_stg.registration_events_grouped .... [[32mSUCCESS 1[0m in 1.43s]
[0m14:43:55.244718 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m14:43:55.244718 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_vehicle_location
[0m14:43:55.245720 [info ] [Thread-1  ]: 5 of 7 START sql table model DBT_dwh.fact_vehicle_location ..................... [RUN]
[0m14:43:55.247722 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m14:43:55.247722 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_vehicle_location
[0m14:43:55.248721 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_vehicle_location
[0m14:43:55.256747 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_vehicle_location"
[0m14:43:55.256747 [debug] [Thread-1  ]: finished collecting timing info
[0m14:43:55.257721 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_vehicle_location
[0m14:43:55.260760 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_vehicle_location"
[0m14:43:55.261721 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m14:43:55.262762 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location  as
        (

with locations as (
    SELECT
        event_at,
        data_id,
        data_location_lat,
        data_location_lng,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    INNER JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON e.event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'update'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_location_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    operating_period_key,
    data_location_lat as vehicle_location_lat,
    data_location_lng as vehicle_location_lng,
    event_at as vehicle_location_time
FROM locations


--- ASSUMPTION Events are recorded only if vehicle is registered to a operation period
        );
[0m14:43:55.262762 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:43:57.081417 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.82 seconds
[0m14:43:57.083412 [debug] [Thread-1  ]: finished collecting timing info
[0m14:43:57.084413 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: Close
[0m14:43:57.233589 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ffa01cec-41a8-457e-bc6c-74bffef13a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025C6F101EE0>]}
[0m14:43:57.234588 [info ] [Thread-1  ]: 5 of 7 OK created sql table model DBT_dwh.fact_vehicle_location ................ [[32mSUCCESS 1[0m in 1.99s]
[0m14:43:57.235617 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_vehicle_location
[0m14:43:57.235617 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_deregistration
[0m14:43:57.236684 [info ] [Thread-1  ]: 6 of 7 START sql table model DBT_dwh.fact_deregistration ....................... [RUN]
[0m14:43:57.237641 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_deregistration"
[0m14:43:57.237641 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_deregistration
[0m14:43:57.238669 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_deregistration
[0m14:43:57.243668 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_deregistration"
[0m14:43:57.244669 [debug] [Thread-1  ]: finished collecting timing info
[0m14:43:57.244669 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_deregistration
[0m14:43:57.247681 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_deregistration"
[0m14:43:57.249669 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m14:43:57.249669 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_deregistration  as
        (

with events as (
    SELECT
        r.data_id,
        r.deregister_event_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time AND op.operating_period_finish_time
    WHERE r.deregister_event_at IS NOT NULL
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(deregister_event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as deregistration_key,
    operating_period_key,
    deregister_event_at as deregistration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
        );
[0m14:43:57.249669 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:43:59.079722 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.83 seconds
[0m14:43:59.082714 [debug] [Thread-1  ]: finished collecting timing info
[0m14:43:59.082714 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: Close
[0m14:43:59.207247 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ffa01cec-41a8-457e-bc6c-74bffef13a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025C6F012F10>]}
[0m14:43:59.207247 [info ] [Thread-1  ]: 6 of 7 OK created sql table model DBT_dwh.fact_deregistration .................. [[32mSUCCESS 1[0m in 1.97s]
[0m14:43:59.209247 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_deregistration
[0m14:43:59.209247 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_registration
[0m14:43:59.210250 [info ] [Thread-1  ]: 7 of 7 START sql table model DBT_dwh.fact_registration ......................... [RUN]
[0m14:43:59.211254 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_registration"
[0m14:43:59.211254 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_registration
[0m14:43:59.212258 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_registration
[0m14:43:59.217249 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_registration"
[0m14:43:59.218291 [debug] [Thread-1  ]: finished collecting timing info
[0m14:43:59.219257 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_registration
[0m14:43:59.222290 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_registration"
[0m14:43:59.223247 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m14:43:59.223247 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_registration  as
        (

with events as (
    SELECT
        r.data_id,
        r.register_event_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(register_event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as registration_key,
    operating_period_key,
    register_event_at as registration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
-- QUESTION:   Difference between event_on and data_location_at
        );
[0m14:43:59.224247 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:44:00.373354 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.15 seconds
[0m14:44:00.376348 [debug] [Thread-1  ]: finished collecting timing info
[0m14:44:00.376348 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: Close
[0m14:44:00.545469 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ffa01cec-41a8-457e-bc6c-74bffef13a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025C6F0A1FA0>]}
[0m14:44:00.546465 [info ] [Thread-1  ]: 7 of 7 OK created sql table model DBT_dwh.fact_registration .................... [[32mSUCCESS 1[0m in 1.33s]
[0m14:44:00.548445 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_registration
[0m14:44:00.549436 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:44:00.550466 [info ] [MainThread]: 
[0m14:44:00.551441 [info ] [MainThread]: Finished running 2 incremental models, 5 table models in 0 hours 0 minutes and 18.64 seconds (18.64s).
[0m14:44:00.552435 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:44:00.552435 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m14:44:00.552435 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_stg' was properly closed.
[0m14:44:00.552435 [debug] [MainThread]: Connection 'model.door2door_dwh.fact_registration' was properly closed.
[0m14:44:00.561465 [info ] [MainThread]: 
[0m14:44:00.562435 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:44:00.563371 [info ] [MainThread]: 
[0m14:44:00.564409 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m14:44:00.565394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025C6F069C70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025C6EC5D970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025C6EA62580>]}
[0m14:44:00.565394 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 14:57:43.449256 | dc29e482-d76e-47bb-bb53-69fdfe20a123 ==============================
[0m14:57:43.449256 [info ] [MainThread]: Running with dbt=1.3.1
[0m14:57:43.450262 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m14:57:43.451259 [debug] [MainThread]: Tracking: tracking
[0m14:57:43.451935 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020FAE789CD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020FAE789D30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020FAE789D90>]}
[0m14:57:43.629258 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:57:43.630258 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\fact_vehicle_location.sql
[0m14:57:43.646265 [debug] [MainThread]: 1603: static parser failed on dwh\fact_vehicle_location.sql
[0m14:57:43.687300 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_vehicle_location.sql
[0m14:57:43.709257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dc29e482-d76e-47bb-bb53-69fdfe20a123', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020FAE9E30D0>]}
[0m14:57:43.721257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dc29e482-d76e-47bb-bb53-69fdfe20a123', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020FAE9B1040>]}
[0m14:57:43.721257 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m14:57:43.722272 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dc29e482-d76e-47bb-bb53-69fdfe20a123', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020FAE9B13D0>]}
[0m14:57:43.723259 [info ] [MainThread]: 
[0m14:57:43.724261 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:57:43.727259 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:57:43.743306 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:57:43.743306 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:57:43.744258 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:57:44.740917 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 1.0 seconds
[0m14:57:44.741918 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:57:44.879264 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:57:44.883281 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:57:44.884283 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:57:44.884283 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:57:45.449927 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.57 seconds
[0m14:57:45.453940 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:57:45.599733 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:57:45.606733 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:57:45.607734 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m14:57:45.607734 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:57:46.023528 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.42 seconds
[0m14:57:46.024523 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m14:57:46.153848 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:57:46.157851 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:57:46.157851 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m14:57:46.158852 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:57:46.555732 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.4 seconds
[0m14:57:46.556728 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m14:57:46.681884 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dc29e482-d76e-47bb-bb53-69fdfe20a123', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020FAE9D03A0>]}
[0m14:57:46.681884 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:57:46.682936 [info ] [MainThread]: 
[0m14:57:46.688545 [debug] [Thread-1  ]: Began running node model.door2door_dwh.event
[0m14:57:46.689594 [info ] [Thread-1  ]: 1 of 7 START sql incremental model DBT_stg.event ............................... [RUN]
[0m14:57:46.690562 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.event"
[0m14:57:46.690562 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.event
[0m14:57:46.691566 [debug] [Thread-1  ]: Compiling model.door2door_dwh.event
[0m14:57:46.699584 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.event"
[0m14:57:46.701556 [debug] [Thread-1  ]: finished collecting timing info
[0m14:57:46.701556 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.event
[0m14:57:46.774557 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.event"
[0m14:57:46.775559 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event"
[0m14:57:46.776599 [debug] [Thread-1  ]: On model.door2door_dwh.event: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event"} */
create or replace transient table DOOR2DOOR_DWH.DBT_stg.event  as
        (

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TEXT as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
        );
[0m14:57:46.776599 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:57:53.694533 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 6.92 seconds
[0m14:57:53.701543 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event"
[0m14:57:53.702543 [debug] [Thread-1  ]: On model.door2door_dwh.event: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.event__dbt_tmp cascade
[0m14:57:53.780278 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m14:57:53.803304 [debug] [Thread-1  ]: finished collecting timing info
[0m14:57:53.803304 [debug] [Thread-1  ]: On model.door2door_dwh.event: Close
[0m14:57:53.935660 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc29e482-d76e-47bb-bb53-69fdfe20a123', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020FAED3AD90>]}
[0m14:57:53.936687 [info ] [Thread-1  ]: 1 of 7 OK created sql incremental model DBT_stg.event .......................... [[32mSUCCESS 1[0m in 7.25s]
[0m14:57:53.938657 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.event
[0m14:57:53.939675 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_operating_period
[0m14:57:53.939675 [info ] [Thread-1  ]: 2 of 7 START sql table model DBT_dwh.dim_operating_period ...................... [RUN]
[0m14:57:53.941667 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_operating_period"
[0m14:57:53.941667 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_operating_period
[0m14:57:53.941667 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_operating_period
[0m14:57:53.946656 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_operating_period"
[0m14:57:53.947670 [debug] [Thread-1  ]: finished collecting timing info
[0m14:57:53.948656 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_operating_period
[0m14:57:53.962661 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_operating_period"
[0m14:57:53.965661 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_operating_period"
[0m14:57:53.966666 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_operating_period"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_operating_period  as
        (

with operating_periods as (
    SELECT
        data_id,
        data_start,
        data_finish,
        ROW_NUMBER() OVER (PARTITION BY data_id ORDER BY data_finish desc, data_start desc) as rn
    FROM DOOR2DOOR_DWH.DBT_stg.event
    WHERE lower(event_on) = 'operating_period'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    data_id as operating_period_source_id,
    data_start as operating_period_start_time,
    data_finish as operating_period_finish_time
FROM operating_periods
        );
[0m14:57:53.966666 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:57:54.960288 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.99 seconds
[0m14:57:54.965289 [debug] [Thread-1  ]: finished collecting timing info
[0m14:57:54.966289 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: Close
[0m14:57:55.095970 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc29e482-d76e-47bb-bb53-69fdfe20a123', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020FAEDB6A60>]}
[0m14:57:55.096970 [info ] [Thread-1  ]: 2 of 7 OK created sql table model DBT_dwh.dim_operating_period ................. [[32mSUCCESS 1[0m in 1.16s]
[0m14:57:55.098941 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_operating_period
[0m14:57:55.098941 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_vehicle
[0m14:57:55.098941 [info ] [Thread-1  ]: 3 of 7 START sql table model DBT_dwh.dim_vehicle ............................... [RUN]
[0m14:57:55.099944 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_vehicle"
[0m14:57:55.100973 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_vehicle
[0m14:57:55.100973 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_vehicle
[0m14:57:55.107944 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_vehicle"
[0m14:57:55.108944 [debug] [Thread-1  ]: finished collecting timing info
[0m14:57:55.108944 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_vehicle
[0m14:57:55.112943 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_vehicle"
[0m14:57:55.113944 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_vehicle"
[0m14:57:55.114943 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_vehicle"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_vehicle  as
        (

with vehicles as (
    SELECT
        DISTINCT data_id
    FROM DOOR2DOOR_DWH.DBT_stg.event
    WHERE lower(event_on) = 'vehicle'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    data_id as vehicle_source_id
FROM vehicles
        );
[0m14:57:55.114943 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:57:56.384178 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.27 seconds
[0m14:57:56.386174 [debug] [Thread-1  ]: finished collecting timing info
[0m14:57:56.387173 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: Close
[0m14:57:56.532945 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc29e482-d76e-47bb-bb53-69fdfe20a123', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020FAED7B790>]}
[0m14:57:56.533946 [info ] [Thread-1  ]: 3 of 7 OK created sql table model DBT_dwh.dim_vehicle .......................... [[32mSUCCESS 1[0m in 1.43s]
[0m14:57:56.534915 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_vehicle
[0m14:57:56.535917 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m14:57:56.535917 [info ] [Thread-1  ]: 4 of 7 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m14:57:56.536966 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:57:56.537945 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m14:57:56.537945 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m14:57:56.544945 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m14:57:56.544945 [debug] [Thread-1  ]: finished collecting timing info
[0m14:57:56.545946 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m14:57:56.549939 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.registration_events_grouped"
[0m14:57:56.551924 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:57:56.552916 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace transient table DOOR2DOOR_DWH.DBT_stg.registration_events_grouped  as
        (

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    WHERE lower(event) in ('register', 'deregister')
        -- AND event_at <= '2019-06-01 18:17:04.089'

    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



SELECT * FROM new_registers
        );
[0m14:57:56.552916 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:57:57.677535 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.12 seconds
[0m14:57:57.681523 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:57:57.681523 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp cascade
[0m14:57:57.760937 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m14:57:57.762932 [debug] [Thread-1  ]: finished collecting timing info
[0m14:57:57.763954 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m14:57:57.893350 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc29e482-d76e-47bb-bb53-69fdfe20a123', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020FAEDFE850>]}
[0m14:57:57.894351 [info ] [Thread-1  ]: 4 of 7 OK created sql incremental model DBT_stg.registration_events_grouped .... [[32mSUCCESS 1[0m in 1.36s]
[0m14:57:57.895353 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m14:57:57.896459 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_deregistration
[0m14:57:57.897499 [info ] [Thread-1  ]: 5 of 7 START sql table model DBT_dwh.fact_deregistration ....................... [RUN]
[0m14:57:57.898488 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_deregistration"
[0m14:57:57.899473 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_deregistration
[0m14:57:57.899473 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_deregistration
[0m14:57:57.952498 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_deregistration"
[0m14:57:57.953473 [debug] [Thread-1  ]: finished collecting timing info
[0m14:57:57.953473 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_deregistration
[0m14:57:57.956498 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_deregistration"
[0m14:57:57.958499 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m14:57:57.958499 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_deregistration  as
        (

with events as (
    SELECT
        r.data_id,
        r.deregister_event_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time AND op.operating_period_finish_time
    WHERE r.deregister_event_at IS NOT NULL
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(deregister_event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as deregistration_key,
    operating_period_key,
    deregister_event_at as deregistration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
        );
[0m14:57:57.958499 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:57:59.187901 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.23 seconds
[0m14:57:59.190926 [debug] [Thread-1  ]: finished collecting timing info
[0m14:57:59.190926 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: Close
[0m14:57:59.315727 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc29e482-d76e-47bb-bb53-69fdfe20a123', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020FAEA28460>]}
[0m14:57:59.316727 [info ] [Thread-1  ]: 5 of 7 OK created sql table model DBT_dwh.fact_deregistration .................. [[32mSUCCESS 1[0m in 1.42s]
[0m14:57:59.317780 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_deregistration
[0m14:57:59.317780 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_registration
[0m14:57:59.318849 [info ] [Thread-1  ]: 6 of 7 START sql table model DBT_dwh.fact_registration ......................... [RUN]
[0m14:57:59.319791 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_registration"
[0m14:57:59.319791 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_registration
[0m14:57:59.320820 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_registration
[0m14:57:59.325818 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_registration"
[0m14:57:59.326842 [debug] [Thread-1  ]: finished collecting timing info
[0m14:57:59.326842 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_registration
[0m14:57:59.329819 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_registration"
[0m14:57:59.331820 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m14:57:59.332830 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_registration  as
        (

with events as (
    SELECT
        r.data_id,
        r.register_event_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(register_event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as registration_key,
    operating_period_key,
    register_event_at as registration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
-- QUESTION:   Difference between event_on and data_location_at
        );
[0m14:57:59.332830 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:58:00.409158 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.08 seconds
[0m14:58:00.413128 [debug] [Thread-1  ]: finished collecting timing info
[0m14:58:00.414128 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: Close
[0m14:58:00.546554 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc29e482-d76e-47bb-bb53-69fdfe20a123', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020FAECF6F70>]}
[0m14:58:00.547554 [info ] [Thread-1  ]: 6 of 7 OK created sql table model DBT_dwh.fact_registration .................... [[32mSUCCESS 1[0m in 1.23s]
[0m14:58:00.548869 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_registration
[0m14:58:00.548869 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_vehicle_location
[0m14:58:00.549908 [info ] [Thread-1  ]: 7 of 7 START sql incremental model DBT_dwh.fact_vehicle_location ............... [RUN]
[0m14:58:00.550895 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m14:58:00.550895 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_vehicle_location
[0m14:58:00.551921 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_vehicle_location
[0m14:58:00.559922 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_vehicle_location"
[0m14:58:00.560896 [debug] [Thread-1  ]: finished collecting timing info
[0m14:58:00.561896 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_vehicle_location
[0m14:58:00.565921 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_vehicle_location"
[0m14:58:00.567927 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m14:58:00.568895 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location  as
        (

with locations as (
    SELECT
        event_at,
        data_id,
        data_location_lat,
        data_location_lng,
        data_location_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    INNER JOIN DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
        ON e.data_id = r.data_id AND e.data_location_at BETWEEN r.register_event_at and COALESCE(r.deregister_event_at, CURRENT_TIMESTAMP())
    INNER JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'update'

    
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_lat as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_lng as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_location_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    operating_period_key,
    data_location_lat as vehicle_location_lat,
    data_location_lng as vehicle_location_lng,
    data_location_at as vehicle_location_time
FROM locations


--- ASSUMPTION Events are recorded only if vehicle is registered to a operation period
        );
[0m14:58:00.568895 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:58:00.982629 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa2122-3201-98a1-0000-0001c1462565
[0m14:58:00.982629 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 002028 (42601): SQL compilation error:
ambiguous column name 'DATA_ID'
[0m14:58:00.983630 [debug] [Thread-1  ]: finished collecting timing info
[0m14:58:00.983630 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: Close
[0m14:58:01.121443 [debug] [Thread-1  ]: Database Error in model fact_vehicle_location (models\dwh\fact_vehicle_location.sql)
  002028 (42601): SQL compilation error:
  ambiguous column name 'DATA_ID'
  compiled Code at target\run\door2door_dwh\models\dwh\fact_vehicle_location.sql
[0m14:58:01.122430 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc29e482-d76e-47bb-bb53-69fdfe20a123', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020FAEDF06D0>]}
[0m14:58:01.122430 [error] [Thread-1  ]: 7 of 7 ERROR creating sql incremental model DBT_dwh.fact_vehicle_location ...... [[31mERROR[0m in 0.57s]
[0m14:58:01.124417 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_vehicle_location
[0m14:58:01.126187 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:58:01.126187 [info ] [MainThread]: 
[0m14:58:01.127187 [info ] [MainThread]: Finished running 3 incremental models, 4 table models in 0 hours 0 minutes and 17.40 seconds (17.40s).
[0m14:58:01.128159 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:58:01.128159 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m14:58:01.128159 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_dwh' was properly closed.
[0m14:58:01.129178 [debug] [MainThread]: Connection 'model.door2door_dwh.fact_vehicle_location' was properly closed.
[0m14:58:01.137188 [info ] [MainThread]: 
[0m14:58:01.138159 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:58:01.139222 [info ] [MainThread]: 
[0m14:58:01.140189 [error] [MainThread]: [33mDatabase Error in model fact_vehicle_location (models\dwh\fact_vehicle_location.sql)[0m
[0m14:58:01.141179 [error] [MainThread]:   002028 (42601): SQL compilation error:
[0m14:58:01.142157 [error] [MainThread]:   ambiguous column name 'DATA_ID'
[0m14:58:01.143254 [error] [MainThread]:   compiled Code at target\run\door2door_dwh\models\dwh\fact_vehicle_location.sql
[0m14:58:01.143254 [info ] [MainThread]: 
[0m14:58:01.144265 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=1 SKIP=0 TOTAL=7
[0m14:58:01.145267 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020FAEB2CF40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020FAED36E50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020FAED3A730>]}
[0m14:58:01.145267 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 14:58:31.618594 | 07149b93-db2e-4081-b8b8-269d593b47c3 ==============================
[0m14:58:31.618594 [info ] [MainThread]: Running with dbt=1.3.1
[0m14:58:31.618594 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m14:58:31.619566 [debug] [MainThread]: Tracking: tracking
[0m14:58:31.619566 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E4EDDF9D60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E4EDDF9DC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E4EDDF9E20>]}
[0m14:58:31.747595 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:58:31.748595 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\fact_vehicle_location.sql
[0m14:58:31.762608 [debug] [MainThread]: 1603: static parser failed on dwh\fact_vehicle_location.sql
[0m14:58:31.799595 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_vehicle_location.sql
[0m14:58:31.820608 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '07149b93-db2e-4081-b8b8-269d593b47c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E4EE0520D0>]}
[0m14:58:31.830596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '07149b93-db2e-4081-b8b8-269d593b47c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E4EE024790>]}
[0m14:58:31.831566 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m14:58:31.831566 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '07149b93-db2e-4081-b8b8-269d593b47c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E4EE024EE0>]}
[0m14:58:31.833595 [info ] [MainThread]: 
[0m14:58:31.834567 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:58:31.836568 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:58:31.850595 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:58:31.850595 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:58:31.851595 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:58:32.697608 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.85 seconds
[0m14:58:32.699604 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:58:32.826027 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:58:32.830031 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:58:32.830031 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:58:32.831030 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:58:33.396103 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.57 seconds
[0m14:58:33.397098 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:58:33.528625 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:58:33.536625 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:58:33.536625 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m14:58:33.537610 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:58:34.121753 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.58 seconds
[0m14:58:34.122750 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m14:58:34.257682 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:58:34.260707 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:58:34.260707 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m14:58:34.261680 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:58:34.679118 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.42 seconds
[0m14:58:34.680111 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m14:58:34.815585 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '07149b93-db2e-4081-b8b8-269d593b47c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E4EDF05910>]}
[0m14:58:34.816554 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:58:34.817553 [info ] [MainThread]: 
[0m14:58:34.822618 [debug] [Thread-1  ]: Began running node model.door2door_dwh.event
[0m14:58:34.822618 [info ] [Thread-1  ]: 1 of 7 START sql incremental model DBT_stg.event ............................... [RUN]
[0m14:58:34.824646 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.event"
[0m14:58:34.824646 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.event
[0m14:58:34.825620 [debug] [Thread-1  ]: Compiling model.door2door_dwh.event
[0m14:58:34.840620 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.event"
[0m14:58:34.841620 [debug] [Thread-1  ]: finished collecting timing info
[0m14:58:34.842620 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.event
[0m14:58:34.898617 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.event"
[0m14:58:34.899618 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event"
[0m14:58:34.900617 [debug] [Thread-1  ]: On model.door2door_dwh.event: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event"} */
create or replace transient table DOOR2DOOR_DWH.DBT_stg.event  as
        (

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TEXT as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
        );
[0m14:58:34.900617 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:58:38.949023 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 4.05 seconds
[0m14:58:38.956021 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event"
[0m14:58:38.957026 [debug] [Thread-1  ]: On model.door2door_dwh.event: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.event__dbt_tmp cascade
[0m14:58:39.036996 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m14:58:39.060017 [debug] [Thread-1  ]: finished collecting timing info
[0m14:58:39.060017 [debug] [Thread-1  ]: On model.door2door_dwh.event: Close
[0m14:58:39.188016 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07149b93-db2e-4081-b8b8-269d593b47c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E4EE253820>]}
[0m14:58:39.188016 [info ] [Thread-1  ]: 1 of 7 OK created sql incremental model DBT_stg.event .......................... [[32mSUCCESS 1[0m in 4.36s]
[0m14:58:39.189605 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.event
[0m14:58:39.191639 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_operating_period
[0m14:58:39.191639 [info ] [Thread-1  ]: 2 of 7 START sql table model DBT_dwh.dim_operating_period ...................... [RUN]
[0m14:58:39.192649 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_operating_period"
[0m14:58:39.193635 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_operating_period
[0m14:58:39.193635 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_operating_period
[0m14:58:39.198633 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_operating_period"
[0m14:58:39.199633 [debug] [Thread-1  ]: finished collecting timing info
[0m14:58:39.199633 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_operating_period
[0m14:58:39.210634 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_operating_period"
[0m14:58:39.212633 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_operating_period"
[0m14:58:39.212633 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_operating_period"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_operating_period  as
        (

with operating_periods as (
    SELECT
        data_id,
        data_start,
        data_finish,
        ROW_NUMBER() OVER (PARTITION BY data_id ORDER BY data_finish desc, data_start desc) as rn
    FROM DOOR2DOOR_DWH.DBT_stg.event
    WHERE lower(event_on) = 'operating_period'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    data_id as operating_period_source_id,
    data_start as operating_period_start_time,
    data_finish as operating_period_finish_time
FROM operating_periods
        );
[0m14:58:39.212633 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:58:40.151416 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.94 seconds
[0m14:58:40.154472 [debug] [Thread-1  ]: finished collecting timing info
[0m14:58:40.154472 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: Close
[0m14:58:40.284194 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07149b93-db2e-4081-b8b8-269d593b47c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E4EE4412E0>]}
[0m14:58:40.284194 [info ] [Thread-1  ]: 2 of 7 OK created sql table model DBT_dwh.dim_operating_period ................. [[32mSUCCESS 1[0m in 1.09s]
[0m14:58:40.286190 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_operating_period
[0m14:58:40.286190 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_vehicle
[0m14:58:40.287222 [info ] [Thread-1  ]: 3 of 7 START sql table model DBT_dwh.dim_vehicle ............................... [RUN]
[0m14:58:40.288214 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_vehicle"
[0m14:58:40.288214 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_vehicle
[0m14:58:40.288214 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_vehicle
[0m14:58:40.293243 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_vehicle"
[0m14:58:40.294243 [debug] [Thread-1  ]: finished collecting timing info
[0m14:58:40.294243 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_vehicle
[0m14:58:40.298217 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_vehicle"
[0m14:58:40.300246 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_vehicle"
[0m14:58:40.300246 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_vehicle"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_vehicle  as
        (

with vehicles as (
    SELECT
        DISTINCT data_id
    FROM DOOR2DOOR_DWH.DBT_stg.event
    WHERE lower(event_on) = 'vehicle'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    data_id as vehicle_source_id
FROM vehicles
        );
[0m14:58:40.300246 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:58:41.311182 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.01 seconds
[0m14:58:41.313177 [debug] [Thread-1  ]: finished collecting timing info
[0m14:58:41.314177 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: Close
[0m14:58:41.437005 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07149b93-db2e-4081-b8b8-269d593b47c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E4EE3A6910>]}
[0m14:58:41.438006 [info ] [Thread-1  ]: 3 of 7 OK created sql table model DBT_dwh.dim_vehicle .......................... [[32mSUCCESS 1[0m in 1.15s]
[0m14:58:41.439025 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_vehicle
[0m14:58:41.440006 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m14:58:41.440006 [info ] [Thread-1  ]: 4 of 7 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m14:58:41.441443 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:58:41.441443 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m14:58:41.441443 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m14:58:41.448465 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m14:58:41.449464 [debug] [Thread-1  ]: finished collecting timing info
[0m14:58:41.449464 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m14:58:41.454477 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.registration_events_grouped"
[0m14:58:41.455466 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:58:41.456464 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace transient table DOOR2DOOR_DWH.DBT_stg.registration_events_grouped  as
        (

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    WHERE lower(event) in ('register', 'deregister')
        -- AND event_at <= '2019-06-01 18:17:04.089'

    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



SELECT * FROM new_registers
        );
[0m14:58:41.456464 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:58:42.338936 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.88 seconds
[0m14:58:42.342930 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:58:42.342930 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp cascade
[0m14:58:42.425335 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m14:58:42.428362 [debug] [Thread-1  ]: finished collecting timing info
[0m14:58:42.428362 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m14:58:42.564396 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07149b93-db2e-4081-b8b8-269d593b47c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E4EE461CD0>]}
[0m14:58:42.565396 [info ] [Thread-1  ]: 4 of 7 OK created sql incremental model DBT_stg.registration_events_grouped .... [[32mSUCCESS 1[0m in 1.12s]
[0m14:58:42.566375 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m14:58:42.568381 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_deregistration
[0m14:58:42.568381 [info ] [Thread-1  ]: 5 of 7 START sql table model DBT_dwh.fact_deregistration ....................... [RUN]
[0m14:58:42.570036 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_deregistration"
[0m14:58:42.570036 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_deregistration
[0m14:58:42.571050 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_deregistration
[0m14:58:42.627049 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_deregistration"
[0m14:58:42.630074 [debug] [Thread-1  ]: finished collecting timing info
[0m14:58:42.630074 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_deregistration
[0m14:58:42.633088 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_deregistration"
[0m14:58:42.635050 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m14:58:42.635050 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_deregistration  as
        (

with events as (
    SELECT
        r.data_id,
        r.deregister_event_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time AND op.operating_period_finish_time
    WHERE r.deregister_event_at IS NOT NULL
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(deregister_event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as deregistration_key,
    operating_period_key,
    deregister_event_at as deregistration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
        );
[0m14:58:42.636050 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:58:43.603688 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.97 seconds
[0m14:58:43.605685 [debug] [Thread-1  ]: finished collecting timing info
[0m14:58:43.606684 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: Close
[0m14:58:43.732169 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07149b93-db2e-4081-b8b8-269d593b47c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E4EE474220>]}
[0m14:58:43.733170 [info ] [Thread-1  ]: 5 of 7 OK created sql table model DBT_dwh.fact_deregistration .................. [[32mSUCCESS 1[0m in 1.16s]
[0m14:58:43.734172 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_deregistration
[0m14:58:43.735170 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_registration
[0m14:58:43.735170 [info ] [Thread-1  ]: 6 of 7 START sql table model DBT_dwh.fact_registration ......................... [RUN]
[0m14:58:43.736170 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_registration"
[0m14:58:43.737173 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_registration
[0m14:58:43.737173 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_registration
[0m14:58:43.742169 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_registration"
[0m14:58:43.743169 [debug] [Thread-1  ]: finished collecting timing info
[0m14:58:43.743169 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_registration
[0m14:58:43.746169 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_registration"
[0m14:58:43.748170 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m14:58:43.748170 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_registration  as
        (

with events as (
    SELECT
        r.data_id,
        r.register_event_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(register_event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as registration_key,
    operating_period_key,
    register_event_at as registration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
-- QUESTION:   Difference between event_on and data_location_at
        );
[0m14:58:43.748170 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:58:45.235417 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.49 seconds
[0m14:58:45.237412 [debug] [Thread-1  ]: finished collecting timing info
[0m14:58:45.238412 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: Close
[0m14:58:45.364097 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07149b93-db2e-4081-b8b8-269d593b47c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E4EDF2F4C0>]}
[0m14:58:45.365123 [info ] [Thread-1  ]: 6 of 7 OK created sql table model DBT_dwh.fact_registration .................... [[32mSUCCESS 1[0m in 1.63s]
[0m14:58:45.366400 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_registration
[0m14:58:45.366400 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_vehicle_location
[0m14:58:45.367414 [info ] [Thread-1  ]: 7 of 7 START sql incremental model DBT_dwh.fact_vehicle_location ............... [RUN]
[0m14:58:45.368414 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m14:58:45.368414 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_vehicle_location
[0m14:58:45.369413 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_vehicle_location
[0m14:58:45.377412 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_vehicle_location"
[0m14:58:45.378413 [debug] [Thread-1  ]: finished collecting timing info
[0m14:58:45.378413 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_vehicle_location
[0m14:58:45.382412 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_vehicle_location"
[0m14:58:45.384413 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m14:58:45.385413 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location  as
        (

with locations as (
    SELECT
        e.event_at,
        e.data_id,
        e.data_location_lat,
        e.data_location_lng,
        e.data_location_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    INNER JOIN DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
        ON e.data_id = r.data_id AND e.data_location_at BETWEEN r.register_event_at and COALESCE(r.deregister_event_at, CURRENT_TIMESTAMP())
    INNER JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'update'

    
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_lat as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_lng as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_location_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    operating_period_key,
    data_location_lat as vehicle_location_lat,
    data_location_lng as vehicle_location_lng,
    data_location_at as vehicle_location_time
FROM locations


--- ASSUMPTION Events are recorded only if vehicle is registered to a operation period
        );
[0m14:58:45.385413 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:58:46.579276 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.19 seconds
[0m14:58:46.582271 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m14:58:46.583271 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
drop view if exists DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location__dbt_tmp cascade
[0m14:58:46.662999 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m14:58:46.666023 [debug] [Thread-1  ]: finished collecting timing info
[0m14:58:46.666023 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: Close
[0m14:58:46.802589 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07149b93-db2e-4081-b8b8-269d593b47c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E4EE45BC10>]}
[0m14:58:46.803589 [info ] [Thread-1  ]: 7 of 7 OK created sql incremental model DBT_dwh.fact_vehicle_location .......... [[32mSUCCESS 1[0m in 1.43s]
[0m14:58:46.804780 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_vehicle_location
[0m14:58:46.806801 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:58:46.807847 [info ] [MainThread]: 
[0m14:58:46.808801 [info ] [MainThread]: Finished running 3 incremental models, 4 table models in 0 hours 0 minutes and 14.97 seconds (14.97s).
[0m14:58:46.808801 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:58:46.809832 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m14:58:46.809832 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_stg' was properly closed.
[0m14:58:46.809832 [debug] [MainThread]: Connection 'model.door2door_dwh.fact_vehicle_location' was properly closed.
[0m14:58:46.818833 [info ] [MainThread]: 
[0m14:58:46.819828 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:58:46.820803 [info ] [MainThread]: 
[0m14:58:46.821805 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m14:58:46.821805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E4EE01C460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E4EE025F70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E4EE38EBE0>]}
[0m14:58:46.822844 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 14:59:29.044634 | d8b0601f-e091-4c75-aadb-5d2400c8c82c ==============================
[0m14:59:29.044634 [info ] [MainThread]: Running with dbt=1.3.1
[0m14:59:29.045634 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m14:59:29.046639 [debug] [MainThread]: Tracking: tracking
[0m14:59:29.046639 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DDE0A58D00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DDE0A58D60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DDE0A58DC0>]}
[0m14:59:29.198993 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:59:29.198993 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:59:29.204916 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd8b0601f-e091-4c75-aadb-5d2400c8c82c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DDE0C4A0D0>]}
[0m14:59:29.204916 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd8b0601f-e091-4c75-aadb-5d2400c8c82c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DDE0B627F0>]}
[0m14:59:29.204916 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m14:59:29.204916 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd8b0601f-e091-4c75-aadb-5d2400c8c82c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DDE0B62910>]}
[0m14:59:29.204916 [info ] [MainThread]: 
[0m14:59:29.204916 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:59:29.220604 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:59:29.220604 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:59:29.220604 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:59:29.220604 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:59:30.207017 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.99 seconds
[0m14:59:30.209059 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:59:30.346575 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m14:59:30.346575 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m14:59:30.346575 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m14:59:30.361632 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:59:30.740037 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.38 seconds
[0m14:59:30.743041 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m14:59:30.881665 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:59:30.890829 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m14:59:30.890829 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m14:59:30.890829 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:59:31.527002 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.64 seconds
[0m14:59:31.530001 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m14:59:31.676203 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:59:31.682205 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m14:59:31.682205 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m14:59:31.683204 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:59:32.059488 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.38 seconds
[0m14:59:32.074723 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m14:59:32.317121 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd8b0601f-e091-4c75-aadb-5d2400c8c82c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DDE0A585E0>]}
[0m14:59:32.317121 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:59:32.317121 [info ] [MainThread]: 
[0m14:59:32.317121 [debug] [Thread-1  ]: Began running node model.door2door_dwh.event
[0m14:59:32.317121 [info ] [Thread-1  ]: 1 of 7 START sql incremental model DBT_stg.event ............................... [RUN]
[0m14:59:32.317121 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.event"
[0m14:59:32.317121 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.event
[0m14:59:32.317121 [debug] [Thread-1  ]: Compiling model.door2door_dwh.event
[0m14:59:32.332714 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.event"
[0m14:59:32.332714 [debug] [Thread-1  ]: finished collecting timing info
[0m14:59:32.332714 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.event
[0m14:59:32.379596 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.event"
[0m14:59:32.395216 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event"
[0m14:59:32.395216 [debug] [Thread-1  ]: On model.door2door_dwh.event: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event"} */
create or replace transient table DOOR2DOOR_DWH.DBT_stg.event  as
        (

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TEXT as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
        );
[0m14:59:32.395216 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:59:37.347567 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 4.95 seconds
[0m14:59:37.347567 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.event"
[0m14:59:37.347567 [debug] [Thread-1  ]: On model.door2door_dwh.event: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.event"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.event__dbt_tmp cascade
[0m14:59:37.425692 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m14:59:37.456339 [debug] [Thread-1  ]: finished collecting timing info
[0m14:59:37.456339 [debug] [Thread-1  ]: On model.door2door_dwh.event: Close
[0m14:59:37.581729 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd8b0601f-e091-4c75-aadb-5d2400c8c82c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DDE0FAAC70>]}
[0m14:59:37.581729 [info ] [Thread-1  ]: 1 of 7 OK created sql incremental model DBT_stg.event .......................... [[32mSUCCESS 1[0m in 5.26s]
[0m14:59:37.581729 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.event
[0m14:59:37.596932 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_operating_period
[0m14:59:37.596932 [info ] [Thread-1  ]: 2 of 7 START sql table model DBT_dwh.dim_operating_period ...................... [RUN]
[0m14:59:37.596932 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_operating_period"
[0m14:59:37.596932 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_operating_period
[0m14:59:37.596932 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_operating_period
[0m14:59:37.612602 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_operating_period"
[0m14:59:37.612602 [debug] [Thread-1  ]: finished collecting timing info
[0m14:59:37.612602 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_operating_period
[0m14:59:37.628231 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_operating_period"
[0m14:59:37.628231 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_operating_period"
[0m14:59:37.628231 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_operating_period"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_operating_period  as
        (

with operating_periods as (
    SELECT
        data_id,
        data_start,
        data_finish,
        ROW_NUMBER() OVER (PARTITION BY data_id ORDER BY data_finish desc, data_start desc) as rn
    FROM DOOR2DOOR_DWH.DBT_stg.event
    WHERE lower(event_on) = 'operating_period'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    data_id as operating_period_source_id,
    data_start as operating_period_start_time,
    data_finish as operating_period_finish_time
FROM operating_periods
        );
[0m14:59:37.628231 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:59:38.503693 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.88 seconds
[0m14:59:38.503693 [debug] [Thread-1  ]: finished collecting timing info
[0m14:59:38.503693 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: Close
[0m14:59:38.628717 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd8b0601f-e091-4c75-aadb-5d2400c8c82c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DDE0FB2C40>]}
[0m14:59:38.628717 [info ] [Thread-1  ]: 2 of 7 OK created sql table model DBT_dwh.dim_operating_period ................. [[32mSUCCESS 1[0m in 1.03s]
[0m14:59:38.628717 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_operating_period
[0m14:59:38.628717 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_vehicle
[0m14:59:38.628717 [info ] [Thread-1  ]: 3 of 7 START sql table model DBT_dwh.dim_vehicle ............................... [RUN]
[0m14:59:38.628717 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_vehicle"
[0m14:59:38.628717 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_vehicle
[0m14:59:38.628717 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_vehicle
[0m14:59:38.643815 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_vehicle"
[0m14:59:38.643815 [debug] [Thread-1  ]: finished collecting timing info
[0m14:59:38.643815 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_vehicle
[0m14:59:38.643815 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_vehicle"
[0m14:59:38.643815 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_vehicle"
[0m14:59:38.643815 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_vehicle"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_vehicle  as
        (

with vehicles as (
    SELECT
        DISTINCT data_id
    FROM DOOR2DOOR_DWH.DBT_stg.event
    WHERE lower(event_on) = 'vehicle'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    data_id as vehicle_source_id
FROM vehicles
        );
[0m14:59:38.643815 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:59:39.857965 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.21 seconds
[0m14:59:39.857965 [debug] [Thread-1  ]: finished collecting timing info
[0m14:59:39.857965 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: Close
[0m14:59:40.014215 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd8b0601f-e091-4c75-aadb-5d2400c8c82c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DDE0C7BE50>]}
[0m14:59:40.014215 [info ] [Thread-1  ]: 3 of 7 OK created sql table model DBT_dwh.dim_vehicle .......................... [[32mSUCCESS 1[0m in 1.39s]
[0m14:59:40.014215 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_vehicle
[0m14:59:40.014215 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m14:59:40.014215 [info ] [Thread-1  ]: 4 of 7 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m14:59:40.014215 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:59:40.014215 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m14:59:40.014215 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m14:59:40.014215 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m14:59:40.014215 [debug] [Thread-1  ]: finished collecting timing info
[0m14:59:40.014215 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m14:59:40.029840 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.registration_events_grouped"
[0m14:59:40.029840 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:59:40.029840 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace transient table DOOR2DOOR_DWH.DBT_stg.registration_events_grouped  as
        (

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    WHERE lower(event) in ('register', 'deregister')
        -- AND event_at <= '2019-06-01 18:17:04.089'

    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



SELECT * FROM new_registers
        );
[0m14:59:40.029840 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:59:41.232985 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.2 seconds
[0m14:59:41.232985 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m14:59:41.232985 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp cascade
[0m14:59:41.327324 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.09 seconds
[0m14:59:41.327324 [debug] [Thread-1  ]: finished collecting timing info
[0m14:59:41.327324 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m14:59:41.452307 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd8b0601f-e091-4c75-aadb-5d2400c8c82c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DDE0D34640>]}
[0m14:59:41.452307 [info ] [Thread-1  ]: 4 of 7 OK created sql incremental model DBT_stg.registration_events_grouped .... [[32mSUCCESS 1[0m in 1.44s]
[0m14:59:41.467344 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m14:59:41.467344 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_deregistration
[0m14:59:41.467344 [info ] [Thread-1  ]: 5 of 7 START sql table model DBT_dwh.fact_deregistration ....................... [RUN]
[0m14:59:41.467344 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_deregistration"
[0m14:59:41.467344 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_deregistration
[0m14:59:41.467344 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_deregistration
[0m14:59:41.467344 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_deregistration"
[0m14:59:41.467344 [debug] [Thread-1  ]: finished collecting timing info
[0m14:59:41.467344 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_deregistration
[0m14:59:41.467344 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_deregistration"
[0m14:59:41.482939 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m14:59:41.482939 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_deregistration  as
        (

with events as (
    SELECT
        r.data_id,
        r.deregister_event_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time AND op.operating_period_finish_time
    WHERE r.deregister_event_at IS NOT NULL
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(deregister_event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as deregistration_key,
    operating_period_key,
    deregister_event_at as deregistration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
        );
[0m14:59:41.482939 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:59:42.655459 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.17 seconds
[0m14:59:42.655459 [debug] [Thread-1  ]: finished collecting timing info
[0m14:59:42.655459 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: Close
[0m14:59:42.795476 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd8b0601f-e091-4c75-aadb-5d2400c8c82c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DDE1033280>]}
[0m14:59:42.795476 [info ] [Thread-1  ]: 5 of 7 OK created sql table model DBT_dwh.fact_deregistration .................. [[32mSUCCESS 1[0m in 1.31s]
[0m14:59:42.795476 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_deregistration
[0m14:59:42.795476 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_registration
[0m14:59:42.795476 [info ] [Thread-1  ]: 6 of 7 START sql table model DBT_dwh.fact_registration ......................... [RUN]
[0m14:59:42.795476 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_registration"
[0m14:59:42.795476 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_registration
[0m14:59:42.795476 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_registration
[0m14:59:42.795476 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_registration"
[0m14:59:42.795476 [debug] [Thread-1  ]: finished collecting timing info
[0m14:59:42.795476 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_registration
[0m14:59:42.795476 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_registration"
[0m14:59:42.795476 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m14:59:42.811102 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_registration  as
        (

with events as (
    SELECT
        r.data_id,
        r.register_event_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(register_event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as registration_key,
    operating_period_key,
    register_event_at as registration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
-- QUESTION:   Difference between event_on and data_location_at
        );
[0m14:59:42.811102 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:59:43.889839 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.08 seconds
[0m14:59:43.889839 [debug] [Thread-1  ]: finished collecting timing info
[0m14:59:43.889839 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: Close
[0m14:59:44.030375 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd8b0601f-e091-4c75-aadb-5d2400c8c82c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DDE0FDA2B0>]}
[0m14:59:44.030375 [info ] [Thread-1  ]: 6 of 7 OK created sql table model DBT_dwh.fact_registration .................... [[32mSUCCESS 1[0m in 1.23s]
[0m14:59:44.030375 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_registration
[0m14:59:44.030375 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_vehicle_location
[0m14:59:44.030375 [info ] [Thread-1  ]: 7 of 7 START sql incremental model DBT_dwh.fact_vehicle_location ............... [RUN]
[0m14:59:44.030375 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m14:59:44.030375 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_vehicle_location
[0m14:59:44.030375 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_vehicle_location
[0m14:59:44.045486 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_vehicle_location"
[0m14:59:44.045486 [debug] [Thread-1  ]: finished collecting timing info
[0m14:59:44.045486 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_vehicle_location
[0m14:59:44.092377 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_vehicle_location"
[0m14:59:44.092377 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m14:59:44.092377 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location  as
        (

with locations as (
    SELECT
        e.event_at,
        e.data_id,
        e.data_location_lat,
        e.data_location_lng,
        e.data_location_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.event e
    INNER JOIN DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
        ON e.data_id = r.data_id AND e.data_location_at BETWEEN r.register_event_at and COALESCE(r.deregister_event_at, CURRENT_TIMESTAMP())
    INNER JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'update'

    
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_lat as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_lng as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_location_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    operating_period_key,
    data_location_lat as vehicle_location_lat,
    data_location_lng as vehicle_location_lng,
    data_location_at as vehicle_location_time
FROM locations


--- ASSUMPTION Events are recorded only if vehicle is registered to a operation period
        );
[0m14:59:44.092377 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:59:45.357978 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.27 seconds
[0m14:59:45.357978 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m14:59:45.357978 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
drop view if exists DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location__dbt_tmp cascade
[0m14:59:45.452349 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.09 seconds
[0m14:59:45.452349 [debug] [Thread-1  ]: finished collecting timing info
[0m14:59:45.452349 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: Close
[0m14:59:45.592974 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd8b0601f-e091-4c75-aadb-5d2400c8c82c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DDE1043430>]}
[0m14:59:45.592974 [info ] [Thread-1  ]: 7 of 7 OK created sql incremental model DBT_dwh.fact_vehicle_location .......... [[32mSUCCESS 1[0m in 1.56s]
[0m14:59:45.592974 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_vehicle_location
[0m14:59:45.592974 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m14:59:45.592974 [info ] [MainThread]: 
[0m14:59:45.607985 [info ] [MainThread]: Finished running 3 incremental models, 4 table models in 0 hours 0 minutes and 16.39 seconds (16.39s).
[0m14:59:45.607985 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:59:45.607985 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m14:59:45.607985 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_stg' was properly closed.
[0m14:59:45.607985 [debug] [MainThread]: Connection 'model.door2door_dwh.fact_vehicle_location' was properly closed.
[0m14:59:45.607985 [info ] [MainThread]: 
[0m14:59:45.607985 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:59:45.607985 [info ] [MainThread]: 
[0m14:59:45.607985 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m14:59:45.607985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DDE0F648E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DDE0F64DC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DDE0F64400>]}
[0m14:59:45.607985 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 15:06:31.044611 | 053632bc-44eb-4b11-8c4d-a57bb59f5612 ==============================
[0m15:06:31.044611 [info ] [MainThread]: Running with dbt=1.3.1
[0m15:06:31.045583 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m15:06:31.045583 [debug] [MainThread]: Tracking: tracking
[0m15:06:31.045583 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002699E8B9CA0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002699E8B9D00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002699E8B9D60>]}
[0m15:06:31.180612 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 4 files changed.
[0m15:06:31.180612 [debug] [MainThread]: Partial parsing: added file: door2door_dwh://models\stg\vehicle_iot_data_parsed.sql
[0m15:06:31.181611 [debug] [MainThread]: Partial parsing: deleted file: door2door_dwh://models\stg\event.sql
[0m15:06:31.181611 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\dim_operating_period.sql
[0m15:06:31.181611 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\dim_vehicle.sql
[0m15:06:31.182583 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\stg\registration_events_grouped.sql
[0m15:06:31.182583 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\fact_vehicle_location.sql
[0m15:06:31.195611 [debug] [MainThread]: 1603: static parser failed on stg\vehicle_iot_data_parsed.sql
[0m15:06:31.213611 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\vehicle_iot_data_parsed.sql
[0m15:06:31.215611 [debug] [MainThread]: 1603: static parser failed on dwh\fact_deregistration.sql
[0m15:06:31.233612 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_deregistration.sql
[0m15:06:31.234601 [debug] [MainThread]: 1603: static parser failed on dwh\fact_registration.sql
[0m15:06:31.241612 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_registration.sql
[0m15:06:31.243611 [debug] [MainThread]: 1603: static parser failed on dwh\fact_vehicle_location.sql
[0m15:06:31.252611 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_vehicle_location.sql
[0m15:06:31.254611 [debug] [MainThread]: 1603: static parser failed on dwh\dim_operating_period.sql
[0m15:06:31.260632 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\dim_operating_period.sql
[0m15:06:31.261599 [debug] [MainThread]: 1603: static parser failed on dwh\dim_vehicle.sql
[0m15:06:31.267612 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\dim_vehicle.sql
[0m15:06:31.269611 [debug] [MainThread]: 1603: static parser failed on stg\registration_events_grouped.sql
[0m15:06:31.278583 [debug] [MainThread]: 1602: parser fallback to jinja rendering on stg\registration_events_grouped.sql
[0m15:06:31.300611 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '053632bc-44eb-4b11-8c4d-a57bb59f5612', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002699EB190D0>]}
[0m15:06:31.309612 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '053632bc-44eb-4b11-8c4d-a57bb59f5612', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002699E9EFB50>]}
[0m15:06:31.310582 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m15:06:31.311586 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '053632bc-44eb-4b11-8c4d-a57bb59f5612', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002699EA6DAC0>]}
[0m15:06:31.312584 [info ] [MainThread]: 
[0m15:06:31.313612 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m15:06:31.316613 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m15:06:31.330617 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m15:06:31.330617 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m15:06:31.331582 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:06:32.342668 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 1.01 seconds
[0m15:06:32.345713 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m15:06:32.499727 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m15:06:32.502723 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m15:06:32.502723 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m15:06:32.502723 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:06:33.085816 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.58 seconds
[0m15:06:33.087770 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m15:06:33.223000 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m15:06:33.229008 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m15:06:33.230009 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m15:06:33.230009 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:06:33.654759 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.42 seconds
[0m15:06:33.657759 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m15:06:33.786703 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m15:06:33.789208 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m15:06:33.789208 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m15:06:33.790207 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:06:34.187548 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.4 seconds
[0m15:06:34.190532 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m15:06:34.377204 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '053632bc-44eb-4b11-8c4d-a57bb59f5612', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002699E9EFCD0>]}
[0m15:06:34.378205 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:06:34.379184 [info ] [MainThread]: 
[0m15:06:34.385156 [debug] [Thread-1  ]: Began running node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:06:34.386157 [info ] [Thread-1  ]: 1 of 7 START sql incremental model DBT_stg.vehicle_iot_data_parsed ............. [RUN]
[0m15:06:34.387156 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:06:34.388170 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:06:34.388170 [debug] [Thread-1  ]: Compiling model.door2door_dwh.vehicle_iot_data_parsed
[0m15:06:34.393159 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:06:34.394223 [debug] [Thread-1  ]: finished collecting timing info
[0m15:06:34.394223 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:06:34.454188 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:06:34.457158 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:06:34.457158 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
create or replace transient table DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed  as
        (

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TEXT as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
        );
[0m15:06:34.458155 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m15:06:40.262670 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 5.8 seconds
[0m15:06:40.271711 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:06:40.271711 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed__dbt_tmp cascade
[0m15:06:40.350721 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m15:06:40.374762 [debug] [Thread-1  ]: finished collecting timing info
[0m15:06:40.375762 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: Close
[0m15:06:40.505681 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '053632bc-44eb-4b11-8c4d-a57bb59f5612', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002699EEA9A30>]}
[0m15:06:40.506686 [info ] [Thread-1  ]: 1 of 7 OK created sql incremental model DBT_stg.vehicle_iot_data_parsed ........ [[32mSUCCESS 1[0m in 6.12s]
[0m15:06:40.507688 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:06:40.508674 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_operating_period
[0m15:06:40.509847 [info ] [Thread-1  ]: 2 of 7 START sql table model DBT_dwh.dim_operating_period ...................... [RUN]
[0m15:06:40.510857 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_operating_period"
[0m15:06:40.511860 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_operating_period
[0m15:06:40.511860 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_operating_period
[0m15:06:40.516897 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_operating_period"
[0m15:06:40.517863 [debug] [Thread-1  ]: finished collecting timing info
[0m15:06:40.518862 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_operating_period
[0m15:06:40.532862 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_operating_period"
[0m15:06:40.536864 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_operating_period"
[0m15:06:40.536864 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_operating_period"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_operating_period  as
        (

with operating_periods as (
    SELECT
        data_id,
        data_start,
        data_finish,
        ROW_NUMBER() OVER (PARTITION BY data_id ORDER BY data_finish desc, data_start desc) as rn
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed
    WHERE lower(event_on) = 'operating_period'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    data_id as operating_period_source_id,
    data_start as operating_period_start_time,
    data_finish as operating_period_finish_time
FROM operating_periods
        );
[0m15:06:40.536864 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:06:41.496892 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.96 seconds
[0m15:06:41.502892 [debug] [Thread-1  ]: finished collecting timing info
[0m15:06:41.503891 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: Close
[0m15:06:41.637851 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '053632bc-44eb-4b11-8c4d-a57bb59f5612', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002699EF0EF10>]}
[0m15:06:41.638840 [info ] [Thread-1  ]: 2 of 7 OK created sql table model DBT_dwh.dim_operating_period ................. [[32mSUCCESS 1[0m in 1.13s]
[0m15:06:41.639815 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_operating_period
[0m15:06:41.640812 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_vehicle
[0m15:06:41.641809 [info ] [Thread-1  ]: 3 of 7 START sql table model DBT_dwh.dim_vehicle ............................... [RUN]
[0m15:06:41.642815 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_vehicle"
[0m15:06:41.643810 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_vehicle
[0m15:06:41.643810 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_vehicle
[0m15:06:41.650812 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_vehicle"
[0m15:06:41.650812 [debug] [Thread-1  ]: finished collecting timing info
[0m15:06:41.651810 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_vehicle
[0m15:06:41.707855 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_vehicle"
[0m15:06:41.709839 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_vehicle"
[0m15:06:41.709839 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_vehicle"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_vehicle  as
        (

with vehicles as (
    SELECT
        DISTINCT data_id
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed
    WHERE lower(event_on) = 'vehicle'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    data_id as vehicle_source_id
FROM vehicles
        );
[0m15:06:41.709839 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:06:42.933076 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.22 seconds
[0m15:06:42.936076 [debug] [Thread-1  ]: finished collecting timing info
[0m15:06:42.937076 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: Close
[0m15:06:43.082390 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '053632bc-44eb-4b11-8c4d-a57bb59f5612', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002699E87FCA0>]}
[0m15:06:43.082390 [info ] [Thread-1  ]: 3 of 7 OK created sql table model DBT_dwh.dim_vehicle .......................... [[32mSUCCESS 1[0m in 1.44s]
[0m15:06:43.084396 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_vehicle
[0m15:06:43.085388 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m15:06:43.086426 [info ] [Thread-1  ]: 4 of 7 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m15:06:43.087388 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:06:43.088388 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m15:06:43.088388 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m15:06:43.099421 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m15:06:43.100428 [debug] [Thread-1  ]: finished collecting timing info
[0m15:06:43.101387 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m15:06:43.106404 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.registration_events_grouped"
[0m15:06:43.109409 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:06:43.109409 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace transient table DOOR2DOOR_DWH.DBT_stg.registration_events_grouped  as
        (

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed e
    WHERE lower(event) in ('register', 'deregister')
        -- AND event_at <= '2019-06-01 18:17:04.089'

    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



SELECT * FROM new_registers
        );
[0m15:06:43.110391 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:06:44.228833 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.12 seconds
[0m15:06:44.232848 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:06:44.233838 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp cascade
[0m15:06:44.323834 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.09 seconds
[0m15:06:44.326877 [debug] [Thread-1  ]: finished collecting timing info
[0m15:06:44.326877 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m15:06:44.477102 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '053632bc-44eb-4b11-8c4d-a57bb59f5612', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002699EF3C2E0>]}
[0m15:06:44.477102 [info ] [Thread-1  ]: 4 of 7 OK created sql incremental model DBT_stg.registration_events_grouped .... [[32mSUCCESS 1[0m in 1.39s]
[0m15:06:44.479057 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m15:06:44.480057 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_deregistration
[0m15:06:44.480057 [info ] [Thread-1  ]: 5 of 7 START sql table model DBT_dwh.fact_deregistration ....................... [RUN]
[0m15:06:44.482062 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:06:44.482062 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_deregistration
[0m15:06:44.482062 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_deregistration
[0m15:06:44.489072 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_deregistration"
[0m15:06:44.491063 [debug] [Thread-1  ]: finished collecting timing info
[0m15:06:44.491063 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_deregistration
[0m15:06:44.494060 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_deregistration"
[0m15:06:44.495061 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:06:44.496060 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_deregistration  as
        (

with events as (
    SELECT
        r.data_id,
        r.deregister_event_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time AND op.operating_period_finish_time
    WHERE r.deregister_event_at IS NOT NULL
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(deregister_event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as deregistration_key,
    operating_period_key,
    deregister_event_at as deregistration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
        );
[0m15:06:44.496060 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:06:46.043878 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.55 seconds
[0m15:06:46.048878 [debug] [Thread-1  ]: finished collecting timing info
[0m15:06:46.048878 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: Close
[0m15:06:46.179950 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '053632bc-44eb-4b11-8c4d-a57bb59f5612', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002699EA8AA60>]}
[0m15:06:46.180951 [info ] [Thread-1  ]: 5 of 7 OK created sql table model DBT_dwh.fact_deregistration .................. [[32mSUCCESS 1[0m in 1.70s]
[0m15:06:46.181946 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_deregistration
[0m15:06:46.182985 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_registration
[0m15:06:46.182985 [info ] [Thread-1  ]: 6 of 7 START sql table model DBT_dwh.fact_registration ......................... [RUN]
[0m15:06:46.184959 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_registration"
[0m15:06:46.184959 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_registration
[0m15:06:46.184959 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_registration
[0m15:06:46.189984 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_registration"
[0m15:06:46.190984 [debug] [Thread-1  ]: finished collecting timing info
[0m15:06:46.191959 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_registration
[0m15:06:46.194984 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_registration"
[0m15:06:46.195959 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:06:46.195959 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_registration  as
        (

with events as (
    SELECT
        r.data_id,
        r.register_event_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(register_event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as registration_key,
    operating_period_key,
    register_event_at as registration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
-- QUESTION:   Difference between event_on and data_location_at
        );
[0m15:06:46.196959 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:06:47.511883 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.31 seconds
[0m15:06:47.514882 [debug] [Thread-1  ]: finished collecting timing info
[0m15:06:47.514882 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: Close
[0m15:06:47.649636 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '053632bc-44eb-4b11-8c4d-a57bb59f5612', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026987CACC40>]}
[0m15:06:47.650636 [info ] [Thread-1  ]: 6 of 7 OK created sql table model DBT_dwh.fact_registration .................... [[32mSUCCESS 1[0m in 1.46s]
[0m15:06:47.651636 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_registration
[0m15:06:47.652666 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_vehicle_location
[0m15:06:47.653638 [info ] [Thread-1  ]: 7 of 7 START sql incremental model DBT_dwh.fact_vehicle_location ............... [RUN]
[0m15:06:47.654637 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:06:47.654637 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_vehicle_location
[0m15:06:47.654637 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_vehicle_location
[0m15:06:47.667633 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_vehicle_location"
[0m15:06:47.669652 [debug] [Thread-1  ]: finished collecting timing info
[0m15:06:47.669652 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_vehicle_location
[0m15:06:47.675634 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_vehicle_location"
[0m15:06:47.679634 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:06:47.679634 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location  as
        (

with locations as (
    SELECT
        e.event_at,
        e.data_id,
        e.data_location_lat,
        e.data_location_lng,
        e.data_location_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed e
    INNER JOIN DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
        ON e.data_id = r.data_id AND e.data_location_at BETWEEN r.register_event_at and COALESCE(r.deregister_event_at, CURRENT_TIMESTAMP())
    INNER JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'update'

    
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_lat as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_lng as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_location_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    operating_period_key,
    data_location_lat as vehicle_location_lat,
    data_location_lng as vehicle_location_lng,
    data_location_at as vehicle_location_time
FROM locations


--- ASSUMPTION Events are recorded only if vehicle is registered to a operation period
        );
[0m15:06:47.680633 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:06:48.982992 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.3 seconds
[0m15:06:48.986020 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:06:48.987021 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
drop view if exists DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location__dbt_tmp cascade
[0m15:06:49.069643 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m15:06:49.073656 [debug] [Thread-1  ]: finished collecting timing info
[0m15:06:49.073656 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: Close
[0m15:06:49.254599 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '053632bc-44eb-4b11-8c4d-a57bb59f5612', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002699ECE4DF0>]}
[0m15:06:49.255599 [info ] [Thread-1  ]: 7 of 7 OK created sql incremental model DBT_dwh.fact_vehicle_location .......... [[32mSUCCESS 1[0m in 1.60s]
[0m15:06:49.256577 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_vehicle_location
[0m15:06:49.258571 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m15:06:49.259572 [info ] [MainThread]: 
[0m15:06:49.260572 [info ] [MainThread]: Finished running 3 incremental models, 4 table models in 0 hours 0 minutes and 17.95 seconds (17.95s).
[0m15:06:49.261572 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:06:49.261572 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m15:06:49.262599 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_stg' was properly closed.
[0m15:06:49.262599 [debug] [MainThread]: Connection 'model.door2door_dwh.fact_vehicle_location' was properly closed.
[0m15:06:49.271601 [info ] [MainThread]: 
[0m15:06:49.272484 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:06:49.273597 [info ] [MainThread]: 
[0m15:06:49.273597 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m15:06:49.274608 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002699EEED7F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002699E9EF670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002699EE2BC10>]}
[0m15:06:49.275635 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 15:08:06.929332 | 3e51044c-45bf-4656-b356-d5859811d2fd ==============================
[0m15:08:06.929332 [info ] [MainThread]: Running with dbt=1.3.1
[0m15:08:06.930333 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m15:08:06.930333 [debug] [MainThread]: Tracking: tracking
[0m15:08:06.930333 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E150FD8D30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E150FD8D90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E150FD8DF0>]}
[0m15:08:07.056333 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m15:08:07.057333 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\fact_deregistration.sql
[0m15:08:07.057333 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\fact_registration.sql
[0m15:08:07.070333 [debug] [MainThread]: 1603: static parser failed on dwh\fact_deregistration.sql
[0m15:08:07.100334 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_deregistration.sql
[0m15:08:07.102334 [debug] [MainThread]: 1603: static parser failed on dwh\fact_registration.sql
[0m15:08:07.109333 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_registration.sql
[0m15:08:07.128337 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3e51044c-45bf-4656-b356-d5859811d2fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E1512850D0>]}
[0m15:08:07.140336 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3e51044c-45bf-4656-b356-d5859811d2fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E1512010D0>]}
[0m15:08:07.140336 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m15:08:07.141334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3e51044c-45bf-4656-b356-d5859811d2fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E1511DDF70>]}
[0m15:08:07.143336 [info ] [MainThread]: 
[0m15:08:07.144335 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m15:08:07.146334 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m15:08:07.161333 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m15:08:07.161333 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m15:08:07.161333 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:08:08.069230 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.91 seconds
[0m15:08:08.070229 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m15:08:08.204874 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m15:08:08.206902 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m15:08:08.207903 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m15:08:08.207903 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:08:08.791232 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.58 seconds
[0m15:08:08.792226 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m15:08:08.927477 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m15:08:08.934476 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m15:08:08.935477 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m15:08:08.935477 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:08:09.549734 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.61 seconds
[0m15:08:09.551776 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m15:08:09.679995 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m15:08:09.682995 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m15:08:09.682995 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m15:08:09.683996 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:08:10.092140 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.41 seconds
[0m15:08:10.093135 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m15:08:10.229709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3e51044c-45bf-4656-b356-d5859811d2fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E151208520>]}
[0m15:08:10.229709 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:08:10.230727 [info ] [MainThread]: 
[0m15:08:10.235854 [debug] [Thread-1  ]: Began running node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:08:10.236853 [info ] [Thread-1  ]: 1 of 7 START sql incremental model DBT_stg.vehicle_iot_data_parsed ............. [RUN]
[0m15:08:10.237863 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:08:10.237863 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:08:10.237863 [debug] [Thread-1  ]: Compiling model.door2door_dwh.vehicle_iot_data_parsed
[0m15:08:10.245893 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:08:10.245893 [debug] [Thread-1  ]: finished collecting timing info
[0m15:08:10.246884 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:08:10.303884 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:08:10.305906 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:08:10.305906 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
create or replace transient table DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed  as
        (

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TEXT as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
        );
[0m15:08:10.306854 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m15:08:15.633248 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 5.33 seconds
[0m15:08:15.640241 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:08:15.640241 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed__dbt_tmp cascade
[0m15:08:15.721148 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m15:08:15.747179 [debug] [Thread-1  ]: finished collecting timing info
[0m15:08:15.747179 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: Close
[0m15:08:15.877652 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3e51044c-45bf-4656-b356-d5859811d2fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E15153EEE0>]}
[0m15:08:15.878665 [info ] [Thread-1  ]: 1 of 7 OK created sql incremental model DBT_stg.vehicle_iot_data_parsed ........ [[32mSUCCESS 1[0m in 5.64s]
[0m15:08:15.881657 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:08:15.883648 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_operating_period
[0m15:08:15.883648 [info ] [Thread-1  ]: 2 of 7 START sql table model DBT_dwh.dim_operating_period ...................... [RUN]
[0m15:08:15.885082 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_operating_period"
[0m15:08:15.885082 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_operating_period
[0m15:08:15.886094 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_operating_period
[0m15:08:15.891134 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_operating_period"
[0m15:08:15.891134 [debug] [Thread-1  ]: finished collecting timing info
[0m15:08:15.892096 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_operating_period
[0m15:08:15.903121 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_operating_period"
[0m15:08:15.905093 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_operating_period"
[0m15:08:15.905093 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_operating_period"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_operating_period  as
        (

with operating_periods as (
    SELECT
        data_id,
        data_start,
        data_finish,
        ROW_NUMBER() OVER (PARTITION BY data_id ORDER BY data_finish desc, data_start desc) as rn
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed
    WHERE lower(event_on) = 'operating_period'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    data_id as operating_period_source_id,
    data_start as operating_period_start_time,
    data_finish as operating_period_finish_time
FROM operating_periods
        );
[0m15:08:15.905093 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:08:16.867575 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.96 seconds
[0m15:08:16.870600 [debug] [Thread-1  ]: finished collecting timing info
[0m15:08:16.870600 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: Close
[0m15:08:16.993358 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3e51044c-45bf-4656-b356-d5859811d2fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E15161AA90>]}
[0m15:08:16.994387 [info ] [Thread-1  ]: 2 of 7 OK created sql table model DBT_dwh.dim_operating_period ................. [[32mSUCCESS 1[0m in 1.11s]
[0m15:08:16.996358 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_operating_period
[0m15:08:16.996358 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_vehicle
[0m15:08:16.997357 [info ] [Thread-1  ]: 3 of 7 START sql table model DBT_dwh.dim_vehicle ............................... [RUN]
[0m15:08:16.998358 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_vehicle"
[0m15:08:16.998358 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_vehicle
[0m15:08:16.998358 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_vehicle
[0m15:08:17.003388 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_vehicle"
[0m15:08:17.004388 [debug] [Thread-1  ]: finished collecting timing info
[0m15:08:17.004388 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_vehicle
[0m15:08:17.007400 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_vehicle"
[0m15:08:17.008402 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_vehicle"
[0m15:08:17.009360 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_vehicle"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_vehicle  as
        (

with vehicles as (
    SELECT
        DISTINCT data_id
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed
    WHERE lower(event_on) = 'vehicle'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    data_id as vehicle_source_id
FROM vehicles
        );
[0m15:08:17.009360 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:08:17.947872 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.94 seconds
[0m15:08:17.950866 [debug] [Thread-1  ]: finished collecting timing info
[0m15:08:17.950866 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: Close
[0m15:08:18.075376 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3e51044c-45bf-4656-b356-d5859811d2fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E151588EB0>]}
[0m15:08:18.076377 [info ] [Thread-1  ]: 3 of 7 OK created sql table model DBT_dwh.dim_vehicle .......................... [[32mSUCCESS 1[0m in 1.08s]
[0m15:08:18.077173 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_vehicle
[0m15:08:18.078184 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m15:08:18.078184 [info ] [Thread-1  ]: 4 of 7 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m15:08:18.080215 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:08:18.080215 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m15:08:18.080215 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m15:08:18.087212 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m15:08:18.088211 [debug] [Thread-1  ]: finished collecting timing info
[0m15:08:18.088211 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m15:08:18.093211 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.registration_events_grouped"
[0m15:08:18.095184 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:08:18.095184 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace transient table DOOR2DOOR_DWH.DBT_stg.registration_events_grouped  as
        (

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed e
    WHERE lower(event) in ('register', 'deregister')
        -- AND event_at <= '2019-06-01 18:17:04.089'

    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



SELECT * FROM new_registers
        );
[0m15:08:18.096180 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:08:19.182254 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.09 seconds
[0m15:08:19.186279 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:08:19.187299 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp cascade
[0m15:08:19.265496 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m15:08:19.268490 [debug] [Thread-1  ]: finished collecting timing info
[0m15:08:19.268490 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m15:08:19.390221 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3e51044c-45bf-4656-b356-d5859811d2fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E1514FF940>]}
[0m15:08:19.391221 [info ] [Thread-1  ]: 4 of 7 OK created sql incremental model DBT_stg.registration_events_grouped .... [[32mSUCCESS 1[0m in 1.31s]
[0m15:08:19.392195 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m15:08:19.393193 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_deregistration
[0m15:08:19.394225 [info ] [Thread-1  ]: 5 of 7 START sql incremental model DBT_dwh.fact_deregistration ................. [RUN]
[0m15:08:19.395207 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:08:19.395207 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_deregistration
[0m15:08:19.396194 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_deregistration
[0m15:08:19.452235 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_deregistration"
[0m15:08:19.453232 [debug] [Thread-1  ]: finished collecting timing info
[0m15:08:19.453232 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_deregistration
[0m15:08:19.458222 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_deregistration"
[0m15:08:19.459212 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:08:19.459212 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_deregistration  as
        (

with events as (
    SELECT
        r.data_id,
        r.deregister_event_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time AND op.operating_period_finish_time
    WHERE r.deregister_event_at IS NOT NULL

    
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(deregister_event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as deregistration_key,
    operating_period_key,
    deregister_event_at as deregistration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
        );
[0m15:08:19.460228 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:08:20.806934 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.35 seconds
[0m15:08:20.809960 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:08:20.810980 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
drop view if exists DOOR2DOOR_DWH.DBT_dwh.fact_deregistration__dbt_tmp cascade
[0m15:08:20.895638 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m15:08:20.897634 [debug] [Thread-1  ]: finished collecting timing info
[0m15:08:20.898643 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: Close
[0m15:08:21.025574 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3e51044c-45bf-4656-b356-d5859811d2fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E15155F6A0>]}
[0m15:08:21.026575 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model DBT_dwh.fact_deregistration ............ [[32mSUCCESS 1[0m in 1.63s]
[0m15:08:21.027927 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_deregistration
[0m15:08:21.027927 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_registration
[0m15:08:21.028988 [info ] [Thread-1  ]: 6 of 7 START sql incremental model DBT_dwh.fact_registration ................... [RUN]
[0m15:08:21.029961 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_registration"
[0m15:08:21.029961 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_registration
[0m15:08:21.030979 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_registration
[0m15:08:21.036949 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_registration"
[0m15:08:21.037961 [debug] [Thread-1  ]: finished collecting timing info
[0m15:08:21.037961 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_registration
[0m15:08:21.041949 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_registration"
[0m15:08:21.044948 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:08:21.044948 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_registration  as
        (


with events as (
    SELECT
        r.data_id,
        r.register_event_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time

    
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(register_event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as registration_key,
    operating_period_key,
    register_event_at as registration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
-- QUESTION:   Difference between event_on and data_location_at
        );
[0m15:08:21.044948 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:08:22.347545 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.3 seconds
[0m15:08:22.350541 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:08:22.350541 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
drop view if exists DOOR2DOOR_DWH.DBT_dwh.fact_registration__dbt_tmp cascade
[0m15:08:22.431972 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m15:08:22.434941 [debug] [Thread-1  ]: finished collecting timing info
[0m15:08:22.435967 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: Close
[0m15:08:22.559082 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3e51044c-45bf-4656-b356-d5859811d2fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E1515621F0>]}
[0m15:08:22.560082 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model DBT_dwh.fact_registration .............. [[32mSUCCESS 1[0m in 1.53s]
[0m15:08:22.561886 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_registration
[0m15:08:22.561886 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_vehicle_location
[0m15:08:22.561886 [info ] [Thread-1  ]: 7 of 7 START sql incremental model DBT_dwh.fact_vehicle_location ............... [RUN]
[0m15:08:22.563914 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:08:22.563914 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_vehicle_location
[0m15:08:22.563914 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_vehicle_location
[0m15:08:22.572914 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_vehicle_location"
[0m15:08:22.573889 [debug] [Thread-1  ]: finished collecting timing info
[0m15:08:22.573889 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_vehicle_location
[0m15:08:22.578914 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_vehicle_location"
[0m15:08:22.580916 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:08:22.581914 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location  as
        (

with locations as (
    SELECT
        e.event_at,
        e.data_id,
        e.data_location_lat,
        e.data_location_lng,
        e.data_location_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed e
    INNER JOIN DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
        ON e.data_id = r.data_id AND e.data_location_at BETWEEN r.register_event_at and COALESCE(r.deregister_event_at, CURRENT_TIMESTAMP())
    INNER JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'update'

    
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_lat as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_lng as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_location_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    operating_period_key,
    data_location_lat as vehicle_location_lat,
    data_location_lng as vehicle_location_lng,
    data_location_at as vehicle_location_time
FROM locations


--- ASSUMPTION Events are recorded only if vehicle is registered to a operation period
        );
[0m15:08:22.581914 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:08:24.056955 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.48 seconds
[0m15:08:24.059980 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:08:24.060981 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
drop view if exists DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location__dbt_tmp cascade
[0m15:08:24.145736 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m15:08:24.147744 [debug] [Thread-1  ]: finished collecting timing info
[0m15:08:24.148746 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: Close
[0m15:08:24.281741 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3e51044c-45bf-4656-b356-d5859811d2fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E151643E80>]}
[0m15:08:24.282741 [info ] [Thread-1  ]: 7 of 7 OK created sql incremental model DBT_dwh.fact_vehicle_location .......... [[32mSUCCESS 1[0m in 1.72s]
[0m15:08:24.284713 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_vehicle_location
[0m15:08:24.286729 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m15:08:24.287713 [info ] [MainThread]: 
[0m15:08:24.289711 [info ] [MainThread]: Finished running 5 incremental models, 2 table models in 0 hours 0 minutes and 17.14 seconds (17.14s).
[0m15:08:24.290725 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:08:24.290725 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m15:08:24.290725 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_dwh' was properly closed.
[0m15:08:24.291717 [debug] [MainThread]: Connection 'model.door2door_dwh.fact_vehicle_location' was properly closed.
[0m15:08:24.303715 [info ] [MainThread]: 
[0m15:08:24.305645 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:08:24.307047 [info ] [MainThread]: 
[0m15:08:24.308057 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m15:08:24.308057 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E151641CA0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E151641BE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E151641D60>]}
[0m15:08:24.309087 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 15:08:34.015440 | c1a331e0-eade-41ff-a2da-14d93804d87c ==============================
[0m15:08:34.015440 [info ] [MainThread]: Running with dbt=1.3.1
[0m15:08:34.015440 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m15:08:34.016412 [debug] [MainThread]: Tracking: tracking
[0m15:08:34.016412 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C236019D30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C236019D90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C236019DF0>]}
[0m15:08:34.145414 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:08:34.145414 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:08:34.151414 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c1a331e0-eade-41ff-a2da-14d93804d87c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C23620B0D0>]}
[0m15:08:34.160440 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c1a331e0-eade-41ff-a2da-14d93804d87c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C236123820>]}
[0m15:08:34.160440 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m15:08:34.161441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c1a331e0-eade-41ff-a2da-14d93804d87c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C236123940>]}
[0m15:08:34.163441 [info ] [MainThread]: 
[0m15:08:34.164410 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m15:08:34.166456 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m15:08:34.182460 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m15:08:34.182460 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m15:08:34.183413 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:08:35.005526 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.82 seconds
[0m15:08:35.006527 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m15:08:35.136139 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m15:08:35.139139 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m15:08:35.139139 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m15:08:35.139139 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:08:35.693641 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.55 seconds
[0m15:08:35.695695 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m15:08:35.821898 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m15:08:35.830892 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m15:08:35.831917 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m15:08:35.831917 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:08:36.442328 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.61 seconds
[0m15:08:36.443325 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m15:08:36.575838 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m15:08:36.578339 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m15:08:36.578339 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m15:08:36.578339 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:08:36.982881 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.4 seconds
[0m15:08:36.984878 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m15:08:37.116046 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c1a331e0-eade-41ff-a2da-14d93804d87c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C236019E20>]}
[0m15:08:37.116046 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:08:37.117077 [info ] [MainThread]: 
[0m15:08:37.122649 [debug] [Thread-1  ]: Began running node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:08:37.123644 [info ] [Thread-1  ]: 1 of 7 START sql incremental model DBT_stg.vehicle_iot_data_parsed ............. [RUN]
[0m15:08:37.124664 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:08:37.125646 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:08:37.126656 [debug] [Thread-1  ]: Compiling model.door2door_dwh.vehicle_iot_data_parsed
[0m15:08:37.135643 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:08:37.136642 [debug] [Thread-1  ]: finished collecting timing info
[0m15:08:37.136642 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:08:37.185685 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:08:37.186672 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
create or replace  view DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed__dbt_tmp
  
   as (
    

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TEXT as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
        where event_at > (select max(event_at) from DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed)
    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
  );
[0m15:08:37.186672 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m15:08:37.708161 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.52 seconds
[0m15:08:37.716168 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:08:37.717168 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
describe table DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed__dbt_tmp
[0m15:08:37.820608 [debug] [Thread-1  ]: SQL status: SUCCESS 9 in 0.1 seconds
[0m15:08:37.824637 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:08:37.825641 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
describe table DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed
[0m15:08:37.908273 [debug] [Thread-1  ]: SQL status: SUCCESS 9 in 0.08 seconds
[0m15:08:37.917300 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:08:37.917300 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
describe table "DOOR2DOOR_DWH"."DBT_STG"."VEHICLE_IOT_DATA_PARSED"
[0m15:08:38.004439 [debug] [Thread-1  ]: SQL status: SUCCESS 9 in 0.09 seconds
[0m15:08:38.021435 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:08:38.022436 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:08:38.022436 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
BEGIN
[0m15:08:38.133525 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.11 seconds
[0m15:08:38.133525 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:08:38.133525 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
insert into DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed ("EVENT", "EVENT_ON", "EVENT_AT", "DATA_ID", "DATA_LOCATION_LAT", "DATA_LOCATION_LNG", "DATA_LOCATION_AT", "DATA_START", "DATA_FINISH")
        (
            select "EVENT", "EVENT_ON", "EVENT_AT", "DATA_ID", "DATA_LOCATION_LAT", "DATA_LOCATION_LNG", "DATA_LOCATION_AT", "DATA_START", "DATA_FINISH"
            from DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed__dbt_tmp
        );
[0m15:08:41.171120 [debug] [Thread-1  ]: SQL status: SUCCESS 0 in 3.04 seconds
[0m15:08:41.171120 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:08:41.172094 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
COMMIT
[0m15:08:41.403167 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.23 seconds
[0m15:08:41.410182 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:08:41.411182 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed__dbt_tmp cascade
[0m15:08:41.523629 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.11 seconds
[0m15:08:41.542625 [debug] [Thread-1  ]: finished collecting timing info
[0m15:08:41.543625 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: Close
[0m15:08:41.670777 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1a331e0-eade-41ff-a2da-14d93804d87c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C236526610>]}
[0m15:08:41.671778 [info ] [Thread-1  ]: 1 of 7 OK created sql incremental model DBT_stg.vehicle_iot_data_parsed ........ [[32mSUCCESS 0[0m in 4.55s]
[0m15:08:41.672787 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:08:41.674779 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_operating_period
[0m15:08:41.674779 [info ] [Thread-1  ]: 2 of 7 START sql table model DBT_dwh.dim_operating_period ...................... [RUN]
[0m15:08:41.676778 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_operating_period"
[0m15:08:41.676778 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_operating_period
[0m15:08:41.676778 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_operating_period
[0m15:08:41.694778 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_operating_period"
[0m15:08:41.695784 [debug] [Thread-1  ]: finished collecting timing info
[0m15:08:41.695784 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_operating_period
[0m15:08:41.723778 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_operating_period"
[0m15:08:41.724778 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_operating_period"
[0m15:08:41.725778 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_operating_period"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_operating_period  as
        (

with operating_periods as (
    SELECT
        data_id,
        data_start,
        data_finish,
        ROW_NUMBER() OVER (PARTITION BY data_id ORDER BY data_finish desc, data_start desc) as rn
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed
    WHERE lower(event_on) = 'operating_period'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    data_id as operating_period_source_id,
    data_start as operating_period_start_time,
    data_finish as operating_period_finish_time
FROM operating_periods
        );
[0m15:08:41.725778 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:08:42.650240 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.92 seconds
[0m15:08:42.655234 [debug] [Thread-1  ]: finished collecting timing info
[0m15:08:42.655234 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: Close
[0m15:08:42.785045 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1a331e0-eade-41ff-a2da-14d93804d87c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C2365D60D0>]}
[0m15:08:42.786047 [info ] [Thread-1  ]: 2 of 7 OK created sql table model DBT_dwh.dim_operating_period ................. [[32mSUCCESS 1[0m in 1.11s]
[0m15:08:42.787046 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_operating_period
[0m15:08:42.788046 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_vehicle
[0m15:08:42.788046 [info ] [Thread-1  ]: 3 of 7 START sql table model DBT_dwh.dim_vehicle ............................... [RUN]
[0m15:08:42.789076 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_vehicle"
[0m15:08:42.790046 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_vehicle
[0m15:08:42.790046 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_vehicle
[0m15:08:42.794046 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_vehicle"
[0m15:08:42.796045 [debug] [Thread-1  ]: finished collecting timing info
[0m15:08:42.796045 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_vehicle
[0m15:08:42.799046 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_vehicle"
[0m15:08:42.800046 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_vehicle"
[0m15:08:42.800046 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_vehicle"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_vehicle  as
        (

with vehicles as (
    SELECT
        DISTINCT data_id
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed
    WHERE lower(event_on) = 'vehicle'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    data_id as vehicle_source_id
FROM vehicles
        );
[0m15:08:42.801046 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:08:43.666258 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.87 seconds
[0m15:08:43.668252 [debug] [Thread-1  ]: finished collecting timing info
[0m15:08:43.669273 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: Close
[0m15:08:43.801247 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1a331e0-eade-41ff-a2da-14d93804d87c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C236522310>]}
[0m15:08:43.802246 [info ] [Thread-1  ]: 3 of 7 OK created sql table model DBT_dwh.dim_vehicle .......................... [[32mSUCCESS 1[0m in 1.01s]
[0m15:08:43.803250 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_vehicle
[0m15:08:43.804246 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m15:08:43.804246 [info ] [Thread-1  ]: 4 of 7 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m15:08:43.805246 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:08:43.805246 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m15:08:43.806247 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m15:08:43.814246 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m15:08:43.814246 [debug] [Thread-1  ]: finished collecting timing info
[0m15:08:43.815245 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m15:08:43.821268 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:08:43.821268 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace  view DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp
  
   as (
    

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed e
    WHERE lower(event) in ('register', 'deregister')
        -- AND event_at <= '2019-06-01 18:17:04.089'

    
        and event_at > (select max(register_event_at) from DOOR2DOOR_DWH.DBT_stg.registration_events_grouped)
    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



    ,new_deregisters as (
        SELECT
            d.data_id,
            d.event_at
        FROM new_events d
        LEFT JOIN new_registers r
            ON d.data_id = r.data_id AND d.event_at = r.deregister_event_at
        WHERE 
            lower(d.event) = 'deregister'
            AND r.deregister_event_at IS NULL
    )
    ,updated_existing_registers as (
        SELECT
            r.data_id,
            r.register_event_at,
            d.event_at as deregister_event_at,
            r._unique_key
        FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
        LEFT JOIN new_deregisters d ON
            r.data_id = d.data_id   
        WHERE r.deregister_event_at IS NULL
    )

    SELECT * FROM updated_existing_registers
    UNION ALL



SELECT * FROM new_registers
  );
[0m15:08:43.822277 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:08:44.337102 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.52 seconds
[0m15:08:44.340100 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:08:44.340100 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
describe table DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp
[0m15:08:44.436058 [debug] [Thread-1  ]: SQL status: SUCCESS 4 in 0.09 seconds
[0m15:08:44.440053 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:08:44.440053 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
describe table DOOR2DOOR_DWH.DBT_stg.registration_events_grouped
[0m15:08:44.530407 [debug] [Thread-1  ]: SQL status: SUCCESS 4 in 0.09 seconds
[0m15:08:44.534403 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:08:44.534403 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
describe table "DOOR2DOOR_DWH"."DBT_STG"."REGISTRATION_EVENTS_GROUPED"
[0m15:08:44.615941 [debug] [Thread-1  ]: SQL status: SUCCESS 4 in 0.08 seconds
[0m15:08:44.633980 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.registration_events_grouped"
[0m15:08:44.635981 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:08:44.635981 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
BEGIN
[0m15:08:44.731755 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.1 seconds
[0m15:08:44.731755 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:08:44.732723 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
merge into DOOR2DOOR_DWH.DBT_stg.registration_events_grouped as DBT_INTERNAL_DEST
        using DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp as DBT_INTERNAL_SOURCE
        on 
                DBT_INTERNAL_SOURCE._unique_key = DBT_INTERNAL_DEST._unique_key
            

    
    when matched then update set
        "DATA_ID" = DBT_INTERNAL_SOURCE."DATA_ID","REGISTER_EVENT_AT" = DBT_INTERNAL_SOURCE."REGISTER_EVENT_AT","DEREGISTER_EVENT_AT" = DBT_INTERNAL_SOURCE."DEREGISTER_EVENT_AT","_UNIQUE_KEY" = DBT_INTERNAL_SOURCE."_UNIQUE_KEY"
    

    when not matched then insert
        ("DATA_ID", "REGISTER_EVENT_AT", "DEREGISTER_EVENT_AT", "_UNIQUE_KEY")
    values
        ("DATA_ID", "REGISTER_EVENT_AT", "DEREGISTER_EVENT_AT", "_UNIQUE_KEY")

;
[0m15:08:44.993835 [debug] [Thread-1  ]: SQL status: SUCCESS 0 in 0.26 seconds
[0m15:08:44.994892 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:08:44.994892 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
COMMIT
[0m15:08:45.154718 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.16 seconds
[0m15:08:45.158715 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:08:45.158715 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp cascade
[0m15:08:45.305426 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.15 seconds
[0m15:08:45.307422 [debug] [Thread-1  ]: finished collecting timing info
[0m15:08:45.308423 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m15:08:45.449734 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1a331e0-eade-41ff-a2da-14d93804d87c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C2365262B0>]}
[0m15:08:45.450736 [info ] [Thread-1  ]: 4 of 7 OK created sql incremental model DBT_stg.registration_events_grouped .... [[32mSUCCESS 0[0m in 1.64s]
[0m15:08:45.452175 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m15:08:45.454198 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_deregistration
[0m15:08:45.454198 [info ] [Thread-1  ]: 5 of 7 START sql incremental model DBT_dwh.fact_deregistration ................. [RUN]
[0m15:08:45.455189 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:08:45.455189 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_deregistration
[0m15:08:45.456224 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_deregistration
[0m15:08:45.462245 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_deregistration"
[0m15:08:45.463210 [debug] [Thread-1  ]: finished collecting timing info
[0m15:08:45.463210 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_deregistration
[0m15:08:45.469216 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:08:45.469216 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
create or replace  view DOOR2DOOR_DWH.DBT_dwh.fact_deregistration__dbt_tmp
  
   as (
    

with events as (
    SELECT
        r.data_id,
        r.deregister_event_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time AND op.operating_period_finish_time
    WHERE r.deregister_event_at IS NOT NULL

    
        and r.deregister_event_at > (select max(deregistration_time) from DOOR2DOOR_DWH.DBT_dwh.fact_deregistration)
    
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(deregister_event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as deregistration_key,
    operating_period_key,
    deregister_event_at as deregistration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
  );
[0m15:08:45.469216 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:08:46.149400 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.68 seconds
[0m15:08:46.152394 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:08:46.152394 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
describe table DOOR2DOOR_DWH.DBT_dwh.fact_deregistration__dbt_tmp
[0m15:08:46.309100 [debug] [Thread-1  ]: SQL status: SUCCESS 3 in 0.16 seconds
[0m15:08:46.313125 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:08:46.313125 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
describe table DOOR2DOOR_DWH.DBT_dwh.fact_deregistration
[0m15:08:46.400723 [debug] [Thread-1  ]: SQL status: SUCCESS 3 in 0.09 seconds
[0m15:08:46.404718 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:08:46.404718 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
describe table "DOOR2DOOR_DWH"."DBT_DWH"."FACT_DEREGISTRATION"
[0m15:08:46.493963 [debug] [Thread-1  ]: SQL status: SUCCESS 3 in 0.09 seconds
[0m15:08:46.496933 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_deregistration"
[0m15:08:46.497929 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:08:46.497929 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
BEGIN
[0m15:08:46.611127 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.11 seconds
[0m15:08:46.611127 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:08:46.612121 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
insert into DOOR2DOOR_DWH.DBT_dwh.fact_deregistration ("DEREGISTRATION_KEY", "OPERATING_PERIOD_KEY", "DEREGISTRATION_TIME")
        (
            select "DEREGISTRATION_KEY", "OPERATING_PERIOD_KEY", "DEREGISTRATION_TIME"
            from DOOR2DOOR_DWH.DBT_dwh.fact_deregistration__dbt_tmp
        );
[0m15:08:47.195383 [debug] [Thread-1  ]: SQL status: SUCCESS 0 in 0.58 seconds
[0m15:08:47.195383 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:08:47.196377 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
COMMIT
[0m15:08:47.460227 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.26 seconds
[0m15:08:47.464227 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:08:47.464227 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
drop view if exists DOOR2DOOR_DWH.DBT_dwh.fact_deregistration__dbt_tmp cascade
[0m15:08:47.573227 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.11 seconds
[0m15:08:47.575230 [debug] [Thread-1  ]: finished collecting timing info
[0m15:08:47.576229 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: Close
[0m15:08:47.708199 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1a331e0-eade-41ff-a2da-14d93804d87c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C236692E20>]}
[0m15:08:47.708199 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model DBT_dwh.fact_deregistration ............ [[32mSUCCESS 0[0m in 2.25s]
[0m15:08:47.710202 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_deregistration
[0m15:08:47.710202 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_registration
[0m15:08:47.711201 [info ] [Thread-1  ]: 6 of 7 START sql incremental model DBT_dwh.fact_registration ................... [RUN]
[0m15:08:47.712201 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_registration"
[0m15:08:47.713229 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_registration
[0m15:08:47.713229 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_registration
[0m15:08:47.719198 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_registration"
[0m15:08:47.720228 [debug] [Thread-1  ]: finished collecting timing info
[0m15:08:47.721232 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_registration
[0m15:08:47.726199 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:08:47.727228 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
create or replace  view DOOR2DOOR_DWH.DBT_dwh.fact_registration__dbt_tmp
  
   as (
    


with events as (
    SELECT
        r.data_id,
        r.register_event_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time

    
        and r.register_event_at > (select max(registration_time) from DOOR2DOOR_DWH.DBT_dwh.fact_registration)
    
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(register_event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as registration_key,
    operating_period_key,
    register_event_at as registration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
-- QUESTION:   Difference between event_on and data_location_at
  );
[0m15:08:47.727228 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:08:48.380140 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.65 seconds
[0m15:08:48.383134 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:08:48.383134 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
describe table DOOR2DOOR_DWH.DBT_dwh.fact_registration__dbt_tmp
[0m15:08:48.477755 [debug] [Thread-1  ]: SQL status: SUCCESS 3 in 0.09 seconds
[0m15:08:48.481753 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:08:48.483414 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
describe table DOOR2DOOR_DWH.DBT_dwh.fact_registration
[0m15:08:48.574628 [debug] [Thread-1  ]: SQL status: SUCCESS 3 in 0.09 seconds
[0m15:08:48.578622 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:08:48.578622 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
describe table "DOOR2DOOR_DWH"."DBT_DWH"."FACT_REGISTRATION"
[0m15:08:48.657933 [debug] [Thread-1  ]: SQL status: SUCCESS 3 in 0.08 seconds
[0m15:08:48.660931 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_registration"
[0m15:08:48.661931 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:08:48.661931 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
BEGIN
[0m15:08:48.763765 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.1 seconds
[0m15:08:48.764765 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:08:48.764765 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
insert into DOOR2DOOR_DWH.DBT_dwh.fact_registration ("REGISTRATION_KEY", "OPERATING_PERIOD_KEY", "REGISTRATION_TIME")
        (
            select "REGISTRATION_KEY", "OPERATING_PERIOD_KEY", "REGISTRATION_TIME"
            from DOOR2DOOR_DWH.DBT_dwh.fact_registration__dbt_tmp
        );
[0m15:08:49.275129 [debug] [Thread-1  ]: SQL status: SUCCESS 100 in 0.51 seconds
[0m15:08:49.276128 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:08:49.276128 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
COMMIT
[0m15:08:49.504542 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.23 seconds
[0m15:08:49.508568 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:08:49.509590 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
drop view if exists DOOR2DOOR_DWH.DBT_dwh.fact_registration__dbt_tmp cascade
[0m15:08:49.616477 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.11 seconds
[0m15:08:49.618471 [debug] [Thread-1  ]: finished collecting timing info
[0m15:08:49.619471 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: Close
[0m15:08:49.751376 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1a331e0-eade-41ff-a2da-14d93804d87c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C2365265B0>]}
[0m15:08:49.751376 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model DBT_dwh.fact_registration .............. [[32mSUCCESS 100[0m in 2.04s]
[0m15:08:49.753407 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_registration
[0m15:08:49.754463 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_vehicle_location
[0m15:08:49.754463 [info ] [Thread-1  ]: 7 of 7 START sql incremental model DBT_dwh.fact_vehicle_location ............... [RUN]
[0m15:08:49.755428 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:08:49.756421 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_vehicle_location
[0m15:08:49.756421 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_vehicle_location
[0m15:08:49.766420 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_vehicle_location"
[0m15:08:49.767420 [debug] [Thread-1  ]: finished collecting timing info
[0m15:08:49.768420 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_vehicle_location
[0m15:08:49.775420 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:08:49.775420 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
create or replace  view DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location__dbt_tmp
  
   as (
    

with locations as (
    SELECT
        e.event_at,
        e.data_id,
        e.data_location_lat,
        e.data_location_lng,
        e.data_location_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed e
    INNER JOIN DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
        ON e.data_id = r.data_id AND e.data_location_at BETWEEN r.register_event_at and COALESCE(r.deregister_event_at, CURRENT_TIMESTAMP())
    INNER JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'update'

    
        and data_location_at > (select max(vehicle_location_time) from DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location)
    
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_lat as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_lng as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_location_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    operating_period_key,
    data_location_lat as vehicle_location_lat,
    data_location_lng as vehicle_location_lng,
    data_location_at as vehicle_location_time
FROM locations


--- ASSUMPTION Events are recorded only if vehicle is registered to a operation period
  );
[0m15:08:49.775420 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:08:50.427134 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.65 seconds
[0m15:08:50.430129 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:08:50.430129 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
describe table DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location__dbt_tmp
[0m15:08:50.519701 [debug] [Thread-1  ]: SQL status: SUCCESS 6 in 0.09 seconds
[0m15:08:50.523684 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:08:50.523684 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
describe table DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location
[0m15:08:50.622635 [debug] [Thread-1  ]: SQL status: SUCCESS 6 in 0.1 seconds
[0m15:08:50.626631 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:08:50.626631 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
describe table "DOOR2DOOR_DWH"."DBT_DWH"."FACT_VEHICLE_LOCATION"
[0m15:08:50.702550 [debug] [Thread-1  ]: SQL status: SUCCESS 6 in 0.08 seconds
[0m15:08:50.705516 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_vehicle_location"
[0m15:08:50.706516 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:08:50.707516 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
BEGIN
[0m15:08:50.819543 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.11 seconds
[0m15:08:50.819543 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:08:50.819543 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
insert into DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location ("VEHICLE_LOCATION_KEY", "VEHICLE_KEY", "OPERATING_PERIOD_KEY", "VEHICLE_LOCATION_LAT", "VEHICLE_LOCATION_LNG", "VEHICLE_LOCATION_TIME")
        (
            select "VEHICLE_LOCATION_KEY", "VEHICLE_KEY", "OPERATING_PERIOD_KEY", "VEHICLE_LOCATION_LAT", "VEHICLE_LOCATION_LNG", "VEHICLE_LOCATION_TIME"
            from DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location__dbt_tmp
        );
[0m15:08:51.515610 [debug] [Thread-1  ]: SQL status: SUCCESS 0 in 0.7 seconds
[0m15:08:51.515610 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:08:51.516606 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
COMMIT
[0m15:08:51.753903 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.24 seconds
[0m15:08:51.757928 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:08:51.757928 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
drop view if exists DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location__dbt_tmp cascade
[0m15:08:51.860726 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.1 seconds
[0m15:08:51.863758 [debug] [Thread-1  ]: finished collecting timing info
[0m15:08:51.863758 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: Close
[0m15:08:51.991883 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1a331e0-eade-41ff-a2da-14d93804d87c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C21F3ECE80>]}
[0m15:08:51.991883 [info ] [Thread-1  ]: 7 of 7 OK created sql incremental model DBT_dwh.fact_vehicle_location .......... [[32mSUCCESS 0[0m in 2.24s]
[0m15:08:51.993782 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_vehicle_location
[0m15:08:51.995817 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m15:08:51.995817 [info ] [MainThread]: 
[0m15:08:51.996809 [info ] [MainThread]: Finished running 5 incremental models, 2 table models in 0 hours 0 minutes and 17.83 seconds (17.83s).
[0m15:08:51.997834 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:08:51.997834 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m15:08:51.998808 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_stg' was properly closed.
[0m15:08:51.998808 [debug] [MainThread]: Connection 'model.door2door_dwh.fact_vehicle_location' was properly closed.
[0m15:08:52.008808 [info ] [MainThread]: 
[0m15:08:52.008808 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:08:52.010689 [info ] [MainThread]: 
[0m15:08:52.011711 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m15:08:52.011711 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C2361237F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C2361233D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C236524100>]}
[0m15:08:52.012710 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 15:09:57.676269 | 901cafa6-7fc1-4404-8b4e-ce364b75b365 ==============================
[0m15:09:57.676269 [info ] [MainThread]: Running with dbt=1.3.1
[0m15:09:57.677281 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m15:09:57.677281 [debug] [MainThread]: Tracking: tracking
[0m15:09:57.677281 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002067CB99CA0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002067CB99D00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002067CB99D60>]}
[0m15:09:57.801300 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:09:57.801300 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:09:57.801300 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '901cafa6-7fc1-4404-8b4e-ce364b75b365', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002067CD8B0D0>]}
[0m15:09:57.826360 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '901cafa6-7fc1-4404-8b4e-ce364b75b365', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002067CCA2790>]}
[0m15:09:57.826360 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m15:09:57.827331 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '901cafa6-7fc1-4404-8b4e-ce364b75b365', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002067CCA28B0>]}
[0m15:09:57.829372 [info ] [MainThread]: 
[0m15:09:57.830338 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m15:09:57.830844 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m15:09:57.850268 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m15:09:57.850268 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m15:09:57.851250 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:09:58.865707 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 1.01 seconds
[0m15:09:58.865707 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m15:09:58.990705 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m15:09:58.990705 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m15:09:58.990705 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m15:09:58.990705 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:09:59.615706 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.63 seconds
[0m15:09:59.615706 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m15:09:59.740704 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m15:09:59.740704 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m15:09:59.740704 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m15:09:59.740704 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:10:00.337387 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.6 seconds
[0m15:10:00.337387 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m15:10:00.476106 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m15:10:00.476106 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m15:10:00.476106 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m15:10:00.476106 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:10:00.883142 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.41 seconds
[0m15:10:00.883142 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m15:10:01.010066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '901cafa6-7fc1-4404-8b4e-ce364b75b365', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002067CBB0E80>]}
[0m15:10:01.010066 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:10:01.010066 [info ] [MainThread]: 
[0m15:10:01.010066 [debug] [Thread-1  ]: Began running node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:10:01.010066 [info ] [Thread-1  ]: 1 of 7 START sql incremental model DBT_stg.vehicle_iot_data_parsed ............. [RUN]
[0m15:10:01.025057 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:10:01.025057 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:10:01.025057 [debug] [Thread-1  ]: Compiling model.door2door_dwh.vehicle_iot_data_parsed
[0m15:10:01.027082 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:10:01.027082 [debug] [Thread-1  ]: finished collecting timing info
[0m15:10:01.027082 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:10:01.077099 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:10:01.077099 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
create or replace  view DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed__dbt_tmp
  
   as (
    

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TEXT as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
        where event_at > (select max(event_at) from DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed)
    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
  );
[0m15:10:01.077099 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m15:10:01.584794 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.51 seconds
[0m15:10:01.584794 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:10:01.584794 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
describe table DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed__dbt_tmp
[0m15:10:01.693988 [debug] [Thread-1  ]: SQL status: SUCCESS 9 in 0.11 seconds
[0m15:10:01.693988 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:10:01.693988 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
describe table DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed
[0m15:10:01.787923 [debug] [Thread-1  ]: SQL status: SUCCESS 9 in 0.09 seconds
[0m15:10:01.787923 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:10:01.787923 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
describe table "DOOR2DOOR_DWH"."DBT_STG"."VEHICLE_IOT_DATA_PARSED"
[0m15:10:01.865684 [debug] [Thread-1  ]: SQL status: SUCCESS 9 in 0.08 seconds
[0m15:10:01.881037 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:10:01.896662 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:10:01.896662 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
BEGIN
[0m15:10:02.021662 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.12 seconds
[0m15:10:02.021662 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:10:02.021662 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
insert into DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed ("EVENT", "EVENT_ON", "EVENT_AT", "DATA_ID", "DATA_LOCATION_LAT", "DATA_LOCATION_LNG", "DATA_LOCATION_AT", "DATA_START", "DATA_FINISH")
        (
            select "EVENT", "EVENT_ON", "EVENT_AT", "DATA_ID", "DATA_LOCATION_LAT", "DATA_LOCATION_LNG", "DATA_LOCATION_AT", "DATA_START", "DATA_FINISH"
            from DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed__dbt_tmp
        );
[0m15:10:07.198475 [debug] [Thread-1  ]: SQL status: SUCCESS 0 in 5.18 seconds
[0m15:10:07.198475 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:10:07.198475 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
COMMIT
[0m15:10:07.477792 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.28 seconds
[0m15:10:07.477792 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:10:07.477792 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed__dbt_tmp cascade
[0m15:10:07.602831 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.13 seconds
[0m15:10:07.618041 [debug] [Thread-1  ]: finished collecting timing info
[0m15:10:07.618041 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: Close
[0m15:10:07.758694 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '901cafa6-7fc1-4404-8b4e-ce364b75b365', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002067D0A7880>]}
[0m15:10:07.758694 [info ] [Thread-1  ]: 1 of 7 OK created sql incremental model DBT_stg.vehicle_iot_data_parsed ........ [[32mSUCCESS 0[0m in 6.73s]
[0m15:10:07.758694 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:10:07.758694 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_operating_period
[0m15:10:07.758694 [info ] [Thread-1  ]: 2 of 7 START sql table model DBT_dwh.dim_operating_period ...................... [RUN]
[0m15:10:07.758694 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_operating_period"
[0m15:10:07.758694 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_operating_period
[0m15:10:07.758694 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_operating_period
[0m15:10:07.774318 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_operating_period"
[0m15:10:07.774318 [debug] [Thread-1  ]: finished collecting timing info
[0m15:10:07.774318 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_operating_period
[0m15:10:07.805579 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_operating_period"
[0m15:10:07.805579 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_operating_period"
[0m15:10:07.805579 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_operating_period"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_operating_period  as
        (

with operating_periods as (
    SELECT
        data_id,
        data_start,
        data_finish,
        ROW_NUMBER() OVER (PARTITION BY data_id ORDER BY data_finish desc, data_start desc) as rn
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed
    WHERE lower(event_on) = 'operating_period'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    data_id as operating_period_source_id,
    data_start as operating_period_start_time,
    data_finish as operating_period_finish_time
FROM operating_periods
        );
[0m15:10:07.805579 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:10:08.743040 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.94 seconds
[0m15:10:08.758680 [debug] [Thread-1  ]: finished collecting timing info
[0m15:10:08.758680 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: Close
[0m15:10:08.884304 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '901cafa6-7fc1-4404-8b4e-ce364b75b365', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002067D157CA0>]}
[0m15:10:08.884304 [info ] [Thread-1  ]: 2 of 7 OK created sql table model DBT_dwh.dim_operating_period ................. [[32mSUCCESS 1[0m in 1.13s]
[0m15:10:08.884304 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_operating_period
[0m15:10:08.884304 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_vehicle
[0m15:10:08.884304 [info ] [Thread-1  ]: 3 of 7 START sql table model DBT_dwh.dim_vehicle ............................... [RUN]
[0m15:10:08.899294 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_vehicle"
[0m15:10:08.899294 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_vehicle
[0m15:10:08.899294 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_vehicle
[0m15:10:08.899294 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_vehicle"
[0m15:10:08.899294 [debug] [Thread-1  ]: finished collecting timing info
[0m15:10:08.899294 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_vehicle
[0m15:10:08.899294 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_vehicle"
[0m15:10:08.899294 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_vehicle"
[0m15:10:08.899294 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_vehicle"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_vehicle  as
        (

with vehicles as (
    SELECT
        DISTINCT data_id
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed
    WHERE lower(event_on) = 'vehicle'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    data_id as vehicle_source_id
FROM vehicles
        );
[0m15:10:08.899294 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:10:09.852428 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.95 seconds
[0m15:10:09.852428 [debug] [Thread-1  ]: finished collecting timing info
[0m15:10:09.852428 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: Close
[0m15:10:09.993076 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '901cafa6-7fc1-4404-8b4e-ce364b75b365', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002067D0F4DF0>]}
[0m15:10:09.993076 [info ] [Thread-1  ]: 3 of 7 OK created sql table model DBT_dwh.dim_vehicle .......................... [[32mSUCCESS 1[0m in 1.09s]
[0m15:10:09.993076 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_vehicle
[0m15:10:09.993076 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m15:10:09.993076 [info ] [Thread-1  ]: 4 of 7 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m15:10:09.993076 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:10:09.993076 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m15:10:09.993076 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m15:10:09.993076 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m15:10:09.993076 [debug] [Thread-1  ]: finished collecting timing info
[0m15:10:09.993076 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m15:10:10.008703 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:10:10.008703 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace  view DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp
  
   as (
    

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed e
    WHERE lower(event) in ('register', 'deregister')
        -- AND event_at <= '2019-06-01 18:17:04.089'

    
        and event_at > (select max(register_event_at) from DOOR2DOOR_DWH.DBT_stg.registration_events_grouped)
    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



    ,new_deregisters as (
        SELECT
            d.data_id,
            d.event_at
        FROM new_events d
        LEFT JOIN new_registers r
            ON d.data_id = r.data_id AND d.event_at = r.deregister_event_at
        WHERE 
            lower(d.event) = 'deregister'
            AND r.deregister_event_at IS NULL
    )
    ,updated_existing_registers as (
        SELECT
            r.data_id,
            r.register_event_at,
            d.event_at as deregister_event_at,
            r._unique_key
        FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
        LEFT JOIN new_deregisters d ON
            r.data_id = d.data_id   
        WHERE r.deregister_event_at IS NULL
    )

    SELECT * FROM updated_existing_registers
    UNION ALL



SELECT * FROM new_registers
  );
[0m15:10:10.008703 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:10:10.665336 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.66 seconds
[0m15:10:10.665336 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:10:10.665336 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
describe table DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp
[0m15:10:10.759316 [debug] [Thread-1  ]: SQL status: SUCCESS 4 in 0.09 seconds
[0m15:10:10.759316 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:10:10.759316 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
describe table DOOR2DOOR_DWH.DBT_stg.registration_events_grouped
[0m15:10:10.853814 [debug] [Thread-1  ]: SQL status: SUCCESS 4 in 0.09 seconds
[0m15:10:10.856810 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:10:10.857810 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
describe table "DOOR2DOOR_DWH"."DBT_STG"."REGISTRATION_EVENTS_GROUPED"
[0m15:10:10.937861 [debug] [Thread-1  ]: SQL status: SUCCESS 4 in 0.08 seconds
[0m15:10:10.962856 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.registration_events_grouped"
[0m15:10:10.964828 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:10:10.964828 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
BEGIN
[0m15:10:11.084704 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.12 seconds
[0m15:10:11.084704 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:10:11.085671 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
merge into DOOR2DOOR_DWH.DBT_stg.registration_events_grouped as DBT_INTERNAL_DEST
        using DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp as DBT_INTERNAL_SOURCE
        on 
                DBT_INTERNAL_SOURCE._unique_key = DBT_INTERNAL_DEST._unique_key
            

    
    when matched then update set
        "DATA_ID" = DBT_INTERNAL_SOURCE."DATA_ID","REGISTER_EVENT_AT" = DBT_INTERNAL_SOURCE."REGISTER_EVENT_AT","DEREGISTER_EVENT_AT" = DBT_INTERNAL_SOURCE."DEREGISTER_EVENT_AT","_UNIQUE_KEY" = DBT_INTERNAL_SOURCE."_UNIQUE_KEY"
    

    when not matched then insert
        ("DATA_ID", "REGISTER_EVENT_AT", "DEREGISTER_EVENT_AT", "_UNIQUE_KEY")
    values
        ("DATA_ID", "REGISTER_EVENT_AT", "DEREGISTER_EVENT_AT", "_UNIQUE_KEY")

;
[0m15:10:11.371759 [debug] [Thread-1  ]: SQL status: SUCCESS 0 in 0.29 seconds
[0m15:10:11.372801 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:10:11.372801 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
COMMIT
[0m15:10:11.547257 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.17 seconds
[0m15:10:11.551255 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:10:11.551255 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp cascade
[0m15:10:11.702780 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.15 seconds
[0m15:10:11.704776 [debug] [Thread-1  ]: finished collecting timing info
[0m15:10:11.705776 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m15:10:11.834764 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '901cafa6-7fc1-4404-8b4e-ce364b75b365', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002066973EB50>]}
[0m15:10:11.835766 [info ] [Thread-1  ]: 4 of 7 OK created sql incremental model DBT_stg.registration_events_grouped .... [[32mSUCCESS 0[0m in 1.84s]
[0m15:10:11.837376 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m15:10:11.838364 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_deregistration
[0m15:10:11.838364 [info ] [Thread-1  ]: 5 of 7 START sql incremental model DBT_dwh.fact_deregistration ................. [RUN]
[0m15:10:11.839365 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:10:11.840366 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_deregistration
[0m15:10:11.840366 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_deregistration
[0m15:10:11.846365 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_deregistration"
[0m15:10:11.848364 [debug] [Thread-1  ]: finished collecting timing info
[0m15:10:11.848364 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_deregistration
[0m15:10:11.853365 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:10:11.853365 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
create or replace  view DOOR2DOOR_DWH.DBT_dwh.fact_deregistration__dbt_tmp
  
   as (
    

with events as (
    SELECT
        r.data_id,
        r.deregister_event_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time AND op.operating_period_finish_time
    WHERE r.deregister_event_at IS NOT NULL

    
        and r.deregister_event_at > (select max(deregistration_time) from DOOR2DOOR_DWH.DBT_dwh.fact_deregistration)
    
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(deregister_event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as deregistration_key,
    operating_period_key,
    deregister_event_at as deregistration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
  );
[0m15:10:11.854377 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:10:12.598844 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.74 seconds
[0m15:10:12.601896 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:10:12.602896 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
describe table DOOR2DOOR_DWH.DBT_dwh.fact_deregistration__dbt_tmp
[0m15:10:12.690827 [debug] [Thread-1  ]: SQL status: SUCCESS 3 in 0.09 seconds
[0m15:10:12.694854 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:10:12.694854 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
describe table DOOR2DOOR_DWH.DBT_dwh.fact_deregistration
[0m15:10:12.783160 [debug] [Thread-1  ]: SQL status: SUCCESS 3 in 0.09 seconds
[0m15:10:12.787156 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:10:12.787156 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
describe table "DOOR2DOOR_DWH"."DBT_DWH"."FACT_DEREGISTRATION"
[0m15:10:12.878712 [debug] [Thread-1  ]: SQL status: SUCCESS 3 in 0.09 seconds
[0m15:10:12.881705 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_deregistration"
[0m15:10:12.882721 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:10:12.882721 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
BEGIN
[0m15:10:12.998647 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.11 seconds
[0m15:10:12.998647 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:10:12.999645 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
insert into DOOR2DOOR_DWH.DBT_dwh.fact_deregistration ("DEREGISTRATION_KEY", "OPERATING_PERIOD_KEY", "DEREGISTRATION_TIME")
        (
            select "DEREGISTRATION_KEY", "OPERATING_PERIOD_KEY", "DEREGISTRATION_TIME"
            from DOOR2DOOR_DWH.DBT_dwh.fact_deregistration__dbt_tmp
        );
[0m15:10:13.586727 [debug] [Thread-1  ]: SQL status: SUCCESS 0 in 0.59 seconds
[0m15:10:13.586727 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:10:13.587721 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
COMMIT
[0m15:10:13.846978 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.26 seconds
[0m15:10:13.852018 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:10:13.852018 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
drop view if exists DOOR2DOOR_DWH.DBT_dwh.fact_deregistration__dbt_tmp cascade
[0m15:10:13.958165 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.11 seconds
[0m15:10:13.961164 [debug] [Thread-1  ]: finished collecting timing info
[0m15:10:13.961164 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: Close
[0m15:10:14.089045 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '901cafa6-7fc1-4404-8b4e-ce364b75b365', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002067D080370>]}
[0m15:10:14.089045 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model DBT_dwh.fact_deregistration ............ [[32mSUCCESS 0[0m in 2.25s]
[0m15:10:14.090034 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_deregistration
[0m15:10:14.091034 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_registration
[0m15:10:14.091034 [info ] [Thread-1  ]: 6 of 7 START sql incremental model DBT_dwh.fact_registration ................... [RUN]
[0m15:10:14.092035 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_registration"
[0m15:10:14.093035 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_registration
[0m15:10:14.093035 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_registration
[0m15:10:14.099034 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_registration"
[0m15:10:14.101035 [debug] [Thread-1  ]: finished collecting timing info
[0m15:10:14.101035 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_registration
[0m15:10:14.106034 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:10:14.106034 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
create or replace  view DOOR2DOOR_DWH.DBT_dwh.fact_registration__dbt_tmp
  
   as (
    


with events as (
    SELECT
        r.data_id,
        r.register_event_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time

    
        and r.register_event_at > (select max(registration_time) from DOOR2DOOR_DWH.DBT_dwh.fact_registration)
    
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(register_event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as registration_key,
    operating_period_key,
    register_event_at as registration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
-- QUESTION:   Difference between event_on and data_location_at
  );
[0m15:10:14.107036 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:10:14.779077 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.67 seconds
[0m15:10:14.782074 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:10:14.782074 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
describe table DOOR2DOOR_DWH.DBT_dwh.fact_registration__dbt_tmp
[0m15:10:14.871034 [debug] [Thread-1  ]: SQL status: SUCCESS 3 in 0.09 seconds
[0m15:10:14.875040 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:10:14.875040 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
describe table DOOR2DOOR_DWH.DBT_dwh.fact_registration
[0m15:10:14.957015 [debug] [Thread-1  ]: SQL status: SUCCESS 3 in 0.08 seconds
[0m15:10:14.960011 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:10:14.961013 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
describe table "DOOR2DOOR_DWH"."DBT_DWH"."FACT_REGISTRATION"
[0m15:10:15.056250 [debug] [Thread-1  ]: SQL status: SUCCESS 3 in 0.1 seconds
[0m15:10:15.059243 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_registration"
[0m15:10:15.060214 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:10:15.060214 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
BEGIN
[0m15:10:15.171210 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.11 seconds
[0m15:10:15.171210 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:10:15.171210 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
insert into DOOR2DOOR_DWH.DBT_dwh.fact_registration ("REGISTRATION_KEY", "OPERATING_PERIOD_KEY", "REGISTRATION_TIME")
        (
            select "REGISTRATION_KEY", "OPERATING_PERIOD_KEY", "REGISTRATION_TIME"
            from DOOR2DOOR_DWH.DBT_dwh.fact_registration__dbt_tmp
        );
[0m15:10:15.815541 [debug] [Thread-1  ]: SQL status: SUCCESS 100 in 0.64 seconds
[0m15:10:15.815541 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:10:15.816505 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
COMMIT
[0m15:10:16.047297 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.23 seconds
[0m15:10:16.051294 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:10:16.051294 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
drop view if exists DOOR2DOOR_DWH.DBT_dwh.fact_registration__dbt_tmp cascade
[0m15:10:16.180371 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.13 seconds
[0m15:10:16.183370 [debug] [Thread-1  ]: finished collecting timing info
[0m15:10:16.183370 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: Close
[0m15:10:16.314704 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '901cafa6-7fc1-4404-8b4e-ce364b75b365', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002067D1C4EE0>]}
[0m15:10:16.315705 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model DBT_dwh.fact_registration .............. [[32mSUCCESS 100[0m in 2.22s]
[0m15:10:16.316844 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_registration
[0m15:10:16.316844 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_vehicle_location
[0m15:10:16.317870 [info ] [Thread-1  ]: 7 of 7 START sql incremental model DBT_dwh.fact_vehicle_location ............... [RUN]
[0m15:10:16.318875 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:10:16.318875 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_vehicle_location
[0m15:10:16.319895 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_vehicle_location
[0m15:10:16.328895 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_vehicle_location"
[0m15:10:16.330871 [debug] [Thread-1  ]: finished collecting timing info
[0m15:10:16.330871 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_vehicle_location
[0m15:10:16.336918 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:10:16.338891 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
create or replace  view DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location__dbt_tmp
  
   as (
    

with locations as (
    SELECT
        e.event_at,
        e.data_id,
        e.data_location_lat,
        e.data_location_lng,
        e.data_location_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed e
    INNER JOIN DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
        ON e.data_id = r.data_id AND e.data_location_at BETWEEN r.register_event_at and COALESCE(r.deregister_event_at, CURRENT_TIMESTAMP())
    INNER JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'update'

    
        and data_location_at > (select max(vehicle_location_time) from DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location)
    
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_lat as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_lng as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_location_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    operating_period_key,
    data_location_lat as vehicle_location_lat,
    data_location_lng as vehicle_location_lng,
    data_location_at as vehicle_location_time
FROM locations


--- ASSUMPTION Events are recorded only if vehicle is registered to a operation period
  );
[0m15:10:16.338891 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:10:16.851795 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.51 seconds
[0m15:10:16.854790 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:10:16.854790 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
describe table DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location__dbt_tmp
[0m15:10:16.950930 [debug] [Thread-1  ]: SQL status: SUCCESS 6 in 0.1 seconds
[0m15:10:16.953923 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:10:16.954923 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
describe table DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location
[0m15:10:17.049227 [debug] [Thread-1  ]: SQL status: SUCCESS 6 in 0.09 seconds
[0m15:10:17.053221 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:10:17.053221 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
describe table "DOOR2DOOR_DWH"."DBT_DWH"."FACT_VEHICLE_LOCATION"
[0m15:10:17.133259 [debug] [Thread-1  ]: SQL status: SUCCESS 6 in 0.08 seconds
[0m15:10:17.136253 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_vehicle_location"
[0m15:10:17.137224 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:10:17.137224 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
BEGIN
[0m15:10:17.254909 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.12 seconds
[0m15:10:17.254909 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:10:17.255911 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
insert into DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location ("VEHICLE_LOCATION_KEY", "VEHICLE_KEY", "OPERATING_PERIOD_KEY", "VEHICLE_LOCATION_LAT", "VEHICLE_LOCATION_LNG", "VEHICLE_LOCATION_TIME")
        (
            select "VEHICLE_LOCATION_KEY", "VEHICLE_KEY", "OPERATING_PERIOD_KEY", "VEHICLE_LOCATION_LAT", "VEHICLE_LOCATION_LNG", "VEHICLE_LOCATION_TIME"
            from DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location__dbt_tmp
        );
[0m15:10:17.836275 [debug] [Thread-1  ]: SQL status: SUCCESS 0 in 0.58 seconds
[0m15:10:17.837338 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:10:17.837338 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
COMMIT
[0m15:10:18.084446 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.25 seconds
[0m15:10:18.088441 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:10:18.088441 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
drop view if exists DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location__dbt_tmp cascade
[0m15:10:18.220921 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.13 seconds
[0m15:10:18.223915 [debug] [Thread-1  ]: finished collecting timing info
[0m15:10:18.223915 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: Close
[0m15:10:18.356787 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '901cafa6-7fc1-4404-8b4e-ce364b75b365', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002067D11DF10>]}
[0m15:10:18.357789 [info ] [Thread-1  ]: 7 of 7 OK created sql incremental model DBT_dwh.fact_vehicle_location .......... [[32mSUCCESS 0[0m in 2.04s]
[0m15:10:18.359455 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_vehicle_location
[0m15:10:18.361466 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m15:10:18.362467 [info ] [MainThread]: 
[0m15:10:18.362467 [info ] [MainThread]: Finished running 5 incremental models, 2 table models in 0 hours 0 minutes and 20.53 seconds (20.53s).
[0m15:10:18.363453 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:10:18.363453 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m15:10:18.364452 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_dwh' was properly closed.
[0m15:10:18.364452 [debug] [MainThread]: Connection 'model.door2door_dwh.fact_vehicle_location' was properly closed.
[0m15:10:18.372453 [info ] [MainThread]: 
[0m15:10:18.373465 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:10:18.375450 [info ] [MainThread]: 
[0m15:10:18.375450 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m15:10:18.376453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002067CCA2550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002067CCA2340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002067D0AE250>]}
[0m15:10:18.377453 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 15:11:17.838442 | c8e76ca0-1b48-49b3-a90a-55cee28f4e59 ==============================
[0m15:11:17.838442 [info ] [MainThread]: Running with dbt=1.3.1
[0m15:11:17.838442 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m15:11:17.839450 [debug] [MainThread]: Tracking: tracking
[0m15:11:17.839450 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CFC8BCACD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CFC8BCAD30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CFC8BCAD90>]}
[0m15:11:17.966443 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:11:17.966443 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:11:17.973443 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c8e76ca0-1b48-49b3-a90a-55cee28f4e59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CFC8DBB0D0>]}
[0m15:11:17.981443 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c8e76ca0-1b48-49b3-a90a-55cee28f4e59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CFC8CD27C0>]}
[0m15:11:17.981443 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m15:11:17.982444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c8e76ca0-1b48-49b3-a90a-55cee28f4e59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CFC8CD28E0>]}
[0m15:11:17.983444 [info ] [MainThread]: 
[0m15:11:17.984444 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m15:11:17.987472 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m15:11:18.000471 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m15:11:18.001472 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m15:11:18.001472 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:11:19.025765 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 1.02 seconds
[0m15:11:19.027753 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m15:11:19.159230 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m15:11:19.162188 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m15:11:19.162188 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m15:11:19.163192 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:11:19.758518 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.6 seconds
[0m15:11:19.760558 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m15:11:19.913948 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m15:11:19.926947 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m15:11:19.927950 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m15:11:19.928952 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:11:20.322466 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.39 seconds
[0m15:11:20.324468 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m15:11:20.453263 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m15:11:20.456263 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m15:11:20.456263 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m15:11:20.457265 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:11:21.029653 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.57 seconds
[0m15:11:21.031692 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m15:11:21.166412 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c8e76ca0-1b48-49b3-a90a-55cee28f4e59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CFC8BF7640>]}
[0m15:11:21.167421 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:11:21.168407 [info ] [MainThread]: 
[0m15:11:21.173378 [debug] [Thread-1  ]: Began running node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:11:21.174407 [info ] [Thread-1  ]: 1 of 7 START sql incremental model DBT_stg.vehicle_iot_data_parsed ............. [RUN]
[0m15:11:21.175378 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:11:21.175378 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:11:21.176378 [debug] [Thread-1  ]: Compiling model.door2door_dwh.vehicle_iot_data_parsed
[0m15:11:21.185377 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:11:21.186378 [debug] [Thread-1  ]: finished collecting timing info
[0m15:11:21.186378 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:11:21.237378 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:11:21.238378 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
create or replace  view DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed__dbt_tmp
  
   as (
    

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TEXT as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
        where event_at > (select max(event_at) from DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed)
    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
  );
[0m15:11:21.238378 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m15:11:21.722489 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.48 seconds
[0m15:11:21.732485 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:11:21.732485 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
describe table DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed__dbt_tmp
[0m15:11:21.828563 [debug] [Thread-1  ]: SQL status: SUCCESS 9 in 0.1 seconds
[0m15:11:21.832525 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:11:21.832525 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
describe table DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed
[0m15:11:21.932316 [debug] [Thread-1  ]: SQL status: SUCCESS 9 in 0.1 seconds
[0m15:11:21.940310 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:11:21.941311 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
describe table "DOOR2DOOR_DWH"."DBT_STG"."VEHICLE_IOT_DATA_PARSED"
[0m15:11:22.024408 [debug] [Thread-1  ]: SQL status: SUCCESS 9 in 0.08 seconds
[0m15:11:22.041406 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:11:22.042416 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:11:22.043378 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
BEGIN
[0m15:11:22.244256 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.2 seconds
[0m15:11:22.244256 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:11:22.245224 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
insert into DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed ("EVENT", "EVENT_ON", "EVENT_AT", "DATA_ID", "DATA_LOCATION_LAT", "DATA_LOCATION_LNG", "DATA_LOCATION_AT", "DATA_START", "DATA_FINISH")
        (
            select "EVENT", "EVENT_ON", "EVENT_AT", "DATA_ID", "DATA_LOCATION_LAT", "DATA_LOCATION_LNG", "DATA_LOCATION_AT", "DATA_START", "DATA_FINISH"
            from DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed__dbt_tmp
        );
[0m15:11:27.101612 [debug] [Thread-1  ]: SQL status: SUCCESS 0 in 4.86 seconds
[0m15:11:27.101612 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:11:27.102610 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
COMMIT
[0m15:11:27.336408 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.23 seconds
[0m15:11:27.343402 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:11:27.343402 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed__dbt_tmp cascade
[0m15:11:27.453641 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.11 seconds
[0m15:11:27.472635 [debug] [Thread-1  ]: finished collecting timing info
[0m15:11:27.473637 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: Close
[0m15:11:27.622055 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8e76ca0-1b48-49b3-a90a-55cee28f4e59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CFC90DA6A0>]}
[0m15:11:27.623051 [info ] [Thread-1  ]: 1 of 7 OK created sql incremental model DBT_stg.vehicle_iot_data_parsed ........ [[32mSUCCESS 0[0m in 6.45s]
[0m15:11:27.624243 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:11:27.625297 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_operating_period
[0m15:11:27.626265 [info ] [Thread-1  ]: 2 of 7 START sql table model DBT_dwh.dim_operating_period ...................... [RUN]
[0m15:11:27.627267 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_operating_period"
[0m15:11:27.627267 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_operating_period
[0m15:11:27.627267 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_operating_period
[0m15:11:27.646265 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_operating_period"
[0m15:11:27.646265 [debug] [Thread-1  ]: finished collecting timing info
[0m15:11:27.647265 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_operating_period
[0m15:11:27.674308 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_operating_period"
[0m15:11:27.676295 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_operating_period"
[0m15:11:27.676295 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_operating_period"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_operating_period  as
        (

with operating_periods as (
    SELECT
        data_id,
        data_start,
        data_finish,
        ROW_NUMBER() OVER (PARTITION BY data_id ORDER BY data_finish desc, data_start desc) as rn
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed
    WHERE lower(event_on) = 'operating_period'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    data_id as operating_period_source_id,
    data_start as operating_period_start_time,
    data_finish as operating_period_finish_time
FROM operating_periods
        );
[0m15:11:27.677295 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:11:28.577900 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.9 seconds
[0m15:11:28.582895 [debug] [Thread-1  ]: finished collecting timing info
[0m15:11:28.582895 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: Close
[0m15:11:28.727287 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8e76ca0-1b48-49b3-a90a-55cee28f4e59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CFC9148370>]}
[0m15:11:28.728288 [info ] [Thread-1  ]: 2 of 7 OK created sql table model DBT_dwh.dim_operating_period ................. [[32mSUCCESS 1[0m in 1.10s]
[0m15:11:28.729954 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_operating_period
[0m15:11:28.729954 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_vehicle
[0m15:11:28.730952 [info ] [Thread-1  ]: 3 of 7 START sql table model DBT_dwh.dim_vehicle ............................... [RUN]
[0m15:11:28.731951 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_vehicle"
[0m15:11:28.731951 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_vehicle
[0m15:11:28.731951 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_vehicle
[0m15:11:28.736980 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_vehicle"
[0m15:11:28.737955 [debug] [Thread-1  ]: finished collecting timing info
[0m15:11:28.737955 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_vehicle
[0m15:11:28.741980 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_vehicle"
[0m15:11:28.742980 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_vehicle"
[0m15:11:28.743953 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_vehicle"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_vehicle  as
        (

with vehicles as (
    SELECT
        DISTINCT data_id
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed
    WHERE lower(event_on) = 'vehicle'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    data_id as vehicle_source_id
FROM vehicles
        );
[0m15:11:28.743953 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:11:29.937274 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.19 seconds
[0m15:11:29.939269 [debug] [Thread-1  ]: finished collecting timing info
[0m15:11:29.940269 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: Close
[0m15:11:30.071940 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8e76ca0-1b48-49b3-a90a-55cee28f4e59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CFC90DAD30>]}
[0m15:11:30.072939 [info ] [Thread-1  ]: 3 of 7 OK created sql table model DBT_dwh.dim_vehicle .......................... [[32mSUCCESS 1[0m in 1.34s]
[0m15:11:30.074942 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_vehicle
[0m15:11:30.074942 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m15:11:30.075969 [info ] [Thread-1  ]: 4 of 7 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m15:11:30.076940 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:11:30.076940 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m15:11:30.076940 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m15:11:30.084940 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m15:11:30.084940 [debug] [Thread-1  ]: finished collecting timing info
[0m15:11:30.085940 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m15:11:30.090938 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:11:30.090938 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace  view DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp
  
   as (
    

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed e
    WHERE lower(event) in ('register', 'deregister')
        -- AND event_at <= '2019-06-01 18:17:04.089'

    
        and event_at > (select max(register_event_at) from DOOR2DOOR_DWH.DBT_stg.registration_events_grouped)
    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



    ,new_deregisters as (
        SELECT
            d.data_id,
            d.event_at
        FROM new_events d
        LEFT JOIN new_registers r
            ON d.data_id = r.data_id AND d.event_at = r.deregister_event_at
        WHERE 
            lower(d.event) = 'deregister'
            AND r.deregister_event_at IS NULL
    )
    ,updated_existing_registers as (
        SELECT
            r.data_id,
            r.register_event_at,
            d.event_at as deregister_event_at,
            r._unique_key
        FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
        LEFT JOIN new_deregisters d ON
            r.data_id = d.data_id   
        WHERE r.deregister_event_at IS NULL
    )

    SELECT * FROM updated_existing_registers
    UNION ALL



SELECT * FROM new_registers
  );
[0m15:11:30.090938 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:11:30.579520 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.49 seconds
[0m15:11:30.582514 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:11:30.582514 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
describe table DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp
[0m15:11:30.729527 [debug] [Thread-1  ]: SQL status: SUCCESS 4 in 0.15 seconds
[0m15:11:30.733523 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:11:30.733523 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
describe table DOOR2DOOR_DWH.DBT_stg.registration_events_grouped
[0m15:11:30.830704 [debug] [Thread-1  ]: SQL status: SUCCESS 4 in 0.1 seconds
[0m15:11:30.834732 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:11:30.835732 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
describe table "DOOR2DOOR_DWH"."DBT_STG"."REGISTRATION_EVENTS_GROUPED"
[0m15:11:30.913628 [debug] [Thread-1  ]: SQL status: SUCCESS 4 in 0.08 seconds
[0m15:11:30.930625 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.registration_events_grouped"
[0m15:11:30.932626 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:11:30.932626 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
BEGIN
[0m15:11:31.045314 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.11 seconds
[0m15:11:31.046311 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:11:31.046311 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
merge into DOOR2DOOR_DWH.DBT_stg.registration_events_grouped as DBT_INTERNAL_DEST
        using DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp as DBT_INTERNAL_SOURCE
        on 
                DBT_INTERNAL_SOURCE._unique_key = DBT_INTERNAL_DEST._unique_key
            

    
    when matched then update set
        "DATA_ID" = DBT_INTERNAL_SOURCE."DATA_ID","REGISTER_EVENT_AT" = DBT_INTERNAL_SOURCE."REGISTER_EVENT_AT","DEREGISTER_EVENT_AT" = DBT_INTERNAL_SOURCE."DEREGISTER_EVENT_AT","_UNIQUE_KEY" = DBT_INTERNAL_SOURCE."_UNIQUE_KEY"
    

    when not matched then insert
        ("DATA_ID", "REGISTER_EVENT_AT", "DEREGISTER_EVENT_AT", "_UNIQUE_KEY")
    values
        ("DATA_ID", "REGISTER_EVENT_AT", "DEREGISTER_EVENT_AT", "_UNIQUE_KEY")

;
[0m15:11:31.488449 [debug] [Thread-1  ]: SQL status: SUCCESS 0 in 0.44 seconds
[0m15:11:31.488449 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:11:31.489442 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
COMMIT
[0m15:11:31.704098 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.21 seconds
[0m15:11:31.708094 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:11:31.708094 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp cascade
[0m15:11:31.863574 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.15 seconds
[0m15:11:31.866596 [debug] [Thread-1  ]: finished collecting timing info
[0m15:11:31.866596 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m15:11:31.999760 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8e76ca0-1b48-49b3-a90a-55cee28f4e59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CFC8B58130>]}
[0m15:11:32.000760 [info ] [Thread-1  ]: 4 of 7 OK created sql incremental model DBT_stg.registration_events_grouped .... [[32mSUCCESS 0[0m in 1.92s]
[0m15:11:32.001733 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m15:11:32.002881 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_deregistration
[0m15:11:32.003929 [info ] [Thread-1  ]: 5 of 7 START sql incremental model DBT_dwh.fact_deregistration ................. [RUN]
[0m15:11:32.004892 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:11:32.004892 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_deregistration
[0m15:11:32.004892 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_deregistration
[0m15:11:32.011921 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_deregistration"
[0m15:11:32.012921 [debug] [Thread-1  ]: finished collecting timing info
[0m15:11:32.013921 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_deregistration
[0m15:11:32.017935 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:11:32.018931 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
create or replace  view DOOR2DOOR_DWH.DBT_dwh.fact_deregistration__dbt_tmp
  
   as (
    

with events as (
    SELECT
        r.data_id,
        r.deregister_event_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time AND op.operating_period_finish_time
    WHERE r.deregister_event_at IS NOT NULL

    
        and r.deregister_event_at > (select max(deregistration_time) from DOOR2DOOR_DWH.DBT_dwh.fact_deregistration)
    
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(deregister_event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as deregistration_key,
    operating_period_key,
    deregister_event_at as deregistration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
  );
[0m15:11:32.018931 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:11:32.773708 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.75 seconds
[0m15:11:32.776704 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:11:32.776704 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
describe table DOOR2DOOR_DWH.DBT_dwh.fact_deregistration__dbt_tmp
[0m15:11:32.872813 [debug] [Thread-1  ]: SQL status: SUCCESS 3 in 0.1 seconds
[0m15:11:32.876807 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:11:32.876807 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
describe table DOOR2DOOR_DWH.DBT_dwh.fact_deregistration
[0m15:11:32.965003 [debug] [Thread-1  ]: SQL status: SUCCESS 3 in 0.09 seconds
[0m15:11:32.968000 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:11:32.968999 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
describe table "DOOR2DOOR_DWH"."DBT_DWH"."FACT_DEREGISTRATION"
[0m15:11:33.048025 [debug] [Thread-1  ]: SQL status: SUCCESS 3 in 0.08 seconds
[0m15:11:33.051020 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_deregistration"
[0m15:11:33.052021 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:11:33.052021 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
BEGIN
[0m15:11:33.161801 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.11 seconds
[0m15:11:33.162814 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:11:33.162814 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
insert into DOOR2DOOR_DWH.DBT_dwh.fact_deregistration ("DEREGISTRATION_KEY", "OPERATING_PERIOD_KEY", "DEREGISTRATION_TIME")
        (
            select "DEREGISTRATION_KEY", "OPERATING_PERIOD_KEY", "DEREGISTRATION_TIME"
            from DOOR2DOOR_DWH.DBT_dwh.fact_deregistration__dbt_tmp
        );
[0m15:11:33.659550 [debug] [Thread-1  ]: SQL status: SUCCESS 0 in 0.5 seconds
[0m15:11:33.659550 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:11:33.660546 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
COMMIT
[0m15:11:33.893599 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.23 seconds
[0m15:11:33.897593 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:11:33.898594 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
drop view if exists DOOR2DOOR_DWH.DBT_dwh.fact_deregistration__dbt_tmp cascade
[0m15:11:34.002578 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.1 seconds
[0m15:11:34.004573 [debug] [Thread-1  ]: finished collecting timing info
[0m15:11:34.005573 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: Close
[0m15:11:34.140068 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8e76ca0-1b48-49b3-a90a-55cee28f4e59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CFC8F850D0>]}
[0m15:11:34.140068 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model DBT_dwh.fact_deregistration ............ [[32mSUCCESS 0[0m in 2.14s]
[0m15:11:34.142151 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_deregistration
[0m15:11:34.143191 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_registration
[0m15:11:34.143191 [info ] [Thread-1  ]: 6 of 7 START sql incremental model DBT_dwh.fact_registration ................... [RUN]
[0m15:11:34.144182 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_registration"
[0m15:11:34.144182 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_registration
[0m15:11:34.145190 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_registration
[0m15:11:34.152190 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_registration"
[0m15:11:34.152190 [debug] [Thread-1  ]: finished collecting timing info
[0m15:11:34.153165 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_registration
[0m15:11:34.158163 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:11:34.158163 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
create or replace  view DOOR2DOOR_DWH.DBT_dwh.fact_registration__dbt_tmp
  
   as (
    


with events as (
    SELECT
        r.data_id,
        r.register_event_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time

    
        and r.register_event_at > (select max(registration_time) from DOOR2DOOR_DWH.DBT_dwh.fact_registration)
    
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(register_event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as registration_key,
    operating_period_key,
    register_event_at as registration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
-- QUESTION:   Difference between event_on and data_location_at
  );
[0m15:11:34.159164 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:11:34.858722 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.7 seconds
[0m15:11:34.861719 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:11:34.861719 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
describe table DOOR2DOOR_DWH.DBT_dwh.fact_registration__dbt_tmp
[0m15:11:34.961884 [debug] [Thread-1  ]: SQL status: SUCCESS 3 in 0.1 seconds
[0m15:11:34.965878 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:11:34.965878 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
describe table DOOR2DOOR_DWH.DBT_dwh.fact_registration
[0m15:11:35.052140 [debug] [Thread-1  ]: SQL status: SUCCESS 3 in 0.09 seconds
[0m15:11:35.056140 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:11:35.056140 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
describe table "DOOR2DOOR_DWH"."DBT_DWH"."FACT_REGISTRATION"
[0m15:11:35.140684 [debug] [Thread-1  ]: SQL status: SUCCESS 3 in 0.08 seconds
[0m15:11:35.143681 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_registration"
[0m15:11:35.144699 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:11:35.144699 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
BEGIN
[0m15:11:35.259972 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.11 seconds
[0m15:11:35.259972 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:11:35.260968 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
insert into DOOR2DOOR_DWH.DBT_dwh.fact_registration ("REGISTRATION_KEY", "OPERATING_PERIOD_KEY", "REGISTRATION_TIME")
        (
            select "REGISTRATION_KEY", "OPERATING_PERIOD_KEY", "REGISTRATION_TIME"
            from DOOR2DOOR_DWH.DBT_dwh.fact_registration__dbt_tmp
        );
[0m15:11:35.842655 [debug] [Thread-1  ]: SQL status: SUCCESS 100 in 0.58 seconds
[0m15:11:35.842655 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:11:35.843651 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
COMMIT
[0m15:11:36.116815 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.27 seconds
[0m15:11:36.120811 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:11:36.120811 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
drop view if exists DOOR2DOOR_DWH.DBT_dwh.fact_registration__dbt_tmp cascade
[0m15:11:36.281173 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.16 seconds
[0m15:11:36.283169 [debug] [Thread-1  ]: finished collecting timing info
[0m15:11:36.283169 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: Close
[0m15:11:36.421378 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8e76ca0-1b48-49b3-a90a-55cee28f4e59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CFC91099D0>]}
[0m15:11:36.422379 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model DBT_dwh.fact_registration .............. [[32mSUCCESS 100[0m in 2.28s]
[0m15:11:36.423224 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_registration
[0m15:11:36.424263 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_vehicle_location
[0m15:11:36.424263 [info ] [Thread-1  ]: 7 of 7 START sql incremental model DBT_dwh.fact_vehicle_location ............... [RUN]
[0m15:11:36.426261 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:11:36.426261 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_vehicle_location
[0m15:11:36.426261 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_vehicle_location
[0m15:11:36.437232 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_vehicle_location"
[0m15:11:36.438235 [debug] [Thread-1  ]: finished collecting timing info
[0m15:11:36.438235 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_vehicle_location
[0m15:11:36.444235 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:11:36.444235 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
create or replace  view DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location__dbt_tmp
  
   as (
    

with locations as (
    SELECT
        e.event_at,
        e.data_id,
        e.data_location_lat,
        e.data_location_lng,
        e.data_location_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed e
    INNER JOIN DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
        ON e.data_id = r.data_id AND e.data_location_at BETWEEN r.register_event_at and COALESCE(r.deregister_event_at, CURRENT_TIMESTAMP())
    INNER JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'update'

    
        and data_location_at > (select max(vehicle_location_time) from DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location)
    
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_lat as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_lng as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_location_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    operating_period_key,
    data_location_lat as vehicle_location_lat,
    data_location_lng as vehicle_location_lng,
    data_location_at as vehicle_location_time
FROM locations


--- ASSUMPTION Events are recorded only if vehicle is registered to a operation period
  );
[0m15:11:36.445233 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:11:36.922360 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.48 seconds
[0m15:11:36.925389 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:11:36.925389 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
describe table DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location__dbt_tmp
[0m15:11:37.048195 [debug] [Thread-1  ]: SQL status: SUCCESS 6 in 0.12 seconds
[0m15:11:37.052190 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:11:37.052190 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
describe table DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location
[0m15:11:37.137430 [debug] [Thread-1  ]: SQL status: SUCCESS 6 in 0.09 seconds
[0m15:11:37.141426 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:11:37.141426 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
describe table "DOOR2DOOR_DWH"."DBT_DWH"."FACT_VEHICLE_LOCATION"
[0m15:11:37.224758 [debug] [Thread-1  ]: SQL status: SUCCESS 6 in 0.08 seconds
[0m15:11:37.227754 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_vehicle_location"
[0m15:11:37.228754 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:11:37.228754 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
BEGIN
[0m15:11:37.353123 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.12 seconds
[0m15:11:37.353123 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:11:37.354111 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
insert into DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location ("VEHICLE_LOCATION_KEY", "VEHICLE_KEY", "OPERATING_PERIOD_KEY", "VEHICLE_LOCATION_LAT", "VEHICLE_LOCATION_LNG", "VEHICLE_LOCATION_TIME")
        (
            select "VEHICLE_LOCATION_KEY", "VEHICLE_KEY", "OPERATING_PERIOD_KEY", "VEHICLE_LOCATION_LAT", "VEHICLE_LOCATION_LNG", "VEHICLE_LOCATION_TIME"
            from DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location__dbt_tmp
        );
[0m15:11:37.954615 [debug] [Thread-1  ]: SQL status: SUCCESS 0 in 0.6 seconds
[0m15:11:37.955670 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:11:37.955670 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
COMMIT
[0m15:11:38.200015 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.24 seconds
[0m15:11:38.204010 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:11:38.204010 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
drop view if exists DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location__dbt_tmp cascade
[0m15:11:38.318207 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.11 seconds
[0m15:11:38.320203 [debug] [Thread-1  ]: finished collecting timing info
[0m15:11:38.321203 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: Close
[0m15:11:38.472778 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8e76ca0-1b48-49b3-a90a-55cee28f4e59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CFC90F4A90>]}
[0m15:11:38.473778 [info ] [Thread-1  ]: 7 of 7 OK created sql incremental model DBT_dwh.fact_vehicle_location .......... [[32mSUCCESS 0[0m in 2.05s]
[0m15:11:38.474778 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_vehicle_location
[0m15:11:38.477778 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m15:11:38.477778 [info ] [MainThread]: 
[0m15:11:38.478790 [info ] [MainThread]: Finished running 5 incremental models, 2 table models in 0 hours 0 minutes and 20.49 seconds (20.49s).
[0m15:11:38.479784 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:11:38.479784 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m15:11:38.480778 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_stg' was properly closed.
[0m15:11:38.480778 [debug] [MainThread]: Connection 'model.door2door_dwh.fact_vehicle_location' was properly closed.
[0m15:11:38.489779 [info ] [MainThread]: 
[0m15:11:38.490778 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:11:38.491780 [info ] [MainThread]: 
[0m15:11:38.491780 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m15:11:38.492780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CFC91D4190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CFC90D7D90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CFC90D7130>]}
[0m15:11:38.492780 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 15:16:33.049339 | a1404097-4e6e-4ee5-a376-f8535923dd8a ==============================
[0m15:16:33.049339 [info ] [MainThread]: Running with dbt=1.3.1
[0m15:16:33.050348 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m15:16:33.050348 [debug] [MainThread]: Tracking: tracking
[0m15:16:33.050348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B23DD78D30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B23DD78D90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B23DD78DF0>]}
[0m15:16:33.183382 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:16:33.183382 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\fact_registration.sql
[0m15:16:33.196367 [debug] [MainThread]: 1603: static parser failed on dwh\fact_registration.sql
[0m15:16:33.233367 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_registration.sql
[0m15:16:33.251368 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a1404097-4e6e-4ee5-a376-f8535923dd8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B23DFD50D0>]}
[0m15:16:33.260368 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a1404097-4e6e-4ee5-a376-f8535923dd8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B23DFAB100>]}
[0m15:16:33.261345 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m15:16:33.262340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a1404097-4e6e-4ee5-a376-f8535923dd8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B23DFAB220>]}
[0m15:16:33.263368 [info ] [MainThread]: 
[0m15:16:33.264339 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m15:16:33.266369 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m15:16:33.282338 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m15:16:33.282338 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m15:16:33.282338 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:16:34.543133 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 1.26 seconds
[0m15:16:34.544133 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m15:16:34.687510 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m15:16:34.690509 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m15:16:34.690509 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m15:16:34.691485 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:16:35.068827 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.38 seconds
[0m15:16:35.069824 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m15:16:35.217524 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m15:16:35.225538 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m15:16:35.225538 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m15:16:35.226534 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:16:35.852544 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.63 seconds
[0m15:16:35.853539 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m15:16:35.991262 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m15:16:35.994263 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m15:16:35.994263 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m15:16:35.994263 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:16:36.655357 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.66 seconds
[0m15:16:36.656353 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m15:16:36.783160 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a1404097-4e6e-4ee5-a376-f8535923dd8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B23DFA1B20>]}
[0m15:16:36.784170 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:16:36.785161 [info ] [MainThread]: 
[0m15:16:36.801946 [debug] [Thread-1  ]: Began running node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:16:36.802946 [info ] [Thread-1  ]: 1 of 7 START sql incremental model DBT_stg.vehicle_iot_data_parsed ............. [RUN]
[0m15:16:36.803944 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:16:36.803944 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:16:36.804963 [debug] [Thread-1  ]: Compiling model.door2door_dwh.vehicle_iot_data_parsed
[0m15:16:36.811976 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:16:36.812976 [debug] [Thread-1  ]: finished collecting timing info
[0m15:16:36.812976 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:16:36.866975 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:16:36.868975 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:16:36.868975 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
create or replace transient table DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed  as
        (

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TEXT as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
        );
[0m15:16:36.868975 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m15:16:42.033864 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 5.16 seconds
[0m15:16:42.040860 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:16:42.041862 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed__dbt_tmp cascade
[0m15:16:42.149651 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.11 seconds
[0m15:16:42.172677 [debug] [Thread-1  ]: finished collecting timing info
[0m15:16:42.172677 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: Close
[0m15:16:42.306675 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a1404097-4e6e-4ee5-a376-f8535923dd8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B23E32A9A0>]}
[0m15:16:42.307699 [info ] [Thread-1  ]: 1 of 7 OK created sql incremental model DBT_stg.vehicle_iot_data_parsed ........ [[32mSUCCESS 1[0m in 5.50s]
[0m15:16:42.309266 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:16:42.310276 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_operating_period
[0m15:16:42.311275 [info ] [Thread-1  ]: 2 of 7 START sql table model DBT_dwh.dim_operating_period ...................... [RUN]
[0m15:16:42.312277 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_operating_period"
[0m15:16:42.312277 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_operating_period
[0m15:16:42.312277 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_operating_period
[0m15:16:42.317305 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_operating_period"
[0m15:16:42.318305 [debug] [Thread-1  ]: finished collecting timing info
[0m15:16:42.318305 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_operating_period
[0m15:16:42.331290 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_operating_period"
[0m15:16:42.333308 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_operating_period"
[0m15:16:42.333308 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_operating_period"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_operating_period  as
        (

with operating_periods as (
    SELECT
        data_id,
        data_start,
        data_finish,
        ROW_NUMBER() OVER (PARTITION BY data_id ORDER BY data_finish desc, data_start desc) as rn
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed
    WHERE lower(event_on) = 'operating_period'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    data_id as operating_period_source_id,
    data_start as operating_period_start_time,
    data_finish as operating_period_finish_time
FROM operating_periods
        );
[0m15:16:42.334305 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:16:43.429136 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.09 seconds
[0m15:16:43.433133 [debug] [Thread-1  ]: finished collecting timing info
[0m15:16:43.434131 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: Close
[0m15:16:43.564164 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a1404097-4e6e-4ee5-a376-f8535923dd8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B23E3BC7F0>]}
[0m15:16:43.564164 [info ] [Thread-1  ]: 2 of 7 OK created sql table model DBT_dwh.dim_operating_period ................. [[32mSUCCESS 1[0m in 1.25s]
[0m15:16:43.566132 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_operating_period
[0m15:16:43.567131 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_vehicle
[0m15:16:43.567131 [info ] [Thread-1  ]: 3 of 7 START sql table model DBT_dwh.dim_vehicle ............................... [RUN]
[0m15:16:43.569138 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_vehicle"
[0m15:16:43.569138 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_vehicle
[0m15:16:43.570135 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_vehicle
[0m15:16:43.577151 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_vehicle"
[0m15:16:43.578165 [debug] [Thread-1  ]: finished collecting timing info
[0m15:16:43.579133 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_vehicle
[0m15:16:43.582136 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_vehicle"
[0m15:16:43.585134 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_vehicle"
[0m15:16:43.585134 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_vehicle"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_vehicle  as
        (

with vehicles as (
    SELECT
        DISTINCT data_id
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed
    WHERE lower(event_on) = 'vehicle'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    data_id as vehicle_source_id
FROM vehicles
        );
[0m15:16:43.586163 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:16:44.447776 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.86 seconds
[0m15:16:44.449772 [debug] [Thread-1  ]: finished collecting timing info
[0m15:16:44.450770 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: Close
[0m15:16:44.574136 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a1404097-4e6e-4ee5-a376-f8535923dd8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B23E32A400>]}
[0m15:16:44.575137 [info ] [Thread-1  ]: 3 of 7 OK created sql table model DBT_dwh.dim_vehicle .......................... [[32mSUCCESS 1[0m in 1.01s]
[0m15:16:44.576110 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_vehicle
[0m15:16:44.577109 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m15:16:44.577109 [info ] [Thread-1  ]: 4 of 7 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m15:16:44.578107 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:16:44.579147 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m15:16:44.579147 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m15:16:44.586148 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m15:16:44.587137 [debug] [Thread-1  ]: finished collecting timing info
[0m15:16:44.587137 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m15:16:44.591137 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.registration_events_grouped"
[0m15:16:44.592137 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:16:44.593154 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace transient table DOOR2DOOR_DWH.DBT_stg.registration_events_grouped  as
        (

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed e
    WHERE lower(event) in ('register', 'deregister')
        -- AND event_at <= '2019-06-01 18:17:04.089'

    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



SELECT * FROM new_registers
        );
[0m15:16:44.593154 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:16:45.774205 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.18 seconds
[0m15:16:45.778198 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:16:45.778198 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp cascade
[0m15:16:45.852401 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.07 seconds
[0m15:16:45.855398 [debug] [Thread-1  ]: finished collecting timing info
[0m15:16:45.855398 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m15:16:45.996284 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a1404097-4e6e-4ee5-a376-f8535923dd8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B23E32AB80>]}
[0m15:16:45.997257 [info ] [Thread-1  ]: 4 of 7 OK created sql incremental model DBT_stg.registration_events_grouped .... [[32mSUCCESS 1[0m in 1.42s]
[0m15:16:45.998277 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m15:16:46.000257 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_deregistration
[0m15:16:46.000257 [info ] [Thread-1  ]: 5 of 7 START sql incremental model DBT_dwh.fact_deregistration ................. [RUN]
[0m15:16:46.001271 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:16:46.002256 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_deregistration
[0m15:16:46.002256 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_deregistration
[0m15:16:46.056256 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_deregistration"
[0m15:16:46.057257 [debug] [Thread-1  ]: finished collecting timing info
[0m15:16:46.057257 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_deregistration
[0m15:16:46.061256 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_deregistration"
[0m15:16:46.064255 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:16:46.064255 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_deregistration  as
        (

with events as (
    SELECT
        r.data_id,
        r.deregister_event_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time AND op.operating_period_finish_time
    WHERE r.deregister_event_at IS NOT NULL

    
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(deregister_event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as deregistration_key,
    operating_period_key,
    deregister_event_at as deregistration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
        );
[0m15:16:46.064255 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:16:47.409945 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.35 seconds
[0m15:16:47.412938 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:16:47.412938 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
drop view if exists DOOR2DOOR_DWH.DBT_dwh.fact_deregistration__dbt_tmp cascade
[0m15:16:47.497179 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m15:16:47.499173 [debug] [Thread-1  ]: finished collecting timing info
[0m15:16:47.500180 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: Close
[0m15:16:47.633224 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a1404097-4e6e-4ee5-a376-f8535923dd8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B23E3DAFD0>]}
[0m15:16:47.634224 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model DBT_dwh.fact_deregistration ............ [[32mSUCCESS 1[0m in 1.63s]
[0m15:16:47.635377 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_deregistration
[0m15:16:47.635377 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_registration
[0m15:16:47.636410 [info ] [Thread-1  ]: 6 of 7 START sql incremental model DBT_dwh.fact_registration ................... [RUN]
[0m15:16:47.637390 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_registration"
[0m15:16:47.638415 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_registration
[0m15:16:47.638415 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_registration
[0m15:16:47.645415 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_registration"
[0m15:16:47.646404 [debug] [Thread-1  ]: finished collecting timing info
[0m15:16:47.646404 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_registration
[0m15:16:47.650396 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_registration"
[0m15:16:47.652398 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:16:47.652398 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_registration  as
        (


with events as (
    SELECT
        r.data_id,
        r.register_event_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE 1=1
    
    
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(register_event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as registration_key,
    operating_period_key,
    register_event_at as registration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
-- QUESTION:   Difference between event_on and data_location_at


2019-06-01T18:17:04.091Z
2019-06-01T18:17:04.091Z
        );
[0m15:16:47.652398 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:16:48.113843 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01aa2134-3201-9838-0000-0001c146370d
[0m15:16:48.113843 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 29 at position 0 unexpected '2019'.
[0m15:16:48.114846 [debug] [Thread-1  ]: finished collecting timing info
[0m15:16:48.114846 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: Close
[0m15:16:48.257783 [debug] [Thread-1  ]: Database Error in model fact_registration (models\dwh\fact_registration.sql)
  001003 (42000): SQL compilation error:
  syntax error line 29 at position 0 unexpected '2019'.
  compiled Code at target\run\door2door_dwh\models\dwh\fact_registration.sql
[0m15:16:48.257783 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a1404097-4e6e-4ee5-a376-f8535923dd8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B23E32A910>]}
[0m15:16:48.258782 [error] [Thread-1  ]: 6 of 7 ERROR creating sql incremental model DBT_dwh.fact_registration .......... [[31mERROR[0m in 0.62s]
[0m15:16:48.260372 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_registration
[0m15:16:48.260372 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_vehicle_location
[0m15:16:48.261416 [info ] [Thread-1  ]: 7 of 7 START sql incremental model DBT_dwh.fact_vehicle_location ............... [RUN]
[0m15:16:48.262371 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:16:48.262371 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_vehicle_location
[0m15:16:48.262371 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_vehicle_location
[0m15:16:48.271410 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_vehicle_location"
[0m15:16:48.272381 [debug] [Thread-1  ]: finished collecting timing info
[0m15:16:48.273375 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_vehicle_location
[0m15:16:48.277400 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_vehicle_location"
[0m15:16:48.280413 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:16:48.280413 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location  as
        (

with locations as (
    SELECT
        e.event_at,
        e.data_id,
        e.data_location_lat,
        e.data_location_lng,
        e.data_location_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed e
    INNER JOIN DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
        ON e.data_id = r.data_id AND e.data_location_at BETWEEN r.register_event_at and COALESCE(r.deregister_event_at, CURRENT_TIMESTAMP())
    INNER JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'update'

    
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_lat as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_lng as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_location_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    operating_period_key,
    data_location_lat as vehicle_location_lat,
    data_location_lng as vehicle_location_lng,
    data_location_at as vehicle_location_time
FROM locations


--- ASSUMPTION Events are recorded only if vehicle is registered to a operation period
        );
[0m15:16:48.280413 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:16:49.668545 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.39 seconds
[0m15:16:49.671535 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:16:49.671535 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
drop view if exists DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location__dbt_tmp cascade
[0m15:16:49.759067 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.09 seconds
[0m15:16:49.763066 [debug] [Thread-1  ]: finished collecting timing info
[0m15:16:49.763066 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: Close
[0m15:16:49.894466 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a1404097-4e6e-4ee5-a376-f8535923dd8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B23E32A6A0>]}
[0m15:16:49.895467 [info ] [Thread-1  ]: 7 of 7 OK created sql incremental model DBT_dwh.fact_vehicle_location .......... [[32mSUCCESS 1[0m in 1.63s]
[0m15:16:49.897126 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_vehicle_location
[0m15:16:49.899128 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m15:16:49.900155 [info ] [MainThread]: 
[0m15:16:49.901679 [info ] [MainThread]: Finished running 5 incremental models, 2 table models in 0 hours 0 minutes and 16.64 seconds (16.64s).
[0m15:16:49.902318 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:16:49.902318 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m15:16:49.902318 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_dwh' was properly closed.
[0m15:16:49.903340 [debug] [MainThread]: Connection 'model.door2door_dwh.fact_vehicle_location' was properly closed.
[0m15:16:49.912339 [info ] [MainThread]: 
[0m15:16:49.913342 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:16:49.914340 [info ] [MainThread]: 
[0m15:16:49.915341 [error] [MainThread]: [33mDatabase Error in model fact_registration (models\dwh\fact_registration.sql)[0m
[0m15:16:49.917344 [error] [MainThread]:   001003 (42000): SQL compilation error:
[0m15:16:49.917344 [error] [MainThread]:   syntax error line 29 at position 0 unexpected '2019'.
[0m15:16:49.918340 [error] [MainThread]:   compiled Code at target\run\door2door_dwh\models\dwh\fact_registration.sql
[0m15:16:49.919472 [info ] [MainThread]: 
[0m15:16:49.919472 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=1 SKIP=0 TOTAL=7
[0m15:16:49.920483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B23E3E4D00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B23E3E4310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B23E301100>]}
[0m15:16:49.921482 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 15:17:01.306795 | f5705e57-0123-44ff-a38d-7d03b6c2689d ==============================
[0m15:17:01.306795 [info ] [MainThread]: Running with dbt=1.3.1
[0m15:17:01.307766 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'full_refresh': True, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m15:17:01.307766 [debug] [MainThread]: Tracking: tracking
[0m15:17:01.307766 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A112A9CD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A112A9D30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A112A9D90>]}
[0m15:17:01.440793 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:17:01.441793 [debug] [MainThread]: Partial parsing: updated file: door2door_dwh://models\dwh\fact_registration.sql
[0m15:17:01.453793 [debug] [MainThread]: 1603: static parser failed on dwh\fact_registration.sql
[0m15:17:01.486800 [debug] [MainThread]: 1602: parser fallback to jinja rendering on dwh\fact_registration.sql
[0m15:17:01.507795 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f5705e57-0123-44ff-a38d-7d03b6c2689d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A115030D0>]}
[0m15:17:01.516795 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f5705e57-0123-44ff-a38d-7d03b6c2689d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A114DA100>]}
[0m15:17:01.517767 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m15:17:01.517767 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f5705e57-0123-44ff-a38d-7d03b6c2689d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A114DA220>]}
[0m15:17:01.519797 [info ] [MainThread]: 
[0m15:17:01.520767 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m15:17:01.522795 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m15:17:01.538796 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m15:17:01.538796 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m15:17:01.539797 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:17:02.471434 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.93 seconds
[0m15:17:02.472431 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m15:17:02.602815 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m15:17:02.605814 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m15:17:02.605814 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m15:17:02.605814 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:17:03.172396 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.57 seconds
[0m15:17:03.173391 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m15:17:03.311443 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m15:17:03.319442 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m15:17:03.320442 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m15:17:03.320442 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:17:03.716065 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.4 seconds
[0m15:17:03.718117 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m15:17:03.850136 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m15:17:03.852114 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m15:17:03.853115 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m15:17:03.853115 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:17:04.461441 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.61 seconds
[0m15:17:04.463480 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m15:17:04.594735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f5705e57-0123-44ff-a38d-7d03b6c2689d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A114D7460>]}
[0m15:17:04.595706 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:17:04.596756 [info ] [MainThread]: 
[0m15:17:04.602019 [debug] [Thread-1  ]: Began running node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:17:04.602019 [info ] [Thread-1  ]: 1 of 7 START sql incremental model DBT_stg.vehicle_iot_data_parsed ............. [RUN]
[0m15:17:04.604018 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:17:04.604018 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:17:04.605035 [debug] [Thread-1  ]: Compiling model.door2door_dwh.vehicle_iot_data_parsed
[0m15:17:04.611059 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:17:04.612057 [debug] [Thread-1  ]: finished collecting timing info
[0m15:17:04.612057 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:17:04.666047 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:17:04.668022 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:17:04.668022 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
create or replace transient table DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed  as
        (

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TEXT as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
        );
[0m15:17:04.669021 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m15:17:08.632353 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 3.96 seconds
[0m15:17:08.639352 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:17:08.640352 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed__dbt_tmp cascade
[0m15:17:08.717355 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m15:17:08.739350 [debug] [Thread-1  ]: finished collecting timing info
[0m15:17:08.740351 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: Close
[0m15:17:08.869457 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5705e57-0123-44ff-a38d-7d03b6c2689d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A115429D0>]}
[0m15:17:08.870459 [info ] [Thread-1  ]: 1 of 7 OK created sql incremental model DBT_stg.vehicle_iot_data_parsed ........ [[32mSUCCESS 1[0m in 4.27s]
[0m15:17:08.871451 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:17:08.873429 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_operating_period
[0m15:17:08.873429 [info ] [Thread-1  ]: 2 of 7 START sql table model DBT_dwh.dim_operating_period ...................... [RUN]
[0m15:17:08.875429 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_operating_period"
[0m15:17:08.875429 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_operating_period
[0m15:17:08.875429 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_operating_period
[0m15:17:08.880429 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_operating_period"
[0m15:17:08.881429 [debug] [Thread-1  ]: finished collecting timing info
[0m15:17:08.881429 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_operating_period
[0m15:17:08.892429 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_operating_period"
[0m15:17:08.894433 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_operating_period"
[0m15:17:08.894433 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_operating_period"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_operating_period  as
        (

with operating_periods as (
    SELECT
        data_id,
        data_start,
        data_finish,
        ROW_NUMBER() OVER (PARTITION BY data_id ORDER BY data_finish desc, data_start desc) as rn
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed
    WHERE lower(event_on) = 'operating_period'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    data_id as operating_period_source_id,
    data_start as operating_period_start_time,
    data_finish as operating_period_finish_time
FROM operating_periods
        );
[0m15:17:08.895437 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:17:09.947728 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.05 seconds
[0m15:17:09.949729 [debug] [Thread-1  ]: finished collecting timing info
[0m15:17:09.950724 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: Close
[0m15:17:10.079937 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5705e57-0123-44ff-a38d-7d03b6c2689d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A118EC7C0>]}
[0m15:17:10.080908 [info ] [Thread-1  ]: 2 of 7 OK created sql table model DBT_dwh.dim_operating_period ................. [[32mSUCCESS 1[0m in 1.21s]
[0m15:17:10.081908 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_operating_period
[0m15:17:10.082908 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_vehicle
[0m15:17:10.083481 [info ] [Thread-1  ]: 3 of 7 START sql table model DBT_dwh.dim_vehicle ............................... [RUN]
[0m15:17:10.084492 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_vehicle"
[0m15:17:10.084492 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_vehicle
[0m15:17:10.084492 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_vehicle
[0m15:17:10.089748 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_vehicle"
[0m15:17:10.090715 [debug] [Thread-1  ]: finished collecting timing info
[0m15:17:10.090715 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_vehicle
[0m15:17:10.093744 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_vehicle"
[0m15:17:10.094770 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_vehicle"
[0m15:17:10.095715 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_vehicle"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_vehicle  as
        (

with vehicles as (
    SELECT
        DISTINCT data_id
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed
    WHERE lower(event_on) = 'vehicle'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    data_id as vehicle_source_id
FROM vehicles
        );
[0m15:17:10.095715 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:17:11.101837 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.01 seconds
[0m15:17:11.104864 [debug] [Thread-1  ]: finished collecting timing info
[0m15:17:11.104864 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: Close
[0m15:17:11.244230 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5705e57-0123-44ff-a38d-7d03b6c2689d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A118518B0>]}
[0m15:17:11.244230 [info ] [Thread-1  ]: 3 of 7 OK created sql table model DBT_dwh.dim_vehicle .......................... [[32mSUCCESS 1[0m in 1.16s]
[0m15:17:11.246206 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_vehicle
[0m15:17:11.246206 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m15:17:11.247278 [info ] [Thread-1  ]: 4 of 7 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m15:17:11.248228 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:17:11.248228 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m15:17:11.249258 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m15:17:11.255258 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m15:17:11.256259 [debug] [Thread-1  ]: finished collecting timing info
[0m15:17:11.256259 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m15:17:11.261269 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.registration_events_grouped"
[0m15:17:11.263229 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:17:11.263229 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace transient table DOOR2DOOR_DWH.DBT_stg.registration_events_grouped  as
        (

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed e
    WHERE lower(event) in ('register', 'deregister')
        -- AND event_at <= '2019-06-01 18:17:04.089'

    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



SELECT * FROM new_registers
        );
[0m15:17:11.264233 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:17:12.205900 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.94 seconds
[0m15:17:12.209927 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:17:12.209927 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp cascade
[0m15:17:12.293790 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m15:17:12.295786 [debug] [Thread-1  ]: finished collecting timing info
[0m15:17:12.296786 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m15:17:12.692114 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5705e57-0123-44ff-a38d-7d03b6c2689d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A11851C70>]}
[0m15:17:12.693113 [info ] [Thread-1  ]: 4 of 7 OK created sql incremental model DBT_stg.registration_events_grouped .... [[32mSUCCESS 1[0m in 1.44s]
[0m15:17:12.694084 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m15:17:12.695113 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_deregistration
[0m15:17:12.696084 [info ] [Thread-1  ]: 5 of 7 START sql incremental model DBT_dwh.fact_deregistration ................. [RUN]
[0m15:17:12.697082 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:17:12.697082 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_deregistration
[0m15:17:12.698114 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_deregistration
[0m15:17:12.754113 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_deregistration"
[0m15:17:12.755114 [debug] [Thread-1  ]: finished collecting timing info
[0m15:17:12.755114 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_deregistration
[0m15:17:12.759112 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_deregistration"
[0m15:17:12.760115 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:17:12.761113 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_deregistration  as
        (

with events as (
    SELECT
        r.data_id,
        r.deregister_event_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time AND op.operating_period_finish_time
    WHERE r.deregister_event_at IS NOT NULL

    
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(deregister_event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as deregistration_key,
    operating_period_key,
    deregister_event_at as deregistration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
        );
[0m15:17:12.761113 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:17:14.110240 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.35 seconds
[0m15:17:14.113238 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:17:14.113238 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
drop view if exists DOOR2DOOR_DWH.DBT_dwh.fact_deregistration__dbt_tmp cascade
[0m15:17:14.196386 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m15:17:14.199353 [debug] [Thread-1  ]: finished collecting timing info
[0m15:17:14.199353 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: Close
[0m15:17:14.331409 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5705e57-0123-44ff-a38d-7d03b6c2689d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A116FE040>]}
[0m15:17:14.332406 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model DBT_dwh.fact_deregistration ............ [[32mSUCCESS 1[0m in 1.63s]
[0m15:17:14.333684 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_deregistration
[0m15:17:14.333684 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_registration
[0m15:17:14.334749 [info ] [Thread-1  ]: 6 of 7 START sql incremental model DBT_dwh.fact_registration ................... [RUN]
[0m15:17:14.335718 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_registration"
[0m15:17:14.335718 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_registration
[0m15:17:14.336710 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_registration
[0m15:17:14.342711 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_registration"
[0m15:17:14.343711 [debug] [Thread-1  ]: finished collecting timing info
[0m15:17:14.344726 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_registration
[0m15:17:14.347709 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_registration"
[0m15:17:14.349710 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:17:14.349710 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_registration  as
        (


with events as (
    SELECT
        r.data_id,
        r.register_event_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE 1=1

    
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(register_event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as registration_key,
    operating_period_key,
    register_event_at as registration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
-- QUESTION:   Difference between event_on and data_location_at
        );
[0m15:17:14.350710 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:17:15.710713 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.36 seconds
[0m15:17:15.713708 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:17:15.713708 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
drop view if exists DOOR2DOOR_DWH.DBT_dwh.fact_registration__dbt_tmp cascade
[0m15:17:15.798769 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m15:17:15.800765 [debug] [Thread-1  ]: finished collecting timing info
[0m15:17:15.801764 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: Close
[0m15:17:15.930055 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5705e57-0123-44ff-a38d-7d03b6c2689d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A11851B50>]}
[0m15:17:15.931056 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model DBT_dwh.fact_registration .............. [[32mSUCCESS 1[0m in 1.59s]
[0m15:17:15.932673 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_registration
[0m15:17:15.932673 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_vehicle_location
[0m15:17:15.932673 [info ] [Thread-1  ]: 7 of 7 START sql incremental model DBT_dwh.fact_vehicle_location ............... [RUN]
[0m15:17:15.934700 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:17:15.934700 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_vehicle_location
[0m15:17:15.934700 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_vehicle_location
[0m15:17:15.943701 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_vehicle_location"
[0m15:17:15.944701 [debug] [Thread-1  ]: finished collecting timing info
[0m15:17:15.945675 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_vehicle_location
[0m15:17:15.949700 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_vehicle_location"
[0m15:17:15.951700 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:17:15.951700 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location  as
        (

with locations as (
    SELECT
        e.event_at,
        e.data_id,
        e.data_location_lat,
        e.data_location_lng,
        e.data_location_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed e
    INNER JOIN DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
        ON e.data_id = r.data_id AND e.data_location_at BETWEEN r.register_event_at and COALESCE(r.deregister_event_at, CURRENT_TIMESTAMP())
    INNER JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'update'

    
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_lat as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_lng as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_location_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    operating_period_key,
    data_location_lat as vehicle_location_lat,
    data_location_lng as vehicle_location_lng,
    data_location_at as vehicle_location_time
FROM locations


--- ASSUMPTION Events are recorded only if vehicle is registered to a operation period
        );
[0m15:17:15.951700 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:17:17.149973 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.2 seconds
[0m15:17:17.152999 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:17:17.152999 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
drop view if exists DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location__dbt_tmp cascade
[0m15:17:17.235252 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.08 seconds
[0m15:17:17.237246 [debug] [Thread-1  ]: finished collecting timing info
[0m15:17:17.238251 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: Close
[0m15:17:17.372301 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5705e57-0123-44ff-a38d-7d03b6c2689d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A118D3CD0>]}
[0m15:17:17.373273 [info ] [Thread-1  ]: 7 of 7 OK created sql incremental model DBT_dwh.fact_vehicle_location .......... [[32mSUCCESS 1[0m in 1.44s]
[0m15:17:17.374424 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_vehicle_location
[0m15:17:17.376447 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m15:17:17.376447 [info ] [MainThread]: 
[0m15:17:17.377476 [info ] [MainThread]: Finished running 5 incremental models, 2 table models in 0 hours 0 minutes and 15.86 seconds (15.86s).
[0m15:17:17.378499 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:17:17.378499 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m15:17:17.378499 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_stg' was properly closed.
[0m15:17:17.379477 [debug] [MainThread]: Connection 'model.door2door_dwh.fact_vehicle_location' was properly closed.
[0m15:17:17.390498 [info ] [MainThread]: 
[0m15:17:17.392456 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:17:17.393466 [info ] [MainThread]: 
[0m15:17:17.394448 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m15:17:17.395476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A11912D00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A114A8580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A114A86D0>]}
[0m15:17:17.395476 [debug] [MainThread]: Flushing usage events


============================== 2023-02-05 15:17:30.081555 | 7c5bf9f3-300e-479b-8cd6-9b46feb1e3de ==============================
[0m15:17:30.081555 [info ] [MainThread]: Running with dbt=1.3.1
[0m15:17:30.082539 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': 'C:\\Users\\Antun\\.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m15:17:30.082539 [debug] [MainThread]: Tracking: tracking
[0m15:17:30.083525 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001792B28AD60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001792B28ADC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001792B28AE20>]}
[0m15:17:30.212556 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:17:30.212556 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:17:30.218555 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7c5bf9f3-300e-479b-8cd6-9b46feb1e3de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001792B47B0D0>]}
[0m15:17:30.227525 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7c5bf9f3-300e-479b-8cd6-9b46feb1e3de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001792B38E850>]}
[0m15:17:30.227525 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 415 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
[0m15:17:30.228556 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7c5bf9f3-300e-479b-8cd6-9b46feb1e3de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001792B38E970>]}
[0m15:17:30.229526 [info ] [MainThread]: 
[0m15:17:30.230557 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m15:17:30.232570 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m15:17:30.248556 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m15:17:30.249557 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m15:17:30.249557 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:17:31.153981 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.9 seconds
[0m15:17:31.154981 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m15:17:31.284609 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH"
[0m15:17:31.286610 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH"
[0m15:17:31.286610 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH"} */
show terse schemas in database DOOR2DOOR_DWH
    limit 10000
[0m15:17:31.287602 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:17:31.834559 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.55 seconds
[0m15:17:31.835588 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH: Close
[0m15:17:31.981334 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m15:17:31.988307 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_dwh"
[0m15:17:31.988307 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_dwh"} */
show terse objects in DOOR2DOOR_DWH.DBT_dwh
[0m15:17:31.988307 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:17:32.595828 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.61 seconds
[0m15:17:32.597819 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_dwh: Close
[0m15:17:32.732446 [debug] [ThreadPool]: Acquiring new snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m15:17:32.734417 [debug] [ThreadPool]: Using snowflake connection "list_DOOR2DOOR_DWH_DBT_stg"
[0m15:17:32.735416 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "connection_name": "list_DOOR2DOOR_DWH_DBT_stg"} */
show terse objects in DOOR2DOOR_DWH.DBT_stg
[0m15:17:32.736418 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:17:33.215301 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.48 seconds
[0m15:17:33.216295 [debug] [ThreadPool]: On list_DOOR2DOOR_DWH_DBT_stg: Close
[0m15:17:33.346054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7c5bf9f3-300e-479b-8cd6-9b46feb1e3de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001792B28A2B0>]}
[0m15:17:33.347027 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:17:33.348055 [info ] [MainThread]: 
[0m15:17:33.353934 [debug] [Thread-1  ]: Began running node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:17:33.353934 [info ] [Thread-1  ]: 1 of 7 START sql incremental model DBT_stg.vehicle_iot_data_parsed ............. [RUN]
[0m15:17:33.355973 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:17:33.355973 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:17:33.355973 [debug] [Thread-1  ]: Compiling model.door2door_dwh.vehicle_iot_data_parsed
[0m15:17:33.365984 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:17:33.366949 [debug] [Thread-1  ]: finished collecting timing info
[0m15:17:33.367948 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:17:33.416944 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:17:33.416944 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
create or replace  view DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed__dbt_tmp
  
   as (
    

with events as (
    SELECT
        VALUE:"event"::TEXT as event,
        VALUE:"on"::TEXT as event_on,
        VALUE:"at"::TIMESTAMP as event_at,
        PARSE_JSON(VALUE:"data"::TEXT) as data,
        VALUE:"organization_id"::TEXT as organization_id
    FROM DOOR2DOOR_DWH.RAW.vehicle_iot_data

    
        where event_at > (select max(event_at) from DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed)
    
)
SELECT
    event,
    event_on,
    event_at,
    data:"id"::TEXT as data_id,
    data:"location":"lat"::FLOAT as data_location_lat,
    data:"location":"lng"::FLOAT as data_location_lng,
    data:"location":"at"::TIMESTAMP as data_location_at,
    data:"start"::TIMESTAMP as data_start,
    data:"finish"::TIMESTAMP as data_finish
FROM events
  );
[0m15:17:33.417943 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m15:17:33.935968 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.52 seconds
[0m15:17:33.943962 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:17:33.943962 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
describe table DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed__dbt_tmp
[0m15:17:34.046110 [debug] [Thread-1  ]: SQL status: SUCCESS 9 in 0.1 seconds
[0m15:17:34.050098 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:17:34.050098 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
describe table DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed
[0m15:17:34.137045 [debug] [Thread-1  ]: SQL status: SUCCESS 9 in 0.09 seconds
[0m15:17:34.146038 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:17:34.146038 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
describe table "DOOR2DOOR_DWH"."DBT_STG"."VEHICLE_IOT_DATA_PARSED"
[0m15:17:34.236499 [debug] [Thread-1  ]: SQL status: SUCCESS 9 in 0.09 seconds
[0m15:17:34.252494 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:17:34.254485 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:17:34.254485 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
BEGIN
[0m15:17:34.369480 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.11 seconds
[0m15:17:34.369480 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:17:34.370448 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
insert into DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed ("EVENT", "EVENT_ON", "EVENT_AT", "DATA_ID", "DATA_LOCATION_LAT", "DATA_LOCATION_LNG", "DATA_LOCATION_AT", "DATA_START", "DATA_FINISH")
        (
            select "EVENT", "EVENT_ON", "EVENT_AT", "DATA_ID", "DATA_LOCATION_LAT", "DATA_LOCATION_LNG", "DATA_LOCATION_AT", "DATA_START", "DATA_FINISH"
            from DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed__dbt_tmp
        );
[0m15:17:37.819216 [debug] [Thread-1  ]: SQL status: SUCCESS 0 in 3.45 seconds
[0m15:17:37.820230 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:17:37.820230 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
COMMIT
[0m15:17:38.080475 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.26 seconds
[0m15:17:38.088529 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.vehicle_iot_data_parsed"
[0m15:17:38.088529 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.vehicle_iot_data_parsed"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed__dbt_tmp cascade
[0m15:17:38.208980 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.12 seconds
[0m15:17:38.227975 [debug] [Thread-1  ]: finished collecting timing info
[0m15:17:38.228976 [debug] [Thread-1  ]: On model.door2door_dwh.vehicle_iot_data_parsed: Close
[0m15:17:38.358327 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7c5bf9f3-300e-479b-8cd6-9b46feb1e3de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001792B795A90>]}
[0m15:17:38.359324 [info ] [Thread-1  ]: 1 of 7 OK created sql incremental model DBT_stg.vehicle_iot_data_parsed ........ [[32mSUCCESS 0[0m in 5.00s]
[0m15:17:38.360291 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.vehicle_iot_data_parsed
[0m15:17:38.362320 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_operating_period
[0m15:17:38.362320 [info ] [Thread-1  ]: 2 of 7 START sql table model DBT_dwh.dim_operating_period ...................... [RUN]
[0m15:17:38.363346 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_operating_period"
[0m15:17:38.363346 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_operating_period
[0m15:17:38.363346 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_operating_period
[0m15:17:38.382343 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_operating_period"
[0m15:17:38.383343 [debug] [Thread-1  ]: finished collecting timing info
[0m15:17:38.384349 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_operating_period
[0m15:17:38.411383 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_operating_period"
[0m15:17:38.413374 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_operating_period"
[0m15:17:38.413374 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_operating_period"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_operating_period  as
        (

with operating_periods as (
    SELECT
        data_id,
        data_start,
        data_finish,
        ROW_NUMBER() OVER (PARTITION BY data_id ORDER BY data_finish desc, data_start desc) as rn
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed
    WHERE lower(event_on) = 'operating_period'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as operating_period_key,
    data_id as operating_period_source_id,
    data_start as operating_period_start_time,
    data_finish as operating_period_finish_time
FROM operating_periods
        );
[0m15:17:38.414348 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:17:39.316708 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.9 seconds
[0m15:17:39.321704 [debug] [Thread-1  ]: finished collecting timing info
[0m15:17:39.321704 [debug] [Thread-1  ]: On model.door2door_dwh.dim_operating_period: Close
[0m15:17:39.450755 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7c5bf9f3-300e-479b-8cd6-9b46feb1e3de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001792B77F2B0>]}
[0m15:17:39.451755 [info ] [Thread-1  ]: 2 of 7 OK created sql table model DBT_dwh.dim_operating_period ................. [[32mSUCCESS 1[0m in 1.09s]
[0m15:17:39.453140 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_operating_period
[0m15:17:39.454218 [debug] [Thread-1  ]: Began running node model.door2door_dwh.dim_vehicle
[0m15:17:39.454218 [info ] [Thread-1  ]: 3 of 7 START sql table model DBT_dwh.dim_vehicle ............................... [RUN]
[0m15:17:39.456205 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.dim_vehicle"
[0m15:17:39.456205 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.dim_vehicle
[0m15:17:39.456205 [debug] [Thread-1  ]: Compiling model.door2door_dwh.dim_vehicle
[0m15:17:39.462199 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.dim_vehicle"
[0m15:17:39.463200 [debug] [Thread-1  ]: finished collecting timing info
[0m15:17:39.463200 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.dim_vehicle
[0m15:17:39.466202 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.dim_vehicle"
[0m15:17:39.467198 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.dim_vehicle"
[0m15:17:39.467198 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.dim_vehicle"} */
create or replace transient table DOOR2DOOR_DWH.DBT_dwh.dim_vehicle  as
        (

with vehicles as (
    SELECT
        DISTINCT data_id
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed
    WHERE lower(event_on) = 'vehicle'
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    data_id as vehicle_source_id
FROM vehicles
        );
[0m15:17:39.468199 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:17:40.321497 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.85 seconds
[0m15:17:40.324524 [debug] [Thread-1  ]: finished collecting timing info
[0m15:17:40.324524 [debug] [Thread-1  ]: On model.door2door_dwh.dim_vehicle: Close
[0m15:17:40.453793 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7c5bf9f3-300e-479b-8cd6-9b46feb1e3de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001792B8479D0>]}
[0m15:17:40.454787 [info ] [Thread-1  ]: 3 of 7 OK created sql table model DBT_dwh.dim_vehicle .......................... [[32mSUCCESS 1[0m in 1.00s]
[0m15:17:40.456114 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.dim_vehicle
[0m15:17:40.456114 [debug] [Thread-1  ]: Began running node model.door2door_dwh.registration_events_grouped
[0m15:17:40.457127 [info ] [Thread-1  ]: 4 of 7 START sql incremental model DBT_stg.registration_events_grouped ......... [RUN]
[0m15:17:40.458139 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:17:40.458139 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.registration_events_grouped
[0m15:17:40.459126 [debug] [Thread-1  ]: Compiling model.door2door_dwh.registration_events_grouped
[0m15:17:40.467142 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.registration_events_grouped"
[0m15:17:40.468168 [debug] [Thread-1  ]: finished collecting timing info
[0m15:17:40.468168 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.registration_events_grouped
[0m15:17:40.474157 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:17:40.474157 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
create or replace  view DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp
  
   as (
    

--- ASSUMPTION - REG and DREG events are ordered

with new_events as (
    SELECT
        data_id,
        event,
        event_at,
        LEAD(event_at) OVER (PARTITION BY data_id ORDER BY event_at) as next_event_at
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed e
    WHERE lower(event) in ('register', 'deregister')
        -- AND event_at <= '2019-06-01 18:17:04.089'

    
        and event_at > (select max(register_event_at) from DOOR2DOOR_DWH.DBT_stg.registration_events_grouped)
    
)
,new_registers as (
    SELECT
        data_id,
        event_at as register_event_at,
        next_event_at as deregister_event_at,
        
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _unique_key
    FROM new_events
    WHERE lower(event) = 'register'
)



    ,new_deregisters as (
        SELECT
            d.data_id,
            d.event_at
        FROM new_events d
        LEFT JOIN new_registers r
            ON d.data_id = r.data_id AND d.event_at = r.deregister_event_at
        WHERE 
            lower(d.event) = 'deregister'
            AND r.deregister_event_at IS NULL
    )
    ,updated_existing_registers as (
        SELECT
            r.data_id,
            r.register_event_at,
            d.event_at as deregister_event_at,
            r._unique_key
        FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
        LEFT JOIN new_deregisters d ON
            r.data_id = d.data_id   
        WHERE r.deregister_event_at IS NULL
    )

    SELECT * FROM updated_existing_registers
    UNION ALL



SELECT * FROM new_registers
  );
[0m15:17:40.475164 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:17:41.075025 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.6 seconds
[0m15:17:41.078021 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:17:41.078021 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
describe table DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp
[0m15:17:41.174038 [debug] [Thread-1  ]: SQL status: SUCCESS 4 in 0.1 seconds
[0m15:17:41.178031 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:17:41.179031 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
describe table DOOR2DOOR_DWH.DBT_stg.registration_events_grouped
[0m15:17:41.272496 [debug] [Thread-1  ]: SQL status: SUCCESS 4 in 0.09 seconds
[0m15:17:41.276492 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:17:41.276492 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
describe table "DOOR2DOOR_DWH"."DBT_STG"."REGISTRATION_EVENTS_GROUPED"
[0m15:17:41.362626 [debug] [Thread-1  ]: SQL status: SUCCESS 4 in 0.09 seconds
[0m15:17:41.379652 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.registration_events_grouped"
[0m15:17:41.381627 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:17:41.381627 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
BEGIN
[0m15:17:41.487508 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.11 seconds
[0m15:17:41.488510 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:17:41.488510 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
merge into DOOR2DOOR_DWH.DBT_stg.registration_events_grouped as DBT_INTERNAL_DEST
        using DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp as DBT_INTERNAL_SOURCE
        on 
                DBT_INTERNAL_SOURCE._unique_key = DBT_INTERNAL_DEST._unique_key
            

    
    when matched then update set
        "DATA_ID" = DBT_INTERNAL_SOURCE."DATA_ID","REGISTER_EVENT_AT" = DBT_INTERNAL_SOURCE."REGISTER_EVENT_AT","DEREGISTER_EVENT_AT" = DBT_INTERNAL_SOURCE."DEREGISTER_EVENT_AT","_UNIQUE_KEY" = DBT_INTERNAL_SOURCE."_UNIQUE_KEY"
    

    when not matched then insert
        ("DATA_ID", "REGISTER_EVENT_AT", "DEREGISTER_EVENT_AT", "_UNIQUE_KEY")
    values
        ("DATA_ID", "REGISTER_EVENT_AT", "DEREGISTER_EVENT_AT", "_UNIQUE_KEY")

;
[0m15:17:41.880775 [debug] [Thread-1  ]: SQL status: SUCCESS 0 in 0.39 seconds
[0m15:17:41.881820 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:17:41.881820 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
COMMIT
[0m15:17:42.101402 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.22 seconds
[0m15:17:42.105400 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.registration_events_grouped"
[0m15:17:42.105400 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.registration_events_grouped"} */
drop view if exists DOOR2DOOR_DWH.DBT_stg.registration_events_grouped__dbt_tmp cascade
[0m15:17:42.294300 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.19 seconds
[0m15:17:42.296277 [debug] [Thread-1  ]: finished collecting timing info
[0m15:17:42.297294 [debug] [Thread-1  ]: On model.door2door_dwh.registration_events_grouped: Close
[0m15:17:42.428386 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7c5bf9f3-300e-479b-8cd6-9b46feb1e3de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001792B795A90>]}
[0m15:17:42.428386 [info ] [Thread-1  ]: 4 of 7 OK created sql incremental model DBT_stg.registration_events_grouped .... [[32mSUCCESS 0[0m in 1.97s]
[0m15:17:42.430325 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.registration_events_grouped
[0m15:17:42.431354 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_deregistration
[0m15:17:42.432335 [info ] [Thread-1  ]: 5 of 7 START sql incremental model DBT_dwh.fact_deregistration ................. [RUN]
[0m15:17:42.433335 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:17:42.433335 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_deregistration
[0m15:17:42.433335 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_deregistration
[0m15:17:42.440363 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_deregistration"
[0m15:17:42.441364 [debug] [Thread-1  ]: finished collecting timing info
[0m15:17:42.442339 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_deregistration
[0m15:17:42.446364 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:17:42.446364 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
create or replace  view DOOR2DOOR_DWH.DBT_dwh.fact_deregistration__dbt_tmp
  
   as (
    

with events as (
    SELECT
        r.data_id,
        r.deregister_event_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time AND op.operating_period_finish_time
    WHERE r.deregister_event_at IS NOT NULL

    
        and r.deregister_event_at > (select max(deregistration_time) from DOOR2DOOR_DWH.DBT_dwh.fact_deregistration)
    
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(deregister_event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as deregistration_key,
    operating_period_key,
    deregister_event_at as deregistration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
  );
[0m15:17:42.447363 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:17:43.237987 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.79 seconds
[0m15:17:43.240952 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:17:43.240952 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
describe table DOOR2DOOR_DWH.DBT_dwh.fact_deregistration__dbt_tmp
[0m15:17:43.332291 [debug] [Thread-1  ]: SQL status: SUCCESS 3 in 0.09 seconds
[0m15:17:43.335281 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:17:43.336281 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
describe table DOOR2DOOR_DWH.DBT_dwh.fact_deregistration
[0m15:17:43.434236 [debug] [Thread-1  ]: SQL status: SUCCESS 3 in 0.1 seconds
[0m15:17:43.437230 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:17:43.438249 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
describe table "DOOR2DOOR_DWH"."DBT_DWH"."FACT_DEREGISTRATION"
[0m15:17:43.526302 [debug] [Thread-1  ]: SQL status: SUCCESS 3 in 0.09 seconds
[0m15:17:43.529301 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_deregistration"
[0m15:17:43.530305 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:17:43.531303 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
BEGIN
[0m15:17:43.640163 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.11 seconds
[0m15:17:43.640163 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:17:43.641159 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
insert into DOOR2DOOR_DWH.DBT_dwh.fact_deregistration ("DEREGISTRATION_KEY", "OPERATING_PERIOD_KEY", "DEREGISTRATION_TIME")
        (
            select "DEREGISTRATION_KEY", "OPERATING_PERIOD_KEY", "DEREGISTRATION_TIME"
            from DOOR2DOOR_DWH.DBT_dwh.fact_deregistration__dbt_tmp
        );
[0m15:17:44.203144 [debug] [Thread-1  ]: SQL status: SUCCESS 0 in 0.56 seconds
[0m15:17:44.203144 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:17:44.204139 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
COMMIT
[0m15:17:44.427697 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.22 seconds
[0m15:17:44.432697 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_deregistration"
[0m15:17:44.432697 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_deregistration"} */
drop view if exists DOOR2DOOR_DWH.DBT_dwh.fact_deregistration__dbt_tmp cascade
[0m15:17:44.562755 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.13 seconds
[0m15:17:44.565723 [debug] [Thread-1  ]: finished collecting timing info
[0m15:17:44.566735 [debug] [Thread-1  ]: On model.door2door_dwh.fact_deregistration: Close
[0m15:17:44.701523 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7c5bf9f3-300e-479b-8cd6-9b46feb1e3de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001792B6419A0>]}
[0m15:17:44.702523 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model DBT_dwh.fact_deregistration ............ [[32mSUCCESS 0[0m in 2.27s]
[0m15:17:44.703518 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_deregistration
[0m15:17:44.704557 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_registration
[0m15:17:44.704557 [info ] [Thread-1  ]: 6 of 7 START sql incremental model DBT_dwh.fact_registration ................... [RUN]
[0m15:17:44.706528 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_registration"
[0m15:17:44.706528 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_registration
[0m15:17:44.707533 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_registration
[0m15:17:44.713527 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_registration"
[0m15:17:44.713527 [debug] [Thread-1  ]: finished collecting timing info
[0m15:17:44.714527 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_registration
[0m15:17:44.718527 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:17:44.719526 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
create or replace  view DOOR2DOOR_DWH.DBT_dwh.fact_registration__dbt_tmp
  
   as (
    


with events as (
    SELECT
        r.data_id,
        r.register_event_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
    LEFT JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE 1=1

    
        and r.register_event_at > (select max(registration_time) from DOOR2DOOR_DWH.DBT_dwh.fact_registration)
    
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(register_event_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as registration_key,
    operating_period_key,
    register_event_at as registration_time
FROM events

-- ASSUMPTION: Operation periods are not overlaping
-- QUESTION:   Difference between event_on and data_location_at
  );
[0m15:17:44.719526 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:17:45.410430 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.69 seconds
[0m15:17:45.413423 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:17:45.413423 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
describe table DOOR2DOOR_DWH.DBT_dwh.fact_registration__dbt_tmp
[0m15:17:45.504272 [debug] [Thread-1  ]: SQL status: SUCCESS 3 in 0.09 seconds
[0m15:17:45.508296 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:17:45.508296 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
describe table DOOR2DOOR_DWH.DBT_dwh.fact_registration
[0m15:17:45.620561 [debug] [Thread-1  ]: SQL status: SUCCESS 3 in 0.11 seconds
[0m15:17:45.623557 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:17:45.624528 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
describe table "DOOR2DOOR_DWH"."DBT_DWH"."FACT_REGISTRATION"
[0m15:17:45.718416 [debug] [Thread-1  ]: SQL status: SUCCESS 3 in 0.09 seconds
[0m15:17:45.721411 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_registration"
[0m15:17:45.722392 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:17:45.722392 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
BEGIN
[0m15:17:45.817523 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.09 seconds
[0m15:17:45.818566 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:17:45.818566 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
insert into DOOR2DOOR_DWH.DBT_dwh.fact_registration ("REGISTRATION_KEY", "OPERATING_PERIOD_KEY", "REGISTRATION_TIME")
        (
            select "REGISTRATION_KEY", "OPERATING_PERIOD_KEY", "REGISTRATION_TIME"
            from DOOR2DOOR_DWH.DBT_dwh.fact_registration__dbt_tmp
        );
[0m15:17:46.361291 [debug] [Thread-1  ]: SQL status: SUCCESS 0 in 0.54 seconds
[0m15:17:46.362321 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:17:46.362321 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
COMMIT
[0m15:17:46.622346 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.26 seconds
[0m15:17:46.626341 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_registration"
[0m15:17:46.627341 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_registration"} */
drop view if exists DOOR2DOOR_DWH.DBT_dwh.fact_registration__dbt_tmp cascade
[0m15:17:46.740396 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.11 seconds
[0m15:17:46.742391 [debug] [Thread-1  ]: finished collecting timing info
[0m15:17:46.743392 [debug] [Thread-1  ]: On model.door2door_dwh.fact_registration: Close
[0m15:17:46.868097 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7c5bf9f3-300e-479b-8cd6-9b46feb1e3de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001792B7953D0>]}
[0m15:17:46.869098 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model DBT_dwh.fact_registration .............. [[32mSUCCESS 0[0m in 2.16s]
[0m15:17:46.870213 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_registration
[0m15:17:46.870213 [debug] [Thread-1  ]: Began running node model.door2door_dwh.fact_vehicle_location
[0m15:17:46.871252 [info ] [Thread-1  ]: 7 of 7 START sql incremental model DBT_dwh.fact_vehicle_location ............... [RUN]
[0m15:17:46.872241 [debug] [Thread-1  ]: Acquiring new snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:17:46.872241 [debug] [Thread-1  ]: Began compiling node model.door2door_dwh.fact_vehicle_location
[0m15:17:46.873253 [debug] [Thread-1  ]: Compiling model.door2door_dwh.fact_vehicle_location
[0m15:17:46.881251 [debug] [Thread-1  ]: Writing injected SQL for node "model.door2door_dwh.fact_vehicle_location"
[0m15:17:46.882253 [debug] [Thread-1  ]: finished collecting timing info
[0m15:17:46.882253 [debug] [Thread-1  ]: Began executing node model.door2door_dwh.fact_vehicle_location
[0m15:17:46.888221 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:17:46.888221 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
create or replace  view DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location__dbt_tmp
  
   as (
    

with locations as (
    SELECT
        e.event_at,
        e.data_id,
        e.data_location_lat,
        e.data_location_lng,
        e.data_location_at,
        op.operating_period_key
    FROM DOOR2DOOR_DWH.DBT_stg.vehicle_iot_data_parsed e
    INNER JOIN DOOR2DOOR_DWH.DBT_stg.registration_events_grouped r
        ON e.data_id = r.data_id AND e.data_location_at BETWEEN r.register_event_at and COALESCE(r.deregister_event_at, CURRENT_TIMESTAMP())
    INNER JOIN DOOR2DOOR_DWH.DBT_dwh.dim_operating_period op
        ON r.register_event_at BETWEEN op.operating_period_start_time and op.operating_period_finish_time
    WHERE lower(event) = 'update'

    
        and data_location_at > (select max(vehicle_location_time) from DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location)
    
)
SELECT
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_lat as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_lng as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(data_location_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_location_key,
    
    
md5(cast(coalesce(cast(data_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as vehicle_key,
    operating_period_key,
    data_location_lat as vehicle_location_lat,
    data_location_lng as vehicle_location_lng,
    data_location_at as vehicle_location_time
FROM locations


--- ASSUMPTION Events are recorded only if vehicle is registered to a operation period
  );
[0m15:17:46.889220 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:17:47.443656 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.55 seconds
[0m15:17:47.446652 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:17:47.446652 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
describe table DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location__dbt_tmp
[0m15:17:47.535422 [debug] [Thread-1  ]: SQL status: SUCCESS 6 in 0.09 seconds
[0m15:17:47.540402 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:17:47.540402 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
describe table DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location
[0m15:17:47.626562 [debug] [Thread-1  ]: SQL status: SUCCESS 6 in 0.09 seconds
[0m15:17:47.630601 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:17:47.630601 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
describe table "DOOR2DOOR_DWH"."DBT_DWH"."FACT_VEHICLE_LOCATION"
[0m15:17:47.723928 [debug] [Thread-1  ]: SQL status: SUCCESS 6 in 0.09 seconds
[0m15:17:47.726895 [debug] [Thread-1  ]: Writing runtime sql for node "model.door2door_dwh.fact_vehicle_location"
[0m15:17:47.727895 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:17:47.727895 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
BEGIN
[0m15:17:47.839435 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.11 seconds
[0m15:17:47.840460 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:17:47.840460 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
insert into DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location ("VEHICLE_LOCATION_KEY", "VEHICLE_KEY", "OPERATING_PERIOD_KEY", "VEHICLE_LOCATION_LAT", "VEHICLE_LOCATION_LNG", "VEHICLE_LOCATION_TIME")
        (
            select "VEHICLE_LOCATION_KEY", "VEHICLE_KEY", "OPERATING_PERIOD_KEY", "VEHICLE_LOCATION_LAT", "VEHICLE_LOCATION_LNG", "VEHICLE_LOCATION_TIME"
            from DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location__dbt_tmp
        );
[0m15:17:48.466493 [debug] [Thread-1  ]: SQL status: SUCCESS 0 in 0.63 seconds
[0m15:17:48.466493 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:17:48.466493 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
COMMIT
[0m15:17:48.729557 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.26 seconds
[0m15:17:48.733551 [debug] [Thread-1  ]: Using snowflake connection "model.door2door_dwh.fact_vehicle_location"
[0m15:17:48.733551 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: /* {"app": "dbt", "dbt_version": "1.3.1", "profile_name": "door2door_dwh", "target_name": "dev", "node_id": "model.door2door_dwh.fact_vehicle_location"} */
drop view if exists DOOR2DOOR_DWH.DBT_dwh.fact_vehicle_location__dbt_tmp cascade
[0m15:17:48.857085 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.12 seconds
[0m15:17:48.859080 [debug] [Thread-1  ]: finished collecting timing info
[0m15:17:48.860087 [debug] [Thread-1  ]: On model.door2door_dwh.fact_vehicle_location: Close
[0m15:17:48.982887 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7c5bf9f3-300e-479b-8cd6-9b46feb1e3de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001792B8D7460>]}
[0m15:17:48.983888 [info ] [Thread-1  ]: 7 of 7 OK created sql incremental model DBT_dwh.fact_vehicle_location .......... [[32mSUCCESS 0[0m in 2.11s]
[0m15:17:48.984727 [debug] [Thread-1  ]: Finished running node model.door2door_dwh.fact_vehicle_location
[0m15:17:48.986754 [debug] [MainThread]: Acquiring new snowflake connection "master"
[0m15:17:48.987779 [info ] [MainThread]: 
[0m15:17:48.988754 [info ] [MainThread]: Finished running 5 incremental models, 2 table models in 0 hours 0 minutes and 18.76 seconds (18.76s).
[0m15:17:48.989768 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:17:48.989768 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH' was properly closed.
[0m15:17:48.989768 [debug] [MainThread]: Connection 'list_DOOR2DOOR_DWH_DBT_stg' was properly closed.
[0m15:17:48.990788 [debug] [MainThread]: Connection 'model.door2door_dwh.fact_vehicle_location' was properly closed.
[0m15:17:48.999752 [info ] [MainThread]: 
[0m15:17:49.000751 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:17:49.002749 [info ] [MainThread]: 
[0m15:17:49.002749 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m15:17:49.003749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001792B38E970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001792B38E4F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001792B794FA0>]}
[0m15:17:49.004749 [debug] [MainThread]: Flushing usage events
